# LONDON_BREAKOUT_ANALYSIS_WORKFLOW_EMBEDDED

# PURPOSE
Define deterministic, rule-driven workflow for analysing and validating the London Breakout strategy.  
Applies session, volatility, structure, regime, liquidity, enrichment, and timing constraints.  
No breakout analysis is allowed unless all validation layers pass.

# STRATEGY_TYPE_MAPPING
**Critical**: "London Breakout" is a workflow/analysis method, not a StrategyType enum value.
When creating auto-execution plans for London Breakout setups:
- **Workflow**: Follow this document (LONDON_BREAKOUT_ANALYSIS_WORKFLOW_EMBEDDING.md) for validation
- **Strategy Type**: Use `strategy_type: "breakout_ib_volatility_trap"` in the plan
- **Reasoning**: London Breakout is a specific application of the Inside Bar Volatility Trap strategy
The workflow determines if the setup is valid, but the enum value used in the plan is `breakout_ib_volatility_trap`.

# WORKFLOW_SEQUENCE
sequence:
  - fetch_price (tool: moneybot.getCurrentPrice)
  - analyze_symbol (tool: moneybot.analyse_symbol_full)
  - detect_session
  - apply_news_filter
  - classify_market_regime
  - select_strategy
  - validate_asian_range
  - validate_volatility
  - validate_structure
  - validate_liquidity
  - evaluate_sweep_displacement
  - run_validation_layer
  - if_all_pass: breakout_analysis_allowed
  - else: breakout_invalid_or_alternative_strategy

# TOOL_USAGE_REQUIREMENTS
required_tools:
  - moneybot.getCurrentPrice (before any analysis)
  - moneybot.analyse_symbol_full (for comprehensive market analysis)
  - moneybot.create_auto_trade_plan (for creating breakout plans with strategy_type: "breakout_ib_volatility_trap")

tool_examples:
  price_fetch: moneybot.getCurrentPrice(symbol: "XAUUSD")
  analysis: moneybot.analyse_symbol_full(symbol: "XAUUSD")
  plan_creation: moneybot.create_auto_trade_plan(symbol: "XAUUSD", direction: "BUY", entry: 2650, stop_loss: 2630, take_profit: 2690, strategy_type: "breakout_ib_volatility_trap", conditions: {...})

# SESSION_RULES
session_valid:
  - london_session_only (07:00–10:00 UTC)
primary_window: 07:00–07:30 UTC
secondary_window: 07:30–08:15 UTC
allowed_if_displacement_clean: 08:15–10:00 UTC
session_invalid_when:
  - <07:00 UTC
  - >10:00 UTC
  - breakout_occurs_too_late
  - no_displacement_by_08:15 UTC

# NEWS_FILTER
news_invalid:
  - high_impact_news_±30m
news_valid:
  - no_high_impact_news

# MARKET_REGIME
# Reference: AUTO_EXECUTION_CHATGPT_KNOWLEDGE_EMBEDDED.md for master regime list
valid_regimes:
  - trending
  - ranging (ranging_expansion is variant)
  - compression (compression_expansion is variant)
  - expansion
  - reversal
invalid_regimes:
  - chop
  - volatility_shock
  - exhaustion (trend_exhaustion is variant)
regime_required: true

# STRATEGY_SELECTION
select_london_breakout_when:
  - asian_range_clean
  - volatility_supportive
  - structure_not_conflicting
  - liquidity_positioning_valid
  - session_valid
fallback_strategies:
  - range_scalp
  - sweep_reversion
  - volatility_trap
  - trend_continuation_non_breakout

# ASIAN_RANGE_VALIDATION
asian_range_valid_when:
  - asian_high_intact
  - asian_low_intact
  - no_pre_london_breakout
  - formed_before_06_30
  - range_clean (no_messy_liquidity)
asian_range_invalid_when:
  - wide_unstable_range
  - early_breakout_occurs
  - no_clear_high_low
  - htf_rejection_at_boundary
  - pre_london_trend_exhaustion

# VOLATILITY_GATE
volatility_valid_when:
  - atr_rising_or_stable
  - spread_within_limits
  - normal_pre_london_volatility
  - no_erratic_spikes
volatility_invalid_when:
  - atr_collapsing
  - volatility_shock_pre_london
  - spread_widening
  - no_expansion_energy

volatility_structure_conflict_invalid:
  - structure_breakout_but_volatility_collapsing
  - volatility_expansion_but_structure_absorption

# STRUCTURE_VALIDATION
structure_valid_when:
  - htf_bias_not_conflicting
  - no_recent_opposite_CHOCH (3–5 candles)
  - liquidity_beyond_asian_levels_identifiable
  - no_htf_absorption_at_boundary
structure_invalid_when:
  - htf_trend_opposite
  - opposite_CHOCH_present
  - displacement_missing_after_sweep
  - liquidity_destination_not_clear

# LIQUIDITY_VALIDATION
liquidity_valid_when:
  - asian_liquidity_intact
  - clean_high_low_edges
  - clear_downstream_liquidity_target
liquidity_invalid_when:
  - messy_liquidity
  - overlapping_reversal_zones
  - no_clear_target_beyond_breakout

# SWEEP_DISPLACEMENT_VALIDATION
sweep_breakout_valid_when:
  - sweep_of_asian_high_or_low
  - displacement_in_opposite_direction
  - retest_of_displacement_origin
sweep_breakout_invalid_when:
  - sweep_without_displacement
  - sweep_into_htf_rejection
  - failed_retest

# VALIDATION_LAYER (MUST PASS ALL)
validation_layer:
  regime_valid: true
  strategy_selected_london_breakout: true
  asian_range_valid: true
  volatility_valid: true
  structure_valid: true
  liquidity_valid: true
  session_valid: true
  news_filter_passed: true
all_must_be_true: true

# EXECUTION_TIMING_LOGIC
entry_valid_when:
  - breakout_during_displacement
  - sweep_retest_clean
  - first_clean_expansion_leg
entry_invalid_when:
  - mid_range_entry
  - late_breakout_without_retest
  - consolidation_stall_at_breakout_level
  - >60m_after_london_open_with_no_displacement

# ENRICHMENT_INTEGRATION
increase_confidence_when:
  - volatility_expansion
  - momentum_alignment
  - micro_alignment_supports_direction (btc/xau/eurusd)
  - confirming_divergence
  - breakout_engulfing_candle
  - bb_contraction_preceding_expansion

decrease_confidence_when:
  - volatility_instability
  - spread_widening
  - divergence_opposing_direction
  - conflicting_micro_alignment
  - momentum_exhaustion

# BREAKOUT_INVALIDATION
breakout_invalid_when:
  - opposite_CHOCH_htf
  - failed_displacement
  - sweep_without_followthrough
  - volatility_collapse
  - htf_rejection_at_breakout
  - news_event_disruption

# OUTPUT_CONSTRAINTS
output_rules:
  - no_predictions
  - no_assumed_levels_without_tools
  - no_plan_without_full_validation
  - fresh_price_required_before_logic
  - must_apply_news_filter
  - must_apply_session_filter
  - must_offer_alternative_strategy_if_invalid

# END_OF_DOCUMENT
