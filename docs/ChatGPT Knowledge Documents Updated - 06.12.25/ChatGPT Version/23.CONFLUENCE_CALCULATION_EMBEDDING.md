# CONFLUENCE_CALCULATION_EMBEDDING

# PURPOSE
Comprehensive guide to confluence score calculation system with symbol-specific logic.

# SCOPE
- Confluence score calculation (0-100)
- Symbol-specific logic (BTC vs XAU)
- Factor breakdown and interpretation
- Timeframe-specific calculations (M1, M5, M15, H1)
- Usage in analysis and trade planning

---

# SYMBOL_SPECIFIC_LOGIC

## BTCUSDc (Bitcoin)

volatility_assessment:
  method: volatility_regime (STABLE/TRANSITIONAL/VOLATILE)
  detection_method: RegimeDetector (accurate_multi_timeframe_analysis)
  fallback: lightweight_method_if_RegimeDetector_unavailable
  not_session_based: true
  regime_mapping:
    STABLE: 80_points (normal_trading_conditions)
    TRANSITIONAL: 75_points (moderate_volatility)
    VOLATILE: 85_points (high_volatility_can_be_profitable_for_BTC)
  RegimeDetector_analysis:
    - analyzes_ATR_ratios_across_M5_M15_H1
    - analyzes_Bollinger_Band_width
    - analyzes_ADX_trend_strength
    - analyzes_volume_patterns
    - provides_confidence_score_0_to_100

atr_percent_thresholds:
  optimal_range: 1.0_percent_to_4.0_percent (scores_100)
  acceptable_range: 0.8_percent_to_5.0_percent (scores_60_to_100)
  too_low: less_than_0.8_percent (scores_less_than_60)
  too_high: greater_than_5.0_percent (scores_less_than_60)

why_different: BTC_is_event_driven_naturally_more_volatile_higher_ATR_percent_is_normal

## XAUUSDc (Gold)

volatility_assessment:
  method: session_based_volatility_tier (LOW/NORMAL/HIGH/VERY_HIGH)
  not_regime_based: true
  tier_mapping:
    LOW: 60_points
    NORMAL: 80_points
    HIGH: 90_points
    VERY_HIGH: 95_points

atr_percent_thresholds:
  optimal_range: 0.4_percent_to_1.5_percent (scores_100)
  acceptable_range: 0.3_percent_to_2.0_percent (scores_60_to_100)
  too_low: less_than_0.3_percent (scores_less_than_60)
  too_high: greater_than_2.0_percent (scores_less_than_70)

why_different: XAU_is_session_driven_lower_ATR_percent_is_normal_during_calm_sessions

## Other Symbols (EURUSDc, etc.)

volatility_assessment:
  method: session_based_volatility_tier (same_as_XAU)

atr_percent_thresholds:
  optimal_range: 0.5_percent_to_2.0_percent (scores_100)
  acceptable_range: 0.3_percent_to_3.0_percent (scores_60_to_100)

---

# FACTOR_BREAKDOWN

## M1 Timeframe (Microstructure Analysis)

calculation_method: microstructure_analysis_not_standard_technical_indicators

factors:
  m1_signal_confidence:
    range: 0_to_100
    description: CHOCH_BOS_detection_quality
    weight: 30_percent

  momentum_quality:
    range: 0_to_100
    description: momentum_strength_and_direction
    weight: 25_percent

  session_volatility_suitability:
    range: 0_to_100
    BTC: based_on_volatility_regime (STABLE=80_TRANSITIONAL=75_VOLATILE=85)
    XAU_others: based_on_session_volatility_tier (LOW=60_NORMAL=80_HIGH=90_VERY_HIGH=95)
    weight: 20_percent

  liquidity_proximity:
    range: 0_to_100
    description: distance_to_PDH_PDL_equal_highs_lows
    weight: 15_percent

  strategy_fit:
    range: 0_to_100
    description: alignment_with_recommended_strategy
    weight: 10_percent

## M5, M15, H1 Timeframes (Standard Technical Analysis)

calculation_method: traditional_technical_indicators

factors:
  trend_alignment:
    range: 0_to_100
    description: EMA_alignment_20_50_200
    weight: 30_percent

  momentum_alignment:
    range: 0_to_100
    description: RSI_and_MACD_confirmation
    weight: 25_percent

  support_resistance:
    range: 0_to_100
    description: proximity_to_key_levels
    weight: 25_percent

  volume_confirmation:
    range: 0_to_100
    description: volume_analysis (neutral_60)
    weight: 10_percent

  volatility_health:
    range: 0_to_100
    description: ATR_percent_assessment_symbol_specific_thresholds
    weight: 10_percent

## Tick Microstructure Factors (When Available) NEW

When tick_metrics is available in response.data, the confluence calculation
REBALANCES weights to incorporate tick-derived factors:

factors_when_tick_metrics_available:
  tick_volatility_alignment:
    range: 0_to_100
    description: realized_volatility vs strategy requirements
    calculation:
      - volatility_ratio in optimal range for strategy -> 100
      - volatility_ratio acceptable -> 70
      - volatility_ratio misaligned -> 40
    weight: 5_percent

  tick_flow_confirmation:
    range: 0_to_100
    description: cvd_slope + delta alignment with structure
    calculation:
      - cvd_slope + structure aligned -> 100
      - cvd_slope neutral -> 70
      - cvd_slope contradicts structure -> 30
    weight: 10_percent

  absorption_risk_penalty:
    range: 0_to_100
    description: inverse of absorption zone risk
    calculation:
      - absorption.count == 0 -> 100
      - absorption.count 1-2 -> 70
      - absorption.count >= 3 -> 40
      - absorption near entry price -> 20
    weight: 5_percent

weight_rebalancing:
  when_tick_metrics_available:
    - Reduce trend_alignment from 30% to 25%
    - Reduce momentum_alignment from 25% to 20%
    - Reduce support_resistance from 25% to 20%
    - Reduce volatility_health from 10% to 5%
    - Add tick factors (5% + 10% + 5% = 20%)
    - Total remains 100%
  when_tick_metrics_unavailable:
    - Use original weights (no tick factors)

---

# SCORE_INTERPRETATION

score_ranges:
  grade_A: 90_to_100 (excellent_setup_high_probability)
  grade_B: 80_to_89 (good_setup_solid_probability)
  grade_C: 70_to_79 (acceptable_setup_moderate_probability)
  grade_D: 60_to_69 (weak_setup_low_probability)
  grade_F: less_than_60 (poor_setup_avoid)

symbol_specific_interpretation:
  BTCUSDc:
    - scores_may_be_higher_due_to_regime_based_volatility_assessment
    - ATR_percent_2.5_percent_is_normal_and_scores_100 (not_penalized)
    - VOLATILE_regime_scores_higher_85_than_STABLE_80_for_volatility_suitability
    - consider_volatility_regime_when_explaining_setups

  XAUUSDc:
    - scores_use_session_based_volatility_assessment
    - ATR_percent_0.8_percent_is_optimal_and_scores_100
    - ATR_percent_2.0_percent_is_too_high_and_scores_less_than_70
    - consider_session_context_when_explaining_setups

---

# USAGE_IN_ANALYSIS

when_analyzing_trades:
  - check_confluence_score_for_relevant_timeframes_M1_M5_M15_H1
  - understand_BTC_scores_may_be_higher_due_to_regime_based_assessment
  - interpret_ATR_percent_in_context_of_symbol (2.5_percent_ATR_is_normal_for_BTC_not_for_XAU)
  - consider_volatility_regime_when_explaining_BTC_setups
  - use_session_context_for_XAU_regime_context_for_BTC

response_template:
  format: |
    ðŸ“Š Confluence Analysis: {symbol} {timeframe}
    Score: {score}/100 (Grade: {grade})
    Breakdown:
    - Trend Alignment: {trend_score}/100 {explanation}
    - Momentum: {momentum_score}/100 {explanation}
    - Support/Resistance: {sr_score}/100 {explanation}
    - Volume: {volume_score}/100 {explanation}
    - Volatility Health: {volatility_score}/100 {explanation}
      {symbol_specific_note_ATR_percent_interpretation}

example_BTC:
  scenario: BTCUSDc_M5_ATR_percent_3.5_percent
  interpretation: ATR_percent_3.5_percent_is_within_optimal_range_1.0_to_4.0_percent_for_BTC
  volatility_health_factor_scores: 100
  response: "BTCUSDc M5 confluence: 82/100 (Grade B). Volatility Health: 100/100 - ATR% of 3.5% is optimal for BTC (within 1.0%-4.0% range). This is normal volatility for Bitcoin and not a concern."

example_XAU:
  scenario: XAUUSDc_M5_ATR_percent_2.0_percent
  interpretation: ATR_percent_2.0_percent_is_at_high_boundary_2.0_percent_for_XAU
  volatility_health_factor_scores: 70 (slightly_high)
  response: "XAUUSDc M5 confluence: 72/100 (Grade C). Volatility Health: 70/100 - ATR% of 2.0% is at the high boundary for XAU (optimal range is 0.4%-1.5%). This indicates elevated volatility, which may increase risk."

example_BTC_volatility_regime:
  scenario: BTCUSDc_M1_VOLATILE_regime_detected
  interpretation: VOLATILE_regime_scores_85_for_volatility_suitability (higher_than_STABLE_80)
  response: "BTCUSDc M1 confluence: 87/100 (Grade A). Volatility Suitability: 85/100 - VOLATILE regime detected. For BTC, high volatility can be profitable, so this regime actually scores higher (85) than STABLE (80). This is a positive signal for BTC trading."

---

# AUTO_EXECUTION_PLAN_THRESHOLDS

minimum_confluence_thresholds:
  BTCUSDc:
    minimum: 70 (grade_C)
    recommended: 80_plus (grade_B)
    ideal: 85_plus (grade_A)

  XAUUSDc:
    minimum: 75 (grade_C_plus)
    recommended: 80_plus (grade_B)
    ideal: 85_plus (grade_A)

  other_symbols:
    minimum: 75 (grade_C_plus)
    recommended: 80_plus (grade_B)

condition_examples:
  BTC_example: |
    if confluence_score >= 80 and volatility_regime in ['STABLE', 'VOLATILE']:
      # Good setup for BTC

  XAU_example: |
    if confluence_score >= 80 and session_volatility_tier in ['NORMAL', 'HIGH']:
      # Good setup for XAU

---

# IMPORTANT_NOTES

do_not_assume:
  - same_ATR_percent_equals_same_score: 2.5_percent_ATR_scores_100_for_BTC_but_less_than_70_for_XAU
  - higher_volatility_equals_lower_score: for_BTC_VOLATILE_regime_scores_higher_85_than_STABLE_80
  - session_context_for_BTC: BTC_uses_regime_not_session_for_volatility_assessment
  - regime_context_for_XAU: XAU_uses_session_not_regime_for_volatility_assessment

always_consider:
  - symbol_type: BTC_vs_XAU_vs_others
  - timeframe: M1_microstructure_vs_M5_M15_H1_standard_TA
  - context: regime_BTC_vs_session_XAU
  - ATR_percent_interpretation: symbol_specific_thresholds

---

# SUMMARY

key_points:
  1. confluence_scores_are_symbol_specific: BTC_and_XAU_use_different_calculation_methods
  2. BTC_uses_volatility_regime: STABLE_TRANSITIONAL_VOLATILE_not_session_based
  3. XAU_uses_session_volatility: LOW_NORMAL_HIGH_VERY_HIGH_not_regime_based
  4. ATR_percent_thresholds_differ: BTC_optimal_is_1.0_to_4.0_percent_XAU_optimal_is_0.4_to_1.5_percent
  5. interpret_scores_in_context: consider_symbol_timeframe_and_volatility_assessment_method
  6. use_appropriate_thresholds: BTC_minimum_70_XAU_minimum_75_for_auto_execution_plans

