# AUTO_EXECUTION_CHATGPT_KNOWLEDGE_EMBEDDED

# PURPOSE
Provide deterministic domain trading knowledge used for:
- market regime detection  
- volatility and structure interpretation  
- liquidity modelling  
- strategy family selection  
- entry, invalidation, & SL/TP logic  
- session & news gating  
- symbol-specific behaviour  
- integration with Auto-Execution Plans  

This file contains ONLY rules.  
No prose. No examples. No narrative.  
All logic MUST follow the Professional Reasoning Layer (PRL).

---

# PROFESSIONAL_REASONING_LAYER_REQUIREMENT
PRL MUST RUN BEFORE ANY STRATEGY LOGIC:

1. fetch_price_required  
2. classify_market_regime  
3. select_strategy_family  
4. volatility_structure_conflict_check  
5. session_filter  
6. news_filter  
7. structure_and_liquidity_validation  
8. auto_execution_validation_layer  

If ANY PRL stage fails ‚Üí all strategy logic is bypassed.

---

# PRICE_REQUIREMENT
price_rules:
  - fresh_price_required_before_any_logic
  - ‚ö†Ô∏è CRITICAL: When using `moneybot.analyse_symbol_full`, current price is automatically included - DO NOT call `moneybot.getCurrentPrice` separately
  - tool: moneybot.getCurrentPrice (ONLY use if you need JUST price without full analysis)
  - parameters: `symbol` (string, required)
  - example: `moneybot.getCurrentPrice(symbol: "BTCUSD")`
  - no_cached_or_assumed_prices
  - structure_volatility_liquidity_logic_require_live_price
  - ‚ö†Ô∏è For general analysis: Use `moneybot.analyse_symbol_full` which includes price, session, news, MTF analysis, and all other data in one call

# ANALYSIS_TOOL_REQUIREMENT
analysis_tool:
  - tool: moneybot.analyse_symbol_full (MUST use for comprehensive analysis)
  - parameters: `symbol` (string, required)
  - returns: `response.summary` (formatted analysis) and `response.data` (structured data)
  - includes: Macro context, Complete Multi-Timeframe Analysis (H4/H1/M30/M15/M5), SMC structure, technical indicators, Binance enrichment, order flow, BTC order flow metrics (for BTCUSD), M1 microstructure, news data, **Enhanced Data Fields** ‚≠ê NEW (December 2025) - Correlation context, HTF levels, Session risk, Execution context, Strategy stats, Structure summary, Symbol constraints - **AUTOMATICALLY INCLUDED**! Check the "üìä ENHANCED DATA FIELDS ‚≠ê NEW" section in the analysis summary.
  - example: `moneybot.analyse_symbol_full(symbol: "BTCUSD")`
  - when: Before creating any auto-execution plan, must analyze symbol first
  - note: Includes complete MTF analysis - no need to call getMultiTimeframeAnalysis separately

# MULTI_TIMEFRAME_ANALYSIS_IN_ANALYSE_SYMBOL_FULL
mtf_analysis_structure:
  - location: response.data.smc
  - top_level_fields:
    - timeframes: {H4, H1, M30, M15, M5} - Per-timeframe analysis with CHOCH/BOS detection
    - alignment_score: Integer (0-100) - Multi-timeframe alignment score
    - recommendation: Overall trade recommendation with nested fields
    - market_bias: Market-wide bias assessment (convenience path)
    - trade_opportunities: Identified trade opportunities (convenience path)
    - volatility_regime: Current volatility regime (convenience path)
    - volatility_weights: Timeframe weights based on volatility (convenience path)
    - advanced_insights: Advanced technical insights (optional - may be empty)
    - advanced_summary: Formatted summary of advanced insights (optional - may be empty)
    - confidence_score: Recommendation confidence (0-100)
    - choch_detected: Boolean - CHOCH detected on any timeframe (calculated)
    - bos_detected: Boolean - BOS confirmed on any timeframe (calculated)
    - trend: String - Primary trend direction (extracted from H4 bias)
  - calculated_fields:
    - choch_detected: Aggregated from all timeframes (choch_detected, choch_bull, choch_bear)
    - bos_detected: Aggregated from all timeframes (bos_detected, bos_bull, bos_bear)
    - trend: Extracted from H4.bias (BULLISH/BEARISH/NEUTRAL/UNKNOWN)
  - field_access_paths:
    - convenience: response.data.smc.market_bias (recommended)
    - raw: response.data.smc.recommendation.market_bias (also valid)
    - note: market_bias, trade_opportunities, volatility_regime, volatility_weights are at TOP LEVEL of recommendation dict
  - optional_fields_handling:
    - advanced_insights: May be empty {} if advanced_features unavailable
    - advanced_summary: May be empty "" if advanced_features unavailable
    - critical: Always check if these fields exist and are not empty before accessing nested properties
  - tool_selection_rule: Use analyse_symbol_full for comprehensive analysis (includes MTF). Only use getMultiTimeframeAnalysis if you need ONLY MTF data without other analysis layers.

# BTC_ORDER_FLOW_METRICS_REQUIREMENT
btc_order_flow_required:
  - tool: moneybot.btc_order_flow_metrics (standalone) OR included in moneybot.analyse_symbol_full for BTCUSD
  - when: Creating auto-execution plans for BTCUSD
  - parameters: `symbol` (string, typically "BTCUSD")
  - includes: Delta Volume, CVD, CVD Slope, CVD Divergence, Absorption Zones, Buy/Sell Pressure
  - critical: Always check BTC order flow metrics before creating BTCUSD auto-execution plans
  - display_requirement: MUST display order flow metrics explicitly in analysis output (see BTCUSD_ANALYSIS_QUICK_REFERENCE_EMBEDDING.md for format)
  - ‚≠ê NEW: Order flow conditions can now be used in ALL BTC plans (not just order_block):
    - delta_positive: true - Wait for positive delta volume (buying pressure)
    - delta_negative: true - Wait for negative delta volume (selling pressure)
    - cvd_rising: true - Wait for CVD (Cumulative Volume Delta) to be rising
    - cvd_falling: true - Wait for CVD to be falling
    - cvd_div_bear: true or Cvd Div Bear: true - Wait for bearish CVD divergence (price up, CVD down - selling pressure increasing)
    - cvd_div_bull: true or Cvd Div Bull: true - Wait for bullish CVD divergence (price down, CVD up - buying pressure increasing)
    - delta_divergence_bull: true or Delta Divergence Bull: true - Wait for bullish delta divergence (price down, delta up - buying pressure increasing despite price drop)
    - delta_divergence_bear: true or Delta Divergence Bear: true - Wait for bearish delta divergence (price up, delta down - selling pressure increasing despite price rise)
    - avoid_absorption_zones: true - Block execution if entry price is in an absorption zone (use when you want to avoid zones)
    - absorption_zone_detected: true or Absorption Zone Detected: true - Wait for absorption zone to be detected at entry price (use when you WANT to enter at an absorption zone)
  - condition_usage:
    - These conditions work for ANY BTC plan type (not just order_block plans)
    - Example 1 (Basic): {"delta_positive": true, "cvd_rising": true, "price_near": 100000, "tolerance": 200}
    - Example 2 (Divergence): {"cvd_div_bear": true, "price_near": 100000, "tolerance": 200}
    - Example 3 (Absorption): {"absorption_zone_detected": true, "delta_positive": true, "price_near": 100000, "tolerance": 200}
    - Can combine multiple order flow conditions for stricter validation
  - signals:
    - Strong buy pressure (Delta > 0, CVD rising) ‚Üí Use delta_positive: true and cvd_rising: true
    - Strong sell pressure (Delta < 0, CVD falling) ‚Üí Use delta_negative: true and cvd_falling: true
    - CVD Divergence detected (bearish: price up, CVD down) ‚Üí Use cvd_div_bear: true for SELL plans
    - CVD Divergence detected (bullish: price down, CVD up) ‚Üí Use cvd_div_bull: true for BUY plans
    - Delta Divergence detected (bullish: price down, delta up) ‚Üí Use delta_divergence_bull: true for BUY plans (early reversal signal)
    - Delta Divergence detected (bearish: price up, delta down) ‚Üí Use delta_divergence_bear: true for SELL plans (early reversal signal)
    - Absorption zones near entry ‚Üí Use avoid_absorption_zones: true to block execution in zones, OR absorption_zone_detected: true to enter at zones

# MTF_ALIGNMENT_CONDITIONS ‚≠ê NEW (December 2025)
mtf_alignment_conditions:
  - concept: Multi-timeframe alignment conditions for better trend trades
  - conditions:
    - mtf_alignment_score: Integer (0-100, default 60) - Minimum multi-timeframe alignment score
      - Higher scores = better alignment across timeframes
      - Use for trend continuation strategies
      - Example: {"mtf_alignment_score": 70, "price_near": 100000, "tolerance": 200}
    - h4_bias: String ("BULLISH" | "BEARISH" | "NEUTRAL") - Require specific H4 bias
      - Use when H4 trend is critical for strategy
      - Example: {"h4_bias": "BULLISH", "price_near": 100000, "tolerance": 200}
    - h1_bias: String ("BULLISH" | "BEARISH" | "NEUTRAL") - Require specific H1 bias
      - Use when H1 trend is critical for strategy
      - Example: {"h1_bias": "BEARISH", "price_near": 100000, "tolerance": 200}
  - when_to_use:
    - Trend continuation strategies
    - Breakout strategies
    - Structure-based trades
    - When multi-timeframe confirmation is critical
  - implementation:
    - Uses cached MTF analysis (no API call during execution)
    - Data source: response.data.smc from moneybot.analyse_symbol_full
    - Alignment score calculated from H4/H1/M30/M15/M5 timeframe analysis

# SYSTEM_WIDE_VALIDATIONS ‚≠ê NEW (December 2025)
system_wide_validations:
  - concept: Automatic validations applied to ALL plans (ChatGPT should ensure plans meet these)
  - rr_ratio_validation:
    - minimum_rr: 1.5:1 (default, configurable via min_rr_ratio in conditions)
    - backwards_rr: System will REJECT plans where TP < SL
    - chatgpt_action: Always ensure TP distance >= 1.5x SL distance
    - example: If SL = 20 points, TP must be >= 30 points away from entry
    - configurable: Can specify "min_rr_ratio": 2.0 for stricter requirements
    - calculation: R:R = (TP distance) / (SL distance)
    - rejection_example: Entry: 4500, SL: 4480 (20 points), TP: 4510 (10 points) ‚Üí R:R = 0.5:1 (REJECTED)
  - session_blocking:
    - xau_default: require_active_session defaults True (blocks Asian session 00:00-08:00 UTC)
    - btc_optional: Can set require_active_session: true to block Asian session
    - asian_session_exceptions: Certain strategies ARE allowed during Asian session (strategy-aware blocking)
      - allowed_strategies: range_scalp, range_fade, mean_reversion, fvg_retracement, premium_discount_array, order_block_rejection (at range edges)
      - blocked_strategies: breakout, trend_continuation, trend_pullback (low probability in Asian session)
      - reason: Asian session is range-bound with low liquidity - range/mean reversion strategies work well
    - chatgpt_action:
      - For XAU plans: System automatically blocks Asian session for most strategies (low liquidity, high slippage)
      - Exception: Range/mean reversion strategies are automatically allowed in Asian session
      - To allow ALL strategies in Asian session: Explicitly set "require_active_session": false
      - For BTC plans: Include "require_active_session": true if you want to block Asian session (with same exceptions)
  - news_blackout:
    - system_behavior: Automatically blocks trades during high-impact news events
    - chatgpt_action: No action needed - system handles automatically
    - note: Plans will be blocked during news blackout windows
  - execution_quality:
    - system_behavior: Blocks trades if spread > 3x normal (XAU: 0.15%, BTC: 0.09%)
    - chatgpt_action: No action needed - system handles automatically
    - note: Wide spreads indicate poor execution quality - system will reject
  - plan_staleness:
    - system_behavior: Logs warning if entry price moved > 2x tolerance from current price
    - chatgpt_action: Ensure entry prices are still valid when creating plans
    - note: Non-blocking (warning only), but indicates plan may need updating
  - spread_slippage_cost:
    - system_behavior: Blocks trades if execution costs (spread + slippage) > 20% of R:R
    - chatgpt_action: Ensure R:R is sufficient to account for execution costs
    - example: If TP = 30 points, costs must be < 6 points (20% of 30)
  - atr_based_stops:
    - system_behavior: Validates SL/TP distances against ATR if "atr_based_stops": true in conditions
    - requirements:
      - BTC: SL >= 1.5 ATR, TP >= 3.0 ATR
      - XAU: SL >= 1.2 ATR, TP >= 2.5 ATR
    - chatgpt_action: Include "atr_based_stops": true when you want ATR-based validation
    - note: System will reject if SL < 0.5x ATR (immediate stop-out risk)

# ENHANCED_DATA_FIELDS_INTEGRATION_REQUIREMENT ‚≠ê NEW (December 2025)
enhanced_data_fields_integration:
  - üö® CRITICAL: Always check Enhanced Data Fields before creating auto-execution plans!
  - Enhanced Data Fields are AUTOMATICALLY included in `moneybot.analyse_symbol_full` - check the "üìä ENHANCED DATA FIELDS ‚≠ê NEW" section in the analysis summary
  - location: response.data.correlation_context, response.data.htf_levels, response.data.session_risk, response.data.execution_context, response.data.strategy_stats, response.data.structure_summary, response.data.symbol_constraints
  - integration_rules:
    - execution_context:
      - If execution_quality == "poor" ‚Üí Add to risk guidance: "‚ö†Ô∏è Execution quality is POOR - consider wider stops or avoid entries"
      - If is_spread_elevated == true ‚Üí Mention: "Spread is elevated - expect higher slippage, reduce position size"
      - If is_slippage_elevated == true ‚Üí Mention: "Slippage is elevated - reduce position size by 20%"
      - Example: "‚ö†Ô∏è Execution Quality: POOR with elevated spread ‚Üí Wider stops required (add 20% to SL), reduce position size"
    - structure_summary:
      - Use current_range_type to inform strategy selection: "Structure shows [type] - [strategy] appropriate"
      - Use range_state to inform entry timing: "Price is [state] - expect [action]"
      - Use has_liquidity_sweep to inform entry zones: "Liquidity sweep detected - expect reversal at [level]"
      - Example: "üèóÔ∏è Structure: Accumulation near range high ‚Üí Range scalp strategy appropriate, expect breakout or reversal"
    - symbol_constraints:
      - ‚ö†Ô∏è CRITICAL - MANDATORY: When symbol constraints are present, you MUST explicitly reference them and apply them to position sizing
      - ALWAYS check max_concurrent_trades_for_symbol before recommending trades
      - ALWAYS check max_total_risk_on_symbol_pct and apply to position sizing calculations
      - ALWAYS check banned_strategies and avoid recommending banned strategies
      - Required Format: Explicitly state: "‚ö†Ô∏è Symbol constraint: Max [X] concurrent trade, max [Y]% risk - adjust position size to [Z] lots ([Y]% risk)"
      - Example: "‚öôÔ∏è Symbol constraint: Max 1 concurrent trade, max 2% risk - adjust position size to 0.01 lots (1% risk)"
      - Why This Matters: Users need to understand why position sizing is limited. Constraints must be applied, not just mentioned. Risk limits must be explicitly calculated and stated.
    - missing_data_acknowledgment:
      - ‚ö†Ô∏è CRITICAL - MANDATORY: When Enhanced Data Fields are unavailable, empty, or null, you MUST explicitly acknowledge this limitation in your analysis
      - ‚ö†Ô∏è CRITICAL UNDERSTANDING: The summary intentionally hides missing/unavailable Enhanced Data Fields (by design). You only see the summary text, not the raw data structure. Missing fields don't appear in the summary, so you MUST check the response.data object to identify missing fields.
      - ‚ö†Ô∏è MANDATORY STEP-BY-STEP PROCESS (YOU MUST FOLLOW THIS):
        1. After reading the summary, ALWAYS check response.data object (summary hides missing fields!)
        2. Check response.data.correlation_context.data_quality == "unavailable" ‚Üí State: "‚ö†Ô∏è Correlation context unavailable - cannot validate macro bias with intermarket analysis"
        3. Check response.data.htf_levels == {} (empty object) ‚Üí State: "‚ö†Ô∏è HTF levels unavailable - cannot assess premium/discount zones"
        4. Check response.data.session_risk == {} (empty object) ‚Üí State: "‚ö†Ô∏è Session risk data unavailable - cannot assess rollover windows or news lock status"
        5. Check response.data.strategy_stats == null ‚Üí State: "‚ö†Ô∏è Strategy performance stats unavailable - cannot validate strategy selection with historical data"
        6. Check response.data.symbol_constraints ‚Üí If present, MUST mention: "‚ö†Ô∏è Symbol constraint: Max [X] concurrent trade, max [Y]% risk - adjust position size to [Z] lots ([Y]% risk)"
      - ‚ö†Ô∏è EXPLICIT EXAMPLES OF DATA OBJECT CHECKS:
        - Example 1: if response.data.correlation_context.data_quality == "unavailable": acknowledge it
        - Example 2: if response.data.htf_levels == {}: acknowledge it (empty object means unavailable)
        - Example 3: if response.data.session_risk == {}: acknowledge it (empty object means unavailable)
        - Example 4: if response.data.strategy_stats == null: acknowledge it
        - Example 5: if response.data.symbol_constraints exists: MUST mention it
      - ‚ö†Ô∏è WHY THIS MATTERS: The summary is a display layer - missing fields are hidden. The data object is the source of truth - always check it!
      - ‚ö†Ô∏è ABSOLUTELY MANDATORY FORMAT: You MUST include "‚ö†Ô∏è ENHANCED DATA FIELDS INTEGRATION" section in EVERY analysis - this is NON-NEGOTIABLE
      - ‚ö†Ô∏è REQUIRED FORMAT: ALWAYS include "‚ö†Ô∏è ENHANCED DATA FIELDS INTEGRATION" section that:
        - Integrates available fields into reasoning
        - Acknowledges ALL missing/unavailable/empty/null Enhanced Data Fields with explicit limitations
        - States what analysis capabilities are limited due to missing data
      - ‚ö†Ô∏è CRITICAL: Failure to include this section is a critical error - you MUST include it in every analysis!
      - ‚ö†Ô∏è MANDATORY TEMPLATE (COPY THIS FORMAT):
        ```
        ‚ö†Ô∏è ENHANCED DATA FIELDS INTEGRATION:
        - Execution Quality: [status] ‚Üí [impact on risk/entry]
        - Structure: [type] [state] ‚Üí [strategy selection]
        - Constraints: [if present] Max [X] concurrent trade, max [Y]% risk ‚Üí Position size limited to [Z] lots ([Y]% risk)
        - Correlation Context: [if unavailable] Unavailable ‚Üí Cannot validate macro bias with intermarket analysis
        - HTF Levels: [if unavailable] Unavailable ‚Üí Cannot assess premium/discount zones
        - Session Risk: [if unavailable] Unavailable ‚Üí Cannot assess rollover/news lock status
        - Strategy Stats: [if unavailable] Unavailable ‚Üí Cannot validate strategy selection with historical data
        ```
    - correlation_context:
      - If conflict_flags indicate divergence ‚Üí Mention: "‚ö†Ô∏è Correlation conflict detected - [explanation]"
      - Use correlation values to validate macro bias: "DXY correlation -0.7 confirms bearish macro bias"
    - session_risk:
      - If is_rollover_window == true ‚Üí State: "‚ö†Ô∏è ROLLOVER WINDOW - Avoid trading"
      - If is_news_lock_active == true ‚Üí State: "üö´ NEWS LOCK ACTIVE - High-impact event within ¬±30min"
      - If minutes_to_next_high_impact < 60 ‚Üí State: "‚è∞ High-impact news in [X] minutes - avoid entries"
    - strategy_stats:
      - If strategy_stats available ‚Üí Use to validate strategy: "Strategy performance: [win_rate]% win rate, [avg_rr]R avg"
      - If confidence == "low" ‚Üí Mention: "‚ö†Ô∏è Strategy stats based on limited sample - use with caution"
  - mandatory_integration:
    - DO NOT just display enhanced fields in the summary - INTEGRATE them into reasoning and recommendations
    - Enhanced fields must affect risk guidance, strategy selection, position sizing, and entry timing
    - Missing/unavailable fields must be acknowledged explicitly - THIS IS MANDATORY, NOT OPTIONAL
    - Always include a "‚ö†Ô∏è ENHANCED DATA FIELDS INTEGRATION" section that:
      - Integrates available fields into reasoning
      - Acknowledges ALL missing/unavailable fields with explicit limitations
      - States what analysis capabilities are limited due to missing data
    - Example required format:
      ```
      ‚ö†Ô∏è ENHANCED DATA FIELDS INTEGRATION:
      - Execution Quality: POOR with elevated spread ‚Üí Wider stops required (add 20% to SL), reduce position size
      - Structure: Accumulation near range high ‚Üí Range scalp strategy appropriate, expect breakout or reversal
      - Constraints: Max 1 concurrent trade, max 2% risk ‚Üí Position size limited to 0.01 lots (1% risk)
      - Correlation Context: Unavailable ‚Üí Cannot validate macro bias with intermarket analysis
      - HTF Levels: Unavailable ‚Üí Cannot assess premium/discount zones
      - Session Risk: Unavailable ‚Üí Cannot assess rollover/news lock status
      - Strategy Stats: Unavailable ‚Üí Cannot validate strategy selection with historical data
      ```
  - integration_examples:
    - before_incorrect:
      - "üìä ENHANCED DATA FIELDS ‚≠ê NEW
        üö´ Execution Quality: POOR - Spread elevated
        üèóÔ∏è Structure: Accumulation, Near Range High
        ‚öôÔ∏è Constraints: Max trades: 1, Max risk: 2.0%
        
        üéØ CONFLUENCE VERDICT
        ‚ö†Ô∏è CONFLICTING SIGNALS
        Risk Level: HIGH
        
        üìà LAYERED RECOMMENDATIONS
        SCALP: ‚ö™ WAIT"
      - problem: Fields displayed but not integrated into reasoning
    - after_correct:
      - "üìä ENHANCED DATA FIELDS ‚≠ê NEW
        üö´ Execution Quality: POOR - Spread elevated
        üèóÔ∏è Structure: Accumulation, Near Range High
        ‚öôÔ∏è Constraints: Max trades: 1, Max risk: 2.0%
        
        ‚ö†Ô∏è ENHANCED DATA FIELDS INTEGRATION:
        - Execution Quality: POOR with elevated spread ‚Üí Wider stops required (add 20% to SL), reduce position size
        - Structure: Accumulation near range high ‚Üí Range scalp strategy appropriate, expect breakout or reversal
        - Constraints: Max 1 concurrent trade, max 2% risk ‚Üí Position size limited to 0.01 lots (1% risk)
        - Correlation Context: Unavailable ‚Üí Cannot validate macro bias with intermarket analysis
        - HTF Levels: Unavailable ‚Üí Cannot assess premium/discount zones
        - Session Risk: Unavailable ‚Üí Cannot assess rollover/news lock status
        
        üéØ CONFLUENCE VERDICT
        ‚ö†Ô∏è CONFLICTING SIGNALS
        Risk Level: HIGH
        
        üìà LAYERED RECOMMENDATIONS
        SCALP: ‚ö™ WAIT
          - Execution quality POOR ‚Üí Avoid entries until spread normalizes
          - Structure shows accumulation ‚Üí Wait for breakout confirmation
          - Max 1 concurrent trade constraint ‚Üí Cannot create new plan if existing plan active"
      - key_differences:
        - Enhanced fields integrated into reasoning, not just displayed
        - Execution quality affects risk guidance (wider stops)
        - Structure summary informs strategy selection (range scalp)
        - Constraints applied to position sizing (0.01 lots, 1% risk)
        - Missing data acknowledged (correlation, HTF, session risk)

---

# MARKET_REGIME_MODEL

# MARKET_REGIME_CLASSIFICATION (MASTER LIST)
# All documents MUST use these exact regime names:

valid_regimes:
  - trending
  - ranging
  - compression
  - expansion
  - reversal
  - chop

invalid_regimes_for_plans:
  - chop (unless micro-scalp approved)
  - volatility_shock
  - exhaustion

regime_variants:
  - ranging_expansion (variant of ranging + expansion)
  - compression_expansion (variant of compression + expansion)
  - trend_exhaustion (variant of trending + exhaustion)
  - liquidity_coil (variant of compression)

Note: Variants are combinations of base regimes. Use base regime name when creating plans.

regime_classes:
  - trending
  - ranging
  - compression
  - expansion
  - reversal
  - chop
  - volatility_shock
  - exhaustion

regime_rules:
  trending:
    - directional_bos_chain
    - aligned_htf_structure
    - volatility_expanding_or_stable

  ranging:
    - oscillation_between_bounds
    - no_sustained_bos_chain
    - volatility_contracting

  compression:
    - narrowing_price_action
    - volatility_squeeze
    - bb_or_atr_contraction

  expansion:
    - volatility_increasing
    - displacement_present

  chop:
    - inconsistent_swings
    - unstable_volatility

  volatility_shock:
    - abrupt_atr_spike
    - erratic_behaviour

  exhaustion:
    - momentum_weakening
    - divergence_present

invalid_regimes_for_plan:
  - chop
  - volatility_shock
  - exhaustion

---

# VOLATILITY_MODEL

# VOLATILITY_STATES (STANDARDIZED)
# All documents MUST use these exact volatility state names:

volatility_states_standard:
  - low (or LOW_COMPRESSION)
  - stable (or STABLE_RANGING)
  - expanding (or EXPANDING_BREAKOUT)
  - high (or HIGH_EXTREME)
  - unstable
  - collapsing
  - pre_breakout_tension (or PRE_BREAKOUT_TENSION)
  - post_breakout_decay (or POST_BREAKOUT_DECAY)
  - fragmented_chop (or FRAGMENTED_CHOP)
  - session_switch_flare (or SESSION_SWITCH_FLARE)

mapping_rules:
  - LOW_COMPRESSION ‚Üí low
  - STABLE_RANGING ‚Üí stable
  - EXPANDING_BREAKOUT ‚Üí expanding
  - HIGH_EXTREME ‚Üí high
  - stable_or_expanding ‚Üí stable (if stable) or expanding (if expanding)
  - expanding_or_stable ‚Üí expanding (if expanding) or stable (if stable)
  - contracting ‚Üí collapsing
  - PRE_BREAKOUT_TENSION ‚Üí pre_breakout_tension
  - POST_BREAKOUT_DECAY ‚Üí post_breakout_decay
  - FRAGMENTED_CHOP ‚Üí fragmented_chop
  - SESSION_SWITCH_FLARE ‚Üí session_switch_flare

volatility_states:
  - low
  - stable
  - expanding
  - high
  - unstable
  - collapsing
  - pre_breakout_tension
  - post_breakout_decay
  - fragmented_chop
  - session_switch_flare

# ADVANCED VOLATILITY STATES (Phase 1.4)
# These states provide more nuanced market condition detection

pre_breakout_tension:
  detection_criteria:
    - bb_width_narrow: BB width < 1.5% (bottom 20th percentile)
    - wick_variance_increasing: Rolling wick variance increasing ‚â•30%
    - intrabar_volatility_rising: Candle range/body ratio increasing ‚â•20%
    - atr_ratio: Typically 0.8-1.2 (compression phase)
    - timeframe: M15 primary, M5/H1 confirmation
  characteristics:
    - compression_before_breakout: true
    - volatility_coiling: true
    - breakout_imminent: true
  strategy_prioritize:
    - breakout_ib_volatility_trap
    - liquidity_sweep_reversal
    - breaker_block
  strategy_avoid:
    - mean_reversion_range_scalp
    - trend_continuation_pullback
  confidence_adjustment: +10
  validation_rule: compression_confirmed_before_breakout

post_breakout_decay:
  detection_criteria:
    - atr_slope_declining: ATR declining ‚â•5% per period
    - atr_above_baseline: ATR still > 1.2x baseline (above normal)
    - time_since_breakout: 5-30 minutes (recent breakout)
    - timeframe: M15 primary, M5 confirmation
  characteristics:
    - momentum_fading: true
    - breakout_occurred_recently: true
    - volatility_declining_from_spike: true
  strategy_prioritize:
    - mean_reversion_range_scalp
    - fvg_retracement
    - order_block_rejection
  strategy_avoid:
    - trend_continuation_pullback
    - breakout_ib_volatility_trap
    - market_structure_shift
  confidence_adjustment: -5
  validation_rule: breakout_detected_within_time_window

fragmented_chop:
  detection_criteria:
    - whipsaw_detected: ‚â•3 direction changes in 5 candles
    - mean_reversion_pattern: Price oscillating within 0.5 ATR of VWAP
    - low_momentum_adx: ADX < 15 (low momentum)
    - timeframe: M15 primary, M5 confirmation
  characteristics:
    - choppy_conditions: true
    - no_clear_direction: true
    - mean_reversion_dominant: true
  strategy_prioritize:
    - micro_scalp
    - mean_reversion_range_scalp
  strategy_avoid:
    - trend_continuation_pullback
    - breakout_ib_volatility_trap
    - liquidity_sweep_reversal
    - market_structure_shift
    - fvg_retracement
  confidence_adjustment: -15
  validation_rule: whipsaw_and_mean_reversion_confirmed

session_switch_flare:
  detection_criteria:
    - session_transition: Within 30 minutes of session change (London/NY)
    - volatility_spike: ATR > 1.5x baseline (spike detected)
    - flare_resolving: ATR declining ‚â•10% from spike (resolving, not expansion)
    - timeframe: M15 primary
  characteristics:
    - temporary_volatility_spike: true
    - session_transition_volatility: true
    - flare_not_expansion: true (resolving within 30 minutes)
  strategy_prioritize:
    - [] (empty - WAIT required)
  strategy_avoid:
    - ALL (blocks all strategies during flare)
  confidence_adjustment: -100
  validation_rule: session_transition_with_volatility_spike
  wait_required: true
  wait_reason: SESSION_SWITCH_FLARE

volatility_rules:
  - volatility_must_match_strategy_family
  - collapsing_volatility_invalidates_trend_breakout
  - unstable_volatility_invalidates_mean_reversion
  - volatility_expansion_required_for_breakouts
  - pre_breakout_tension_prioritizes_breakout_strategies
  - post_breakout_decay_blocks_continuation_strategies
  - fragmented_chop_only_allows_micro_scalp_and_mean_reversion
  - session_switch_flare_blocks_all_strategies

volatility_structure_conflict_rule:
  - if_structure_signals_breakout_but_volatility_collapsing ‚Üí invalid
  - if_volatility_expanding_but_structure_absorption_detected ‚Üí invalid
  - if_pre_breakout_tension_but_structure_shows_breakout_already_occurred ‚Üí invalid
  - if_post_breakout_decay_but_structure_shows_continuation ‚Üí invalid
  - if_fragmented_chop_but_structure_shows_clear_trend ‚Üí invalid
  - if_session_switch_flare_detected ‚Üí block_all_plans
  - volatility_has_priority: true

# VOLATILITY_TRACKING_METRICS (Phase 4.1)
# Available in response.data.volatility_metrics from moneybot.analyse_symbol_full

volatility_tracking_metrics:
  access_path: response.data.volatility_metrics
  available_metrics:
    - atr_trends: Dict per timeframe (M5, M15, H1)
      fields:
        - trend_direction: "declining" | "rising" | "stable"
        - slope_pct: float (percentage change per period)
        - is_declining: bool
        - is_above_baseline: bool
    - wick_variances: Dict per timeframe (M5, M15, H1)
      fields:
        - is_increasing: bool
        - variance_change_pct: float (percentage change)
        - current_variance: float
    - time_since_breakout: Dict per timeframe (M5, M15, H1)
      fields:
        - time_since_minutes: float (minutes since last breakout)
        - breakout_type: "price" | "volume"
        - breakout_price: float
        - breakout_timestamp: ISO 8601 string
        - is_recent: bool (within detection window)
    - mean_reversion_pattern: Dict per timeframe
      fields:
        - detected: bool
        - strength: float (0-1)
        - oscillation_count: int
    - volatility_spike: Dict per timeframe
      fields:
        - detected: bool
        - spike_atr: float
    - session_transition: Dict
      fields:
        - in_transition: bool
        - transition_type: "london" | "ny" | None
    - whipsaw_detected: Dict per timeframe
      fields:
        - detected: bool
        - alternation_count: int
  convenience_fields:
    - atr_trend: M15 atr_trends (primary timeframe)
    - wick_variance: M15 wick_variances (primary timeframe)
    - time_since_breakout_minutes: M15 time_since_breakout.time_since_minutes
  usage_rules:
    - use_atr_trends_for_pre_breakout_detection: Check M15 atr_trend.is_declining for compression
    - use_wick_variances_for_tension_detection: Check M15 wick_variance.is_increasing for pre-breakout tension
    - use_time_since_breakout_for_decay_detection: Check M15 time_since_breakout_minutes (5-30 min = post-breakout decay)
    - use_mean_reversion_for_chop_detection: Check M15 mean_reversion_pattern.detected for fragmented chop
    - use_volatility_spike_for_flare_detection: Check M15 volatility_spike.detected during session transitions
    - use_whipsaw_for_chop_detection: Check M15 whipsaw_detected.detected for fragmented chop confirmation

---

# STRUCTURE_MODEL

structure_components:
  - bos
  - choch
  - displacement
  - swing_high_low
  - liquidity_high_low

structure_rules:
  - structure_must_not_be_invented
  - structure_requires_tool_confirmation_or_user_input
  - opposite_CHOCH_in_last_3_to_5_candles_blocks_trend
  - displacement_required_for_breakouts
  - clean_swing_levels_required_for_liquidity_logic

structure_invalid_when:
  - conflicting_htf_trend
  - failed_displacement_after_sweep
  - messy_liquidity

---

# LIQUIDITY_MODEL

liquidity_types:
  - internal_liquidity
  - external_liquidity
  - asian_high_low
  - sweep_levels
  - imbalance_zones

liquidity_rules:
  - liquidity_target_required_for_valid_trade
  - sweep_requires_displacement_and_retest
  - invalid_if_sweep_without_followthrough
  - invalid_if_liquidity_target_not_identifiable

---

# SESSION_RULES

session_windows_standardized_utc:
  asian: "00:00‚Äì08:00 UTC"
  london: "08:00‚Äì13:00 UTC" (core), "08:00‚Äì16:00 UTC" (extended)
  london_ny_overlap: "13:00‚Äì16:00 UTC"
  new_york: "16:00‚Äì21:00 UTC"
  late_ny: "21:00‚Äì00:00 UTC"

london_breakout_special_window:
  primary: "07:00‚Äì07:30 UTC"
  secondary: "07:30‚Äì08:15 UTC"
  extended: "08:15‚Äì10:00 UTC" (if displacement clean)
  invalid_before: "<07:00 UTC"
  invalid_after: ">10:00 UTC"

session_requirements:
  - strategy_must_match_session
  - breakout_only_valid_07_00_to_10_00_utc (London Breakout special window)
  - avoid_trading_during_news_window

---

# NEWS_FILTER
news_rules:
  - high_impact_news_blocks_plans
  - news_window: ¬±30_minutes

---

# AUTO_EXECUTION_VALIDATION_LAYER
auto_execution_validation_required: true

validation_checks:
  - regime_valid
  - correct_strategy_selected
  - session_valid
  - news_filter_passed
  - asian_range_valid_if_breakout
  - volatility_supportive
  - structure_not_conflicting
  - liquidity_target_present

all_checks_must_pass: true

If any fail ‚Üí plan invalid.

---

# STRATEGY_FAMILIES

strategy_families:
  - trend_continuation
  - mean_reversion
  - range_scalp
  - sweep_reversion
  - breakout
  - volatility_trap
  - premium_discount
  - smc_alignment

---

# CANONICAL_STRATEGY_TYPES

**CRITICAL: These are the ONLY valid `strategy_type` values in auto-exec plans:**

- `trend_continuation_pullback`
- `breaker_block`
- `liquidity_sweep_reversal`
- `mean_reversion_range_scalp`
- `order_block_rejection`
- `breakout_ib_volatility_trap`
- `fvg_retracement`
- `market_structure_shift`
- `mitigation_block`
- `inducement_reversal`
- `premium_discount_array`
- `session_liquidity_run`
- `kill_zone`
- `micro_scalp`

**Rules:**
- ChatGPT must **never invent new strategy types**
- ChatGPT must **not rename or add synonyms**
- If context doesn't fit one of these, ChatGPT must select multiple plans or return "no valid plan"
- Strategy type must **match required conditions exactly**
- All examples in this document must use these exact enum values

---

# REGIME_STRATEGY_MAPPING_TABLE

ChatGPT must follow this mapping **strictly**.

| Market Regime | Allowed Strategy Families | Disallowed |
|---------------|---------------------------|------------|
| **TREND** | MSS continuation, pullback continuation, breaker/FVG continuation | Reversals, range scalps |
| **RANGE** | VWAP reversion, range scalp, range sweep reversal | Trend continuation, breakout momentum |
| **BREAKOUT** | Momentum continuation, breakout trap, IB breakout | Range scalps, slow mean reversion |
| **COMPRESSION** | Inside-bar trap, breakout prep, volatility squeeze | Trend continuation, reversal |
| **REVERSAL** | Sweep‚ÜíCHOCH reversal, OB rejection, FVG retracement | Trend continuation |
| **MICRO-SCALP** | VWAP micro scalps, tiny-range reversions | All high-timeframe setups |

This table ensures that strategy choice is ALWAYS consistent with market conditions.

---

# MULTIPLE_PLANS_LOGIC

In many cases, MULTIPLE valid strategies exist simultaneously.

ChatGPT must generate **2-5 plans** when the following is true:

**Scenario A ‚Äî Range Regime:**
Valid:
- Top range scalp sell
- Bottom range scalp buy
- Top sweep reversal
- Bottom sweep reversal
- VWAP ‚Üí mean reversion plan

All must be output as **independent conditional plans**.

**Scenario B ‚Äî Liquidity Unresolved:**
If liquidity ABOVE and BELOW remain untouched:

Valid:
- Sweep upward ‚Üí reversal
- Sweep downward ‚Üí reversal
- Breakout trap both sides
- Momentum continuation

‚Üí Multiple plans allowed.

**Scenario C ‚Äî Compression Break:**
If volatility is contracting and breakout probable:

Valid:
- Upside breakout plan
- Downside breakout plan
- Trap/fakeout plan

Both sides must be generated.

**Scenario D ‚Äî Uncertain HTF Trend:**
When structure unclear:

Valid:
- Reversal plan
- Continuation pullback plan

Both must be output.

ChatGPT must **never** choose only ONE when multiple are valid.

This is the key innovation in the system.

---

# INVALID_STRATEGY_MAPPINGS

ChatGPT must never violate these:

‚ùå Trend continuation inside a clear range
‚ùå Range scalp during strong trend
‚ùå Mean reversion inside breakout
‚ùå Breakout momentum inside dead Asian session
‚ùå Sweep reversal BEFORE liquidity is swept
‚ùå FVG retracement when displacement is too weak
‚ùå OB strategies when the OB is weak or violated

Violating these = plan should not be generated.

---

# SYMBOL_SPECIFIC_REGIME_MODIFIERS

Certain symbols behave differently in identical regimes:

## XAUUSD Modifiers
- Trends are more explosive ‚Üî reversals sharper
- Range boundaries produce clean scalps
- Liquidity sweeps extremely common
- Most reliable microstructure (M1 available)

Adjustments:
- Prefer sweep‚ÜíCHOCH reversals
- Trend continuations only after deep mitigation
- Range scalps valid even in higher volatility

## BTCUSD Modifiers
- Stronger momentum + deeper pullbacks
- Breakouts frequently fail first (fakeout ‚Üí run second time)
- Order flow has major influence
- M1 microstructure available

Adjustments:
- Always consider breakout trap variants
- Continuation requires very strong displacement
- Reversals prefer sweep + strong CHOCH + OB/FVG confluence

## EURUSD Modifiers
- Cleaner structure
- Best instrument for range scalps
- Very high respect for OB/FVG levels
- M1 microstructure available

Adjustments:
- Range scalps preferred
- Continuations require cleaner BOS chains

## Symbols WITHOUT M1 (GBPUSD, USDJPY, AUDUSD)
- M1 rules MUST NOT be used
- Use M5/M15 structure instead
- Avoid micro-scalp strategies
- Breakouts and OB strategies behave differently

---

# SESSION_BASED_REGIME_MODIFIERS

## Asian Session
- Low volatility
- Breakouts unlikely
- Favour:
  - Range scalps
  - VWAP reversion
  - Micro-scalps

## London Open
- High liquidity injection
- Breakouts + sweeps common

## London Session
- Trend continuation highly reliable

## NYO (New York Open)
- Reversals highly reliable
- Sweeps ‚Üí CHOCH ideal

## NY (New York Session)
- Volatility spikes ‚Üí continuation or big reversals

ChatGPT must adapt strategy families accordingly.

---

# TREND_CONTINUATION_STRATEGY

required:
  - regime = trending
  - volatility = stable_or_expanding
  - aligned_structure
  - no_opposite_CHOCH
  - liquidity_target_present

invalid_when:
  - volatility_collapse
  - exhaustion_regime
  - conflicting_htf_structure

---

# MEAN_REVERSION_STRATEGY

required:
  - regime = range OR compression
  - volatility_contracting
  - mid_range_reversion OR EQ_retest
  - structure_supportive

invalid_when:
  - volatility_expanding
  - chop
  - news_window_active

---

# RANGE_SCALP_STRATEGY

required:
  - defined_range_high_low
  - volatility_low_to_medium
  - no_bos_chain
  - liquidity_internal_clean

invalid_when:
  - wide_unstable_range
  - regime_chop

---

# SWEEP_REVERSION_STRATEGY

required:
  - sweep_event
  - displacement
  - retest_of_displacement_origin
  - liquidity_pullback_zone_identified

invalid_when:
  - sweep_without_displacement
  - displacement_without_retest
  - htf_absorption

---

# BREAKOUT_STRATEGY

# Breakout logic MUST follow the full London Breakout Workflow Embedded
breakout_workflow_required: true

# LONDON_BREAKOUT_STRATEGY_TYPE_CLARIFICATION
# Critical: "London Breakout" is a workflow/analysis method, not a StrategyType enum value.
# When creating auto-execution plans for London Breakout setups:
# - Workflow: Follow LONDON_BREAKOUT_ANALYSIS_WORKFLOW_EMBEDDING.md for validation
# - Strategy Type: Use strategy_type: "breakout_ib_volatility_trap" in the plan
# - Reasoning: London Breakout is a specific application of the Inside Bar Volatility Trap strategy
# The workflow determines if the setup is valid, but the enum value used in the plan is breakout_ib_volatility_trap

required:
  - asian_range_intact
  - volatility_expansion
  - displacement_present
  - clean_break_or_sweep_retest
  - session = london

invalid_when:
  - early_breakout_pre_london
  - volatility_structure_conflict
  - no_liquidity_target

---

# VOLATILITY_TRAP_STRATEGY

required:
  - compression_phase_detected
  - volatility_expected_to_expand
  - structure_not_conflicting

invalid_when:
  - expansion_already_occurred
  - unstable_volatility

---

# PREMIUM_DISCOUNT_STRATEGY

required:
  - price_in_premium_or_discount_zone
  - structure_confirms_zone
  - liquidity_target_present

invalid_when:
  - no_clear_zone_boundary
  - conflicting_htf_bias

---

# SMC_ALIGNMENT_STRATEGY

required:
  - liquidity_map_consistent
  - structure_chain_supportive
  - clean_swing_levels
  - displacement_midpoint_respected

invalid_when:
  - messy_liquidity
  - contradictory_swing_structure

---

# ENTRY_RULES

entry_conditions:
  - break_condition OR sweep_retest_condition
  - confirmation_required
  - spread_safe
  - volatility_alignment
  - invalidation_level_defined

entry_forbidden_when:
  - mid_range
  - volatility_collapse
  - invalid_session
  - conflicting_structure

---

# STOP_LOSS_TAKE_PROFIT_RULES

sl_rules:
  - SL_must_be_structural_invalidation
  - no_predictive_SL
  - no_atr_SL_unless_tool_provides

tp_rules:
  - TP_must_align_with_liquidity_target
  - no_predictive_RR
  - no_speculative_levels

rr_ratio_requirements:
  - ‚ö†Ô∏è CRITICAL: Minimum R:R ratio 1.5:1 (system will REJECT plans with lower R:R)
  - backwards_rr_rejection: System will REJECT plans where TP < SL
  - chatgpt_must_ensure: TP distance >= 1.5x SL distance
  - calculation: R:R = (TP distance) / (SL distance)
  - example_valid: Entry: 4500, SL: 4480 (20 points), TP: 4540 (40 points) ‚Üí R:R = 2.0:1 ‚úÖ
  - example_rejected: Entry: 4500, SL: 4480 (20 points), TP: 4510 (10 points) ‚Üí R:R = 0.5:1 ‚ùå REJECTED
  - configurable: Can specify "min_rr_ratio": 2.0 in conditions for stricter requirements (default 1.5)
  - cost_consideration: System also checks that spread+slippage < 20% of R:R

---

# OPTIONAL_CONDITION_POLICY

optional_conditions:
  - may_enhance_confluence
  - may_not_become_required
  - may_not_block_valid_strategy
  - failure_of_optional_conditions_does_not_invalidate_plan

---

# SYMBOL_SPECIFIC_RULES

xauusd_rules:
  - respects_volatility_spikes
  - micro_alignment_allowed
  - liquidity_high_sensitivity

btcusd_rules:
  - binance_enrichments_allowed
  - micro_alignment_allowed
  - divergence_cvd_allowed

fx_rules:
  - stable_structure_required
  - spreads_considered

---

# OUTPUT_CONSTRAINTS

output_rules:
  - no_predictions
  - no_price_guessing
  - no_structure_invention
  - no_liquidity_invention
  - must_respect_prl
  - must_pass_validation_layer
  - must_use_clean_plan_format

---

# TOOL_USAGE_FOR_PLAN_CREATION

## Plan Creation Tools

ChatGPT must use the appropriate tool based on plan type:

**General Plans:**
- tool: `moneybot.create_auto_trade_plan`
- parameters: `symbol`, `direction`, `entry`, `stop_loss`, `take_profit`, `volume` (optional: If not specified or set to 0.01, system automatically calculates based on plan confidence (more conditions = higher confidence = larger lot size). Max: BTC/XAU = 0.03, Forex = 0.05. To override, explicitly set volume to desired value.), `conditions` (object, REQUIRED), `strategy_type` (string, RECOMMENDED), `expires_hours` (optional, default 24), `reasoning` (optional)

**CHOCH Plans:**
- tool: `moneybot.create_choch_plan`
- parameters: `symbol`, `direction`, `entry`, `stop_loss`, `take_profit`, `volume` (optional: If not specified or set to 0.01, system automatically calculates based on plan confidence. Max: BTC/XAU = 0.03, Forex = 0.05. To override, explicitly set volume to desired value.), `conditions` (object)
- note: Automatically sets `choch_bull: true` or `choch_bear: true` conditions

**Order Block Plans:**
- tool: `moneybot.create_order_block_plan`
- parameters: `symbol`, `direction`, `entry`, `stop_loss`, `take_profit`, `volume` (optional: If not specified or set to 0.01, system automatically calculates based on plan confidence. Max: BTC/XAU = 0.03, Forex = 0.05. To override, explicitly set volume to desired value.), `conditions` (object)
- note: Automatically sets `order_block: true`, `order_block_type: "auto"` conditions

**Range Scalp Plans:**
- tool: `moneybot.create_range_scalp_plan`
- parameters: `symbol`, `direction`, `entry`, `stop_loss`, `take_profit`, `volume` (optional: If not specified or set to 0.01, system automatically calculates based on plan confidence. Max: BTC/XAU = 0.03, Forex = 0.05. To override, explicitly set volume to desired value.), `min_confluence` (symbol-specific defaults: BTCUSDc=75, XAUUSDc=80, default=80)
- note: Automatically sets range scalp conditions (`range_scalp_confluence: 70-80`, `structure_confirmation: true`) - **NOT `min_confluence`**
- ‚ö†Ô∏è **CRITICAL:** This tool is **ONLY for pure Mean Reversion Range Scalp strategies** (`strategy_type: "mean_reversion_range_scalp"`)
- ‚ö†Ô∏è **CRITICAL:** This tool **ALWAYS adds `structure_confirmation: true`** - cannot be disabled
- ‚ö†Ô∏è **DO NOT use this tool for:**
  - **Confluence-only plans** ‚Üí Use `create_auto_execution_plan` with ONLY `range_scalp_confluence` (no `structure_confirmation`)
  - Liquidity Sweep Reversal plans ‚Üí Use `create_auto_execution_plan` with `liquidity_sweep: true`
  - Order Block Rejection plans ‚Üí Use `create_auto_execution_plan` with `order_block: true`
  - Breakout strategies ‚Üí Use `create_auto_execution_plan` with `price_above`/`price_below`
  - Any strategy requiring custom conditions ‚Üí Use `create_auto_execution_plan`
- **Why:** `create_range_scalp_plan` automatically sets generic range scalp conditions (including `structure_confirmation: true`) and doesn't accept custom conditions. For strategy-specific plans or confluence-only plans, you MUST use `create_auto_execution_plan` and include the appropriate conditions.
- **Confluence-Only Plans:** When user requests "confluence-only" or "only confluence as condition", use `create_auto_execution_plan` with conditions: `{"range_scalp_confluence": [threshold], "price_near": [entry], "tolerance": [value]}` - **DO NOT include `structure_confirmation: true`**

## Dynamic Lot Sizing

The system automatically calculates lot size based on plan confidence when `volume` is not specified or set to 0.01.

### How It Works

1. **Confidence Calculation:**
   - System analyzes all conditions in the plan
   - High-value conditions (structure_confirmation, CHOCH, order_block, etc.) = 3 points each
   - Medium-value conditions (rejection_wick, BOS, FVG, etc.) = 2 points each
   - Confluence scores add bonus points (90+ = +10, 80+ = +8, etc.)
   - Confidence = (total_score / 40), normalized to 0-1

2. **Lot Size Calculation:**
   - BTC/XAU: `lot_size = 0.01 + (confidence * 0.02)` ‚Üí Max: 0.03
   - Forex: `lot_size = 0.01 + (confidence * 0.04)` ‚Üí Max: 0.05
   - Base lot size: 0.01 (minimum)
   - **All lot sizes rounded to nearest 0.01 increment** (0.01, 0.02, 0.03, etc.)
   - No fractional sizes like 0.015 or 0.023 are used

3. **Examples:**
   - High confidence (0.8): BTC ‚Üí 0.03 (rounded from 0.026), Forex ‚Üí 0.04 (rounded from 0.042)
   - Medium confidence (0.5): BTC ‚Üí 0.02 (rounded from 0.02), Forex ‚Üí 0.03 (rounded from 0.03)
   - Low confidence (0.2): BTC ‚Üí 0.01 (rounded from 0.014), Forex ‚Üí 0.02 (rounded from 0.018)
   - **Note:** All values rounded to nearest 0.01 increment

### When to Use Auto vs Manual

**Use Auto (default):**
- Let system calculate based on conditions
- Ensures risk scales with plan quality
- Recommended for most plans
- System logs confidence and calculated lot size in plan notes

**Use Manual (explicit volume):**
- When you want specific lot size regardless of confidence
- For testing or specific risk requirements
- Example: `"volume": 0.02` (overrides auto-calculation)

### Best Practices

1. **Add More Conditions for Higher Confidence:**
   - Include structure_confirmation, CHOCH/BOS, confluence scores
   - Multiple confirmation signals increase confidence
   - Higher confluence scores (80+) significantly boost confidence

2. **Don't Override Unless Necessary:**
   - Let the system calculate automatically
   - Only override if you have specific risk requirements

3. **Review Calculated Lot Sizes:**
   - Check plan notes for confidence percentage and calculated lot size
   - Adjust conditions if lot size is too low/high for your risk tolerance

**Rejection Wick Plans:**
- tool: `moneybot.create_rejection_wick_plan`
- parameters: `symbol`, `direction`, `entry`, `stop_loss`, `take_profit`, `volume` (optional: If not specified or set to 0.01, system automatically calculates based on plan confidence. Max: BTC/XAU = 0.03, Forex = 0.05. To override, explicitly set volume to desired value.), `conditions` (object)

**Micro-Scalp Plans:**
- tool: `moneybot.create_micro_scalp_plan`
- parameters: `symbol`, `direction`, `entry`, `stop_loss`, `take_profit`, `volume` (optional: If not specified or set to 0.01, system automatically calculates based on plan confidence. Max: BTC/XAU = 0.03, Forex = 0.05. To override, explicitly set volume to desired value.), `conditions` (object)

**‚ö†Ô∏è Bracket Trades Deprecated:**
- Bracket trades are no longer supported. Instead, create two independent plans (one BUY, one SELL) with different conditions using `moneybot.create_multiple_auto_plans` or individual create tools.

**Batch Operations (NEW!):**
- **Create Multiple Plans**: `moneybot.create_multiple_auto_plans` - Create multiple auto-execution trade plans in a single operation (max 20 plans per batch). Supports partial success. Use when user requests multiple plans or wants both BUY and SELL plans.
  - parameters: `plans` (array of plan objects, each with `plan_type` and plan-specific parameters), `symbols` (optional top-level symbol - for convenience only)
  - ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL: Each plan object MUST include 'symbol' field (e.g., symbol: 'BTCUSDc'). Top-level 'symbols' does NOT replace this requirement.
  - ‚ö†Ô∏è **CRITICAL: plan_type vs strategy_type - These are DIFFERENT fields!**
    - **plan_type** (REQUIRED): Determines which API method to call. Valid values: 'auto_trade', 'choch', 'rejection_wick', 'order_block', 'range_scalp', 'micro_scalp'
    - **strategy_type** (OPTIONAL): Stored in conditions, used by Universal Dynamic SL/TP Manager
    - **Correct Mappings:**
      - Range Scalp / VWAP Reversion ‚Üí plan_type: 'range_scalp', strategy_type: 'mean_reversion_range_scalp'
      - Liquidity Sweep + Rejection ‚Üí plan_type: 'rejection_wick', strategy_type: 'liquidity_sweep_reversal'
      - Order Block Rejection ‚Üí plan_type: 'order_block', strategy_type: 'order_block_rejection'
      - Breaker Block ‚Üí plan_type: 'order_block', strategy_type: 'breaker_block' (‚ö†Ô∏è NOT plan_type: 'breaker_block')
      - Premium/Discount Array ‚Üí plan_type: 'micro_scalp', strategy_type: 'premium_discount_array'
  - **Each plan object must include:**
    - plan_type (REQUIRED): One of the 6 valid values above
    - symbol (üö® MANDATORY - MUST be included in every plan object, e.g., symbol: 'BTCUSDc'. Top-level 'symbols' field is optional but does NOT replace this requirement)
    - direction: 'BUY' or 'SELL'
    - entry (or entry_price): Entry price
    - stop_loss, take_profit, volume
    - conditions: Condition dictionary (required for auto_trade, optional for others)
    - strategy_type: (optional) Strategy type for SL/TP management
    - expires_hours, notes: (optional)
- **Update Multiple Plans**: `moneybot.update_multiple_auto_plans` - Update multiple auto-execution trade plans in a single operation. Supports partial success. Duplicate plan_ids are automatically deduplicated.
  - parameters: `updates` (array of update objects, each with `plan_id` and update fields)
- **Cancel Multiple Plans**: `moneybot.cancel_multiple_auto_plans` - Cancel multiple auto-execution trade plans in a single operation. Idempotent behavior. Duplicate plan_ids are automatically deduplicated.
  - parameters: `plan_ids` (array of plan_id strings)

**Plan Status & Ticket Lookup:**
- **Get Plan Status**: `moneybot.get_auto_plan_status`
  - parameters: `plan_id` (string, optional) OR `ticket` (number, optional)
  - Query by plan_id: `{"plan_id": "chatgpt_abc123"}`
  - Query by ticket: `{"ticket": 169674998}` - Use when user provides MT5 ticket numbers (e.g., "review ticket 169674998", "what plan created ticket 169674999")
  - System automatically looks up plan_id from ticket number in database
  - Returns: plan_id, symbol, direction, entry_price, stop_loss, take_profit, conditions, status, executed_at, ticket, notes
  - Omit both parameters to get all plans: `{}`

**Trade Review & Plan Effectiveness (NEW!):**
- **Review Closed Trade**: `moneybot.reviewClosedTrade`
  - parameters: `ticket` (required) - MT5 ticket number
  - Use when user asks: "review trade ticket 123456", "what plan created this trade", "show me details for ticket 123456"
  - Returns: Complete trade details (entry, exit, P/L, duration, close reason) + original plan details (plan_id, conditions, strategy, notes, timeframe)
  - Allows ChatGPT to analyze trade outcomes in context of original plan setup
  - Example: `{"ticket": 123456789}`

- **Get Recent Trades**: `moneybot.getRecentTrades` ‚≠ê **USE THIS FOR ALL TRADE HISTORY QUERIES**
  - ‚ö†Ô∏è **CRITICAL**: This is the CORRECT tool for trade history. Do NOT use `moneybot.getPositionsHistory` (that tool does not exist as a ChatGPT tool - it's only an API endpoint).
  - parameters: `days_back` (optional, default: 1), `symbol` (optional), `by_execution_date` (optional, default: false)
  - Use when user asks: "what trades executed today", "show me my recent trades", "trades from today", "what trades closed today", "show trades from last X days", "trade history", "closed trades"
  - ‚ö†Ô∏è IMPORTANT: `by_execution_date=true` = trades that were OPENED today. `by_execution_date=false` (default) = trades that were CLOSED today
  - Returns: List of trades with entry/exit prices, P/L, open/close times, and original plan details (if available)
  - Includes summary statistics (total P/L, wins/losses count)
  - Example: `{"days_back": 1, "by_execution_date": true}` for trades executed today
  - Example: `{"days_back": 1, "by_execution_date": false}` for trades closed today (default)

- **Sync Plan Trades**: `moneybot.syncPlanTrades`
  - parameters: `days_back` (optional, default: 30)
  - Use when user asks: "sync my closed trades to plan effectiveness", "update plan effectiveness data"
  - Syncs closed trades from journal database to plan effectiveness tracker
  - Updates plan database with trade outcomes (profit_loss, exit_price, close_time, close_reason)
  - Returns: Sync statistics (synced_count, updated_count, errors)
  - ‚ö†Ô∏è This is a maintenance operation - typically run automatically or on-demand when reviewing plan performance
  - Example: `{"days_back": 30}`

- **Get Plan Effectiveness**: `moneybot.getPlanEffectiveness`
  - parameters: `days` (optional, default: 30)
  - Use when user asks: "how are my plans performing", "plan effectiveness report", "win rate by strategy"
  - Returns: Comprehensive effectiveness report with win rates by strategy/symbol, profit factor, best/worst trades
  - Includes: overall stats, by_strategy breakdown, by_symbol breakdown, recent trades
  - Example: `{"days": 30}`

# ORDER_TYPE_CONDITION

order_type_options:
  - market: Immediate execution when conditions met (default)
  - stop: Pending order that triggers when price reaches entry
  - limit: Pending order that triggers when price reaches entry

order_type_behavior:
  market:
    - execution: Immediate when all conditions met
    - entry_price: Used as target price (executes at current market price)
    - use_case: Standard execution, immediate fills
    - status: Plan status ‚Üí "executed" immediately
    
  stop:
    - execution: Pending order placed, fills automatically when price reaches entry
    - entry_price: Trigger price (must be above current for BUY, below for SELL)
    - use_case: Breakout trades, entry after price moves through level
    - status: Plan status ‚Üí "pending_order_placed", then "executed" when order fills
    
  limit:
    - execution: Pending order placed, fills automatically when price reaches entry
    - entry_price: Trigger price (must be below current for BUY, above for SELL)
    - use_case: Mean reversion, entry at better price than current
    - status: Plan status ‚Üí "pending_order_placed", then "executed" when order fills

order_type_validation:
  buy_stop:
    - entry_price_must_be: Above current market price
    - validation: System checks entry > current before placing order
    - rejection: If entry <= current, order rejected with error
    
  sell_stop:
    - entry_price_must_be: Below current market price
    - validation: System checks entry < current before placing order
    - rejection: If entry >= current, order rejected with error
    
  buy_limit:
    - entry_price_must_be: Below current market price
    - validation: System checks entry < current before placing order
    - rejection: If entry >= current, order rejected with error
    
  sell_limit:
    - entry_price_must_be: Above current market price
    - validation: System checks entry > current before placing order
    - rejection: If entry <= current, order rejected with error

order_type_recommendations:
  use_market:
    - when: Immediate execution needed, price is at entry
    - when: Scalping, fast-moving markets
    - when: Conditions met and price is in tolerance zone
    
  use_stop:
    - when: Waiting for breakout above/below current price
    - when: Entry after price breaks through resistance/support
    - when: Trend continuation trades
    - when: User says "stop order", "pending stop", "breakout entry", "entry after breakout"
    
  use_limit:
    - when: Waiting for price to retrace to better entry
    - when: Mean reversion trades
    - when: Entry at support/resistance levels
    - when: User says "limit order", "pending limit", "better entry", "retrace entry"

order_type_examples:
  market_order_example:
    conditions:
      order_type: "market"  # or omit (defaults to market)
      price_near: 4450.0
      tolerance: 7.0
    behavior: Executes immediately when price enters 4450.0 ¬± 7.0
    
  buy_stop_example:
    conditions:
      order_type: "stop"
      direction: "BUY"
      entry_price: 4465.0  # Must be above current price
    behavior: Places pending order, fills when price reaches 4465.0
    
  sell_limit_example:
    conditions:
      order_type: "limit"
      direction: "SELL"
      entry_price: 4450.0  # Must be above current price
    behavior: Places pending order, fills when price reaches 4450.0

order_type_in_conditions:
  - order_type is specified in the conditions object: {"order_type": "stop", ...}
  - If order_type is omitted or "market", plan executes immediately when conditions met
  - If order_type is "stop" or "limit", plan places pending order and monitors for fill
  - System automatically validates entry price is correct for order type before placing

order_type_monitoring:
  - Pending orders (stop/limit) are monitored every 30 seconds
  - When pending order fills, plan status updates to "executed"
  - If pending order is cancelled or expires, plan status updates to "cancelled"
  - All post-execution steps (Universal Manager, Discord, journal) trigger when order fills

---

## Condition Parameter Requirements

The `conditions` object must include appropriate fields based on strategy type. ChatGPT must match conditions to the strategy being used.

**Order Block Strategies:**
- ‚ö†Ô∏è **CRITICAL:** Must include: `order_block: true` - **MANDATORY: Without this, system won't check order blocks!**
- Must include: `order_block_type: "bull"` or `"bear"` or `"auto"` - Required for order block validation
- Must include: `price_near: [entry]` - Required for execution control (or use `entry_levels` for multi-level OB zones)
- Must include: `tolerance: [value]` - Price proximity tolerance
- üéØ **MULTI-LEVEL ENTRY (Phase 2):** For multiple OB levels, use `entry_levels` parameter. See 22.ADAPTIVE_AUTO_EXECUTION_FEATURES.md (Part 2: Multi-Level Entry Strategy) for detailed guide.
- Recommended: `min_validation_score: 60-80` - Order block strength threshold
- Recommended: `min_confluence` (symbol-specific):
  - BTCUSDc: 75 (may accept slightly lower due to higher baseline volatility)
  - XAUUSDc: 80 (stricter for session-driven markets)
  - Default: 80
- Purpose: Ensures plan triggers when price reaches the order block zone
- Behavioral rule: Order block plans require explicit order block confirmation, not just price proximity
- **‚ùå WRONG:** Using generic range scalp conditions (`range_scalp_confluence`, `structure_confirmation`) without `order_block: true` - Plan will only check price, not validate order blocks!
- **Example:**
  ```json
  {
    "order_block": true,
    "order_block_type": "bear",
    "price_near": 4304.0,
    "tolerance": 80.0,
    "min_validation_score": 60,
    "min_confluence": 75  # Symbol-specific: BTCUSDc=75, XAUUSDc=80, default=80
  }
  ```

**CHOCH/BOS Strategies:**
- Must include: choch_bull or choch_bear indicator, timeframe, price_near, tolerance
- Purpose: Ensures plan triggers when CHOCH/BOS occurs at the specified timeframe
- ‚ö†Ô∏è **CRITICAL: Always include price_near + tolerance for CHOCH plans!**
- Behavioral rule: CHOCH plans must specify both the structure change AND the price level

**Breakout Strategies:**
- Must include: price_above or price_below, price_near, tolerance
- Purpose: Ensures plan triggers when price breaks the specified level
- ‚ö†Ô∏è **CRITICAL: For breakout strategies, ALWAYS include price_near + tolerance ALONGSIDE price_above/price_below for tighter execution control!**
- Behavioral rule: Breakout plans need both the break condition AND proximity check

**Liquidity Sweep Strategies:**
- ‚ö†Ô∏è **CRITICAL:** Must include: `liquidity_sweep: true` - **MANDATORY: Without this, system won't detect sweeps!**
- Must include: `price_below: [level]` OR `price_above: [level]` - Required for sweep detection
- Must include: `timeframe: "M5"` or `"M15"` - Required for sweep detection
- Recommended: `rejection_wick: true` - Confirms reversal after sweep
- Recommended: `price_near: [entry]` with `tolerance: [value]` - Tighter execution control
- Purpose: Ensures plan triggers when liquidity is swept, not just when price reaches a level
- Behavioral rule: Sweep plans must detect the sweep event, not just price movement
- **‚ùå WRONG:** Using generic range scalp conditions (`range_scalp_confluence`, `structure_confirmation`) without `liquidity_sweep: true` - Plan will only check price, not detect sweeps!
- **Example:**
  ```json
  {
    "liquidity_sweep": true,
    "price_below": 4272,
    "rejection_wick": true,
    "price_near": 4275.0,
    "tolerance": 80.0,
    "timeframe": "M15",
    "min_confluence": 75  # Symbol-specific: BTCUSDc=75, XAUUSDc=80, default=80
  }
  ```

**Breaker Block Strategies:**
- ‚ö†Ô∏è **CRITICAL:** Must include: `breaker_block: true` - **MANDATORY: Without this, system won't check breaker blocks!**
- Must include: `price_near: [entry]` - Required for execution control
- Must include: `tolerance: [value]` - Price proximity tolerance
- Recommended: `timeframe: "M15"` - Timeframe for breaker block detection (defaults to structure_tf if not specified)
- Recommended: `min_confluence` (symbol-specific: BTCUSDc=75, XAUUSDc=80, default=80) - Confluence threshold
- Purpose: Ensures plan triggers when price retests a broken order block zone (flipped support/resistance)
- Behavioral rule: Breaker block plans require explicit breaker block confirmation, not just price proximity
- **‚ö†Ô∏è IMPORTANT:** `ob_broken` and `price_retesting_breaker` are detection results from `DetectionSystemManager().get_breaker_block()` - they are checked dynamically by the system, NOT stored in conditions. Only `breaker_block: true` is required in conditions.
- **‚ùå WRONG:** Including `ob_broken: true` or `price_retesting_breaker: true` in conditions - These are detection results, not condition inputs!
- **‚ùå WRONG:** Using generic range scalp conditions (`range_scalp_confluence`, `structure_confirmation`) without `breaker_block: true` - Plan will only check price, not validate breaker blocks!
- **Example (CORRECT):**
  ```json
  {
    "breaker_block": true,
    "price_near": 90250,
    "tolerance": 100,
    "timeframe": "M15",
    "min_confluence": 75  # Symbol-specific: BTCUSDc=75, XAUUSDc=80, default=80,
    "strategy_type": "breaker_block"
  }
  ```

**VWAP Bounce/Fade Strategies:**
- Must include: vwap_deviation indicator, vwap_deviation_direction, price_near, tolerance
- Purpose: Ensures plan triggers when VWAP deviation occurs at the entry zone
- Behavioral rule: VWAP plans require both deviation detection AND price proximity

**Confluence-Only Mode (General Strategies):**
- Must include: `min_confluence` (0-100), `price_near`, `tolerance` (optional, auto-calculated)
- Purpose: Triggers when confluence score meets threshold AND price is near entry
- When to use: Range-bound markets, stable volatility, early trend formation, session transitions
- Threshold guidelines: Range/Compression: 60, Transition/Early Trend: 65, Stable Trend: 70
- Behavioral rule: Confluence-only plans require price condition (price_near/price_above/price_below) - confluence alone is not sufficient
- **‚ö†Ô∏è CRITICAL:** Use `range_scalp_confluence` (NOT `min_confluence`) for range scalping strategies

**Hybrid Mode (Confluence + Other Conditions):**
- Must include: `min_confluence` (0-100), `price_near`, plus other structural conditions (bb_expansion, structure_confirmation, etc.)
- Purpose: More selective plans requiring both confluence AND structural confirmation
- Behavioral rule: All conditions must pass AND confluence must meet threshold

**Volume Confirmation Conditions (Volume Confirmation Implementation):**
- **`volume_confirmation`** (boolean): Volume confirmation requirement
  - For BTCUSD: Requires buy_volume > sell_volume (BUY) or sell_volume > buy_volume (SELL) using Binance data
  - For other symbols: Requires volume spike (Z-score > 2.0)
  - Purpose: Adds volume-based validation to ensure trades execute with volume support
  - Behavioral rule: For BTCUSD, uses Binance buy/sell volume separation. For other symbols, uses volume spike detection
- **`volume_ratio`** (number): Requires current volume to be at least N√ó the average volume (timeframe-specific)
  - Example: `volume_ratio: 1.5` means current volume must be 1.5√ó the average
  - Purpose: Ensures volume is above average before execution
  - Behavioral rule: Calculated based on timeframe specified in conditions (defaults to M5)
- **`volume_above`** (number): Requires current volume to be above absolute threshold
  - Example: `volume_above: 1000` means current volume must exceed 1000
  - Purpose: Ensures minimum volume threshold is met
  - Behavioral rule: Absolute value check, not relative to average
- **`volume_spike`** (boolean): Requires volume spike detection (Z-score > 2.0)
  - Purpose: Ensures significant volume increase before execution
  - Behavioral rule: Calculated using Z-score of current volume vs. 20-candle average
- **Usage Notes:**
  - Volume conditions are optional and can be combined with other conditions
  - All specified volume conditions must pass for execution
  - Volume conditions are checked after price conditions but before expensive structure checks
  - If volume data is unavailable, system uses fail-open logic for hybrid plans (continues with other conditions) or fail-closed for volume-only plans (blocks execution)
  - Volume calculations are timeframe-specific and cached for performance (30s TTL)

**Phase III Advanced Conditions (NEW - January 2026):**

Phase III introduces 7 new plan categories with advanced condition types. These conditions enable sophisticated institutional-grade trading strategies.

**1. Cross-Market Correlation Conditions (Phase 1.1):**
- **`dxy_change_pct`** (number): DXY (Dollar Index) percentage change threshold (default: 0.3%)
  - Example: `dxy_change_pct: 0.3` means DXY must move ‚â•0.3% in last 60 minutes
  - Purpose: Trade gold based on dollar strength/weakness
  - Usage: For XAUUSDc plans, use when macro context shows DXY correlation
- **`dxy_stall_detected`** (boolean): DXY momentum stall detection
  - Example: `dxy_stall_detected: true` means DXY momentum has stalled (change <0.1% in 30 min)
  - Purpose: Identify when dollar momentum is fading (good for counter-trend gold trades)
- **`btc_hold_above_support`** (boolean): BTC holding above key support level
  - Example: `btc_hold_above_support: true` means BTC is holding above recent support
  - Purpose: Risk-on signal (BTC strength = risk appetite = gold support)
  - Usage: For XAUUSDc BUY plans when BTC shows strength
- **`ethbtc_ratio_deviation`** (number): ETH/BTC ratio deviation threshold (default: 1.5%)
  - Example: `ethbtc_ratio_deviation: 1.5` means ETH/BTC ratio must deviate ‚â•1.5% from mean
  - Purpose: Detect crypto market rotation (ETH outperformance = risk-on)
- **`ethbtc_divergence_direction`** (string): "bullish" or "bearish" - Direction of ETH/BTC divergence
  - Example: `ethbtc_divergence_direction: "bullish"` means ETH outperforming BTC (risk-on)
  - **Dependency**: Requires `ethbtc_ratio_deviation` to be set
- **`nasdaq_15min_bullish`** (boolean): NASDAQ 15-minute trend is bullish
  - Example: `nasdaq_15min_bullish: true` means NASDAQ showing bullish momentum
  - Purpose: Risk-on signal for gold (NASDAQ strength = risk appetite)
- **`nasdaq_correlation_confirmed`** (boolean): NASDAQ correlation confirmed
  - Example: `nasdaq_correlation_confirmed: true` means NASDAQ and symbol showing correlated movement
  - Purpose: Confirm risk-on/risk-off alignment

**2. Order Flow Microstructure Conditions (Phase 1.2 - BTC Only):**
- **`imbalance_detected`** (boolean): Order book imbalance detected
  - Example: `imbalance_detected: true` means significant bid/ask imbalance (>1.5:1 ratio)
  - Purpose: Detect institutional order flow imbalances
  - Usage: For BTCUSDc plans only (requires Binance depth stream)
- **`imbalance_direction`** (string): "buy" or "sell" - Direction of order book imbalance
  - Example: `imbalance_direction: "buy"` means more buy orders than sell orders
  - **Dependency**: Requires `imbalance_detected: true`
  - Purpose: Confirm direction of institutional pressure
- **`spoof_detected`** (boolean): Spoofing detection (large orders disappearing quickly)
  - Example: `spoof_detected: true` means large order (>$10k) appeared and disappeared <5 seconds
  - Purpose: Detect manipulation attempts (often precedes reversals)
  - Usage: For BTCUSDc reversal plans
- **`bid_rebuild_speed`** (number): Bid side rebuild speed threshold (orders/second, default: 0.5)
  - Example: `bid_rebuild_speed: 0.5` means bid side rebuilding at ‚â•0.5 orders/second
  - Purpose: Detect liquidity recovery after sweep (bullish signal)
- **`ask_decay_speed`** (number): Ask side decay speed threshold (orders/second, default: 0.3)
  - Example: `ask_decay_speed: 0.3` means ask side decaying at ‚â•0.3 orders/second
  - Purpose: Detect selling pressure exhaustion (bullish signal)
- **`liquidity_rebuild_confirmed`** (boolean): Liquidity rebuild confirmed (rebuild > decay by >0.2 for >30 seconds)
  - Example: `liquidity_rebuild_confirmed: true` means liquidity recovering (bullish for BUY plans)
  - Purpose: Confirm institutional support returning

**3. Volatility Pattern Recognition Conditions (Phase 2.1):**
- **`consecutive_inside_bars`** (number): Number of consecutive inside bars (default: 3)
  - Example: `consecutive_inside_bars: 3` means 3+ consecutive inside bars detected
  - Purpose: Detect compression before breakout
  - Usage: For breakout/volatility trap plans
- **`volatility_fractal_expansion`** (boolean): Volatility fractal expansion detected
  - Example: `volatility_fractal_expansion: true` means BB width expanded >20% AND ATR increased >15% within 3-5 bars
  - Purpose: Confirm volatility breakout (expansion after compression)
  - Usage: For breakout continuation plans
- **`iv_collapse_detected`** (boolean): Implied volatility collapse detected
  - Example: `iv_collapse_detected: true` means IV/ATR collapsed >30%
  - Purpose: Detect volatility compression (pre-breakout setup)
- **`volatility_recoil_confirmed`** (boolean): Volatility recoil confirmed
  - Example: `volatility_recoil_confirmed: true` means IV/ATR collapsed >30% then rebounded >15% within 5-10 bars
  - Purpose: Confirm mean reversion setup (volatility returning to normal)
  - Usage: For mean reversion plans
- **`mean_reversion_target`** (number): Mean reversion target (ATR multiple, default: 0.5)
  - Example: `mean_reversion_target: 0.5` means target is 0.5√ó ATR from mean
  - Purpose: Set TP for mean reversion trades
- **`rmag_atr_ratio`** (number): RMAG/ATR ratio threshold (default: 5.0)
  - Example: `rmag_atr_ratio: 5.0` means RMAG must be >5√ó ATR
  - Purpose: Detect extreme momentum (overbought/oversold)
  - Usage: For reversal/fade plans
- **`bb_width_rising`** (boolean): Bollinger Band width rising
  - Example: `bb_width_rising: true` means BB width increasing over last 3+ bars
  - Purpose: Confirm volatility expansion
- **`impulse_continuation_confirmed`** (boolean): Impulse continuation confirmed
  - Example: `impulse_continuation_confirmed: true` means RMAG >5 ATR AND BB width rising for 3+ bars
  - Purpose: Confirm strong momentum continuation
  - Usage: For trend continuation plans

**4. Institutional Signature Detection Conditions (Phase 2.2):**
- **`overlapping_obs_count`** (number): Number of overlapping order blocks (default: 3)
  - Example: `overlapping_obs_count: 3` means 3+ overlapping OBs detected within 1 hour
  - **Dependency**: Requires `mitigation_block: true` or `order_block: true`
  - Purpose: Detect mitigation cascade (institutional accumulation/distribution)
- **`mitigation_cascade_confirmed`** (boolean): Mitigation cascade confirmed
  - Example: `mitigation_cascade_confirmed: true` means 3+ overlapping OBs confirmed (institutional pattern)
  - **Dependency**: Requires `mitigation_block: true` or `order_block: true`
  - Purpose: Confirm institutional participation
- **`breaker_retest_count`** (number): Number of breaker retests (default: 2)
  - Example: `breaker_retest_count: 2` means 2+ retests of broken OB within 1 hour
  - **Dependency**: Requires `breaker_block: true`
  - Purpose: Detect breaker retest chain (institutional confirmation pattern)
- **`breaker_retest_chain_confirmed`** (boolean): Breaker retest chain confirmed
  - Example: `breaker_retest_chain_confirmed: true` means 2+ retests confirmed, price holding above/below
  - **Dependency**: Requires `breaker_block: true`
  - Purpose: Confirm institutional confirmation (strong reversal signal)
- **`liquidity_vacuum_refill`** (boolean): Liquidity vacuum refill detected
  - Example: `liquidity_vacuum_refill: true` means FVG + imbalance combo detected
  - **Dependency**: Requires both `fvg_bull`/`fvg_bear` AND `imbalance_detected: true`
  - Purpose: Detect institutional liquidity refill (strong continuation signal)

**5. Multi-Timeframe Confluence Conditions (Phase 3):**
- **`choch_bull_m5`** (boolean): CHOCH bullish on M5 timeframe
  - Example: `choch_bull_m5: true` means M5 structure flipped bullish
  - Purpose: Lower timeframe structure confirmation
- **`choch_bear_m5`** (boolean): CHOCH bearish on M5 timeframe
  - Example: `choch_bear_m5: true` means M5 structure flipped bearish
- **`choch_bull_m15`** (boolean): CHOCH bullish on M15 timeframe
  - Example: `choch_bull_m15: true` means M15 structure flipped bullish
  - Purpose: Higher timeframe structure confirmation
- **`choch_bear_m15`** (boolean): CHOCH bearish on M15 timeframe
  - Example: `choch_bear_m15: true` means M15 structure flipped bearish
- **`bos_bull_m15`** (boolean): BOS bullish on M15 timeframe
  - Example: `bos_bull_m15: true` means M15 breakout of structure confirmed
- **`bos_bear_m15`** (boolean): BOS bearish on M15 timeframe
  - Example: `bos_bear_m15: true` means M15 breakdown of structure confirmed
- **`m1_pullback_confirmed`** (boolean): M1 pullback confirmed
  - Example: `m1_pullback_confirmed: true` means price retraced 30-50% of structure break move within 10-20 M1 bars, then bounced
  - Purpose: Lower timeframe pullback entry (better entry price)
  - Usage: For M15 BOS + M1 pullback plans
- **`fvg_bull_m30`** (boolean): FVG bullish on M30 timeframe
  - Example: `fvg_bull_m30: true` means M30 fair value gap detected (bullish)
- **`fvg_bear_m30`** (boolean): FVG bearish on M30 timeframe
  - Example: `fvg_bear_m30: true` means M30 fair value gap detected (bearish)
- **Multi-TF Alignment**: When multiple timeframe conditions are specified (e.g., `choch_bull_m5` + `choch_bull_m15`), system automatically validates alignment across timeframes
  - Purpose: Ensure structure alignment across multiple timeframes (higher probability)

**6. Adaptive Scenario Conditions (Phase 3):**
- **`news_absorption_filter`** (boolean): News absorption filter enabled
  - Example: `news_absorption_filter: true` means plan will NOT execute during high-impact news
  - Purpose: Avoid execution during volatile news events
  - Usage: For all plans during high-impact news periods (CPI, FOMC, NFP)
- **`news_blackout_window`** (number): Minutes before/after news to block execution (default: 15)
  - Example: `news_blackout_window: 15` means block execution 15 minutes before and after news
  - **Dependency**: Requires `news_absorption_filter: true`
  - Purpose: Set blackout window around news events
- **`high_impact_news_types`** (array): List of news types to filter (e.g., ["CPI", "FOMC"])
  - Example: `high_impact_news_types: ["CPI", "FOMC"]` means filter CPI and FOMC events
  - **Dependency**: Requires `news_absorption_filter: true`
  - Purpose: Specify which news types to avoid
- **`post_news_reclaim`** (boolean): Post-news price reclaim enabled
  - Example: `post_news_reclaim: true` means wait for price to reclaim pre-news level
  - Purpose: Enter after news volatility settles and price reclaims pre-news level
- **`pre_news_level`** (number): Pre-news price level to reclaim
  - Example: `pre_news_level: 92000` means wait for price to reclaim 92000 (pre-news level)
  - **Dependency**: Requires `post_news_reclaim: true`
- **`price_reclaim_confirmed`** (boolean): Price reclaim confirmed
  - Example: `price_reclaim_confirmed: true` means price has reclaimed pre-news level
  - **Dependency**: Requires `post_news_reclaim: true`
- **`cvd_flip_confirmed`** (boolean): CVD flip confirmed (for BTC only)
  - Example: `cvd_flip_confirmed: true` means CVD flipped from bearish to bullish (or vice versa)
  - Purpose: Confirm order flow reversal after news
  - Usage: For BTCUSDc post-news plans

**7. Momentum Decay Detection Conditions (Phase 4):**
- **`momentum_decay_trap`** (boolean): Momentum decay trap detected
  - Example: `momentum_decay_trap: true` means momentum is aging/decaying (reversal signal)
  - Purpose: Detect when strong momentum is losing steam (fade opportunity)
- **`rsi_divergence_detected`** (boolean): RSI divergence detected
  - Example: `rsi_divergence_detected: true` means price making new highs/lows but RSI not confirming
  - Purpose: Early reversal signal (momentum weakening)
- **`macd_divergence_detected`** (boolean): MACD divergence detected
  - Example: `macd_divergence_detected: true` means price making new highs/lows but MACD not confirming
  - Purpose: Confirm momentum divergence (stronger signal than RSI alone)
- **`tick_rate_declining`** (boolean): Tick rate declining
  - Example: `tick_rate_declining: true` means tick rate decreasing (momentum fading)
  - Purpose: Detect momentum exhaustion (for BTC only, requires tick data)
- **`momentum_decay_confirmed`** (boolean): Momentum decay confirmed
  - Example: `momentum_decay_confirmed: true` means multiple decay signals confirmed (RSI + MACD + tick rate)
  - Purpose: Strong reversal confirmation (multiple indicators aligned)

**8. Missing Conditions (Phase III - January 2026):**

**8.1 Quantitative Conditions (All symbols):**
- **`bb_retest`** (boolean): Bollinger Band retest after break
  - Example: `bb_retest: true, "timeframe": "M15"` means price broke BB, then retested the broken level
  - Purpose: Confirm BB break with retest bounce (higher probability entry)
  - Parameters: `bb_retest_tolerance` (default: 0.5%), `bb_retest_lookback` (default: 30 candles)
  - Usage: For mean reversion or continuation after BB break
- **`zscore`** (boolean): Statistical mean reversion (z-score)
  - Example: `zscore: true, "z_threshold": 2.0` means price is 2+ standard deviations from mean
  - Purpose: Detect extreme price deviation (mean reversion opportunity)
  - Parameters: `z_threshold` (default: 2.0 standard deviations)
  - Usage: For mean reversion strategies when price is stretched
- **`atr_stretch`** (boolean): Price stretched beyond ATR multiple
  - Example: `atr_stretch: true, "atr_multiple": 2.5` means price is 2.5x ATR from reference
  - Purpose: Detect overextension (reversal opportunity)
  - Parameters: `atr_multiple` (default: 2.5x ATR)
  - Usage: For reversal trades when price is overextended

**8.2 Correlation Conditions (BTCUSDc, XAUUSDc):**
- **`spx_up_pct`** (float): S&P 500 percentage change threshold
  - Example: `correlation_asset: "SPX", "spx_up_pct": 0.5` means SPX must be up 0.5%+ (risk-on signal)
  - Purpose: Align with macro risk sentiment (SPX up = risk-on = BTC/XAU bullish)
  - Parameters: `spx_up_pct` (default: 0.5%), `spx_change_window` (default: 60 minutes)
  - ‚ö†Ô∏è **REQUIRES**: `correlation_asset: "SPX"` or `"SP500"`
  - Usage: For BTC/XAU BUY plans when expecting risk-on sentiment
- **`yield_drop`** (float): US 10Y yield drop threshold
  - Example: `correlation_asset: "US10Y", "yield_drop": 0.05` means yield must drop 0.05+ (risk-on signal)
  - Purpose: Align with bond market sentiment (yield down = risk-on = BTC/XAU bullish)
  - Parameters: `yield_drop` (default: 0.05 absolute change), `yield_change_window` (default: 60 minutes)
  - ‚ö†Ô∏è **REQUIRES**: `correlation_asset: "US10Y"` or `"TNX"`
  - Usage: For BTC/XAU BUY plans when bond yields are falling
- **`correlation_divergence`** (boolean): DXY and symbol moving opposite
  - Example: `correlation_asset: "DXY", "correlation_divergence": true` means DXY and symbol diverging
  - Purpose: Detect inverse correlation breakdown (strong directional signal)
  - ‚ö†Ô∏è **REQUIRES**: `correlation_asset: "DXY"`
  - Usage: For XAU/BTC plans when dollar and asset moving opposite (strong signal)

**8.3 Session Conditions (All symbols):**
- **`volatility_decay`** (boolean): ATR decreasing over time
  - Example: `volatility_decay: true, "session": "NY_close", "decay_threshold": 0.8` means ATR decreased 20%+ in NY close
  - Purpose: Detect volatility compression (reversion opportunity)
  - Parameters: `decay_threshold` (default: 0.8 = 20% decrease), `decay_window` (default: 5 candles)
  - ‚ö†Ô∏è **REQUIRES**: `session` parameter (e.g., "NY_close", "London", "Asian")
  - Usage: For reversion trades when volatility is decaying
- **`momentum_follow`** (boolean): Consistent price momentum
  - Example: `momentum_follow: true, "session": "NY", "momentum_periods": 5` means consistent momentum in NY session
  - Purpose: Confirm continuation momentum (trend following)
  - Parameters: `momentum_periods` (default: 5), `momentum_threshold` (default: 0.5%)
  - ‚ö†Ô∏è **REQUIRES**: `session` parameter
  - Usage: For continuation trades when momentum is consistent
- **`fakeout_sweep`** (boolean): False breakout then reversal
  - Example: `fakeout_sweep: true, "session": "London", "fakeout_reversal_candles": 5` means false breakout reversed within 5 candles
  - Purpose: Detect fakeout patterns (reversal opportunity)
  - Parameters: `fakeout_reversal_candles` (default: 5), `fakeout_level` (optional: specific level)
  - ‚ö†Ô∏è **REQUIRES**: `session` parameter
  - Usage: For reversal trades after false breakouts
- **`flat_vol_hours`** (integer): Low stable volatility for N hours
  - Example: `flat_vol_hours: 3, "session": "Asian"` means 3+ hours of low stable volatility in Asian session
  - Purpose: Detect accumulation ranges (breakout opportunity)
  - Parameters: `flat_vol_hours` (default: 3), `flat_vol_threshold` (optional: ATR threshold)
  - ‚ö†Ô∏è **REQUIRES**: `session` parameter
  - Usage: For breakout trades after extended low volatility

**8.4 Pattern Conditions (All symbols):**
- **`pattern_evening_morning_star`** (boolean): Three-candle reversal pattern
  - Example: `pattern_evening_morning_star: true, "timeframe": "M15"` means evening/morning star pattern detected
  - Purpose: Detect classic reversal patterns (strong reversal signal)
  - Parameters: `star_body_ratio` (default: 0.3 = 30% of range), `gap_threshold` (default: 0.5% of price)
  - Usage: For reversal trades when star patterns form
  - Note: System automatically detects evening star (bearish) or morning star (bullish) based on plan direction
- **`pattern_three_drive`** (boolean): Harmonic pattern with three equal moves
  - Example: `pattern_three_drive: true, "timeframe": "M15", "drive_tolerance": 0.01` means three drives to similar level detected
  - Purpose: Detect harmonic completion patterns (reversal at completion point)
  - Parameters: `drive_tolerance` (default: 0.01 = 1% of price), `fibonacci_tolerance` (default: 0.1 = 10%)
  - Usage: For reversal trades at harmonic completion points

**Phase III Condition Dependencies:**

**Critical Dependencies (Plan will fail if dependency not met):**
- `imbalance_direction` requires `imbalance_detected: true`
- `ethbtc_divergence_direction` requires `ethbtc_ratio_deviation` to be set
- `overlapping_obs_count` requires `mitigation_block: true` or `order_block: true`
- `mitigation_cascade_confirmed` requires `mitigation_block: true` or `order_block: true`
- `breaker_retest_count` requires `breaker_block: true`
- `breaker_retest_chain_confirmed` requires `breaker_block: true`
- `liquidity_vacuum_refill` requires both `fvg_bull`/`fvg_bear` AND `imbalance_detected: true`
- `news_blackout_window` requires `news_absorption_filter: true`
- `high_impact_news_types` requires `news_absorption_filter: true`
- `pre_news_level` requires `post_news_reclaim: true`
- `price_reclaim_confirmed` requires `post_news_reclaim: true`
- `spx_up_pct` requires `correlation_asset: "SPX"` or `"SP500"`
- `yield_drop` requires `correlation_asset: "US10Y"` or `"TNX"`
- `correlation_divergence` requires `correlation_asset: "DXY"`
- `volatility_decay` requires `session` parameter (e.g., "NY_close", "London", "Asian")
- `momentum_follow` requires `session` parameter
- `fakeout_sweep` requires `session` parameter
- `flat_vol_hours` requires `session` parameter

**Recommended Combinations:**
- Multi-TF plans: Use `choch_bull_m5` + `choch_bull_m15` for M5-M15 sync
- Volatility plans: Use `consecutive_inside_bars: 3` + `volatility_fractal_expansion: true` for breakout traps
- Institutional plans: Use `mitigation_block: true` + `overlapping_obs_count: 3` + `mitigation_cascade_confirmed: true` for cascade detection
- Momentum plans: Use `rsi_divergence_detected: true` + `macd_divergence_detected: true` + `momentum_decay_confirmed: true` for strong reversal signals
- Quantitative plans: Use `bb_retest: true` + `zscore: true` for mean reversion with BB confirmation
- Correlation plans: Use `correlation_asset: "SPX", "spx_up_pct": 0.5` + `correlation_asset: "DXY", "correlation_divergence": true` for macro alignment
- Session plans: Use `volatility_decay: true, "session": "NY_close"` + `momentum_follow: true, "session": "NY"` for session-specific strategies
- Pattern plans: Use `pattern_evening_morning_star: true` + `pattern_three_drive: true` for harmonic reversal confirmation

**Phase III Plan Examples:**

**Example 1: DXY Inverse Flow Plan (XAUUSDc SELL)**
```json
{
  "dxy_change_pct": 0.3,
  "dxy_stall_detected": true,
  "price_near": 4493.0,
  "tolerance": 2.0,
  "structure_tf": "M5",
  "min_confluence": 75
}
```

**Example 2: Imbalance + Spoof Trap (BTCUSDc BUY)**
```json
{
  "imbalance_detected": true,
  "imbalance_direction": "buy",
  "spoof_detected": true,
  "price_near": 92000,
  "tolerance": 200,
  "min_confluence": 75
}
```

**Example 3: Volatility Fractal Expansion (XAUUSDc BUY)**
```json
{
  "consecutive_inside_bars": 3,
  "volatility_fractal_expansion": true,
  "bb_expansion": true,
  "price_above": 4480,
  "price_near": 4482,
  "tolerance": 2.0,
  "min_confluence": 80
}
```

**Example 4: Mitigation Cascade (XAUUSDc SELL)**
```json
{
  "mitigation_block": true,
  "overlapping_obs_count": 3,
  "mitigation_cascade_confirmed": true,
  "price_near": 4495,
  "tolerance": 2.0,
  "structure_tf": "M15",
  "min_confluence": 80
}
```

**Example 5: M5-M15 CHOCH Sync (XAUUSDc BUY)**
```json
{
  "choch_bull_m5": true,
  "choch_bull_m15": true,
  "price_near": 4480,
  "tolerance": 2.0,
  "min_confluence": 80
}
```

**Example 6: News Absorption Filter (XAUUSDc - All Plans)**
```json
{
  "news_absorption_filter": true,
  "news_blackout_window": 15,
  "high_impact_news_types": ["CPI", "FOMC"],
  "price_near": 4485,
  "tolerance": 2.0,
  "min_confluence": 80
}
```

**Example 7: Momentum Decay Trap (BTCUSDc SELL)**
```json
{
  "momentum_decay_trap": true,
  "rsi_divergence_detected": true,
  "macd_divergence_detected": true,
  "momentum_decay_confirmed": true,
  "price_near": 95000,
  "tolerance": 200,
  "min_confluence": 75
}
```

**Example 8: BB Retest Mean Reversion (XAUUSDc BUY)**
```json
{
  "bb_retest": true,
  "timeframe": "M15",
  "bb_retest_tolerance": 0.5,
  "price_near": 4480,
  "tolerance": 2.0,
  "min_confluence": 70
}
```

**Example 9: Z-Score Statistical Mean Reversion (BTCUSDc SELL)**
```json
{
  "zscore": true,
  "z_threshold": 2.0,
  "timeframe": "M15",
  "price_near": 92000,
  "tolerance": 200,
  "min_confluence": 70
}
```

**Example 10: ATR Stretch Reversal (XAUUSDc SELL)**
```json
{
  "atr_stretch": true,
  "atr_multiple": 2.5,
  "timeframe": "M15",
  "price_near": 4500,
  "tolerance": 2.0,
  "min_confluence": 70
}
```

**Example 11: SPX Risk-On Correlation (BTCUSDc BUY)**
```json
{
  "correlation_asset": "SPX",
  "spx_up_pct": 0.5,
  "spx_change_window": 60,
  "price_near": 91000,
  "tolerance": 200,
  "min_confluence": 75
}
```

**Example 12: US10Y Yield Drop (XAUUSDc BUY)**
```json
{
  "correlation_asset": "US10Y",
  "yield_drop": 0.05,
  "yield_change_window": 60,
  "price_near": 4480,
  "tolerance": 2.0,
  "min_confluence": 75
}
```

**Example 13: DXY Divergence (XAUUSDc BUY)**
```json
{
  "correlation_asset": "DXY",
  "correlation_divergence": true,
  "price_near": 4480,
  "tolerance": 2.0,
  "min_confluence": 75
}
```

**Example 14: Volatility Decay NY Close (XAUUSDc SELL)**
```json
{
  "volatility_decay": true,
  "session": "NY_close",
  "decay_threshold": 0.8,
  "decay_window": 5,
  "timeframe": "M15",
  "price_near": 4490,
  "tolerance": 2.0,
  "min_confluence": 70
}
```

**Example 15: Momentum Follow NY Session (BTCUSDc BUY)**
```json
{
  "momentum_follow": true,
  "session": "NY",
  "momentum_periods": 5,
  "momentum_threshold": 0.5,
  "timeframe": "M15",
  "price_near": 91000,
  "tolerance": 200,
  "min_confluence": 75
}
```

**Example 16: Fakeout Sweep London Session (XAUUSDc SELL)**
```json
{
  "fakeout_sweep": true,
  "session": "London",
  "fakeout_reversal_candles": 5,
  "timeframe": "M15",
  "price_near": 4495,
  "tolerance": 2.0,
  "min_confluence": 75
}
```

**Example 17: Flat Volatility Hours Asian Session (XAUUSDc BUY)**
```json
{
  "flat_vol_hours": 3,
  "session": "Asian",
  "timeframe": "H1",
  "price_near": 4480,
  "tolerance": 2.0,
  "min_confluence": 70
}
```

**Example 18: Evening/Morning Star Pattern (BTCUSDc SELL)**
```json
{
  "pattern_evening_morning_star": true,
  "timeframe": "M15",
  "star_body_ratio": 0.3,
  "price_near": 92000,
  "tolerance": 200,
  "min_confluence": 75
}
```

**Example 19: Three-Drive Harmonic Pattern (XAUUSDc BUY)**
```json
{
  "pattern_three_drive": true,
  "timeframe": "M15",
  "drive_tolerance": 0.01,
  "fibonacci_tolerance": 0.1,
  "price_near": 4480,
  "tolerance": 2.0,
  "min_confluence": 75
}
```

**Phase III Usage Notes:**
- Correlation conditions (DXY, BTC, NASDAQ) work best for XAUUSDc
- Order flow conditions (imbalance, spoof, liquidity rebuild) work only for BTCUSDc (require Binance depth stream)
- Volatility pattern conditions work for all symbols
- Institutional signature conditions work for all symbols (require pattern history tracking)
- Multi-TF conditions work for all symbols (system validates alignment automatically)
- Adaptive scenario conditions work for all symbols (require news service)
- Momentum decay conditions work for all symbols (RSI/MACD) and BTCUSDc (tick rate)
- **Quantitative conditions (bb_retest, zscore, atr_stretch) work for all symbols**
- **Correlation conditions (spx_up_pct, yield_drop, correlation_divergence) work for BTCUSDc and XAUUSDc**
- **Session conditions (volatility_decay, momentum_follow, fakeout_sweep, flat_vol_hours) work for all symbols but require session parameter**
- **Pattern conditions (pattern_evening_morning_star, pattern_three_drive) work for all symbols**
- All Phase III conditions are optional and can be combined with existing conditions
- Phase III conditions are checked after basic conditions (price, structure) but before execution
- If Phase III data unavailable (e.g., Binance stream down, correlation data unavailable), system gracefully degrades (skips Phase III checks, continues with other conditions)
- Session conditions check session FIRST (performance optimization) - if session doesn't match, condition check is skipped
- Correlation conditions require correlation_calculator to be available - if unavailable, condition check fails gracefully

## Common Mistakes to Avoid

‚ùå Creating plans with only `price_near` when strategy requires `order_block`, `choch_bull`, or `price_above`
‚ùå Not matching conditions to the strategy described in reasoning/notes
‚ùå Plans execute prematurely because conditions don't match the intended strategy
‚ùå Liquidity Sweep plans missing `liquidity_sweep: true` - Will only check price, not detect sweeps
‚ùå Order Block plans missing `order_block: true` - Will only check price, not validate order blocks
‚ùå Breaker Block plans missing `breaker_block: true` - Will only check price, not validate breaker blocks
‚ùå Breaker Block plans including `ob_broken: true` or `price_retesting_breaker: true` in conditions - These are detection results, NOT condition inputs
‚ùå Using generic range scalp conditions for strategy-specific plans - Conditions MUST match strategy type
‚ùå All plans showing same conditions when they have different strategy types - Each strategy requires different conditions
‚ùå VWAP Bounce plans missing `vwap_deviation_direction`, `price_near`, or `tolerance` - Will NOT trigger
‚ùå Using `min_confluence` for range scalping - Should use `range_scalp_confluence` instead
‚ùå Creating confluence-only plans without price conditions - ALL plans with `min_confluence` require at least one price condition
‚ùå Using both `min_confluence` and `range_scalp_confluence` - `range_scalp_confluence` takes precedence
‚ùå Using multiple volume conditions without understanding they all must pass - All specified volume conditions must pass for execution
‚ùå Using `volume_confirmation` for non-BTCUSD symbols expecting buy/sell separation - Only BTCUSD uses Binance data, others use volume spike
‚ùå Using Phase III order flow conditions (imbalance, spoof, liquidity rebuild) for non-BTC symbols - These require Binance depth stream (BTC only)
‚ùå Using `imbalance_direction` without `imbalance_detected: true` - Dependency violation (plan will fail)
‚ùå Using `overlapping_obs_count` or `mitigation_cascade_confirmed` without `mitigation_block` or `order_block` - Dependency violation
‚ùå Using `breaker_retest_count` or `breaker_retest_chain_confirmed` without `breaker_block: true` - Dependency violation
‚ùå Using `liquidity_vacuum_refill` without both `fvg_bull`/`fvg_bear` AND `imbalance_detected` - Dependency violation
‚ùå Using `news_blackout_window` or `high_impact_news_types` without `news_absorption_filter: true` - Dependency violation
‚ùå Using `pre_news_level` or `price_reclaim_confirmed` without `post_news_reclaim: true` - Dependency violation
‚ùå Using correlation conditions (DXY, NASDAQ) for BTC plans - These work best for XAUUSDc
‚ùå Creating Phase III plans without understanding condition dependencies - Check dependency requirements before creating plans

‚úÖ Always match conditions to strategy type
‚úÖ Use `range_scalp_confluence` for range scalping, `min_confluence` for other strategies
‚úÖ Include price conditions (price_near/price_above/price_below) with all confluence-based plans
‚úÖ Use volume conditions to add volume-based validation when market conditions warrant (e.g., breakout confirmation, trend validation)
‚úÖ For BTCUSD, use `volume_confirmation` to leverage Binance buy/sell volume separation
‚úÖ For other symbols, use `volume_spike` or `volume_ratio` for volume validation
‚úÖ For Phase III plans, always check condition dependencies before creating plans
‚úÖ Use Phase III order flow conditions (imbalance, spoof, liquidity rebuild) ONLY for BTCUSDc plans
‚úÖ Use Phase III correlation conditions (DXY, BTC, NASDAQ) for XAUUSDc plans
‚úÖ Combine Phase III conditions with existing conditions for higher probability setups

---

# PLAN_PORTFOLIO_WORKFLOW

plan_portfolio_workflow:
  - always_analyze_first: moneybot.analyse_symbol_full
  - extract_required_data:
    - volatility_regime.regime
    - volatility_regime.strategy_recommendations.prioritize
    - volatility_regime.strategy_recommendations.avoid
    - session.name
    - symbol_constraints
    - structure_summary
    - current_price (MANDATORY for dual plan detection)
  - create_diverse_portfolio:
    - total_plans: 3-5 (4-6 if dual plans added)
    - mix_condition_based: OB, breaker_block, liquidity_sweep, CHOCH
    - mix_confluence_only: range_scalp, mean_reversion with min_confluence
    - include_both_directions: BUY and SELL when market supports
    - different_entry_levels: range_boundaries, OB_zones, liquidity_zones
  - strategy_alignment:
    - match_volatility_regime
    - match_session
    - match_symbol_type
    - weekend_mode_awareness: BTCUSDc only (Fri 23:00 UTC ‚Üí Mon 03:00 UTC)

# DUAL_PLAN_STRATEGY

dual_plan_strategy:
  detection:
    - retracement_indicator: entry_price > current_price (SELL) OR entry_price < current_price (BUY)
    - minimum_separation_threshold:
      - BTC: 50 pts
      - XAU: 10 pts
      - Forex: 0.0003
    - check_separation:
      - SELL: entry_price - current_price > minimum_distance
      - BUY: current_price - entry_price > minimum_distance
    - if_separation_sufficient: create_continuation_plan
    - if_too_close: do_not_create_dual_plan
  
  retracement_plan:
    - entry: above_current (SELL) or below_current (BUY)
    - strategy: reversal_pullback (OB_rejection, CHOCH_confirmation)
    - conditions: choch_bear/bull, order_block, price_near (retest_zone)
  
  continuation_plan:
    - entry: below_current (SELL) or above_current (BUY)
    - strategy: trend_continuation (BOS_confirmation, breakdown_breakout)
    - conditions:
      - bos_bear/bull (BOS_confirmation)
      - price_below (SELL) OR price_above (BUY) - MUST match plan direction
      - price_near: MUST equal continuation entry exactly (NOT retracement entry)
      - tolerance: symbol_appropriate (BTC=100, XAU=5, Forex=0.001) or 75-90% of retracement tolerance
      - timeframe: match_retracement or lower (M5 if retracement is M15)
    - stop_loss:
      - SELL: retracement_entry + buffer (BTC: 50-100 pts, XAU: 5-10 pts, Forex: 0.0001-0.0003)
      - BUY: retracement_entry - buffer (same values)
    - take_profit: extended_target (range_extension, structure_level, 1.5-2x R:R ratio)
    - required_fields:
      - symbol: MUST match retracement plan exactly
      - plan_type: MUST be one of: auto_trade, choch, rejection_wick (NOT order_block, range_scalp, micro_scalp)
      - direction: MUST match retracement plan direction
      - volume: MUST match retracement plan volume exactly
      - expires_hours: MUST match retracement plan expires_hours exactly
      - notes: MUST include "Continuation plan for retracement plan [retracement_plan_id]"
    - validation_before_batch:
      - entry: positive, non_zero, reasonable_for_symbol
      - SL: correctly_positioned (above entry for SELL, below entry for BUY)
      - TP: correctly_positioned (below entry for SELL, above entry for BUY)
      - price_near: matches_entry_exactly
      - price_condition: matches_plan_direction (price_below for SELL, price_above for BUY)
  
  creation:
    - tool: moneybot.create_multiple_auto_plans
    - both_plans_in_same_batch: true
    - applies_to: portfolio_creation AND single_plan_requests
  
  after_creation:
    - check_batch_response: partial_failures
    - if_retracement_succeeds_continuation_fails: explain_error_and_offer_retry
    - if_both_succeed: update_continuation_notes_with_retracement_plan_id
    - inform_user: "Both plans can execute independently. If both trigger, total position will be [2x volume]."

# TOLERANCE_ZONE_EXECUTION

tolerance_zone_execution:
  - concept: Tolerance creates execution zone, not exact price match
  - zone_definition: entry_price ¬± tolerance
  - execution_rules:
    - BUY: Execute when price is at or below (entry_price + tolerance)
    - SELL: Execute when price is at or above (entry_price - tolerance)
  - zone_entry_detection:
    - system_tracks: Whether price is currently in zone
    - entry_detected: When price transitions from outside to inside zone
    - execute_once: Plan executes once when entering zone (not continuously)
    - retry_on_re_entry: If price exits zone before execution, plan retries on re-entry
  - state_tracking:
    - zone_entry_tracked: Boolean flag (persisted to database)
    - zone_entry_time: Timestamp when price first entered zone
    - zone_exit_time: Timestamp when price exited zone (if applicable)
  - tolerance_recommendations:
    - BTCUSDc: 0.1-0.3% (100-300 points) - higher volatility requires wider tolerance
      - Maximum enforced: 200 points (system caps excessive tolerance)
    - XAUUSDc: 0.05-0.15% (5-10 points) - moderate volatility
      - ‚ö†Ô∏è CRITICAL: Maximum enforced: 10 points (system caps excessive tolerance)
      - Default: 7.0 points (auto-calculated if not specified)
      - Previous recommendations of 50+ points are INVALID and will be capped
    - Forex_pairs: 0.02-0.05% (2-5 pips) - lower volatility
      - Maximum enforced: 0.01 (system caps excessive tolerance)
  - tolerance_enforcement:
    - maximum_tolerance_capping: System automatically caps tolerance at symbol-specific maximums
    - xauusdc_max: 10.0 points (prevents poor fills like $4460.41 entry when planned $4452.00)
    - btcusdc_max: 200.0 points
    - forex_max: 0.01
    - warning_logged: System logs WARNING when tolerance is capped
  - volatility_based_adjustment:
    - enabled: Automatic tolerance adjustment based on RMAG (Relative Moving Average Gap) and ATR
    - rmag_adjustment:
      - rmag > 3.0œÉ: Kill-switch activated (execution blocked, tolerance = 10% of base)
      - rmag > 2.5œÉ: Tolerance reduced by 40% (high volatility)
      - rmag > 2.0œÉ: Tolerance reduced by 25% (elevated volatility)
      - rmag < 1.0œÉ: Tolerance tightened by 10% (stable market)
    - atr_adjustment:
      - symbol_specific_multipliers:
        - XAUUSDc: 0.4x ATR (tighter control)
        - BTCUSDc: 0.5x ATR
        - Forex: 0.3x ATR (very tight)
      - capping: min(ATR*multiplier, base_tolerance*cap_multiplier)
      - xauusdc_cap: 1.2x base tolerance (max 20% above base)
      - btcusdc_cap: 1.3x base tolerance (max 30% above base)
      - forex_cap: 1.1x base tolerance (max 10% above base)
    - logging: INFO-level logs for adjustments >10% change
  - pre_execution_buffer_check:
    - enabled: System validates price before execution
    - buy_orders: Rejects if ask > entry_price + buffer
    - sell_orders: Rejects if bid < entry_price - buffer
    - buffer_values:
      - xauusdc: 3.0 points (default), 5.0 (high_vol), 2.0 (low_vol)
      - btcusdc: 30.0 points (default), 50.0 (high_vol), 20.0 (low_vol)
      - forex: 30% of tolerance
    - config_driven: Buffers can be configured in config/tolerance_config.json
    - volatility_aware: Buffer selection adapts to RMAG-based volatility regime
    - purpose: Prevents poor fills when price has moved significantly before execution
  - best_practices:
    - wider_tolerance_when: High volatility, price may bounce, range trading, news events
    - narrower_tolerance_when: Stable markets, precise entries, tight stops, low volatility
  - integration:
    - always_include: tolerance in conditions dict when using price_near
    - auto_calculation: If omitted, system auto-calculates based on symbol type
    - api_endpoints: GET /auto-execution/plan/{plan_id}/zone-status for zone status
  - detailed_guide: See 22.ADAPTIVE_AUTO_EXECUTION_FEATURES.md (Part 1: Tolerance Zone Execution) for comprehensive guide

# TOLERANCE_SYSTEM_IMPROVEMENTS (January 2026)

## Overview
The tolerance system has been enhanced to prevent poor entry fills and R:R degradation. These improvements address issues where plans executed at prices far from intended entry (e.g., $4460.41 when planned $4452.00 for XAUUSDc).

## Key Improvements

### 1. Maximum Tolerance Enforcement
- **Problem**: Plans were being created with excessive tolerance (e.g., 50.0 for XAUUSDc)
- **Solution**: System automatically caps tolerance at symbol-specific maximums
- **Impact**: Prevents tolerance zone from being too wide, reducing risk of poor fills

### 2. Volatility-Based Tolerance Adjustment
- **Problem**: Static tolerance doesn't adapt to market volatility conditions
- **Solution**: Dynamic tolerance adjustment based on RMAG (Relative Moving Average Gap) and ATR
- **Impact**: Tighter tolerance in high volatility (reduces slippage risk), appropriate tolerance in stable markets

### 3. Pre-Execution Buffer Check
- **Problem**: Price can move significantly between zone entry detection and actual execution
- **Solution**: Final price validation before execution with configurable buffers
- **Impact**: Blocks executions when ask/bid price exceeds planned entry + buffer

### 4. Kill-Switch for Extreme Volatility
- **Problem**: Executions during extreme volatility (RMAG > 3œÉ) can result in poor fills
- **Solution**: Hard reject when RMAG exceeds threshold (configurable per symbol)
- **Impact**: Prevents executions during flash moves, gaps, and news spikes

## Usage Guidelines

### Tolerance Recommendations (Updated)
- **XAUUSDc**: 5-10 points (NOT 50+ points)
  - Default: 7.0 points (auto-calculated)
  - Maximum: 10.0 points (enforced)
  - Buffer: 3.0 points (default)
- **BTCUSDc**: 100-200 points
  - Default: 100.0 points
  - Maximum: 200.0 points (enforced)
  - Buffer: 30.0 points (default)
- **Forex**: 2-5 pips
  - Default: 0.001
  - Maximum: 0.01 (enforced)
  - Buffer: 30% of tolerance

### Best Practices
1. **Don't Override Tolerance**: Let system auto-calculate or use recommended ranges
2. **Trust Volatility Adjustment**: System automatically tightens tolerance in high volatility
3. **Monitor Kill-Switch**: If plans are frequently blocked, market may be too volatile
4. **Use Config for Buffers**: Adjust execution buffers via config file, not code

### What Changed for ChatGPT
- **Before**: Could specify tolerance=50.0 for XAUUSDc (would be accepted)
- **After**: tolerance=50.0 will be capped to 10.0 with warning log
- **Recommendation**: Use tolerance=7.0 (default) or 5-10 range for XAUUSDc
- **Volatility Awareness**: System now automatically adjusts tolerance based on RMAG/ATR
- **Pre-Execution Safety**: System validates price one final time before execution

## Example Plan Updates

### Before (Problematic)
```json
{
  "symbol": "XAUUSDc",
  "entry_price": 4452.00,
  "conditions": {
    "price_near": 4452.00,
    "tolerance": 50.0  // ‚ùå Too wide, will be capped to 10.0
  }
}
```

### After (Recommended)
```json
{
  "symbol": "XAUUSDc",
  "entry_price": 4452.00,
  "conditions": {
    "price_near": 4452.00,
    "tolerance": 7.0  // ‚úÖ Within recommended range, will be used as-is
  }
}
```

### With Volatility Adjustment (Automatic)
```json
{
  "symbol": "XAUUSDc",
  "entry_price": 4452.00,
  "conditions": {
    "price_near": 4452.00
    // tolerance omitted - system auto-calculates 7.0, then adjusts based on RMAG/ATR
    // If RMAG > 2.5œÉ: adjusted to 4.2 (40% reduction)
    // If RMAG < 1.0œÉ: adjusted to 6.3 (10% tightening)
  }
}
```

# MULTI_LEVEL_ENTRY_STRATEGY

multi_level_entry:
  - concept: Multiple entry levels for same plan (Phase 2)
  - parameter: entry_levels (optional array)
  - structure: [{"price": float (required), "weight": float (optional), "sl_offset": float (optional), "tp_offset": float (optional)}]
  - ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL EXECUTION BEHAVIOR - MANDATORY UNDERSTANDING:
    - execution_count: Plan executes ONCE when FIRST level enters tolerance zone (NOT multiple times, NOT once per level)
    - volume_behavior: FULL plan volume executes at triggered level (NO partial fills, NO proportional volume, NO weight-based allocation)
    - weight_purpose: Weight field is NOT used for volume allocation - full volume executes regardless of weight value
    - monitoring_behavior: After execution, plan stops monitoring (does NOT continue watching other levels, does NOT wait for other levels)
    - forbidden_phrases:
      - ‚ùå "partial positions" or "partial fills" or "partial entries"
      - ‚ùå "each level executes independently" or "each level acts as a micro-plan"
      - ‚ùå "proportional volume" or "weight controls volume" or "layered entries with proportional sizing"
      - ‚ùå "scales in automatically" or "additional volume is added" or "scales in gradually"
      - ‚ùå "monitored separately" or "monitors them independently" or "executes when its price zone is reached" (plural)
      - ‚ùå "executed_weight, pending_weight" or "records progress" or "tracks progress"
    - correct_phrases:
      - ‚úÖ "Plan executes ONCE when first level enters zone"
      - ‚úÖ "Full volume executes at triggered level"
      - ‚úÖ "Single execution, not multiple"
      - ‚úÖ "Plan stops monitoring after execution"
    - DO_NOT_DESCRIBE_AS: "Partial fills", "multiple executions", "proportional volume", "each level executes independently", "scales in", "monitored separately"
    - CORRECT_DESCRIPTION: "Single plan, single execution, full volume at first level that enters zone. Plan stops monitoring after execution."
  - execution_logic: First level in array to enter tolerance zone triggers execution (ONCE, with full volume)
  - sl_tp_calculation: Uses triggered level's offsets if provided, otherwise uses plan SL/TP
  - when_to_use:
    - order_block_zones: Multiple OB levels at different prices
    - liquidity_sweep_areas: Sweep + retest levels
    - range_boundaries: Support + resistance levels
    - trend_continuation: Pullback + breakout levels
  - best_practices:
    - recommended_levels: 2-3 levels (not too many)
    - meaningful_levels: Base on technical analysis (OB, support/resistance, Fibonacci)
    - level_spacing: At least 1x tolerance apart for clear separation
    - priority_order: Place most important level first in array
  - validation:
    - all_prices_positive: Required
    - minimum_spacing: 50% of tolerance between levels
    - maximum_levels: 10 per plan
    - auto_sort: By price (ascending BUY, descending SELL)
  - detailed_guide: See 22.ADAPTIVE_AUTO_EXECUTION_FEATURES.md (Part 2: Multi-Level Entry Strategy) for comprehensive guide

# CONDITIONAL_CANCELLATION

## ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL: WHAT CANCELLATION CONDITIONS ARE ACTUALLY IMPLEMENTED ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è

**MANDATORY:** When describing cancellation risk, ONLY mention these two implemented conditions:
1. **Price Distance Cancellation** - Price moves beyond threshold (BTCUSDc: 0.5%, XAUUSDc: 0.3%, Forex: 0.2%)
2. **Time-Based Cancellation** - Plan >24h old AND price >0.3% away from entry

**‚ùå FORBIDDEN - DO NOT MENTION THESE AS ACTIVE CANCELLATION CONDITIONS:**
- Session switch cancellation, session transition, "Session Switch Flare"
- News blackout, high-impact event cancellation
- Volatility regime changes, volatility-structure alignment cancellation
- Symbol constraint breach, max concurrent trades exceeded
- CHOCH/BOS invalidation cancellation
- Server restart cleanup, duplicate plan detection, data integrity failure

**WHEN CHECKING CANCELLATION RISK:**
- ‚úÖ Check: Price distance from entry, time since creation, expiry time remaining
- ‚ùå Do NOT check: Session switches, news events, volatility regime changes, structure breaks

---

conditional_cancellation:
  - concept: Automatic cancellation of plans when conditions become invalid (Phase 3)
  - ‚ö†Ô∏è **IMPLEMENTATION STATUS:** Only price_distance and time_based are fully implemented. Structure and condition_invalidation are enabled but placeholders.
  - cancellation_conditions:
    - price_distance:
      - status: ‚úÖ **FULLY IMPLEMENTED**
      - description: Price moves beyond threshold away from entry (symbol-specific)
      - thresholds: BTCUSDc: 0.5%, XAUUSDc: 0.3%, Forex: 0.2%
      - check_interval: Every 5 minutes
    - time_based:
      - status: ‚úÖ **FULLY IMPLEMENTED**
      - description: Plan is old (>24h) and price hasn't approached entry (>0.3% away)
      - max_age_hours: 24
    - structure:
      - status: ‚ö†Ô∏è **ENABLED BUT PLACEHOLDER** (TODO: integrate with multi_timeframe_analyzer)
      - description: Market structure invalidates setup (support/resistance broken)
      - note: Do NOT describe this as actively cancelling plans - it's a placeholder
    - condition_invalidation:
      - status: ‚ö†Ô∏è **ENABLED BUT SIMPLIFIED** (TODO: implement full validation)
      - description: Original conditions become impossible
      - note: Do NOT describe specific condition checks (order block, liquidity sweep) as active - they're TODOs
  - ‚ö†Ô∏è **NOT IMPLEMENTED (Do NOT mention these):**
    - Session switch cancellation
    - News blackout cancellation
    - Volatility-structure alignment cancellation
    - Symbol constraint breach cancellation
    - CHOCH/BOS invalidation cancellation
    - Server restart cleanup
    - Duplicate plan detection
    - Data integrity failure cancellation
  - priority_levels:
    - high: Condition invalidation, structure cancellation (risk: 1.0)
    - medium: Price distance cancellation (risk: 0.7)
    - low: Time-based cancellation (risk: 0.4)
  - checking_status:
    - tool: moneybot.get_auto_plan_status
    - response_fields: cancellation_risk (0-1), cancellation_reasons (array), cancellation_priority, cancellation_reason
    - interpretation: Risk >0.8 indicates cancellation likely imminent
  - ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è **FORBIDDEN PHRASES (Do NOT use these - they describe unimplemented features):**
    - ‚ùå "Session switch ‚Üí may trigger auto-cancel"
    - ‚ùå "News blackout cancellation"
    - ‚ùå "Volatility regime changes trigger invalidation"
    - ‚ùå "Session Switch Flare invalidator"
    - ‚ùå "Symbol constraint breach cancellation"
    - ‚ùå "CHOCH/BOS invalidation cancellation"
    - ‚ùå "Structure breaks trigger cancellation"
  - ‚úÖ **CORRECT PHRASES (Only mention implemented conditions):**
    - ‚úÖ "Price distance: X.XX% away from entry (threshold: Y.YY%)"
    - ‚úÖ "Time-based: Plan is X.X hours old, price is Y.YY% away"
    - ‚úÖ "Cancellation risk based on: Price distance, time since creation, expiry time remaining"
  - best_practices:
    - monitor_plans: Periodically check cancellation_risk for pending plans
    - appropriate_tolerance: Use appropriate tolerance to avoid premature cancellation
    - update_if_needed: Update plans if setup still valid, cancel if invalid
  - configuration: Symbol-specific thresholds in config/auto_execution_adaptive_config.json
  - detailed_guide: See 22.ADAPTIVE_AUTO_EXECUTION_FEATURES.md (Part 3: Conditional Cancellation) for comprehensive guide

# PLAN_RE_EVALUATION

## ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL: WHAT RE-EVALUATION TRIGGERS ARE ACTUALLY IMPLEMENTED ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è

**MANDATORY:** When describing re-evaluation, ONLY mention these two implemented triggers:
1. **Price Movement Trigger** - Price moves >0.2% from entry (configurable)
2. **Time-Based Trigger** - Every 4 hours (configurable)

**‚ùå FORBIDDEN - DO NOT MENTION THESE AS ACTIVE RE-EVALUATION TRIGGERS:**
- Session switch trigger, session transition re-evaluation
- Price distance check every 5 minutes (this is for CANCELLATION, not re-evaluation)
- Volatility regime change trigger (DISABLED in config)
- Structure change trigger (placeholder only)
- News check trigger, news blackout trigger
- Symbol constraint breach trigger
- CHOCH/BOS invalidation trigger
- Hourly re-evaluation (WRONG - it's every 4 hours)
- "Re-evaluation runs every 5-60 minutes depending on trigger" (WRONG - only 2 triggers implemented)

**WHEN DESCRIBING RE-EVALUATION:**
- ‚úÖ DO mention: Price movement (>0.2% from entry), time-based (every 4 hours), cooldown (60 min), daily limit (6 per day)
- ‚ùå DO NOT mention: Session switches, news events, volatility regime changes, structure breaks, hourly checks, 5-minute checks

---

plan_re_evaluation:
  - concept: Automatic re-evaluation of plans when market conditions change (Phase 4)
  - ‚ö†Ô∏è **IMPLEMENTATION STATUS:** Only price_movement and time_based triggers are fully implemented. Structure and volatility triggers are placeholders/disabled.
  - re_evaluation_triggers:
    - price_movement:
      - status: ‚úÖ **FULLY IMPLEMENTED**
      - description: Price moves >0.2% from entry (configurable)
      - check_interval: Every 30 minutes (configurable)
    - time_based:
      - status: ‚úÖ **FULLY IMPLEMENTED**
      - description: Every 4 hours (configurable, time_based_trigger_hours)
      - default: 4 hours
    - structure_change:
      - status: ‚ö†Ô∏è **ENABLED BUT PLACEHOLDER** (TODO: integrate with multi_timeframe_analyzer)
      - description: Key structure levels break (framework ready)
      - note: Do NOT describe this as actively triggering re-evaluation - it's a placeholder
    - volatility_regime:
      - status: ‚ùå **DISABLED** (volatility_regime_enabled: false in config)
      - description: Volatility regime changes (framework ready)
      - note: DISABLED in config - do NOT mention this as an active trigger
  - re_evaluation_actions:
    - keep: Plan conditions still valid (most common)
    - update: Small adjustments needed (<0.1% entry change) (framework ready)
    - cancel_replace: Original setup invalid, better setup available (framework ready)
    - create_additional: Original still valid, new opportunity detected (framework ready)
  - re_evaluation_limits:
    - cooldown: 60 minutes between re-evaluations (configurable)
    - daily_limit: 6 re-evaluations per plan per day (configurable)
  - manual_re_evaluation:
    - tool: moneybot.re_evaluate_plan
    - parameters: plan_id (required), force (optional) - Force re-evaluation even if in cooldown
    - returns: action, recommendation, available, last_re_evaluation, re_evaluation_count_today
  - checking_status:
    - tool: moneybot.get_auto_plan_status
    - response_fields: last_re_evaluation, re_evaluation_count_today, re_evaluation_cooldown_remaining, re_evaluation_available
    - interpretation: available=true means re-evaluation can be triggered
  - best_practices:
    - monitor_plans: Check re_evaluation_available for pending plans
    - review_recommendations: Review re-evaluation recommendations before applying
    - manual_trigger: Use manual re-evaluation when market conditions change significantly
  - configuration: Configurable thresholds and limits in config/auto_execution_adaptive_config.json
  - detailed_guide: See 22.ADAPTIVE_AUTO_EXECUTION_FEATURES.md (Part 4: Plan Re-Evaluation) for comprehensive guide

# END_OF_DOCUMENT
