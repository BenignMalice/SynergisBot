TRADE SETUP WATCHER - SYSTEM FLOW
==================================

USER INTERACTION FLOW:
----------------------

1. Initial Analysis (via ChatGPT)
   User: "Analyze XAUUSDc"
   Bot: Multi-timeframe analysis
        H4: BULLISH (85%)
        H1: CONTINUATION (80%)
        M30: BUY_SETUP (80%)
        M15: NONE (50%)        <-- CONFLICT
        M5: NO_TRADE (30%)     <-- CONFLICT
        Recommendation: WAIT

2. User Starts Watching
   User: "/watch XAUUSDc BUY"
   Bot: Checking current conditions...
        Current Confidence: 65%
        Required: 70%
        2 conditions not met
        Status: WATCHING

3. Background Monitoring Loop (Every 30 seconds)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  check_trade_setups_async()             â”‚
   â”‚  â”œâ”€ For each symbol (XAUUSDc, etc.)     â”‚
   â”‚  â”‚  â”œâ”€ Get multi-timeframe analysis     â”‚
   â”‚  â”‚  â”œâ”€ Check 15 conditions               â”‚
   â”‚  â”‚  â”œâ”€ Calculate confidence              â”‚
   â”‚  â”‚  â””â”€ If all met â†’ Send alert           â”‚
   â”‚  â””â”€ Sleep 30 seconds                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. Conditions Update
   Time: T+30s
   M15 RSI: 43 â†’ 52 (NOW MEETS BUY criteria)
   M15 MACD: bearish â†’ bullish
   M15 Price: below â†’ above EMA20
   New Confidence: 85%

5. Alert Sent
   Bot: ğŸ¯ BUY SETUP ALERT - XAUUSDc
        Confidence: 85%
        Entry: 2005.75
        Stop Loss: 1985.75
        Take Profit: 2035.75
        Risk/Reward: 1:1.5
        All conditions met!

6. User Executes Trade
   User reviews and executes with confidence


SYSTEM ARCHITECTURE:
--------------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         chatgpt_bot.py                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Background Tasks (AsyncIOScheduler)                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Position Monitor         (60s)                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ Signal Scanner            (5min)                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Circuit Breaker           (2min)                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Automated Loss-Cutting    (60s)                      â”‚ â”‚
â”‚  â”‚  â””â”€ Trade Setup Watcher       (30s) â† NEW!              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Command Handlers                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ /start, /menu, /help                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ /status, /journal, /circuit                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ /watch â† NEW!                                        â”‚ â”‚
â”‚  â”‚  â””â”€ /chatgpt, /endgpt                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              infra/trade_setup_watcher.py (NEW!)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  TradeSetupWatcher Class                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ check_setup_conditions(symbol, action)               â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Get multi-timeframe data                          â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Check RSI, MACD, EMA, ADX, ATR                    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Calculate confidence score                        â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Return (all_met, conditions, confidence)          â”‚ â”‚
â”‚  â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ generate_trade_alert(symbol, action, conditions)     â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Get current price                                 â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Calculate SL (entry Â± 2 ATR)                      â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Calculate TP (entry Â± 3 ATR)                      â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Calculate R/R ratio                               â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Format notification message                       â”‚ â”‚
â”‚  â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  â””â”€ watch_setup(symbol, action, min_confidence)          â”‚ â”‚
â”‚  â”‚     â”œâ”€ Mark as being watched                             â”‚ â”‚
â”‚  â”‚     â”œâ”€ Check conditions                                  â”‚ â”‚
â”‚  â”‚     â””â”€ Return alert if conditions met                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IndicatorBridge â”‚  â”‚   MT5Service    â”‚  â”‚ SessionAnalyzer â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚ Multi-timeframe â”‚  â”‚ Current prices  â”‚  â”‚ Session data    â”‚
â”‚ analysis        â”‚  â”‚ Get ATR         â”‚  â”‚ (optional)      â”‚
â”‚ RSI, MACD, EMA  â”‚  â”‚ Symbol info     â”‚  â”‚                 â”‚
â”‚ ADX, SAR, VWAP  â”‚  â”‚                 â”‚  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   MetaTrader5   â”‚
                    â”‚   (MT5 Platform)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DATA FLOW:
----------

1. Market Data Collection
   MT5 â†’ MT5Service â†’ IndicatorBridge
   â”œâ”€ H4 timeframe data
   â”œâ”€ H1 timeframe data
   â”œâ”€ M30 timeframe data
   â”œâ”€ M15 timeframe data
   â””â”€ M5 timeframe data

2. Indicator Calculation
   IndicatorBridge processes:
   â”œâ”€ RSI (14 period)
   â”œâ”€ MACD (12, 26, 9)
   â”œâ”€ EMA (20, 50, 200)
   â”œâ”€ ADX (14 period)
   â”œâ”€ ATR (14 period)
   â””â”€ Price vs EMA20

3. Condition Evaluation
   TradeSetupWatcher checks:
   For BUY:
   â”œâ”€ H4: RSI >= 50, EMA bullish, ADX >= 25
   â”œâ”€ H1: RSI >= 50, MACD bullish, Price > EMA20
   â”œâ”€ M30: RSI >= 50, EMA bullish, ATR >= 5
   â”œâ”€ M15: RSI >= 50, MACD bullish, Price > EMA20
   â””â”€ M5: RSI >= 50, MACD bullish, Price > EMA20

   For SELL:
   â”œâ”€ H4: RSI <= 50, EMA bearish, ADX >= 25
   â”œâ”€ H1: RSI <= 50, MACD bearish, Price < EMA20
   â”œâ”€ M30: RSI <= 50, EMA bearish, ATR >= 5
   â”œâ”€ M15: RSI <= 50, MACD bearish, Price < EMA20
   â””â”€ M5: RSI <= 50, MACD bearish, Price < EMA20

4. Confidence Calculation
   Score = (Conditions Met Points) / (Total Conditions)
   
   Points per condition:
   â”œâ”€ RSI: 20 points
   â”œâ”€ MACD: 15 points
   â”œâ”€ Price vs EMA20: 15 points
   â”œâ”€ EMA alignment: 10 points
   â”œâ”€ ADX: 10 points
   â””â”€ ATR: 5 points
   
   Total possible: ~75 points
   Typical good setup: 70-85%

5. Alert Generation
   If all conditions met AND confidence >= threshold:
   â”œâ”€ Get current price (ask/bid)
   â”œâ”€ Calculate SL (entry Â± 2 ATR)
   â”œâ”€ Calculate TP (entry Â± 3 ATR)
   â”œâ”€ Calculate R/R ratio
   â”œâ”€ Format message with all conditions
   â””â”€ Send Telegram notification


CONDITION MONITORING EXAMPLE:
------------------------------

Symbol: XAUUSDc
Action: BUY
Target Confidence: 70%

T=0s (Initial check)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Timeframe  â”‚ Indicatorâ”‚ Current  â”‚ Requiredâ”‚ Status
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ H4         â”‚ RSI      â”‚ 75.0     â”‚ >= 50   â”‚ âœ…
â”‚ H4         â”‚ EMA      â”‚ bullish  â”‚ bullish â”‚ âœ…
â”‚ H4         â”‚ ADX      â”‚ 50.0     â”‚ >= 25   â”‚ âœ…
â”‚ H1         â”‚ RSI      â”‚ 60.0     â”‚ >= 50   â”‚ âœ…
â”‚ H1         â”‚ MACD     â”‚ bullish  â”‚ bullish â”‚ âœ…
â”‚ H1         â”‚ Price    â”‚ above    â”‚ above   â”‚ âœ…
â”‚ M30        â”‚ RSI      â”‚ 55.0     â”‚ >= 50   â”‚ âœ…
â”‚ M30        â”‚ EMA      â”‚ bullish  â”‚ bullish â”‚ âœ…
â”‚ M30        â”‚ ATR      â”‚ 8.0      â”‚ >= 5.0  â”‚ âœ…
â”‚ M15        â”‚ RSI      â”‚ 43.0     â”‚ >= 50   â”‚ âŒ
â”‚ M15        â”‚ MACD     â”‚ bearish  â”‚ bullish â”‚ âŒ
â”‚ M15        â”‚ Price    â”‚ below    â”‚ above   â”‚ âŒ
â”‚ M5         â”‚ RSI      â”‚ 45.0     â”‚ >= 50   â”‚ âŒ
â”‚ M5         â”‚ MACD     â”‚ bearish  â”‚ bullish â”‚ âŒ
â”‚ M5         â”‚ Price    â”‚ below    â”‚ above   â”‚ âŒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€
Conditions Met: 9/15 (60%)
Status: WATCHING

T=30s
M15 RSI: 43 â†’ 48 (still below 50)
Conditions Met: 9/15 (60%)
Status: WATCHING

T=60s
M15 RSI: 48 â†’ 52 âœ…
M15 MACD: bearish â†’ bullish âœ…
M15 Price: below â†’ above âœ…
Conditions Met: 12/15 (80%)
Status: WATCHING

T=90s
M5 RSI: 45 â†’ 51 âœ…
M5 MACD: bearish â†’ bullish âœ…
M5 Price: below â†’ above âœ…
Conditions Met: 15/15 (100%)
Status: âœ… ALERT SENT!


CONFIGURATION CASCADE:
----------------------

Environment Variables (.env)
           â†“
      config.py (Settings class)
           â†“
 TradeSetupWatcher (uses config)
           â†“
    Background Task (every 30s)
           â†“
   User Telegram Notification


TELEGRAM NOTIFICATION FLOW:
---------------------------

1. Condition Met
   â†“
2. generate_trade_alert()
   â†“
3. Format message:
   ğŸ¯ BUY SETUP ALERT - XAUUSDc
   Confidence: 85%
   Entry: 2005.75
   Stop Loss: 1985.75
   Take Profit: 2035.75
   Risk/Reward: 1:1.5
   [All conditions listed]
   â†“
4. app.bot.send_message()
   â†“
5. User receives notification
   â†“
6. User reviews and executes


INTEGRATION WITH EXISTING SYSTEMS:
-----------------------------------

Automated Loss-Cutting System    Trade Setup Watcher
        (Closes losers)      &    (Finds new setups)
              â”‚                           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Position Monitor  â”‚
                    â”‚  (Master Monitor)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Telegram Bot    â”‚
                    â”‚   (Notifications)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                            USER

Result: Complete trading automation!
- Find setups automatically âœ…
- Monitor positions âœ…
- Cut losses automatically âœ…
- Get all notifications âœ…
