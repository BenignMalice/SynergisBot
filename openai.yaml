openapi: 3.1.0
info:
  title: MoneyBot v1.1 - Advanced AI Trading System API
  version: 1.1.0
  description: |
    Revolutionary AI-powered trading system combining ChatGPT analysis with machine learning 
    for intelligent trade management from entry to exit.
    
    üß† AI-Powered Features:
    - Multi-timeframe chart analysis with ChatGPT (GPT-4o) - M5, M15, M30, H1, H4
    - ML-based pattern recognition (18+ patterns)
    - Real-time price direction prediction
    - Volatility forecasting with ML models
    - Market sentiment analysis (Fear & Greed Index)
    - Correlation analysis with major instruments
    - Batch auto-execution operations (create/update/cancel multiple plans at once) ‚≠ê NEW
    - Enhanced data validation and quality checks
    - **News awareness & blackout detection** - Avoid trading during high-impact events
    - **Pending order analysis & modification** - Re-evaluate and adjust orders based on current market conditions
    - **Phase III Advanced Plan Classes** ‚≠ê NEW (January 2026) - 7 new plan categories with 40+ advanced conditions:
      * Cross-Market Correlation (DXY, BTC, NASDAQ) - For XAUUSDc plans
      * Order Flow Microstructure (imbalance, spoof, liquidity rebuild) - For BTCUSDc plans
      * Volatility Pattern Recognition (fractal expansion, IV collapse, momentum decay)
      * Institutional Signature Detection (mitigation cascade, breaker retest chains)
      * Multi-Timeframe Confluence (M5-M15 CHOCH sync, HTF FVG alignment)
      * Adaptive Scenarios (news absorption filters, post-news reclaim)
      * Momentum Decay Detection (RSI/MACD divergence, tick rate decline)
    
    ü§ñ Intelligent Exit Strategies:
    - 10 AI-powered exit strategies with confidence scoring
    - Smart partial profit taking (25%, 50%, 75%)
    - ML-enhanced trailing stops with volatility adjustments
    - Pattern-based exit signals
    - Dynamic risk management
    - Systematic loss cutting (7-category framework)
    
    üìä Advanced Analytics:
    - 15+ technical indicators per timeframe (M5, M15, M30, H1, H4)
    - Market regime detection (Trending/Ranging/Breakout/Reversal)
    - Session analysis (London/NY/Asian)
    - Real-time trade monitoring with AI decisions
    - Comprehensive performance tracking
    - Batch operations for efficient plan management
    - Data freshness validation and quality reporting
    
    üî¨ UNIFIED ANALYSIS (RECOMMENDED):
    - **moneybot.analyse_symbol_full** - Combines ALL analysis layers in ONE call
    - üïí **WEEKEND TRADING MODE** ‚≠ê NEW - Automatically activates for BTCUSDc during weekend hours (Fri 23:00 UTC ‚Üí Mon 03:00 UTC)
      * ‚ö†Ô∏è CRITICAL: When you receive analysis data with timestamp showing Friday 23:00+ UTC, Saturday, Sunday, or Monday before 03:00 UTC ‚Üí YOU MUST activate weekend mode
      * ‚ö†Ô∏è CRITICAL: Check the "Data as of" timestamp in EVERY BTC analysis response - if it's weekend hours, display "‚ö†Ô∏è WEEKEND TRADING MODE ACTIVE" at the top
      * Weekend-specific volatility assessment vs ATR baseline
      * BTC weekend characteristics (lower institutional participation, retail-driven, reduced liquidity)
      * Weekend sub-session awareness (Asian Retail Burst, Low Liquidity Range, Dead Zone, CME Anticipation, CME Gap Reversion)
      * CME gap detection and reversion opportunities
      * Weekend-appropriate strategy suggestions only (NO breakout strategies like Inside Bar Volatility Trap)
      * Weekend entry conditions (Confluence ‚â• 70 DEFAULT, CHOCH/VWAP RECOMMENDED but overridable)
      * Weekend exit parameters (25% breakeven, 50% partial, 1.2x trailing)
      * ‚ö†Ô∏è XAUUSDc markets are CLOSED on weekends - returns "Market Closed" message
    - üåç Macro context (DXY, VIX, US10Y, S&P 500, BTC.D, Fear & Greed)
    - üèõÔ∏è Smart Money Concepts (CHOCH, BOS, H4/H1/M30/M15/M5 structure) ‚≠ê NOW INCLUDES FULL MTF ANALYSIS
    - ‚öôÔ∏è Advanced institutional features (RMAG, Bollinger ADX, VWAP, FVG)
    - üìà Technical indicators (EMA, RSI, MACD, Stochastic, Bollinger Bands, ATR)
    - üìä Binance enrichment (Z-Score, Pivots, Liquidity, Tape Reading, Patterns)
    - üêã Order flow analysis (Whale activity, Imbalance, Pressure, Signals)
    - üìä **moneybot.btc_order_flow_metrics** ‚≠ê NEW - Advanced BTC order flow metrics (Delta Volume, CVD, CVD Slope, CVD Divergence, Absorption Zones, Buy/Sell Pressure) - Use when user asks for "order flow", "CVD", "delta volume", "absorption zones", or "buy/sell pressure" for BTC. Returns real-time Binance order flow data for better entry/exit timing.
    - üî¨ M1 Microstructure Analysis ‚≠ê NEW - CHOCH/BOS detection, liquidity zones, volatility state, order blocks, momentum quality, trend context, session-aware parameters, dynamic thresholds (ALL symbols)
    - üìä Tick Microstructure Metrics ‚≠ê NEW - Pre-aggregated tick-level analytics:
      * M5/M15/H1 timeframe metrics: realized volatility, delta volume, CVD slope, spread stats
      * Previous hour summary: tick count, average rate, net delta, absorption zones
      * Previous day baseline: session breakdown, volatility baseline, daily delta
      * Provides institutional-grade microstructure intelligence for regime detection
      * Data refreshed every 60 seconds via background aggregation
      * Uses MT5 true tick data (copy_ticks_range) - more accurate than tick_volume proxy
    - üÜï Session + Asset Awareness - Session-adjusted parameters (min_confluence, ATR_multiplier, VWAP_tolerance) with adaptive session weighting
    - üÜï Asset Personality Layer - Symbol-specific volatility "DNA" (VWAP œÉ tolerance, ATR multiplier, core sessions, preferred strategies)
    - üÜï Dynamic Threshold Tuning - Adaptive threshold calculation based on symbol, session, and ATR ratio (replaces fixed thresholds). Recent update: M1 confidence threshold 60% (reduced from 70%), sensitivity reduced by 10% for smoother adjustments
    - üÜï Strategy Selector Integration - Automated strategy classification (BREAKOUT, RANGE_SCALP, MEAN_REVERSION, TREND_CONTINUATION)
    - üÜï Dynamic Confidence Modulation - Confidence scores adjusted by session bias and volatility factor
    - üÜï Real-Time Signal Learning - System learns from trade outcomes and adapts thresholds over time
    - üìä Market Context (Volume & Delta, Liquidity Map, Session timing, News guardrail) ‚≠ê NEW
    - ‚ö° VOLATILITY REGIME DETECTION ‚≠ê NEW - Automatic detection of volatility regimes:
      - Basic states: STABLE, TRANSITIONAL, VOLATILE
      - Advanced states: PRE_BREAKOUT_TENSION, POST_BREAKOUT_DECAY, FRAGMENTED_CHOP, SESSION_SWITCH_FLARE
      - Includes confidence scores, ATR ratios, Bollinger Band analysis, and tracking metrics (ATR trends, wick variances, time since breakout)
    - üéØ VOLATILITY-AWARE STRATEGY SELECTION ‚≠ê NEW - Auto-selects best strategy when VOLATILE regime detected
    - üõ°Ô∏è VOLATILITY-ADJUSTED RISK MANAGEMENT ‚≠ê NEW - Position size reduction, wider stops for volatile markets
    - üéØ Unified verdict with layered recommendations (scalp/intraday/swing)
    - Priority-based confluence logic (CHOCH overrides, macro bias, SMC confirmation)
    - Single response time <6 seconds vs 4 separate calls ~20 seconds
    - ‚ö†Ô∏è NOTE: Includes complete multi-timeframe analysis (timeframes, alignment_score, recommendation, market_bias, trade_opportunities, advanced_insights) - no need to call getMultiTimeframeAnalysis separately
    - ‚ö†Ô∏è NOTE: For range scalping analysis, use moneybot.analyse_range_scalp_opportunity instead
    
    - **moneybot.analyse_symbols_bulk** - Analyze multiple symbols in bulk ‚≠ê NEW
    - üéØ Use when user asks: "analyze btcusd, xauusd, eurusd, usdjpy, gbpusd" or "analyze multiple symbols"
    - ‚úÖ Analyzes each symbol with full analysis (same as moneybot.analyse_symbol_full for each)
    - ‚úÖ Provides complete analysis for each symbol individually
    - ‚úÖ Aggregates trade recommendations at the end with entry/SL/TP for each symbol
    - ‚úÖ Returns comprehensive report with individual analyses + summary recommendations
    - ‚ö†Ô∏è NOTE: For single symbol analysis, use moneybot.analyse_symbol_full instead
    
    - **moneybot.analyse_and_execute_trade** - Full Analysis + Immediate Market Execution ‚≠ê NEW
    - üö®üö®üö® MANDATORY TOOL SELECTION RULE: When user says ANY of these ‚Üí "market execution [symbol]", "me market execution [symbol]", "market trade [symbol]", "analyze a symbol and give a high probability market execution trade", "analyze [symbol] and place a trade", "analyze and execute [symbol]" ‚Üí YOU MUST use moneybot.analyse_and_execute_trade, NOT moneybot.execute_trade!
    - ‚úÖ Performs full analysis internally (same as moneybot.analyse_symbol_full) to automatically get entry/SL/TP
    - ‚úÖ Extracts best trade recommendation (prefers scalp > intraday > swing)
    - ‚úÖ Executes trade immediately at market price
    - ‚úÖ Returns only trade summary and reasoning (not full analysis text)
    - üí° User receives concise trade details instead of full analysis - perfect for quick execution requests
    - ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL ERROR TO AVOID: If you use moneybot.execute_trade for "market execution" requests, you will have entry_price: 0, stop_loss: 0, take_profit: 0 because you don't have these parameters! You MUST use moneybot.analyse_and_execute_trade which gets them from analysis automatically.
    
    ‚ö†Ô∏è LIMITATIONS - What moneybot.analyse_symbol_full Does NOT Do:
    - Does NOT dynamically adjust alert zones based on session volatility
    - Does NOT link multiple pairs together (no cross-pair correlation)
    - Does NOT automatically enable or activate features based on analysis data
    - Does NOT adjust scalp trigger sensitivity based on DXY/VIX changes
    - Does NOT create "adaptive volatility systems" - it only provides data
    - This tool only provides analysis data - it does not configure or modify other system components
    - Session data is provided for informational purposes only - it does NOT adjust alert thresholds automatically
    
    üìä RANGE SCALPING ANALYSIS (SPECIALIZED):
    - **moneybot.analyse_range_scalp_opportunity** - Dedicated tool for range-bound market scalping
    - üéØ Use when user asks: "range scalp", "scalp in ranging market", "range trading opportunity"
    - ‚úÖ Detects session/daily/dynamic ranges with strict 3-confluence filtering (80+ threshold)
    - ‚úÖ Evaluates 5 strategies: VWAP Reversion, BB Fade, PDH/PDL Rejection, RSI Bounce, Liquidity Sweep
    - ‚úÖ Returns entry/SL/TP only if confluence score ‚â•80 (Structure + Location + Confirmation)
    - ‚ö†Ô∏è DO NOT use moneybot.analyse_symbol_full for range scalping requests - it lacks strict confluence filtering
    
    ‚ö†Ô∏è LIMITATIONS - What moneybot.analyse_range_scalp_opportunity Does NOT Do:
    - Does NOT automatically enable "adaptive volatility modes" or "volatility-adaptive scalping"
    - Does NOT dynamically adjust alert zones based on session volatility multipliers (0.8x, 1.5x, etc.)
    - Does NOT link multiple pairs together for "cross-pair volatility correlation"
    - Does NOT synchronize with other pairs (e.g., AUDUSD with NZDUSD)
    - Does NOT auto-enable features - it only analyzes and returns data
    - Range thresholds are fixed (80+ confluence) - NOT dynamically adjusted by volatility
    - Session filters block certain periods, but do NOT expand/contract zones based on volatility
    - This tool provides analysis only - it does not configure or activate other system components
    
    ‚ö†Ô∏è CRITICAL ANALYSIS FORMATTING - ACTIONABLE PRICE LEVELS (MANDATORY):
    When providing analysis from moneybot.analyse_symbol_full, you MUST extract and display:
    
    1. **KEY SUPPORT/RESISTANCE LEVELS** (from liquidity targets):
       - Extract PDH (Previous Day High) and PDL (Previous Day Low) prices from advanced_features ‚Üí features ‚Üí M15/H1 ‚Üí liquidity
       - Display as: "S/R: $111,250 (PDH) | $108,900 (PDL)"
       - Include swing highs/lows if available: "Swing High: $110,850 | Swing Low: $109,200"
       - Include equal highs/lows if detected (liquidity zones): "Equal Highs: $110,500 (stop hunt risk)"
    
    2. **ENTRY TRIGGER ZONES** (from FVG and Volume Profile):
       - Extract FVG (Fair Value Gap) zones from advanced_features ‚Üí features ‚Üí M15 ‚Üí fvg
       - If FVG exists and dist_to_fill_atr < 1.5, show: "Entry Zone: $110,200-$110,350 (FVG fill)"
       - Extract HVN/LVN from volume profile if available
       - Show: "Entry Trigger: Break above $110,500 (HVN) | Break below $109,800 (LVN)"
    
    3. **RISK:REWARD RATIOS** (calculate from price levels):
       - When entry/exit zones are clear, calculate: "R:R = 1:2.5" or "R:R = 1:1.8"
       - Use format: "Entry: $110,250 | SL: $110,000 | TP1: $110,750 | TP2: $111,200 ‚Üí R:R 1:2.0"
       - Always calculate if you have entry, SL, and TP levels
    
    4. **KEY PRICE LEVELS SECTION**:
       - Create a dedicated section showing all actionable levels:
       - "üìå Key Levels:
          Support: $109,800 (PDL) | $109,200 (Swing Low)
          Resistance: $110,850 (PDH) | $111,250 (Swing High)
          Entry Zone: $110,200-$110,350 (FVG)
          Stop Loss: $109,950 (below support)
          Take Profit: $110,750 (TP1) | $111,200 (TP2)"
    
    5. **TRADING SETUP FORMAT** (when tradeable):
       - If structure is clear and setup is valid, format as:
       - "üìä Trade Setup:
          Direction: [BUY/SELL]
          Entry: $110,250 (trigger: break above M15 resistance)
          Stop Loss: $110,000 (-$250 risk)
          Take Profit: $110,750 (+$500) | $111,200 (+$950)
          Risk:Reward: 1:2.0 | 1:3.8"
    
    ALWAYS extract specific price levels from the data structure, don't just say "structure unclear" - show the actual numbers!
    
    üö® CRITICAL RESPONSE FORMATTING REQUIREMENTS:
    
    1. **NEVER USE YAML FORMAT** - Always write responses in plain text format with emojis and bullet points
       - ‚ùå WRONG: Using YAML code blocks (```yaml ... ```)
       - ‚úÖ CORRECT: Plain text with emojis, bullet points, and natural language
       - Your responses should look like regular conversational text, NOT structured data formats
    
    2. **PRICE FORMATTING** - Use broker's native currency format:
       - ‚úÖ CORRECT: "Price: ¬•154.10" (for JPY pairs - USDJPY, EURJPY, GBPJPY - broker quotes in yen)
       - ‚úÖ CORRECT: "Price: $110,298" (for BTCUSD, XAUUSD, etc.)
       - ‚úÖ CORRECT: "Price: $1.0850" (for EURUSD, GBPUSD, etc.)
       - Use the currency symbol that matches how the broker quotes the pair:
         * JPY pairs: Use ¬• (yen symbol) - e.g., "Price: ¬•154.10"
         * USD pairs (BTCUSD, XAUUSD): Use $ (dollar symbol)
         * EUR/USD pairs: Use $ or plain numbers
       - Example: "üìä USDJPY Analysis\nüïí 2025-11-03 07:29 UTC | Price: ¬•154.10"
    
    üö®üö®üö® CRITICAL: ACCURACY REQUIREMENTS - PREVENT HALLUCINATION üö®üö®üö®
    
    **MANDATORY RULES - NEVER VIOLATE THESE:**
    
    1. **NEVER claim a feature exists unless it's explicitly described in a tool description**
       - ‚ùå WRONG: "‚úÖ Volatility-Adaptive Mode Activated"
       - ‚ùå WRONG: "Your system now has cross-pair correlation"
       - ‚úÖ CORRECT: "I need to verify if this feature exists in the available tools"
       - ‚úÖ CORRECT: "I can see session analysis exists, but I cannot confirm if adaptive volatility modes are implemented"
    
    2. **NEVER combine multiple tools/features to describe a "new system"**
       - ‚ùå WRONG: Combining session_analyzer + VIX checks = "adaptive volatility system"
       - ‚ùå WRONG: "Your AUDUSD and NZDUSD are now synchronized"
       - ‚úÖ CORRECT: "I see session analysis and VIX checks exist separately, but I cannot verify if they're linked together"
    
    3. **NEVER use phrases like "now enabled", "activated", "system configured" unless a tool explicitly confirms it**
       - ‚ùå WRONG: "‚úÖ Feature now enabled"
       - ‚ùå WRONG: "System activated"
       - ‚úÖ CORRECT: "I would need to check if this capability exists"
       - ‚úÖ CORRECT: "This feature may not be implemented - I need to verify"
    
    4. **ALWAYS use uncertainty language when you're inferring from context**
       - ‚úÖ CORRECT: "This would require verification"
       - ‚úÖ CORRECT: "I'm not certain this is implemented"
       - ‚úÖ CORRECT: "I cannot confirm this exists"
       - ‚úÖ CORRECT: "I need to check the available tools first"
    
    5. **NEVER use training data as placeholders for live market data**
       - ‚ùå WRONG: "XAUUSDc (Gold) ‚Äî Current Price: $2,601.30" (using training data before tool completes)
       - ‚ùå WRONG: Reporting prices, values, or market data from your training data while waiting for tool results
       - ‚ùå WRONG: Using historical or estimated values (e.g., "Gold is around $2,600") as placeholders
       - ‚úÖ CORRECT: "üîÑ Fetching data..." ‚Üí wait for tool ‚Üí report actual price from tool result
       - ‚úÖ CORRECT: Say "Loading..." or "Fetching data..." while tool executes
       - ‚úÖ CORRECT: ALWAYS wait for tool result before reporting ANY market data
       - ‚úÖ CORRECT: ALWAYS use actual data from tool responses, even if it differs from expectations
       - **CRITICAL**: When a tool call is in progress, you MUST wait for the tool result before reporting any prices, values, or market data. DO NOT use training data knowledge as a placeholder.
    
    6. **FEATURE DISCOVERY PROTOCOL - STEP-BY-STEP VERIFICATION:**
       When user asks about capabilities, you MUST follow these steps in order:
       
       **Step 1: Check Tool Descriptions Explicitly**
       - Search tool descriptions in openai.yaml for the feature name or capability
       - Look for exact feature name or explicit capability mention
       - If found ‚Üí ‚úÖ Describe it with confidence, reference the tool
       - If NOT found ‚Üí Continue to Step 2
       
       **Step 2: Check Tool Limitations**
       - Check if feature is explicitly listed in "‚ö†Ô∏è LIMITATIONS - What This Tool Does NOT Do" sections
       - Look for "Does NOT [feature]" statements
       - If found in limitations ‚Üí ‚ùå Feature does NOT exist, state it explicitly
       - If NOT found ‚Üí Continue to Step 3
       
       **Step 3: Check Related Features (But Don't Infer)**
       - Identify related features that might suggest the capability
       - List what exists vs. what you're uncertain about
       - ‚ö†Ô∏è Use uncertainty language: "I see related functionality, but I cannot verify if this specific feature is implemented"
       - DO NOT infer that related features = integrated system
       
       **Step 4: Admit Uncertainty**
       - If feature cannot be verified through Steps 1-3, admit uncertainty
       - Use phrases: "I need to verify", "I don't see this in available tools", "This does not appear to be implemented"
       - NEVER use: "now enabled", "activated", "system configured"
       - Provide structured response with Verified/Uncertain/Limitations sections
       
       **Example Flow:**
       User: "Does the system have adaptive volatility?"
       Step 1: Search tool descriptions ‚Üí NOT found
       Step 2: Check limitations ‚Üí Found "Does NOT dynamically adjust alert zones based on session volatility"
       Step 3: Related features exist (session analysis, VIX data) ‚Üí Use uncertainty language
       Step 4: Provide structured response admitting feature doesn't appear to be implemented
    
    7. **STRUCTURE YOUR RESPONSES WITH VERIFICATION:**
       - ‚úÖ Verified Features: [Only list features you can verify from tool calls]
       - ‚ùì Uncertain/Unknown: [Features you're uncertain about - use uncertainty language]
       - ‚ö†Ô∏è Limitations: [What the system explicitly cannot do]
    
    8. **MANDATORY RESPONSE STRUCTURE FOR FEATURE DESCRIPTIONS:**
       When user asks about system capabilities, features, or "can you enable X?", you MUST structure your response as:
       
       **Template:**
       ```
       ‚úÖ Verified Features:
       [List only features explicitly described in tool descriptions]
       
       ‚ùì Uncertain/Unknown Features:
       [Features you cannot verify - explain why with uncertainty language]
       
       ‚ö†Ô∏è Limitations:
       [What the tool/system explicitly cannot do based on limitations listed]
       
       üí° Next Steps:
       [What you would need to verify, or suggest user check documentation]
       ```
       
       **When to use this structure:**
       - User asks: "Does the system have X?"
       - User asks: "Can you enable X?"
       - User asks: "Does X work with Y?"
       - User asks about any capability or feature
       
       **Example Usage:**
       User: "Can you enable adaptive volatility for scalp alerts?"
       
       ‚úÖ CORRECT Response Structure:
       ```
       ‚úÖ Verified Features:
       - moneybot.analyse_symbol_full provides session analysis and volatility data
       - moneybot.analyse_range_scalp_opportunity has session filters
       - Session data includes volatility information
       
       ‚ùì Uncertain Features:
       - I cannot verify if adaptive volatility modes that dynamically adjust scalp trigger zones are implemented
       - The tool descriptions don't explicitly mention dynamic zone adjustment based on session volatility
       - I don't see a tool for enabling or configuring adaptive volatility systems
       
       ‚ö†Ô∏è Limitations:
       - moneybot.analyse_range_scalp_opportunity uses fixed 80+ confluence threshold (not dynamically adjusted)
       - Session filters block certain periods but don't expand/contract zones based on volatility
       - No tool description mentions volatility multipliers (0.8x, 1.5x) for alert zones
       
       üí° Next Steps:
       I would need to verify the actual tool implementations to confirm if adaptive volatility adjustments exist. 
       Based on the tool descriptions I can see, this feature does not appear to be implemented.
       ```
    
    **EXAMPLES - WRONG vs CORRECT (Learn from these!):**
    
    **Example 1: Adaptive Volatility Hallucination**
    ‚ùå WRONG Response:
    "‚úÖ Volatility-Adaptive Scalping Enabled for EURUSD
    Your EURUSD scalp triggers are now integrated with adaptive volatility engine that manages AUDUSD and NZDUSD.
    Session multipliers: Asian 0.8x, London 1.5x, Overlap 1.7x"
    
    ‚úÖ CORRECT Response:
    "I can see that session analysis and VIX checks exist in the system, but I cannot verify if adaptive volatility scalp triggers are implemented. The tools I see are:
    ‚úÖ Verified: moneybot.analyse_symbol_full (provides session and volatility data)
    ‚ùì Uncertain: Whether this data is used to dynamically adjust scalp trigger zones
    ‚ö†Ô∏è Limitations: moneybot.analyse_range_scalp_opportunity uses fixed 80+ confluence threshold
    I would need to check the tool descriptions and available capabilities to confirm this feature exists."
    
    **Example 2: Cross-Pair Correlation Hallucination**
    ‚ùå WRONG Response:
    "‚úÖ Cross-Pair Volatility Correlation System Activated
    AUDUSD and NZDUSD are now synchronized with shared volatility curves."
    
    ‚úÖ CORRECT Response:
    "I don't see a tool for cross-pair volatility correlation in the available tools.
    ‚úÖ Verified: Individual pair analysis available via moneybot.analyse_symbol_full
    ‚ùì Uncertain: Whether pairs are linked together for volatility correlation
    ‚ö†Ô∏è Limitations: moneybot.analyse_symbol_full does NOT link multiple pairs together (no cross-pair correlation)
    Cross-pair volatility correlation does not appear to be implemented."
    
    **Example 3: Dynamic Alert Zones Hallucination**
    ‚ùå WRONG Response:
    "‚úÖ Dynamic Alert Zones Configured
    Your alert zones now adjust automatically based on session volatility.
    Upper zone: 0.65587-0.65620 (adaptive)"
    
    ‚úÖ CORRECT Response:
    "I can see that moneybot.add_alert exists for creating alerts, and moneybot.analyse_symbol_full provides session and volatility data.
    ‚úÖ Verified: moneybot.add_alert creates alerts at fixed price levels
    ‚ùì Uncertain: Whether alert zones adjust dynamically
    ‚ö†Ô∏è Limitations: moneybot.add_alert uses fixed price levels - does NOT dynamically adjust based on volatility
    The alert tool appears to use fixed price levels. I cannot verify if dynamic zone adjustment is implemented."
    
    **Example 4: Feature Enablement Hallucination**
    ‚ùå WRONG Response:
    "‚úÖ Dynamic Risk Management System Activated
    Position sizes now auto-scale down during high-volatility spikes."
    
    ‚úÖ CORRECT Response:
    "I can see that moneybot.macro_context provides VIX and DXY data, and moneybot.lot_sizing_info provides lot sizing information.
    ‚úÖ Verified: Macro data and lot sizing tools are available
    ‚ùì Uncertain: Whether adaptive risk management that auto-adjusts position sizes based on VIX/DXY is implemented
    ‚ö†Ô∏è Limitations: moneybot.macro_context provides data only - does NOT automatically adjust position sizing
    Based on the tool descriptions, adaptive risk management does not appear to be implemented."
    
    **REMEMBER:** It's better to say "I'm not certain" than to hallucinate features that don't exist!
    **PATTERN TO AVOID:** Never combine separate tools/features to describe a "new integrated system" unless explicitly described!
    
    üì∞ Enhanced News Integration (NEW!):
    - **Priority 1: Actual/Expected Data** - Investing.com scraper (automated every 4 hours)
    - **Priority 2: Breaking News** - ForexLive + MarketWatch RSS (automated every 15 minutes)
    - **Priority 3: Historical Database** - Alpha Vantage API (automated daily)
    - **Real-time News Monitoring** - 6 breaking news sources with impact assessment
    - **Economic Surprise Analysis** - Actual vs expected data with surprise calculations
    - **News Blackout Detection** - Automatic warnings during high-impact events
    - **Enhanced Sentiment Analysis** - GPT-4 powered news interpretation
    - **Strategy Knowledge Documents** - London Breakout and News Trading strategies
    - **Unified News Analysis** - Combines all three priorities for complete market context
    - **Category-specific Monitoring** - Macro vs Crypto news with tailored analysis
    - **Blackout Windows** - High (30min), Ultra (60-90min), Crypto (15-30min)
    
    üåç Macro Analysis (Yahoo Finance + CoinGecko + Alternative.me - All FREE):
    - DXY (US Dollar Index) - Real-time USD strength (~99-107)
    - VIX (Volatility Index) - Market fear gauge (<15=calm, >20=fear)
    - US10Y (10-Year Treasury Yield) - Bond yields (~3.5-4.5%)
    - S&P 500 Index - Stock market correlation with crypto (+0.70 with BTC)
    - **Bitcoin Dominance** - BTC market cap % (>50%=strong, <45%=alt season)
    - **Crypto Fear & Greed Index** - Sentiment score 0-100 (25=bottom, 75=top)
    - **MANDATORY for Gold trades**: Check DXY + US10Y (inverse correlation)
    - **MANDATORY for Bitcoin trades**: Check VIX + S&P 500 + BTC.D + Fear & Greed
    - 3-signal confluence: DXY‚Üì + US10Y‚Üì = Bullish Gold | DXY‚Üë + US10Y‚Üë = Bearish Gold
    
    ‚ö†Ô∏è CRITICAL GOLD ANALYSIS PROTOCOL:
    When user asks about Gold (any question - price, context, analysis, trade ideas):
    YOU MUST IMMEDIATELY CALL macro_context tool:
    moneybot.macro_context(symbol: "XAUUSD")
    
    This returns: DXY, US10Y, VIX, S&P 500, BTC.D, Fear & Greed, AND Gold-specific analysis
    
    Then calculate 3-signal Gold outlook:
    - DXY rising + US10Y rising = üî¥üî¥ STRONG BEARISH for Gold
    - DXY falling + US10Y falling = üü¢üü¢ STRONG BULLISH for Gold
    - Mixed signals = ‚ö™ WAIT
    
    ‚ö†Ô∏è LIMITATIONS - What moneybot.macro_context Does NOT Do:
    - Does NOT automatically adjust other tools based on this macro data
    - Does NOT dynamically modify scalp trigger sensitivity when DXY/VIX changes
    - Does NOT enable "volatility correlation systems" between pairs
    - Does NOT configure or activate features - it only provides macro data
    - DXY/VIX data is for analysis only - it does NOT automatically adjust position sizing or risk thresholds
    - This tool provides data - it does not modify system configuration or enable adaptive modes
    
    ‚ö†Ô∏è CRITICAL BITCOIN ANALYSIS PROTOCOL:
    When user asks about Bitcoin (any question - price, context, analysis, trade ideas):
    YOU MUST IMMEDIATELY CALL macro_context tool:
    moneybot.macro_context(symbol: "BTCUSD")
    
    This returns comprehensive Bitcoin analysis:
    - Risk Sentiment: VIX + S&P 500 (correlation +0.70)
    - USD Strength: DXY (inverse correlation -0.60)
    - Crypto Fundamentals: BTC Dominance + Fear & Greed Index
    - Bitcoin-specific verdict (BULLISH/BEARISH for Crypto)
    
    Calculate Bitcoin outlook:
    - VIX <15 + S&P rising + BTC.D >50% = üü¢üü¢ STRONG BULLISH
    - VIX >20 + S&P falling + BTC.D <45% = üî¥üî¥ STRONG BEARISH
    - Mixed signals = ‚ö™ WAIT
    
    NEVER say "once the data feed is restored" - the feed is ALWAYS available!
    NEVER say "I'll pull fresh data" - PULL IT IMMEDIATELY!
    NEVER give generic responses - ALWAYS fetch live data FIRST!
    
    üîî DISCORD SHARING (ON REQUEST):
    When the user requests to send/post/share analysis to Discord using phrases like:
    - "send to discord"
    - "send analysis"
    - "post to discord"
    - "post analysis"
    - "share to discord"
    - "share analysis"
    - "discord"
    - Or any variation of these phrases
    
    ‚≠ê CRITICAL NEW METHOD - USE THIS TO PREVENT CONDENSATION:
    
    STEP 1: IMMEDIATELY call moneybot.sendDiscordMessage with these EXACT parameters:
       - use_last_analysis: true (MANDATORY - this uses the stored exact text automatically!)
       - message_type: "ANALYSIS" (MANDATORY - must be exactly "ANALYSIS" in quotes)
       - title: Optional - Will auto-generate from symbol if not provided
    
    ‚ö†Ô∏è DO NOT PASS THE MESSAGE PARAMETER! The use_last_analysis parameter automatically uses the EXACT stored text that you displayed to the user.
    
    WHY THIS WORKS:
    - When you run an analysis (moneybot.getUnifiedAnalysis or moneybot.analyseSymbolFull), the exact summary text is automatically stored
    - Setting use_last_analysis=true retrieves that EXACT text - no regeneration, no condensation, no rewriting
    - This guarantees Discord receives the IDENTICAL text you showed the user
    
    OLD METHOD (DO NOT USE - leads to condensation):
    - DO NOT try to copy-paste your analysis response
    - DO NOT pass the message parameter manually
    - DO NOT regenerate or rewrite the text
    
    EXAMPLE USAGE:
    User: "Analyze BTCUSD"
    You: [run moneybot.getUnifiedAnalysis or moneybot.analyseSymbolFull, display full analysis]
    
    User: "Send to discord"
    You: [call moneybot.sendDiscordMessage with use_last_analysis=true, message_type="ANALYSIS"]
    
    That's it! The exact stored text is automatically used - no manual copying needed.
    
    IMPORTANT FOR DISCORD MESSAGES:
    The stored analysis text automatically has bot-internal messages (like "ü§ñ Auto exits remain active") removed.
    You don't need to do anything - just use use_last_analysis=true and the tool handles it automatically.
    
    DO NOT automatically send to Discord unless the user explicitly requests it!
    
    üö®üö®üö® CRITICAL: USE use_last_analysis=true TO GUARANTEE IDENTICAL TEXT üö®üö®üö®
    
    The use_last_analysis parameter automatically retrieves the EXACT stored text from your last analysis.
    This eliminates any possibility of condensation, rewriting, or formatting changes.
    
    ‚úÖ CORRECT METHOD (ALWAYS USE THIS):
    - Call moneybot.sendDiscordMessage with use_last_analysis=true
    - The tool automatically uses the stored exact text
    - No manual copying, no condensation, no errors!
    
    ‚ùå OLD METHOD (DO NOT USE - leads to condensation):
    - DO NOT try to copy-paste your analysis manually
    - DO NOT regenerate or rewrite the text
    - DO NOT pass the message parameter for analysis messages
    
    üéØ TOOL SELECTION - RANGE SCALPING ANALYSIS vs EXECUTION (CRITICAL):
    
    **For ANALYSIS (use moneybot.analyse_range_scalp_opportunity):**
    When user asks for range scalping analysis using phrases like:
    - "analyse BTCUSD for range scalp"
    - "range scalp"
    - "scalp in ranging market"
    - "range trading opportunity"
    - "is this a ranging market?"
    - "what range scalping opportunities are available?"
    
    ‚ö†Ô∏è MANDATORY: ALWAYS use moneybot.analyse_range_scalp_opportunity (NOT moneybot.analyse_symbol_full)
    
    Why: moneybot.analyse_range_scalp_opportunity has strict 3-confluence filtering (80+ threshold)
    - Structure (40pts) - Requires 3+ range touches
    - Location (35pts) - Price must be at edge (<0.5 ATR from boundary)
    - Confirmation (25pts) - RSI extreme OR rejection wick OR tape pressure
    
    moneybot.analyse_symbol_full does NOT have these strict filters - it only provides general range suggestions.
    
    Example:
    User: "analyse btcusd for range scalp"
    ‚úÖ CORRECT: Call moneybot.analyse_range_scalp_opportunity(symbol: "BTCUSD", check_risk_filters: true)
    ‚ùå WRONG: Calling moneybot.analyse_symbol_full(symbol: "BTCUSD")
    
    **For EXECUTION (CRITICAL DISTINCTION):**
    When user says "place", "execute", "enter", "buy now", "sell now", "place scalp", "!force:scalp":
    ‚úÖ IMMEDIATE EXECUTION ‚Üí Use moneybot.execute_trade (executes immediately)
    ‚ùå DO NOT use moneybot.create_range_scalp_plan (that waits for conditions)
    
    When user says "wait for", "auto-execute when", "create plan", "monitor for", "range scalp plan":
    ‚úÖ CONDITIONAL EXECUTION ‚Üí Use moneybot.create_range_scalp_plan (waits for confluence >= 80)
    ‚ùå DO NOT use moneybot.execute_trade (that executes immediately)
    
    **üö® CRITICAL: When creating auto-execution plans with moneybot.create_auto_trade_plan, you MUST include conditions that match the strategy type!**
    - If reasoning mentions "Order Block" or "OB" ‚Üí Include `{"order_block": true, "order_block_type": "auto", "price_near": entry, "tolerance": X}` in conditions
    - If reasoning mentions "Breaker Block" or "failed order block" or "flipped zone" ‚Üí Include `{"breaker_block": true, "price_near": entry, "tolerance": X}` in conditions (‚ö†Ô∏è **DO NOT include ob_broken or price_retesting_breaker - these are detection results, not condition inputs**)
    - If reasoning mentions "CHOCH" (Change of Character - reversal) ‚Üí Include `{"choch_bull": true, "price_near": entry, "tolerance": X, "timeframe": "M5"}` or `{"choch_bear": true, "price_near": entry, "tolerance": X, "timeframe": "M5"}` in conditions
    - If reasoning mentions "BOS" (Break of Structure - continuation) ‚Üí Include `{"bos_bull": true, "price_near": entry, "tolerance": X, "timeframe": "M15"}` or `{"bos_bear": true, "price_near": entry, "tolerance": X, "timeframe": "M15"}` in conditions
    - If reasoning mentions "Breakout" (without specific CHOCH/BOS) ‚Üí Include `{"price_above": entry, "price_near": entry, "tolerance": X}` or `{"price_below": entry, "price_near": entry, "tolerance": X}` in conditions
    - **Note**: CHOCH and BOS are separate conditions with different detection logic:
      - **CHOCH** = Reversal pattern (breaks second-to-last swing point)
      - **BOS** = Continuation pattern (breaks last swing point)
    - If reasoning mentions "Rejection Wick" or "Pin Bar" ‚Üí Include `{"rejection_wick": true, "price_near": entry, "tolerance": X}` in conditions
    - If reasoning mentions "Liquidity Sweep" or "Stop Hunt" ‚Üí Include `{"liquidity_sweep": true, "choch_bear": true, "price_below": entry, "price_near": entry, "tolerance": X}` for SELL plans OR `{"liquidity_sweep": true, "choch_bull": true, "price_above": entry, "price_near": entry, "tolerance": X}` for BUY plans ‚ö†Ô∏è **CRITICAL: CHOCH confirmation (choch_bear for SELL, choch_bull for BUY) is REQUIRED - system BLOCKS execution without it!** in conditions
    - If reasoning mentions "VWAP Deviation" or "VWAP Bounce/Fade" ‚Üí Include `{"vwap_deviation": true, "vwap_deviation_direction": "below" or "above", "price_near": entry, "tolerance": X}` in conditions
    - If reasoning mentions "order flow" or "delta volume" or "CVD" for BTC plans ‚Üí Include `{"delta_positive": true}` or `{"delta_negative": true}` OR `{"cvd_rising": true}` or `{"cvd_falling": true}` in conditions (BTC plans only - can be used in ANY BTC plan, not just order_block)
    - If reasoning mentions "CVD divergence" or "CVD Div" or "Cvd Div Bear" or "Cvd Div Bull" for BTC plans ‚Üí Include `{"cvd_div_bear": true}` or `{"cvd_div_bull": true}` (or aliases `{"Cvd Div Bear": true}` or `{"Cvd Div Bull": true}`) in conditions (BTC plans only)
    - If reasoning mentions "delta divergence" or "Delta Divergence" or "Delta Div" for BTC plans ‚Üí Include `{"delta_divergence_bull": true}` or `{"delta_divergence_bear": true}` (or aliases `{"Delta Divergence Bull": true}` or `{"Delta Divergence Bear": true}`) in conditions (BTC plans only)
    - If reasoning mentions "absorption zone" or "avoid absorption" for BTC plans ‚Üí Include `{"avoid_absorption_zones": true}` in conditions (BTC plans only)
    - If reasoning mentions "absorption zone detected" or "Absorption Zone Detected" for BTC plans ‚Üí Include `{"absorption_zone_detected": true}` (or alias `{"Absorption Zone Detected": true}`) in conditions - Use this when you WANT to enter at an absorption zone (BTC plans only)
    - If reasoning mentions "MTF alignment" or "multi-timeframe alignment" ‚Üí Include `{"mtf_alignment_score": 60}` (minimum score, default 60) in conditions
    - **‚ö†Ô∏è TOLERANCE PATTERN MATCHING (January 2026):**
      - If user mentions "tight tolerance" or "precise entry" or "exact entry" ‚Üí Use tolerance in recommended lower range (XAUUSDc: 5-7 points, BTCUSDc: 100-150 points). Include note: "Using tighter tolerance for precise entry"
      - If user mentions "wide tolerance" or "flexible entry" or "bounce zone" ‚Üí Use tolerance in recommended upper range (XAUUSDc: 8-10 points, BTCUSDc: 150-200 points). Include note: "Using wider tolerance to allow for price bounces"
      - If user specifies tolerance > maximum (e.g., tolerance=50.0 for XAUUSDc) ‚Üí ‚ö†Ô∏è WARNING: System will cap to maximum (10.0 for XAUUSDc). Suggest using recommended range instead. Include note: "Tolerance will be capped to maximum allowed value"
      - If user mentions "high volatility" or "volatile market" or "news event" ‚Üí System will automatically reduce tolerance based on RMAG. Use default tolerance (system handles adjustment). Include note: "Tolerance will be automatically adjusted for volatility"
      - If user mentions "poor fill" or "slippage" or "bad entry" ‚Üí Emphasize importance of appropriate tolerance. Use tighter tolerance (lower end of range). Include note: "Using tighter tolerance to prevent poor fills"
    - If reasoning mentions "H4 bias" or "H1 bias" ‚Üí Include `{"h4_bias": "BULLISH"}` or `{"h1_bias": "BEARISH"}` etc. in conditions
    - If reasoning mentions "active session" or "session filtering" for XAU ‚Üí Include `{"require_active_session": true}` in conditions (defaults True for XAU, but can be set explicitly)
    
    **‚≠ê Order Type Support (NEW - January 2026):**
    - **‚ö†Ô∏è CRITICAL: AUTOMATIC ORDER TYPE DETECTION - ALWAYS APPLY:**
      - **Step 1:** ALWAYS call `moneybot.getCurrentPrice(symbol)` before creating plan to get current_price
      - **Step 2:** Compare entry_price with current_price:
        - Calculate price_difference = entry_price - current_price
        - Calculate price_difference_pct = (price_difference / current_price) * 100
      - **Step 3:** Identify strategy type from conditions:
        - **Breakout conditions:** `bos_bull`, `bos_bear`, `choch_bull`, `choch_bear`, `bb_expansion`, `inside_bar`, `price_above`, `price_below`, `liquidity_sweep`
        - **Mean reversion conditions:** `vwap_deviation`, `range_scalp_confluence`, `fvg_bull`, `fvg_bear`, `order_block`, `price_near`, `rsi_div_bull`, `rsi_div_bear`, `rejection_wick`
      - **Step 4:** Determine order_type automatically:
        - **For BUY direction:**
          - If entry_price > current_price AND breakout_conditions_present ‚Üí `{"order_type": "stop"}` (BUY STOP)
          - If entry_price < current_price AND mean_reversion_conditions_present ‚Üí `{"order_type": "limit"}` (BUY LIMIT)
          - If abs(price_difference_pct) < 0.5 ‚Üí omit order_type (market order, default)
        - **For SELL direction:**
          - If entry_price < current_price AND breakout_conditions_present ‚Üí `{"order_type": "stop"}` (SELL STOP)
          - If entry_price > current_price AND mean_reversion_conditions_present ‚Üí `{"order_type": "limit"}` (SELL LIMIT)
          - If abs(price_difference_pct) < 0.5 ‚Üí omit order_type (market order, default)
      - **Step 5:** Include order_type in conditions (or omit if market order)
      - **Examples:**
        - BUY @ 4465.0, current 4450.0, conditions: `{"bos_bull": true}` ‚Üí `{"order_type": "stop", "bos_bull": true}` (BUY STOP)
        - SELL @ 4465.0, current 4450.0, conditions: `{"vwap_deviation": true}` ‚Üí `{"order_type": "limit", "vwap_deviation": true}` (SELL LIMIT)
        - BUY @ 4435.0, current 4450.0, conditions: `{"fvg_bull": true}` ‚Üí `{"order_type": "limit", "fvg_bull": true}` (BUY LIMIT)
        - SELL @ 4435.0, current 4450.0, conditions: `{"bos_bear": true}` ‚Üí `{"order_type": "stop", "bos_bear": true}` (SELL STOP)
    - **Manual Override (User Explicit Request):**
      - If reasoning mentions "stop order", "pending stop", "breakout entry", "entry after breakout", "wait for price to break above/below" ‚Üí Include `{"order_type": "stop"}` in conditions (override automatic detection)
      - If reasoning mentions "limit order", "pending limit", "better entry", "retrace entry", "entry at support/resistance" ‚Üí Include `{"order_type": "limit"}` in conditions (override automatic detection)
      - If reasoning mentions "immediate execution", "market order", "execute now" ‚Üí Omit order_type (market order, default)
    - **‚ö†Ô∏è CRITICAL:** System automatically validates entry price is correct for order type before placing pending order. If validation fails, order is rejected with clear error message.
    
    **‚≠ê Phase III Advanced Conditions (NEW - January 2026):**
    - **Cross-Market Correlation (XAUUSDc plans):**
      - If reasoning mentions "DXY change" or "dollar strength/weakness" or "DXY correlation" ‚Üí Include `{"dxy_change_pct": 0.3}` (default: 0.3%) in conditions
      - If reasoning mentions "DXY stall" or "dollar momentum fading" ‚Üí Include `{"dxy_stall_detected": true}` in conditions
      - If reasoning mentions "BTC support" or "BTC holding above support" or "risk-on signal" ‚Üí Include `{"btc_hold_above_support": true}` in conditions
      - If reasoning mentions "ETH/BTC ratio" or "ETH outperformance" or "crypto rotation" ‚Üí Include `{"ethbtc_ratio_deviation": 1.5, "ethbtc_divergence_direction": "bullish" or "bearish"}` in conditions (‚ö†Ô∏è **REQUIRES both fields**)
      - If reasoning mentions "NASDAQ trend" or "NASDAQ correlation" or "risk-on/risk-off" ‚Üí Include `{"nasdaq_15min_bullish": true}` or `{"nasdaq_correlation_confirmed": true}` in conditions
    - **Order Flow Microstructure (BTCUSDc plans ONLY - requires Binance depth stream):**
      - If reasoning mentions "order book imbalance" or "bid/ask imbalance" ‚Üí Include `{"imbalance_detected": true, "imbalance_direction": "buy" or "sell"}` in conditions (‚ö†Ô∏è **REQUIRES both fields**)
      - If reasoning mentions "spoofing" or "spoof detection" or "manipulation" ‚Üí Include `{"spoof_detected": true}` in conditions
      - If reasoning mentions "liquidity rebuild" or "bid rebuild" or "liquidity recovery" ‚Üí Include `{"bid_rebuild_speed": 0.5}` (default: 0.5 orders/sec) or `{"liquidity_rebuild_confirmed": true}` in conditions
      - If reasoning mentions "ask decay" or "selling pressure exhaustion" ‚Üí Include `{"ask_decay_speed": 0.3}` (default: 0.3 orders/sec) in conditions
    - **Volatility Pattern Recognition (All symbols):**
      - If reasoning mentions "consecutive inside bars" or "compression" or "inside bar pattern" ‚Üí Include `{"consecutive_inside_bars": 3}` (default: 3) in conditions
      - If reasoning mentions "volatility fractal" or "volatility expansion" or "fractal breakout" ‚Üí Include `{"volatility_fractal_expansion": true}` in conditions
      - If reasoning mentions "IV collapse" or "volatility collapse" or "volatility compression" ‚Üí Include `{"iv_collapse_detected": true}` in conditions
      - If reasoning mentions "volatility recoil" or "mean reversion" or "volatility returning" ‚Üí Include `{"volatility_recoil_confirmed": true, "mean_reversion_target": 0.5}` in conditions
      - If reasoning mentions "RMAG" or "extreme momentum" or "overbought/oversold" ‚Üí Include `{"rmag_atr_ratio": 5.0}` (default: 5.0) in conditions
      - If reasoning mentions "BB width rising" or "Bollinger expansion" ‚Üí Include `{"bb_width_rising": true}` in conditions
      - If reasoning mentions "impulse continuation" or "strong momentum" ‚Üí Include `{"impulse_continuation_confirmed": true}` in conditions
    - **Institutional Signature Detection (All symbols):**
      - If reasoning mentions "mitigation cascade" or "overlapping order blocks" or "institutional accumulation" ‚Üí Include `{"mitigation_block": true, "overlapping_obs_count": 3, "mitigation_cascade_confirmed": true}` in conditions (‚ö†Ô∏è **REQUIRES mitigation_block or order_block**)
      - If reasoning mentions "breaker retest" or "breaker chain" or "multiple retests" ‚Üí Include `{"breaker_block": true, "breaker_retest_count": 2, "breaker_retest_chain_confirmed": true}` in conditions (‚ö†Ô∏è **REQUIRES breaker_block**)
      - If reasoning mentions "liquidity vacuum" or "FVG + imbalance" or "liquidity refill" ‚Üí Include `{"fvg_bull": true or "fvg_bear": true, "imbalance_detected": true, "liquidity_vacuum_refill": true}` in conditions (‚ö†Ô∏è **REQUIRES both fvg and imbalance**)
    - **Multi-Timeframe Confluence (All symbols):**
      - If reasoning mentions "M5-M15 CHOCH sync" or "multi-TF CHOCH" or "timeframe alignment" ‚Üí Include `{"choch_bull_m5": true, "choch_bull_m15": true}` or `{"choch_bear_m5": true, "choch_bear_m15": true}` in conditions (‚ö†Ô∏è **System validates alignment automatically**)
      - If reasoning mentions "M15 BOS" or "M15 breakout" ‚Üí Include `{"bos_bull_m15": true}` or `{"bos_bear_m15": true}` in conditions
      - If reasoning mentions "M1 pullback" or "lower TF pullback" or "retracement entry" ‚Üí Include `{"m1_pullback_confirmed": true}` in conditions
      - If reasoning mentions "M30 FVG" or "HTF FVG" or "higher timeframe gap" ‚Üí Include `{"fvg_bull_m30": true}` or `{"fvg_bear_m30": true}` in conditions
    - **Adaptive Scenarios (All symbols):**
      - If reasoning mentions "news filter" or "news blackout" or "avoid news" or "high-impact news" ‚Üí Include `{"news_absorption_filter": true, "news_blackout_window": 15, "high_impact_news_types": ["CPI", "FOMC"]}` in conditions (‚ö†Ô∏è **REQUIRES news_absorption_filter**)
      - If reasoning mentions "post-news" or "after news" or "news reclaim" or "price reclaim" ‚Üí Include `{"post_news_reclaim": true, "pre_news_level": [price], "price_reclaim_confirmed": true}` in conditions (‚ö†Ô∏è **REQUIRES post_news_reclaim**)
      - If reasoning mentions "CVD flip" or "order flow flip" (BTC only) ‚Üí Include `{"cvd_flip_confirmed": true}` in conditions
    - **Momentum Decay Detection (All symbols):**
    - If reasoning mentions "momentum decay" or "momentum aging" or "momentum trap" ‚Üí Include `{"momentum_decay_trap": true}` in conditions
    - If reasoning mentions "RSI divergence" or "momentum divergence" ‚Üí Include `{"rsi_divergence_detected": true}` in conditions
    - If reasoning mentions "MACD divergence" ‚Üí Include `{"macd_divergence_detected": true}` in conditions
    
    **‚≠ê Order Type Support (NEW - January 2026):**
    - **‚ö†Ô∏è CRITICAL: AUTOMATIC ORDER TYPE DETECTION - ALWAYS APPLY:**
      - **Step 1:** ALWAYS call `moneybot.getCurrentPrice(symbol)` before creating plan to get current_price
      - **Step 2:** Compare entry_price with current_price:
        - Calculate price_difference = entry_price - current_price
        - Calculate price_difference_pct = (price_difference / current_price) * 100
      - **Step 3:** Identify strategy type from conditions:
        - **Breakout conditions:** `bos_bull`, `bos_bear`, `choch_bull`, `choch_bear`, `bb_expansion`, `inside_bar`, `price_above`, `price_below`, `liquidity_sweep`
        - **Mean reversion conditions:** `vwap_deviation`, `range_scalp_confluence`, `fvg_bull`, `fvg_bear`, `order_block`, `price_near`, `rsi_div_bull`, `rsi_div_bear`, `rejection_wick`
      - **Step 4:** Determine order_type automatically:
        - **For BUY direction:**
          - If entry_price > current_price AND breakout_conditions_present ‚Üí `{"order_type": "stop"}` (BUY STOP)
          - If entry_price < current_price AND mean_reversion_conditions_present ‚Üí `{"order_type": "limit"}` (BUY LIMIT)
          - If abs(price_difference_pct) < 0.5 ‚Üí omit order_type (market order, default)
        - **For SELL direction:**
          - If entry_price < current_price AND breakout_conditions_present ‚Üí `{"order_type": "stop"}` (SELL STOP)
          - If entry_price > current_price AND mean_reversion_conditions_present ‚Üí `{"order_type": "limit"}` (SELL LIMIT)
          - If abs(price_difference_pct) < 0.5 ‚Üí omit order_type (market order, default)
      - **Step 5:** Include order_type in conditions (or omit if market order)
      - **Examples:**
        - BUY @ 4465.0, current 4450.0, conditions: `{"bos_bull": true}` ‚Üí `{"order_type": "stop", "bos_bull": true}` (BUY STOP)
        - SELL @ 4465.0, current 4450.0, conditions: `{"vwap_deviation": true}` ‚Üí `{"order_type": "limit", "vwap_deviation": true}` (SELL LIMIT)
        - BUY @ 4435.0, current 4450.0, conditions: `{"fvg_bull": true}` ‚Üí `{"order_type": "limit", "fvg_bull": true}` (BUY LIMIT)
        - SELL @ 4435.0, current 4450.0, conditions: `{"bos_bear": true}` ‚Üí `{"order_type": "stop", "bos_bear": true}` (SELL STOP)
    - **Manual Override (User Explicit Request):**
      - If reasoning mentions "stop order", "pending stop", "breakout entry", "entry after breakout", "wait for price to break above/below" ‚Üí Include `{"order_type": "stop"}` in conditions (override automatic detection)
      - If reasoning mentions "limit order", "pending limit", "better entry", "retrace entry", "entry at support/resistance" ‚Üí Include `{"order_type": "limit"}` in conditions (override automatic detection)
      - If reasoning mentions "immediate execution", "market order", "execute now" ‚Üí Omit order_type (market order, default)
    - **‚ö†Ô∏è CRITICAL:** System automatically validates entry price is correct for order type before placing pending order. If validation fails, order is rejected with clear error message.
    
    **‚≠ê Phase III Missing Conditions (NEW - January 2026):**
    - **Quantitative Conditions (All symbols):**
      - If reasoning mentions "BB retest" or "Bollinger retest" or "retest after break" ‚Üí Include `{"bb_retest": true, "timeframe": "M15"}` in conditions (default timeframe: M15)
      - If reasoning mentions "z-score" or "statistical mean reversion" or "price deviation" ‚Üí Include `{"zscore": true, "z_threshold": 2.0}` in conditions (default threshold: 2.0 standard deviations)
      - If reasoning mentions "ATR stretch" or "price stretched" or "ATR multiple" ‚Üí Include `{"atr_stretch": true, "atr_multiple": 2.5}` in conditions (default: 2.5x ATR)
    - **Correlation Conditions (BTCUSDc, XAUUSDc):**
      - If reasoning mentions "SPX up" or "S&P 500 up" or "risk-on" or "SPX correlation" ‚Üí Include `{"correlation_asset": "SPX", "spx_up_pct": 0.5}` in conditions (default: 0.5% change, ‚ö†Ô∏è **REQUIRES correlation_asset: "SPX"**)
      - If reasoning mentions "yield drop" or "US10Y drop" or "yield falling" or "bond yield" ‚Üí Include `{"correlation_asset": "US10Y", "yield_drop": 0.05}` in conditions (default: 0.05 absolute change, ‚ö†Ô∏è **REQUIRES correlation_asset: "US10Y"**)
      - If reasoning mentions "DXY divergence" or "dollar divergence" or "correlation divergence" ‚Üí Include `{"correlation_asset": "DXY", "correlation_divergence": true}` in conditions (‚ö†Ô∏è **REQUIRES correlation_asset: "DXY"**)
    - **Session Conditions (All symbols):**
      - If reasoning mentions "volatility decay" or "volatility decreasing" or "NY close reversion" ‚Üí Include `{"volatility_decay": true, "session": "NY_close", "decay_threshold": 0.8}` in conditions (default: 0.8 = 20% decrease, ‚ö†Ô∏è **REQUIRES session**)
      - If reasoning mentions "momentum follow" or "consistent momentum" or "NY momentum" ‚Üí Include `{"momentum_follow": true, "session": "NY", "momentum_periods": 5, "momentum_threshold": 0.5}` in conditions (default: 5 periods, 0.5% threshold, ‚ö†Ô∏è **REQUIRES session**)
      - If reasoning mentions "fakeout sweep" or "false breakout" or "fakeout reversal" ‚Üí Include `{"fakeout_sweep": true, "session": "London", "fakeout_reversal_candles": 5}` in conditions (default: 5 candles for reversal, ‚ö†Ô∏è **REQUIRES session**)
      - If reasoning mentions "flat volatility" or "low volatility hours" or "Asian accumulation" ‚Üí Include `{"flat_vol_hours": 3, "session": "Asian"}` in conditions (default: 3 hours, ‚ö†Ô∏è **REQUIRES session**)
    - **Pattern Conditions (All symbols):**
      - If reasoning mentions "evening star" or "morning star" or "three-candle reversal" ‚Üí Include `{"pattern_evening_morning_star": true, "timeframe": "M15"}` in conditions (default timeframe: M15)
      - If reasoning mentions "three drive" or "harmonic pattern" or "three equal moves" ‚Üí Include `{"pattern_three_drive": true, "timeframe": "M15", "drive_tolerance": 0.01}` in conditions (default: 1% tolerance, default timeframe: M15)
      - If reasoning mentions "tick rate declining" or "momentum exhaustion" (BTC only) ‚Üí Include `{"tick_rate_declining": true}` in conditions
      - If reasoning mentions "momentum decay confirmed" or "multiple decay signals" ‚Üí Include `{"momentum_decay_confirmed": true}` in conditions
    - **‚ö†Ô∏è CRITICAL Phase III Notes:**
      - Order flow microstructure conditions (imbalance, spoof, liquidity rebuild) work **ONLY for BTCUSDc** (require Binance depth stream)
      - Correlation conditions (DXY, BTC, NASDAQ) work **best for XAUUSDc** plans
      - All Phase III conditions are **optional** and can be combined with existing conditions
      - **Check dependencies** before using Phase III conditions (see knowledge docs for full dependency list)
      - If Phase III data unavailable, system gracefully degrades (skips Phase III checks, continues with other conditions)
                    - If reasoning mentions "Inside Bar" or "Volatility Trap" or "Breakout" ‚Üí Include `{"price_above": entry, "price_near": entry, "tolerance": X}` or `{"price_below": entry, "price_near": entry, "tolerance": X}` in conditions ‚ö†Ô∏è **CRITICAL: For breakout strategies, ALWAYS include price_near + tolerance ALONGSIDE price_above/price_below for tighter execution control!**
                    - ‚ö†Ô∏è **CRITICAL: If you mention validation thresholds in your reasoning/notes (e.g., "min_confluence ‚â• 75", "validation score ‚â• 70", "risk filters enabled"), you MUST include them in the conditions dict:**
                      * `"min_confluence": 75` or `"range_scalp_confluence": 75` - Minimum confluence score (0-100, numeric value, NOT a string like ">80" or "confluence: >80")
                      * ‚ö†Ô∏è **FORMAT**: Use numeric value: `"min_confluence": 80` ‚úÖ CORRECT
                      * ‚ùå **WRONG**: `"confluence": ">80"` or `"confluence": >80` or `"min_confluence": ">80"` - These are INVALID formats
                      * `"min_validation_score": 70` - Minimum validation score for order blocks (default: 60 if not specified)
                      * `"risk_filters": true` - Risk filters enabled (system always applies, but include to make explicit)
                      * **If you don't include these in the conditions dict, they won't be saved to the database and won't appear on the webpage!**
                    - ‚ö†Ô∏è **CRITICAL RULES FOR price_above/price_below AND price_near:**
                      * NEVER include both price_above AND price_below in the same plan - they are contradictory!
                      * price_near MUST always match the entry_price (NOT midpoint, NOT a different level)
                      * For plans with price_above: price_near = entry_price (same value)
                      * For plans with price_below: price_near = entry_price (same value)
                      * For independent BUY/SELL plans: BUY plan uses price_near = entry_price, SELL plan uses price_near = entry_price
                    - ALWAYS include `{"price_near": entry, "tolerance": X}` along with other conditions - this ensures execution happens at the correct price level, not just when directional conditions are met
                    - If you don't include proper conditions, the plan will only execute when price reaches entry, which may not match the strategy!
    
    **‚ö†Ô∏è OPTIONAL ENHANCEMENTS - Use ONLY When Market Conditions Warrant:**
    - **CRITICAL**: These conditions are OPTIONAL and should NOT be added by default
    - **They make plans more strict and can prevent execution** - only add when market conditions specifically warrant stricter validation
    - **Default approach**: Start with SIMPLE conditions (price_above/price_below, price_near, tolerance, choch_bull/bear, order_block)
    - **`m1_choch_bos_combo: true`**: ONLY for CHOCH plans when M1 structure is clear and extra precision is critical (very strict - may prevent execution)
    - **`min_volatility: 0.5`**: ONLY when market is in a dead zone and you want to wait for volatility expansion (can prevent execution if volatility is low)
    - **`bb_width_threshold: 2.5`**: ONLY when specifically waiting for volatility expansion (Bollinger squeeze breakout) (can prevent execution if BB width is narrow)
    - **Remember**: More conditions = Less likely to execute. Simpler is better for most trades.
    
    Key distinction:
    - "scalp" = Trade type (fast profit capture) ‚Üí Execute IMMEDIATELY with moneybot.execute_trade
    - "range scalp" = Strategy type (waiting for confluence) ‚Üí CREATE PLAN with moneybot.create_range_scalp_plan
    - "!force:scalp" = Force flag ‚Üí Execute IMMEDIATELY with moneybot.execute_trade (NOT create plan)
    
    **üìã PLAN PORTFOLIO CREATION PATTERN:**
    When user requests: "analyze [symbol] and create plans" OR "give me buy and sell plans" OR "create plans for [symbol]":
    
    1. Call moneybot.analyse_symbol_full(symbol: "[symbol]")
    2. Extract regime, session, symbol data from response
    3. Acknowledge: "Creating diverse plan portfolio (3-5 plans) based on current market conditions"
    4. Explain strategy selection based on regime/symbol/session
    5. Create 3-5 diverse plans using moneybot.create_multiple_auto_plans
       - üö® MANDATORY: Each plan object MUST include 'symbol' field (e.g., symbol: 'BTCUSDc')
       - ‚ùå WRONG: Omitting 'symbol' from individual plans
       - ‚úÖ CORRECT: Every plan must have: { plan_type: 'auto_trade', symbol: 'BTCUSDc', direction: 'BUY', ... }
    6. For any retracement plans, automatically add continuation plans
    7. Display all plans in response with clear labels (retracement/continuation)
    
    **üîÑ SINGLE PLAN WITH DUAL STRATEGY PATTERN:**
    When user requests: "set auto exec [direction] plan for [symbol]"
    AND entry_price is above current (SELL) or below current (BUY):
    
    1. Call moneybot.analyse_symbol_full to get current_price
    2. Acknowledge: "Creating dual plan strategy: retracement + continuation"
    3. Explain: "Retracement plan catches pullback, continuation plan catches breakdown/breakout"
    4. Create both plans using moneybot.create_multiple_auto_plans
       - üö® MANDATORY: Each plan object MUST include 'symbol' field (e.g., symbol: 'BTCUSDc')
       - ‚ùå WRONG: Omitting 'symbol' from individual plans
       - ‚úÖ CORRECT: Both plans must have: { plan_type: 'auto_trade', symbol: 'BTCUSDc', direction: 'SELL', ... }
    5. Display both plans in response with clear labels
    
    CRITICAL ALERTS vs TRADES - DO NOT CONFUSE!
    When user says "set alert" or "alert me when", use moneybot.add_alert with ALERT parameters:
    REQUIRED: symbol, alert_type, condition, description, parameters (with price_level)
    NEVER use: direction, entry, stop_loss, take_profit, volume, ticket, action (those are ONLY for trades!)
    
    Example: User says "set alert when xauusd reaches 4085"
    CORRECT format:
      tool: moneybot.add_alert
      arguments:
        symbol: XAUUSDc
        alert_type: price
        condition: crosses_above
        description: XAUUSDc crosses above 4085
        parameters:
          price_level: 4085
        expires_hours: 48
        one_time: true
    
    ‚ö†Ô∏è LIMITATIONS - What moneybot.add_alert Does NOT Do:
    - Does NOT create "dynamic alert zones" that adjust based on session volatility
    - Does NOT automatically adapt alert thresholds based on DXY/VIX changes
    - Does NOT link alerts between multiple pairs (no cross-pair alert synchronization)
    - Does NOT adjust alert zones based on volatility multipliers (0.8x, 1.5x, etc.)
    - Alerts use fixed price levels - they do NOT dynamically expand/contract based on market conditions
    - This tool only creates alerts at fixed price levels - it does not configure adaptive systems
    
    WRONG format (treating alert as trade - DO NOT DO THIS):
      - DO NOT use direction field (that is for trades only)
      - DO NOT use entry field (use parameters.price_level instead)
      - DO NOT use stop_loss field (alerts don't have stop loss)
      - DO NOT use volume field (alerts don't have volume)
  contact:
    name: MoneyBot Support
  license:
    name: Private

servers:
  - url: https://verbally-faithful-monster.ngrok-free.app
    description: "Production server (ngrok tunnel) - IMPORTANT: Always check /api/v1/price/{symbol} for broker-specific prices before trading!"
 
paths:
  # PHONE CONTROL ENDPOINT
  /dispatch:
    post:
      operationId: dispatchCommand
      summary: Send command to desktop trading bot (Phone Control)
      description: Control your desktop trading bot from your phone. Dispatches commands to the desktop agent and waits for response.
      tags:
        - Phone Control
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - tool
                - arguments
              properties:
                tool:
                  type: string
                  description: Tool to execute on desktop
                  enum:
                    - ping
                    - moneybot.analyse_symbol
                    - moneybot.execute_trade
                    - moneybot.register_trade_with_universal_manager
                    - moneybot.getCurrentPrice
                    - moneybot.getPositions
                    - moneybot.getPendingOrders
                    - moneybot.monitor_status
                    - moneybot.modify_position
                    - moneybot.close_position
                    - moneybot.cancel_pending_order
                    - moneybot.add_alert
                    - moneybot.list_alerts
                    - moneybot.remove_alert
                    - moneybot.sendDiscordMessage
                    - moneybot.toggle_intelligent_exits
                    - moneybot.enableIntelligentExits
                    - moneybot.start_trailing_stops
                    - moneybot.macro_context
                    - moneybot.lot_sizing_info
                    - moneybot.getAdvancedFeatures
                    - moneybot.getMultiTimeframeAnalysis
                    - moneybot.analyse_symbol_full
                    - moneybot.analyse_symbols_bulk
                    - moneybot.analyse_range_scalp_opportunity
                    - moneybot.create_auto_trade_plan
                    - moneybot.create_choch_plan
                    - moneybot.create_rejection_wick_plan
                    - moneybot.create_order_block_plan
                    - moneybot.create_range_scalp_plan
                    - moneybot.create_micro_scalp_plan
                    - moneybot.create_multiple_auto_plans
                    - moneybot.update_multiple_auto_plans
                    - moneybot.cancel_multiple_auto_plans
                    - moneybot.cancel_auto_plan
                    - moneybot.update_auto_plan
                    - moneybot.get_auto_plan_status
                    - moneybot.get_auto_system_status
                    - moneybot.dtms_status
                    - moneybot.dtms_trade_info
                    - moneybot.dtms_action_history
                arguments:
                  type: object
                  description: |
                    Tool-specific arguments object. This is a NESTED object that contains the actual parameters.
                    
                    üö®üö®üö® CRITICAL: IMMEDIATE EXECUTION vs AUTO-EXECUTION PLANS üö®üö®üö®
                    
                    **IMMEDIATE EXECUTION** (use moneybot.execute_trade):
                    When user says: "place", "execute", "enter", "go ahead", "do it now", "trade now", "buy now", "sell now"
                    - User wants trade executed IMMEDIATELY at current or specified price
                    - Examples: "place buy scalp", "execute trade", "enter now", "place buy !force:scalp"
                    - Use moneybot.execute_trade with trade parameters (direction, stop_loss, take_profit, volume, order_type)
                    - ‚ö†Ô∏è CRITICAL: For market orders (order_type: "market" or when user says "execute at market price"), DO NOT provide `entry` parameter - it will be ignored and system uses current market price automatically. Only provide `entry` for limit/stop orders.
                    - Trade executes immediately as market order or pending order
                    - The word "scalp" alone means trade type (fast profit capture) - EXECUTE IMMEDIATELY
                    - The flag "!force:scalp" means FORCE IMMEDIATE EXECUTION with SCALP exit parameters
                    - ‚≠ê RECOMMENDED: Include strategy_type parameter ('breakout_ib_volatility_trap', 'trend_continuation_pullback', 'liquidity_sweep_reversal', 'order_block_rejection', 'mean_reversion_range_scalp') to enable Universal Dynamic SL/TP Manager for advanced stop loss and take profit management. If strategy_type is omitted, trade will use Intelligent Exit Manager instead.
                    
                    **AUTO-EXECUTION PLANS** (use moneybot.create_*_plan):
                    When user says: "wait for", "auto-execute when", "monitor for", "set alert and auto-execute", "create plan"
                    - User wants system to WAIT for conditions before executing
                    - Examples: "wait for CHOCH", "auto-execute when confluence reaches 80", "create range scalp plan"
                    - Use moneybot.create_auto_trade_plan, moneybot.create_choch_plan, moneybot.create_rejection_wick_plan, moneybot.create_order_block_plan, moneybot.create_range_scalp_plan, moneybot.create_micro_scalp_plan
                    - **BATCH OPERATIONS**: When user requests multiple plans (e.g., "create 3 buy plans", "give me plans for different strategies"), use moneybot.create_multiple_auto_plans instead of calling individual create tools multiple times. This reduces permission prompts and improves efficiency. When updating multiple plans, use moneybot.update_multiple_auto_plans. When cancelling multiple plans, use moneybot.cancel_multiple_auto_plans. Single-plan tools still work for single operations.
                    - ‚ö†Ô∏è **CRITICAL FOR BATCH OPERATIONS**: Each plan in the batch MUST specify `plan_type` field (NOT strategy_type). Valid plan_type values are EXACTLY: 'auto_trade', 'choch', 'rejection_wick', 'order_block', 'range_scalp', 'micro_scalp'. The `strategy_type` field is separate and optional - it's stored in conditions for SL/TP management. 
                    - üö® **COMMON MISTAKES TO AVOID**: DO NOT use strategy_type values as plan_type! Examples of WRONG usage: plan_type: 'mean_reversion_range_scalp' (should be 'range_scalp'), plan_type: 'liquidity_sweep_reversal' (should be 'rejection_wick'), plan_type: 'liquidity_sweep' (should be 'rejection_wick'), plan_type: 'breaker_block' (should be 'order_block'). See correct mappings: Range Scalp ‚Üí plan_type: 'range_scalp', Liquidity Sweep ‚Üí plan_type: 'rejection_wick', Order Block ‚Üí plan_type: 'order_block', Breaker Block ‚Üí plan_type: 'order_block' (NOT 'breaker_block'), Premium/Discount ‚Üí plan_type: 'micro_scalp'.
                    - **NOTE**: Bracket trades are deprecated. Instead, create two independent plans (one BUY, one SELL) with different conditions using moneybot.create_multiple_auto_plans or individual create tools.
                    - Trade executes automatically when conditions are met (confluence >= 80, structure confirmed, etc.)
                    - The phrase "range scalp" means strategy type (waiting for confluence) - CREATE PLAN
                    - The phrase "micro scalp" means ultra-short-term trade (waiting for micro conditions) - CREATE PLAN with moneybot.create_micro_scalp_plan
                    
                    **üìã PLAN PORTFOLIO WORKFLOW + DUAL PLAN STRATEGY:**
                    
                    When user requests "analyze [symbol] and create plans" or "give me buy and sell plans":
                    
                    STEP 1: Always analyze first using moneybot.analyse_symbol_full
                    STEP 1.5: **CRITICAL - Timing**: Use current_price immediately after analysis. If more than 5 minutes pass before plan creation, re-check current_price
                    STEP 2: Extract from analysis response (CRITICAL - all required):
                      - response.data.volatility_regime.regime ‚Üí Strategy prioritization
                      - response.data.volatility_regime.strategy_recommendations.prioritize ‚Üí Use these
                      - response.data.volatility_regime.strategy_recommendations.avoid ‚Üí Avoid these
                      - response.data.session.name ‚Üí Session-specific filters
                      - response.data.symbol_constraints ‚Üí Symbol-specific limits
                      - response.data.structure_summary ‚Üí Entry level selection
                      - **response.data.current_price ‚Üí Current market price (MANDATORY for dual plan detection)**
                      - **NOTE: analyse_symbol_full automatically includes current_price - DO NOT call getCurrentPrice separately**
                    
                    STEP 3: Create 3-5 diverse plans using moneybot.create_multiple_auto_plans:
                      - üö® MANDATORY: Each plan object MUST include 'symbol' field (e.g., symbol: 'BTCUSDc')
                      - ‚ùå WRONG: Omitting 'symbol' from individual plans
                      - ‚úÖ CORRECT: Every plan must have: { plan_type: 'auto_trade', symbol: 'BTCUSDc', direction: 'BUY', ... }
                      - Mix condition-based plans (OB, breaker block, liquidity sweep, CHOCH)
                      - Mix confluence-only plans (range scalp, mean reversion with min_confluence)
                      - Include both BUY and SELL plans when market supports both
                      - Use different entry levels (range boundaries, OB zones, liquidity zones)
                    
                    STEP 4: For each retracement plan (entry > current for SELL, or entry < current for BUY):
                      - Automatically create a complementary continuation plan
                      - Use same direction, different entry (below current for SELL, above current for BUY)
                      - Adjust strategy type to continuation (BOS confirmation vs CHOCH confirmation)
                      - üö® MANDATORY: When adding continuation plan to batch, ensure all plans include 'symbol' field with the same symbol value (e.g., symbol: 'BTCUSDc')
                      - **CRITICAL: Before adding continuation plan to batch, verify**:
                        * üö® MANDATORY: 'symbol' field is present in the plan object (e.g., symbol: 'BTCUSDc')
                        * All required fields present (symbol, plan_type, direction, entry, SL, TP, volume, expires_hours, conditions, notes)
                        * plan_type is valid (auto_trade, choch, or rejection_wick)
                        * symbol matches retracement plan exactly
                        * volume matches retracement plan exactly
                        * expires_hours matches retracement plan exactly
                        * conditions are complete and valid:
                          - bos_bear/bull present
                          - price_below (SELL) or price_above (BUY) - matches direction
                          - price_near matches continuation entry exactly
                          - tolerance is symbol-appropriate (75-90% of retracement tolerance)
                          - timeframe matches retracement or is lower
                        * entry is positive, non-zero, and reasonable for symbol
                        * SL is correctly positioned (above entry for SELL, below entry for BUY)
                        * TP is correctly positioned (below entry for SELL, above entry for BUY)
                        * notes include retracement plan identifier (use descriptive identifier if plan_id not yet known)
                    STEP 5: After batch creation succeeds:
                      - Check batch response for partial failures
                      - If retracement succeeds but continuation fails, explain error and offer to retry
                      - If both succeed, update continuation plan notes with actual retracement plan_id (if placeholder was used)
                      - Inform user: "Both plans can execute independently. If both trigger, total position will be [2x volume]."
                    
                    **DUAL PLAN DETECTION RULE:**
                    When creating a plan with entry_price > current_price (SELL) OR entry_price < current_price (BUY):
                    
                    - This indicates a RETRACEMENT/REVERSAL strategy
                    - Check minimum separation threshold:
                      * SELL: entry_price - current_price must be > minimum_distance (50 pts for BTC, 10 pts for XAU, 0.0003 for forex)
                      * BUY: current_price - entry_price must be > minimum_distance (same values)
                    - If separation is sufficient, you MUST automatically create a second CONTINUATION plan in the same direction
                    - If entry is too close to current price (< minimum_distance), do NOT create dual plan (plan is already at market)
                    - Add both plans to the same batch using moneybot.create_multiple_auto_plans
                    - üö® MANDATORY: Each plan object MUST include 'symbol' field (e.g., symbol: 'BTCUSDc')
                    - ‚ùå WRONG: Omitting 'symbol' from individual plans
                    - ‚úÖ CORRECT: Both plans must have: { plan_type: 'auto_trade', symbol: 'BTCUSDc', direction: 'SELL', ... }
                    - This applies to BOTH portfolio creation AND single plan requests
                    - **CRITICAL: After batch creation, check response for partial failures**:
                      * If retracement succeeds but continuation fails, explain error and offer to retry
                      * If both fail, explain both errors clearly
                      * Always display which plans succeeded and which failed
                    
                    **CONTINUATION PLAN PARAMETERS:**
                    Retracement Plan (Original):
                    - Entry: Original entry price (above/below current)
                    - Strategy: Reversal/pullback (OB rejection, CHOCH confirmation)
                    - Conditions: choch_bear/bull, order_block, price_near (retest zone)
                    
                    Continuation Plan (Auto-Generated):
                    - Entry: Below current price (SELL) or above current price (BUY)
                    - Strategy: Trend continuation (BOS confirmation, breakdown/breakout)
                    - Conditions: 
                      * bos_bear/bull (BOS confirmation)
                      * price_below (for SELL) OR price_above (for BUY) - MUST match plan direction
                      * price_near: MUST equal continuation entry exactly (NOT retracement entry)
                      * tolerance: Symbol-appropriate (BTC=100, XAU=5, Forex=0.001) or 75-90% of retracement tolerance
                      * timeframe: Match retracement timeframe or use lower timeframe (M5 if retracement is M15)
                    - SL: Set above failed retest zone (retracement plan entry + buffer)
                      * SELL: SL must be > entry (above entry)
                      * BUY: SL must be < entry (below entry)
                    - TP: Extended target (range extension, structure target, typically 1.5-2x R:R ratio)
                      * SELL: TP must be < entry (below entry)
                      * BUY: TP must be > entry (above entry)
                    - **CRITICAL: Required Fields**:
                      * symbol: MUST match retracement plan symbol exactly
                      * plan_type: MUST be one of: auto_trade, choch, or rejection_wick
                        - auto_trade: Most common for continuation plans (trend_continuation_pullback strategy)
                        - choch: Use if BOS confirmation is the primary trigger
                        - rejection_wick: Use if liquidity sweep continuation is the strategy
                        - DO NOT use: order_block, range_scalp, or micro_scalp (these are not appropriate for continuation strategies)
                      * direction: MUST match retracement plan direction
                      * volume: MUST match retracement plan volume exactly (for risk consistency)
                      * expires_hours: MUST match retracement plan expires_hours exactly (for expiration consistency)
                      * conditions: MUST include:
                        - bos_bear/bull (BOS confirmation)
                        - price_below (for SELL) OR price_above (for BUY) - MUST match plan direction
                        - price_near: MUST equal continuation entry exactly (NOT retracement entry)
                        - tolerance: Symbol-appropriate (BTC=100, XAU=5, Forex=0.001) or 75-90% of retracement tolerance
                        - timeframe: Match retracement timeframe or use lower timeframe (M5 if retracement is M15)
                      * notes: MUST include "Continuation plan for retracement plan [retracement_plan_id]" for traceability
                    - **CRITICAL: Validation Before Batch Creation**:
                      * Verify entry is positive, non-zero, and reasonable for symbol
                      * Verify SL is correctly positioned (above entry for SELL, below entry for BUY)
                      * Verify TP is correctly positioned (below entry for SELL, above entry for BUY)
                      * Verify price_near matches entry exactly
                      * Verify price condition direction matches plan direction (price_below for SELL, price_above for BUY)
                    
                    **üö® CRITICAL: When using moneybot.create_auto_trade_plan, you MUST include conditions that match the strategy type!**
                    - If reasoning mentions "Order Block" or "OB" ‚Üí Include `{"order_block": true, "order_block_type": "auto", "price_near": entry, "tolerance": X}`
                    - If reasoning mentions "Breaker Block" or "failed order block" or "flipped zone" ‚Üí Include `{"breaker_block": true, "price_near": entry, "tolerance": X}` (‚ö†Ô∏è **DO NOT include ob_broken or price_retesting_breaker - these are detection results, not condition inputs**)
                    - If reasoning mentions "CHOCH" or "BOS" or "Breakout" ‚Üí Include `{"choch_bull": true, "price_near": entry, "tolerance": X}` or `{"choch_bear": true, "price_near": entry, "tolerance": X}` or `{"price_above": entry, "price_near": entry, "tolerance": X}` or `{"price_below": entry, "price_near": entry, "tolerance": X}` ‚ö†Ô∏è **CRITICAL: CHOCH/Breakout plans MUST include price_near + tolerance or they'll execute at ANY price!**
                    - If reasoning mentions "Rejection Wick" or "Pin Bar" ‚Üí Include `{"rejection_wick": true, "price_near": entry, "tolerance": X}`
                    - If reasoning mentions "Liquidity Sweep" or "Stop Hunt" ‚Üí Include `{"liquidity_sweep": true, "choch_bear": true, "price_near": entry, "tolerance": X}` for SELL plans OR `{"liquidity_sweep": true, "choch_bull": true, "price_near": entry, "tolerance": X}` for BUY plans ‚ö†Ô∏è **CRITICAL: CHOCH confirmation (choch_bear for SELL, choch_bull for BUY) is REQUIRED - system BLOCKS execution without it!** Also include `price_below: [entry]` for SELL or `price_above: [entry]` for BUY for proper sweep detection.
                    - If reasoning mentions "VWAP Deviation" or "VWAP Bounce/Fade" ‚Üí Include `{"vwap_deviation": true, "vwap_deviation_direction": "below" or "above", "vwap_deviation_threshold": 2.0, "price_near": entry, "tolerance": X}`
                    - If reasoning mentions "EMA Slope" or "Trend Alignment" ‚Üí Include `{"ema_slope": true, "ema_slope_direction": "bullish" or "bearish", "price_near": entry, "tolerance": X}`
                    
                    **‚≠ê RECOMMENDED: Include strategy_type parameter for Universal Dynamic SL/TP Manager:**
                    
                    **‚ö†Ô∏è CRITICAL: Strategy selection must match market conditions - DO NOT default to breakouts!**
                    
                    **üîç Detection Signals for ChatGPT - How to Identify SMC Patterns:**
                    
                    When analyzing market structure, look for these keywords/signals to identify SMC patterns:
                    
                    **Order Block Detection:**
                    - Keywords: "strong support/resistance zone", "institutional level", "order block", "OB zone"
                    - Signals: Price rejecting from a zone, volume spike at zone, last candle before displacement
                    - Tech Dict Fields: `order_block_bull`, `order_block_bear`, `ob_strength`
                    - When detected: Price is near or retesting an institutional order block zone
                    
                    **Breaker Block Detection:**
                    - Keywords: "failed order block", "flipped zone", "support became resistance", "resistance became support", "broken order block"
                    - Signals: Price broke through an order block, then returned to test the flipped zone
                    - Tech Dict Fields: `breaker_block_bull`, `breaker_block_bear`, `ob_broken`, `price_retesting_breaker`
                    - When detected: Order block was broken and price is retesting the flipped level
                    - ‚ö†Ô∏è **IMPORTANT:** `ob_broken` and `price_retesting_breaker` are detection results from `DetectionSystemManager().get_breaker_block()` - they are checked dynamically by the system, NOT stored in conditions. Only `breaker_block: true` is required in conditions.
                    
                    **Fair Value Gap (FVG) Detection:**
                    - Keywords: "imbalance", "fair value gap", "inefficiency", "FVG", "gap in price action"
                    - Signals: Three-candle pattern with gap, price filling the gap, continuation after gap
                    - Tech Dict Fields: `fvg_bull`, `fvg_bear`, `fvg_filled_pct`, `fvg_strength`
                    - When detected: Price is filling or has filled 50-75% of a fair value gap zone
                    
                    **Market Structure Shift (MSS) Detection:**
                    - Keywords: "market structure shift", "trend reversal confirmed", "structure break", "MSS", "break of structure with pullback"
                    - Signals: Break of swing high/low, followed by pullback to break level, stronger than CHOCH
                    - Tech Dict Fields: `mss_bull`, `mss_bear`, `mss_level`, `pullback_to_mss`
                    - When detected: Market structure has shifted and price is pulling back to confirm the shift
                    
                    **Mitigation Block Detection:**
                    - Keywords: "last candle before break", "mitigation block", "smart money exit zone", "structure break zone"
                    - Signals: Last bullish/bearish candle before structure break, often with FVG nearby
                    - Tech Dict Fields: `mitigation_block_bull`, `mitigation_block_bear`, `structure_broken`, `fvg_present`
                    - When detected: Last candle before structure break, often combined with FVG
                    
                    **Inducement Reversal Detection:**
                    - Keywords: "liquidity grab", "stop hunt", "liquidity sweep", "rejection from liquidity zone", "inducement"
                    - Signals: Price sweeps liquidity above/below key level, then rejects back into structure
                    - Tech Dict Fields: `liquidity_grab_bull`, `liquidity_grab_bear`, `rejection_detected`, `order_block_present`, `fvg_present`
                    - When detected: Liquidity was grabbed and price rejected, with OB/FVG confluence
                    
                    **Premium/Discount Array Detection:**
                    - Keywords: "premium zone", "discount zone", "Fibonacci retracement", "value zone", "0.618 fib", "0.786 fib"
                    - Signals: Price in discount zone (0.62-0.79 fib) for longs, premium zone (0.21-0.38 fib) for shorts
                    - Tech Dict Fields: `fib_levels`, `price_in_discount`, `price_in_premium`
                    - When detected: Price is in optimal value zone based on Fibonacci retracement
                    
                    **Session Liquidity Run Detection:**
                    - Keywords: "Asian session high/low", "session liquidity", "London sweeps Asian levels", "session breakout"
                    - Signals: Asian session high/low being swept during London session, followed by reversal
                    - Tech Dict Fields: `asian_session_high`, `asian_session_low`, `london_session_active`, `sweep_detected`, `reversal_structure`
                    - When detected: London session is targeting Asian session liquidity levels
                    
                    **Kill Zone Detection:**
                    - Keywords: "London open", "NY open", "high volatility window", "kill zone", "session open volatility"
                    - Signals: London Open (02:00-05:00 EST) or NY Open (08:00-11:00 EST) with volatility spike
                    - Tech Dict Fields: `session`, `kill_zone_active`, `volatility_spike`
                    - When detected: High volatility window during session opens
                    
                    **Complete SMC Strategy Priority Hierarchy (Auto-Selection):**
                    
                    ü•á **TIER 1: Highest Confluence (Institutional Footprints)**
                    
                    1. **Order Block Rejection** ‚Üí `strategy_type: "order_block_rejection"`
                       - **Use when:** Institutional order blocks detected (order_block_bull/order_block_bear in analysis)
                       - **Priority:** HIGHEST - Always select when OB detected
                       - **Best for:** High-probability reversal trades with institutional support
                       - **Conditions:** `{"order_block": true, "order_block_type": "auto", "price_near": entry, "tolerance": X}`
                    
                    2. **Breaker Block** ‚Üí `strategy_type: "breaker_block"`
                       - **Use when:** Price breaks through OB, returns to flip zone (failed order block)
                       - **Priority:** HIGHEST - Higher probability than regular OB
                       - **Best for:** Reversal trades at flipped support/resistance
                       - **Conditions:** `{"breaker_block": true, "price_near": entry, "tolerance": X}`
                    
                    3. **Market Structure Shift (MSS)** ‚Üí `strategy_type: "market_structure_shift"`
                       - **Use when:** Break of high/low + pullback confirmation
                       - **Priority:** HIGHEST - Stronger than CHOCH, confirms trend change
                       - **Best for:** Trend change trades with structure confirmation
                       - **Conditions:** `{"mss_bull": true, "pullback_to_mss": true, "price_near": entry, "tolerance": X}` or `{"mss_bear": true, ...}`
                    
                    ü•à **TIER 2: High Confluence (Smart Money Patterns)**
                    
                    4. **Fair Value Gap (FVG) Retracement** ‚Üí `strategy_type: "fvg_retracement"`
                       - **Use when:** Price fills 50-75% of FVG zone, best after CHOCH/BOS
                       - **Priority:** HIGH - Strong institutional footprint
                       - **Best for:** Continuation trades after structure break
                       - **Conditions:** `{"fvg_bull": true, "fvg_filled_pct": 0.5-0.75, "choch_bull": true, "price_near": entry, "tolerance": X}`
                    
                    5. **Mitigation Block** ‚Üí `strategy_type: "mitigation_block"`
                       - **Use when:** Last bullish/bearish candle before structure break, often with FVG
                       - **Priority:** HIGH - Smart money exit/entry zone
                       - **Best for:** Reversal trades at structure break zones
                       - **Conditions:** `{"mitigation_block_bull": true, "structure_broken": true, "price_near": entry, "tolerance": X}`
                    
                    6. **Inducement + Reversal** ‚Üí `strategy_type: "inducement_reversal"`
                       - **Use when:** Liquidity grab above/below key level + rejection + OB/FVG confluence
                       - **Priority:** HIGH - Combine with OB/FVG for maximum confluence
                       - **Best for:** Reversal trades after liquidity grab
                       - **Conditions:** `{"liquidity_grab_bull": true, "rejection_detected": true, "order_block": true, "price_near": entry, "tolerance": X}`
                    
                    ü•â **TIER 3: Medium-High Confluence**
                    
                    7. **Liquidity Sweep Reversal** ‚Üí `strategy_type: "liquidity_sweep_reversal"`
                       - **Use when:** Price sweeps liquidity zones, stop hunt detected, reversal signals present
                       - **Priority:** MEDIUM-HIGH - Select when sweep detected (if no Tier 1/2)
                       - **Best for:** Reversal trades after liquidity grab, mean reversion setups
                       - **Conditions:** `{"liquidity_sweep": true, "price_near": entry, "tolerance": X}`
                    
                    8. **Session Liquidity Run** ‚Üí `strategy_type: "session_liquidity_run"`
                       - **Use when:** Asian session highs/lows during London, after sweep + reversal
                       - **Priority:** MEDIUM-HIGH - Session-specific high-probability setups
                       - **Best for:** Reversal trades targeting session liquidity
                       - **Conditions:** `{"asian_session_high": true, "london_session_active": true, "sweep_detected": true, "reversal_structure": true, "price_near": entry, "tolerance": X}`
                    
                    üèÖ **TIER 4: Medium Confluence**
                    
                    9. **Trend Continuation Pullback** ‚Üí `strategy_type: "trend_continuation_pullback"`
                       - **Use when:** Strong trend in place, pullback to support/resistance, CHOCH/BOS continuation
                       - **Priority:** MEDIUM - Select when trend confirmed (if no Tier 1-3)
                       - **Best for:** Trend-following trades, riding established momentum
                       - **Conditions:** `{"choch_bull": true, "price_near": entry, "tolerance": X}` or `{"choch_bear": true, ...}`
                    
                    10. **Premium/Discount Array** ‚Üí `strategy_type: "premium_discount_array"`
                        - **Use when:** Price in discount zone (0.62-0.79 fib) for longs, premium zone (0.21-0.38 fib) for shorts
                        - **Priority:** MEDIUM - Value zone entries
                        - **Best for:** Mean reversion trades at optimal value zones
                        - **Conditions:** `{"price_in_discount": true, "price_near": entry, "tolerance": X}` or `{"price_in_premium": true, ...}`
                    
                    ‚ö™ **TIER 5: Lower Priority**
                    
                    11. **Kill Zone Strategy** ‚Üí `strategy_type: "kill_zone"`
                        - **Use when:** London Open (02:00-05:00 EST) or NY Open (08:00-11:00 EST) with volatility
                        - **Priority:** LOW - Time-based (lower than structure-based)
                        - **Best for:** High volatility window trades
                        - **Conditions:** `{"kill_zone_active": true, "volatility_spike": true, "price_near": entry, "tolerance": X}`
                    
                    12. **Range Scalp/Mean Reversion** ‚Üí `strategy_type: "mean_reversion_range_scalp"`
                        - **Use when:** Price in range, bouncing between support/resistance, VWAP mean reversion signals
                        - **Priority:** LOW - Select when range-bound (if no structure)
                        - **Best for:** Range trading, scalping between levels
                        - **Conditions:** `{"vwap_deviation": true, "vwap_deviation_direction": "below" or "above", "price_near": entry, "tolerance": X}`
                    
                    13. **Breakout/Inside Bar/Volatility Trap** ‚Üí `strategy_type: "breakout_ib_volatility_trap"`
                        - **Use when:** Volatility compression confirmed (inside bars, Bollinger squeeze), range breakout imminent
                        - **Priority:** LOWEST - Only use when NO structure detected (fallback only)
                        - **Best for:** Range breakouts, volatility expansion trades
                        - **‚ö†Ô∏è WARNING: Only use when volatility compression is confirmed - NOT a default choice!**
                        - **Conditions:** `{"bb_squeeze": true, "price_above": entry, "price_near": entry, "tolerance": X}` or `{"inside_bar": true, ...}`
                    
                    **Selection Rules (Priority Order):**
                    1. ‚úÖ **TIER 1 FIRST** - Check for Order Blocks, Breaker Blocks, MSS
                    2. ‚úÖ **TIER 2 SECOND** - Check for FVG, Mitigation Blocks, Inducement
                    3. ‚úÖ **TIER 3 THIRD** - Check for Liquidity Sweeps, Session Runs
                    4. ‚úÖ **TIER 4 FOURTH** - Check for Trend Pullbacks, Premium/Discount
                    5. ‚úÖ **TIER 5 LAST** - Check for Kill Zone, Range Scalp
                    6. ‚ö†Ô∏è **IBVT AS LAST RESORT** - Only when NO structure detected (no OB, no sweep, no CHOCH/BOS, no FVG, no MSS, etc.)
                    - If strategy_type is provided, Universal Dynamic SL/TP Manager will automatically manage the trade with strategy-specific, symbol-specific, and session-specific dynamic stop loss and take profit adjustments
                    - If strategy_type is omitted, trade will use Intelligent Exit Manager instead (still functional, but less advanced SL/TP management)
                    
                    **üö® CRITICAL FOR BTC TRADES: Always check BTC order flow metrics before creating auto-execution plans for BTCUSD!**
                    - For BTCUSD analysis, recommendations, and auto-execution plans: ALWAYS use `moneybot.btc_order_flow_metrics` to check Delta Volume, CVD, CVD Divergence, Delta Divergence, Absorption Zones, and Buy/Sell Pressure
                    - BTC order flow metrics are AUTOMATICALLY included in `moneybot.analyse_symbol_full` for BTCUSD - check the "BTC ORDER FLOW METRICS" section in the analysis summary
                    - When creating BTC auto-execution plans, consider order flow signals:
                      * Strong buy pressure (Delta > 0, CVD rising) ‚Üí Favor BUY plans, use `delta_positive: true` and `cvd_rising: true` conditions
                      * Strong sell pressure (Delta < 0, CVD falling) ‚Üí Favor SELL plans, use `delta_negative: true` and `cvd_falling: true` conditions
                      * CVD Divergence detected (bearish: price up, CVD down) ‚Üí Use `cvd_div_bear: true` condition for SELL plans
                      * CVD Divergence detected (bullish: price down, CVD up) ‚Üí Use `cvd_div_bull: true` condition for BUY plans
                      * Delta Divergence detected (bullish: price down, delta up) ‚Üí Use `delta_divergence_bull: true` condition for BUY plans (early reversal signal)
                      * Delta Divergence detected (bearish: price up, delta down) ‚Üí Use `delta_divergence_bear: true` condition for SELL plans (early reversal signal)
                      * Absorption zones near entry ‚Üí Use `avoid_absorption_zones: true` to block execution, OR `absorption_zone_detected: true` to enter at zones
                    - BTC order flow metrics help validate entry timing and direction for BTC trades
                    - **NEW (Phase 1-3):** Order flow conditions now include divergence detection and enhanced absorption zones for better entry/exit timing
                    - **üö´ DO NOT ADD volatility_state - IT BLOCKS MOST EXECUTIONS:**
                      * **CRITICAL**: Plans with volatility_state almost NEVER trigger - market is usually STABLE, not EXPANDING
                      * **DEFAULT RULE**: NEVER add volatility_state to any plan - price conditions alone trigger reliably
                      * **BB_SQUEEZE plans**: Price breakout IS the volatility expansion confirmation - do NOT add volatility_state
                      * **All breakout plans**: Just use `price_above/price_below` + `price_near` + `tolerance` - that's enough
                    - **ONLY add volatility_state if user EXPLICITLY requests it:**
                      * User says "wait for volatility expansion" or "only trade if volatility expands" ‚Üí ADD it
                      * User says nothing about volatility ‚Üí DO NOT ADD IT
                      * BB_SQUEEZE alert detected ‚Üí DO NOT add volatility_state (price breakout = expansion)
                      * Standard breakout/breakdown ‚Üí DO NOT add volatility_state
                    - **üö® CRITICAL: Discord Alert Workflow - MANDATORY Analysis Before Creating Plans:**
                      * **‚ö†Ô∏è MANDATORY STEP 1: When you receive a Discord alert (e.g., "Analyze BTCUSDc M15 for RSI_DIV_BEAR alert..."), you MUST FIRST analyze the symbol using `moneybot.analyse_symbol_full` to:**
                        - ‚úÖ Validate the alert signal is still present/valid
                        - ‚úÖ Check current market structure (CHOCH, BOS, trend direction)
                        - ‚úÖ Verify price is still near the alert level
                        - ‚úÖ Assess confluence (macro, session, volatility, order flow)
                        - ‚úÖ Determine if the setup is still valid for trading
                        - ‚úÖ Calculate appropriate entry/SL/TP based on current market conditions
                      * **‚ö†Ô∏è MANDATORY STEP 2: Only AFTER analysis, evaluate if the alert represents a valid trading setup:**
                        - ‚úÖ If analysis confirms the alert is valid ‚Üí Create auto-execution plan with proper conditions
                        - ‚ö†Ô∏è **"WAIT" verdict is OK for auto-execution plans** ‚Üí "WAIT" means "wait for conditions/price", which is EXACTLY what auto-execution plans do! They wait for conditions to be met before executing.
                        - ‚úÖ **If analysis says "WAIT" but alert is valid** ‚Üí You CAN create an auto-execution plan (the plan will wait for conditions)
                        - ‚ùå **DO NOT create plan if analysis verdict is "AVOID"** ‚Üí Analysis explicitly says "AVOID" (don't trade), so do not create plan
                        - ‚ùå **DO NOT create plan if confluence score is "AVOID" or Grade: F with explicit "AVOID" message** ‚Üí Analysis explicitly says to avoid trading
                        - ‚ùå **DO NOT create plan if confluence score is below 50/100 (Grade: F)** ‚Üí Low confluence means setup is not valid, even if Grade is not explicitly "AVOID"
                        - ‚ùå **DO NOT create plan if analysis shows "CHOCH/BOS: ‚ùå None detected" but alert claims CHOCH/BOS** ‚Üí Alert condition not confirmed in analysis
                        - ‚ùå **DO NOT create plan if alert claims RSI divergence but analysis does NOT detect RSI divergence** ‚Üí If analysis shows "RSI 56.7" with no divergence detected, but alert claims "RSI_DIV_BEAR", the analysis contradicts the alert - DO NOT create plan
                        - ‚ùå **DO NOT create plan if alert condition is NOT detected in analysis** ‚Üí The analysis must independently confirm the alert condition exists (e.g., if alert says "RSI_DIV_BEAR" but analysis shows no RSI divergence, the alert is not validated)
                        - ‚ùå If price has moved significantly away from alert level (e.g., >50 points for XAUUSD, >200 points for BTCUSD) ‚Üí DO NOT create a plan, explain why
                        - ‚ùå If market structure contradicts the alert direction (e.g., alert says SELL but structure is BULLISH) ‚Üí DO NOT create a plan, explain why
                        - ‚ùå If alert condition already passed (e.g., CHOCH already occurred, price already moved) ‚Üí DO NOT create a plan, explain why
                        - ‚ùå If analysis shows the alert is invalid/expired/contradictory ‚Üí DO NOT create a plan, explain why
                        - **üí° Key Distinction: "WAIT" = OK for plans (they wait for conditions), "AVOID" = Block plan creation (don't trade)**
                        - **üö® CRITICAL: If analysis does NOT detect the alert condition (e.g., no RSI divergence detected, no CHOCH/BOS detected), you MUST explain to the user that the alert condition was not confirmed in your analysis and therefore you cannot create a plan. Do NOT create a plan "just in case" or "waiting for confirmation" - if the condition isn't present, the plan should not be created.**
                      * **‚ö†Ô∏è MANDATORY STEP 3: If valid, create auto-execution plan using the analysis results:**
                        - ‚úÖ Use entry/SL/TP from analysis (not just from alert)
                        - ‚úÖ Include required conditions matching the alert type
                        - ‚úÖ Adjust entry if price has moved (use current price from analysis)
                        - ‚úÖ Include reasoning based on analysis findings
                      * **‚ùå WRONG WORKFLOW: Immediately creating auto-execution plan without analysis**
                      * **‚úÖ CORRECT WORKFLOW: Analyze ‚Üí Validate ‚Üí Create plan (if valid)**
                    - **üö® CRITICAL: Alert-to-Condition Mapping - REQUIRED Conditions + TIMING:**
                      * **‚ö†Ô∏è TIMING ISSUE: Alerts fire when conditions are detected, but plans are created AFTER (30s-2min delay). The auto-execution system checks conditions in REAL-TIME. If the alert condition already passed, the plan will wait for it to occur again.**
                      * **BB_SQUEEZE alert** ‚Üí ‚ö†Ô∏è **DO NOT use `bb_squeeze: true`** - By the time plan is created, squeeze may already be over. Instead use: `{"bb_expansion": true, "price_above": entry, "price_near": entry, "tolerance": X, "timeframe": "M15"}` OR `{"price_above": entry, "price_near": entry, "tolerance": X}` (wait for breakout, not squeeze)
                      * **BB_EXPANSION alert** ‚Üí MUST include: `{"bb_expansion": true, "price_above": entry, "price_near": entry, "tolerance": X, "timeframe": "M15"}` (bb_expansion validates expansion is active)
                      * **RSI_DIV_BEAR alert** ‚Üí MUST include: `{"rsi_div_bear": true, "price_near": entry, "tolerance": X, "timeframe": "M15"}` (rsi_div_bear validates divergence is present)
                        - ‚ö†Ô∏è **CRITICAL: If your analysis does NOT detect RSI bearish divergence, DO NOT create the plan!** The analysis must independently confirm the divergence exists. If analysis shows "RSI 56.7" with no divergence detected, the alert is not validated - explain to user why you cannot create the plan.
                      * **RSI_DIV_BULL alert** ‚Üí MUST include: `{"rsi_div_bull": true, "price_near": entry, "tolerance": X, "timeframe": "M15"}` (rsi_div_bull validates divergence is present)
                        - ‚ö†Ô∏è **CRITICAL: If your analysis does NOT detect RSI bullish divergence, DO NOT create the plan!** The analysis must independently confirm the divergence exists. If analysis shows no divergence detected, the alert is not validated - explain to user why you cannot create the plan.
                      * **CHOCH_BEAR alert** ‚Üí MUST include: `{"choch_bear": true, "price_near": entry, "tolerance": X, "timeframe": "M5"}` 
                        - **CHOCH (Change of Character)**: Detects reversal by checking if price breaks the **second-to-last** swing low (structure shift from bullish to bearish)
                        - Validates structure shift/reversal pattern
                      * **CHOCH_BULL alert** ‚Üí MUST include: `{"choch_bull": true, "price_near": entry, "tolerance": X, "timeframe": "M5"}` 
                        - **CHOCH (Change of Character)**: Detects reversal by checking if price breaks the **second-to-last** swing high (structure shift from bearish to bullish)
                        - Validates structure shift/reversal pattern
                      * **BOS_BEAR alert** ‚Üí MUST include: `{"bos_bear": true, "price_near": entry, "tolerance": X, "timeframe": "M15"}` 
                        - **BOS (Break of Structure)**: Detects continuation by checking if price breaks the **last** swing low (downtrend continuation)
                        - Validates trend continuation pattern
                      * **BOS_BULL alert** ‚Üí MUST include: `{"bos_bull": true, "price_near": entry, "tolerance": X, "timeframe": "M15"}` 
                        - **BOS (Break of Structure)**: Detects continuation by checking if price breaks the **last** swing high (uptrend continuation)
                        - Validates trend continuation pattern
                      * **‚ö†Ô∏è IMPORTANT**: The system uses separate detection functions for CHOCH and BOS. They are NOT interchangeable:
                        - Use `choch_bull`/`choch_bear` for reversal patterns (structure shifts)
                        - Use `bos_bull`/`bos_bear` for continuation patterns (trend breaks)
                      * **BULLISH_OB / BEARISH_OB alert** ‚Üí MUST include: `{"order_block": true, "order_block_type": "auto", "price_near": entry, "tolerance": X}` (order_block validates OB is present)
                      * **BEAR_SWEEP / BULL_SWEEP alert** ‚Üí MUST include: `{"liquidity_sweep": true, "price_near": entry, "tolerance": X}` (liquidity_sweep validates sweep occurred)
                      * **INSIDE_BAR alert** ‚Üí MUST include: `{"inside_bar": true, "price_above": entry, "price_near": entry, "tolerance": X, "timeframe": "M15"}` (inside_bar validates compression pattern)
                      * **EQUAL_HIGHS alert** ‚Üí MUST include: `{"equal_highs": true, "price_near": entry, "tolerance": X, "timeframe": "H1"}` (equal_highs validates liquidity zone)
                      * **EQUAL_LOWS alert** ‚Üí MUST include: `{"equal_lows": true, "price_near": entry, "tolerance": X, "timeframe": "H1"}` (equal_lows validates liquidity zone)
                      * **VWAP_DEV_HIGH / VWAP_DEV_LOW alert** ‚Üí MUST include: `{"vwap_deviation": true, "vwap_deviation_direction": "above/below", "price_near": entry, "tolerance": X}` (vwap_deviation validates deviation)
                      * **‚ö†Ô∏è If you don't include the alert-specific condition (bb_squeeze, rsi_div_bear, etc.), the plan will execute without validating the alert signal!**
                    - If reasoning mentions "Inside Bar" or "Volatility Trap" or "Breakout" ‚Üí Include `{"price_above": entry, "price_near": entry, "tolerance": X}` or `{"price_below": entry, "price_near": entry, "tolerance": X}` ‚ö†Ô∏è **CRITICAL: For breakout strategies, ALWAYS include price_near + tolerance ALONGSIDE price_above/price_below for tighter execution control!**
                    - ‚ö†Ô∏è **CRITICAL RULES FOR price_above/price_below AND price_near:**
                      * NEVER include both price_above AND price_below in the same plan - they are contradictory!
                      * price_near MUST always match the entry_price (NOT midpoint, NOT a different level)
                      * For plans with price_above: price_near = entry_price (same value)
                      * For plans with price_below: price_near = entry_price (same value)
                      * For independent BUY/SELL plans: BUY plan uses price_near = entry_price, SELL plan uses price_near = entry_price
                    - ALWAYS include `{"price_near": entry, "tolerance": X}` along with other conditions - this ensures execution happens at the correct price level, not just when directional conditions are met
                    - If you don't include proper conditions, the plan will only execute when price reaches entry, which may not match the strategy!
                    
                    **‚ö†Ô∏è OPTIONAL ENHANCEMENTS - Use ONLY When Market Conditions Warrant:**
                    - **CRITICAL**: These conditions are OPTIONAL and should NOT be added by default
                    - **They make plans more strict and can prevent execution** - only add when market conditions specifically warrant stricter validation
                    - **Default approach**: Start with SIMPLE conditions (price_above/price_below, price_near, tolerance, choch_bull/bear, bos_bull/bear, order_block)
                    - **`m1_choch_bos_combo: true`**: ONLY for CHOCH plans when M1 structure is clear and extra precision is critical (very strict - may prevent execution)
                    - **`min_volatility: 0.5`**: ONLY when market is in a dead zone and you want to wait for volatility expansion (can prevent execution if volatility is low)
                    - **`bb_width_threshold: 2.5`**: ONLY when specifically waiting for volatility expansion (Bollinger squeeze breakout) (can prevent execution if BB width is narrow)
                    - **Example simple CHOCH plan (RECOMMENDED)**: `{"choch_bull": true, "timeframe": "M5", "price_near": 83800, "tolerance": 100}` ‚ö†Ô∏è **Note: price_near + tolerance are REQUIRED, not optional!**
                    - **Example enhanced CHOCH plan (ONLY when needed)**: `{"choch_bull": true, "timeframe": "M5", "price_near": 83800, "tolerance": 100, "m1_choch_bos_combo": true, "min_volatility": 0.5, "bb_width_threshold": 2.5}` - Use only when market conditions specifically warrant all these conditions
                    - **üö® CRITICAL: Multi-Timeframe Conditions - System Checks BOTH Timeframes:**
                      * **`m1_choch_bos_combo`** - When used, you MUST also include `choch_bull` or `choch_bear` (system checks M5/M15 AND M1)
                      * **`order_block`** - Automatically uses M1 data with M5 cross-timeframe validation (checks both)
                      * **`liquidity_sweep`** - Uses M1 data for detection (M1 only, but can combine with M5/M15 structure)
                      * **`structure_confirmation`** - Checks M15 structure using separate `_detect_choch()` and `_detect_bos()` functions. Passes if EITHER CHOCH (reversal) OR BOS (continuation) is detected in trade direction
                      * **‚ö†Ô∏è If you use `m1_choch_bos_combo` without `choch_bull`/`choch_bear`, the plan will only check M1 and miss higher timeframe structure!**
                      * **‚ö†Ô∏è CHOCH vs BOS Detection**: The system uses separate functions:
                        - `_detect_choch()` checks if price breaks the **second-to-last** swing point (reversal)
                        - `_detect_bos()` checks if price breaks the **last** swing point (continuation)
                        - `structure_confirmation` checks for EITHER pattern in the trade direction
                    - **Remember**: More conditions = Less likely to execute. Simpler is better for most trades.
                    
                    **KEY DISTINCTION:**
                    - "scalp" = Trade type ‚Üí Execute IMMEDIATELY using moneybot.execute_trade
                    - "range scalp" = Strategy type ‚Üí CREATE PLAN using moneybot.create_range_scalp_plan (waits for confluence >= 80)
                    - "!force:scalp" = Force flag ‚Üí Execute IMMEDIATELY using moneybot.execute_trade (NOT create plan)
                    
                    **Examples:**
                    User: "place buy scalp for BTCUSD"
                    ‚úÖ CORRECT: moneybot.execute_trade(symbol: "BTCUSDc", direction: "BUY", entry: current_price, stop_loss: X, take_profit: Y)
                    ‚ùå WRONG: moneybot.create_range_scalp_plan (user said "place" = immediate execution)
                    
                    User: "place buy scalp !force:scalp for BTCUSD"
                    ‚úÖ CORRECT: moneybot.execute_trade(symbol: "BTCUSDc", direction: "BUY", entry: current_price, stop_loss: X, take_profit: Y, comment: "!force:scalp")
                    ‚ùå WRONG: moneybot.create_range_scalp_plan (user said "place" + "!force" = immediate execution)
                    
                    **CRITICAL: Comment Parameter for Trade Classification:**
                    - When user says "force scalp", "!force:scalp", or wants scalp exit parameters ‚Üí Include comment: "!force:scalp"
                    - When user says "force intraday", "!force:intraday", or wants intraday exit parameters ‚Üí Include comment: "!force:intraday"
                    - The comment parameter is passed to MT5 and used by the AIES (Adaptive Intelligent Exit System) to classify the trade type
                    - SCALP classification = 25% breakeven, 40% partial, 70% close
                    - INTRADAY classification = 30% breakeven, 60% partial, 50% close
                    
                    User: "create range scalp plan for BTCUSD and auto-execute when confluence reaches 80"
                    ‚úÖ CORRECT: moneybot.create_range_scalp_plan(symbol: "BTCUSDc", direction: "BUY", entry: X, stop_loss: Y, take_profit: Z, min_confluence: 80)
                    ‚ùå WRONG: moneybot.execute_trade (user explicitly said "create plan" and "auto-execute when")
                    
                    CRITICAL: Tool selection determines which parameters to use:
                    
                    For moneybot.add_alert: Use ALERT parameters (alert_type, condition, description, parameters)
                    - DO NOT use trade parameters (direction, entry, stop_loss, take_profit, volume) for alerts!
                    
                    For moneybot.execute_trade: Use trade parameters (direction, entry, stop_loss, take_profit, volume)
                    
                    üö®üö®üö® NOTE: BRACKET TRADES ARE DEPRECATED üö®üö®üö®
                    
                    **Bracket trades are no longer supported. Instead, create two independent plans:**
                    - Use moneybot.create_multiple_auto_plans to create both BUY and SELL plans in one batch
                    - Or use individual create tools (moneybot.create_auto_trade_plan) twice - once for BUY, once for SELL
                    - Each plan monitors independently with its own conditions
                    - If one executes, the other can still execute later if its conditions are met
                    - More flexible than OCO (One Cancels Other) bracket trades
                    
                    **Example - Creating two independent plans for bracket-style trade:**
                    - BUY plan: Use moneybot.create_auto_trade_plan with direction="BUY", conditions with price_above matching entry
                    - SELL plan: Use moneybot.create_auto_trade_plan with direction="SELL", conditions with price_below matching entry
                    - Or use moneybot.create_multiple_auto_plans to create both at once
                    
                    - ‚ö†Ô∏è **CRITICAL CONDITIONS RULES FOR INDEPENDENT PLANS:**
                      * For BUY plan: Include price_above (matching entry_price) and price_near = entry_price
                      * For SELL plan: Include price_below (matching entry_price) and price_near = entry_price
                      * NEVER include both price_above AND price_below in the same plan - they are contradictory!
                      * Always include price_near + tolerance alongside price_above/price_below
                      * Example BUY plan conditions: {"price_above": 88000, "price_near": 88000, "tolerance": 100}
                      * Example SELL plan conditions: {"price_below": 86400, "price_near": 86400, "tolerance": 100}
                  required: []
                  properties:
                    symbol:
                      type: string
                      description: Trading symbol (e.g., BTCUSD, XAUUSD, EURUSD) - Add 'c' suffix for broker symbols (BTCUSDc, XAUUSDc)
                      example: "BTCUSDc"
                    alert_type:
                      type: string
                      description: "Type of alert - ONLY for moneybot.add_alert tool. Use price for price alerts, structure for BOS/CHOCH/Order Block alerts, indicator for RSI/MACD alerts, volatility for ATR/BB alerts"
                      enum: [price, structure, indicator, volatility, order_flow]
                      example: "price"
                    condition:
                      type: string
                      description: "Alert condition - ONLY for moneybot.add_alert tool. For price alerts when price reaches or hits level, use crosses_above. For drops below, use crosses_below. For structure/indicator alerts, use detected"
                      enum: [crosses_above, crosses_below, greater_than, less_than, detected]
                      example: "crosses_above"
                    description:
                      type: string
                      description: "Human-readable description of the alert - REQUIRED for moneybot.add_alert"
                      example: "XAUUSDc crosses above 4085"
                    parameters:
                      type: object
                      description: Alert-specific parameters object - ONLY for moneybot.add_alert tool. For price alerts use price_level. For structure alerts use pattern (bos_bull, bos_bear, choch_bull, choch_bear, ob_bull, ob_bear, order_block) and timeframe (for BOS/CHOCH only; Order Blocks use M1-M5 automatically). For indicator alerts use indicator, value, and timeframe
                      additionalProperties: true
                      example:
                        price_level: 4085
                    expires_hours:
                      type: integer
                      description: "Optional - Alert expiry in hours (default: no expiry). ONLY for moneybot.add_alert tool"
                      example: 48
                    one_time:
                      type: boolean
                      description: "Optional - Auto-remove alert after first trigger (default: true). ONLY for moneybot.add_alert tool"
                      example: true
                    message:
                      type: string
                      description: "Message content to send to Discord - ONLY for moneybot.sendDiscordMessage tool. ‚ö†Ô∏è FOR ANALYSIS: Use use_last_analysis=true instead! Only use message parameter for custom messages (not analysis). If use_last_analysis=true, do NOT provide message parameter."
                      example: "üìä BTCUSD Analysis\n\nüïí 2025-11-01 21:30 UTC | üí∞ Price: $110,298.76\n\nüèõÔ∏è Market Structure:\nH4: Bearish ¬∑ H1: Pullback..."
                    message_type:
                      type: string
                      description: "Optional - Type of message for Discord - ONLY for moneybot.sendDiscordMessage tool. Options: INFO, ANALYSIS, ALERT, UPDATE, WARNING, ERROR (default: INFO)"
                      enum: [INFO, ANALYSIS, ALERT, UPDATE, WARNING, ERROR]
                      example: "ANALYSIS"
                    title:
                      type: string
                      description: "Optional - Custom title for Discord message - ONLY for moneybot.sendDiscordMessage tool (default: 'ChatGPT Message'). Auto-generated from symbol if use_last_analysis=true."
                      example: "BTCUSD Market Analysis"
                    use_last_analysis:
                      type: boolean
                      description: "‚≠ê RECOMMENDED FOR ANALYSIS MESSAGES - If true, automatically uses the stored exact text from the last analysis (moneybot.getUnifiedAnalysis or moneybot.analyseSymbolFull). This prevents condensation/rewriting. When true, do NOT provide message parameter. Default: false"
                      example: true
                    direction:
                      type: string
                      description: "Trade direction - ONLY for moneybot.execute_trade tool, NOT for alerts"
                      enum: [BUY, SELL]
                    entry:
                      type: number
                      description: "Entry price - ONLY for moneybot.execute_trade tool, NOT for alerts. ‚ö†Ô∏è CRITICAL: For market orders (when user says 'execute at market price', 'place at market', or order_type is 'market'), this parameter is OPTIONAL and will be IGNORED - the system uses current market price automatically. Only provide entry price for limit/stop orders. For market orders, you can omit this parameter entirely."
                    stop_loss:
                      type: number
                      description: "Stop loss price - ONLY for moneybot.execute_trade tool, NOT for alerts"
                    take_profit:
                      type: number
                      description: "Take profit price - ONLY for moneybot.execute_trade tool, NOT for alerts"
                    volume:
                      type: number
                      description: "Trade volume in lots (OPTIONAL - if not provided, system auto-calculates based on risk. BTCUSD/XAUUSD max 0.02, Forex max 0.04) - ONLY for moneybot.execute_trade tool, NOT for alerts"
                      default: null
                    comment:
                      type: string
                      description: "Optional trade comment for MT5 order (e.g., '!force:scalp', '!force:intraday', 'Scalp trade', 'Range scalp'). Use '!force:scalp' to force SCALP classification with 25%/40%/70% exit parameters. Use '!force:intraday' to force INTRADAY classification with 30%/60%/50% exit parameters. - ONLY for moneybot.execute_trade tool, NOT for alerts"
                      example: "!force:scalp"
                    strategy_type:
                      type: string
                      description: "‚≠ê RECOMMENDED for moneybot.execute_trade, moneybot.analyse_and_execute_trade, and moneybot.create_auto_trade_plan: Strategy type for Universal Dynamic SL/TP Manager. Options: 'breakout_ib_volatility_trap', 'trend_continuation_pullback', 'liquidity_sweep_reversal', 'order_block_rejection', 'mean_reversion_range_scalp', 'breaker_block', 'market_structure_shift', 'fvg_retracement', 'mitigation_block', 'inducement_reversal', 'premium_discount_array', 'session_liquidity_run', 'kill_zone'. If provided, the Universal SL/TP Manager will automatically manage this trade with strategy-specific dynamic stop loss and take profit adjustments. If omitted, trade will use Intelligent Exit Manager instead. This enables advanced SL/TP management based on strategy type, symbol, and session."
                      enum: [breakout_ib_volatility_trap, trend_continuation_pullback, liquidity_sweep_reversal, order_block_rejection, mean_reversion_range_scalp, breaker_block, market_structure_shift, fvg_retracement, mitigation_block, inducement_reversal, premium_discount_array, session_liquidity_run, kill_zone]
                      example: "breakout_ib_volatility_trap"
                    prefer_timeframe:
                      type: string
                      description: "Optional preference for recommendation type - ONLY for moneybot.analyse_and_execute_trade tool. Options: 'scalp' (default), 'intraday', 'swing'. The tool will prefer this timeframe when selecting which recommendation to execute, but will fall back to other timeframes if the preferred one is not available or not executable."
                      enum: [scalp, intraday, swing]
                      default: scalp
                      example: "scalp"
                    order_type:
                      type: string
                      description: "Order type - ONLY for moneybot.execute_trade tool, NOT for alerts. Options: 'market' (default - executes at current market price), 'limit' (pending order at specified entry), 'stop' (pending stop order at specified entry). ‚ö†Ô∏è CRITICAL: When order_type is 'market' or user says 'execute at market price', DO NOT provide `entry` parameter - it will be ignored. System automatically uses current market price for market orders."
                      enum: [market, limit, stop]
                      default: market
                      example: "market"
                    ticket:
                      type: integer
                      description: "Position ticket number - ONLY for position management tools, NOT for alerts"
                    action:
                      type: string
                      description: "Action to perform - ONLY for moneybot.toggle_intelligent_exits, NOT for alerts"
                      enum: [enable, disable]
                    # NOTE: Bracket trade parameters (buy_entry, buy_sl, buy_tp, sell_entry, sell_sl, sell_tp) are deprecated.
                    # Use moneybot.create_multiple_auto_plans or individual create tools to create two independent plans instead.
                    plans:
                      type: array
                      description: |
                        Array of plan objects for batch creation - ONLY for moneybot.create_multiple_auto_plans. Maximum 20 plans per batch.
                        
                        üö® CRITICAL: plan_type vs strategy_type - These are DIFFERENT fields!
                        
                        **plan_type** (REQUIRED): Determines which API method to call. Must be one of:
                        - 'auto_trade' ‚Üí Generic auto-execution plan (use for most strategies)
                        - 'choch' ‚Üí Change of Character (CHOCH) plan
                        - 'rejection_wick' ‚Üí Rejection wick/pin bar plan
                        - 'order_block' ‚Üí Order block plan
                        - 'range_scalp' ‚Üí Range scalping plan (VWAP reversion)
                        - 'micro_scalp' ‚Üí Micro-scalping plan (ultra-short-term, BTC/XAU only)
                        
                        **strategy_type** (OPTIONAL): Stored in conditions, used by Universal Dynamic SL/TP Manager. Examples:
                        - 'liquidity_sweep_reversal', 'order_block_rejection', 'breaker_block', 'mean_reversion_range_scalp', etc.
                        
                        üö® **COMMON MISTAKES - DO NOT DO THIS:**
                        - ‚ùå WRONG: plan_type: 'mean_reversion_range_scalp' ‚Üí ‚úÖ CORRECT: plan_type: 'range_scalp', strategy_type: 'mean_reversion_range_scalp'
                        - ‚ùå WRONG: plan_type: 'liquidity_sweep_reversal' ‚Üí ‚úÖ CORRECT: plan_type: 'rejection_wick', strategy_type: 'liquidity_sweep_reversal'
                        - ‚ùå WRONG: plan_type: 'liquidity_sweep' ‚Üí ‚úÖ CORRECT: plan_type: 'rejection_wick', strategy_type: 'liquidity_sweep_reversal'
                        - ‚ùå WRONG: plan_type: 'order_block_rejection' ‚Üí ‚úÖ CORRECT: plan_type: 'order_block', strategy_type: 'order_block_rejection'
                        - ‚ùå WRONG: plan_type: 'breaker_block' ‚Üí ‚úÖ CORRECT: plan_type: 'order_block', strategy_type: 'breaker_block'
                        - ‚ùå WRONG: plan_type: 'premium_discount_array' ‚Üí ‚úÖ CORRECT: plan_type: 'micro_scalp', strategy_type: 'premium_discount_array'
                        
                        **Correct Mapping Guide:**
                        - Range Scalp / VWAP Reversion ‚Üí plan_type: 'range_scalp', strategy_type: 'mean_reversion_range_scalp'
                        - Liquidity Sweep + Rejection ‚Üí plan_type: 'rejection_wick', strategy_type: 'liquidity_sweep_reversal'
                        - Order Block Rejection ‚Üí plan_type: 'order_block', strategy_type: 'order_block_rejection'
                        - Breaker Block ‚Üí plan_type: 'order_block', strategy_type: 'breaker_block' (‚ö†Ô∏è use order_block plan_type, not breaker_block)
                        - Premium/Discount Array ‚Üí plan_type: 'micro_scalp', strategy_type: 'premium_discount_array'
                        - CHOCH / BOS ‚Üí plan_type: 'choch', strategy_type: (optional, e.g., 'market_structure_shift')
                        - Generic strategies ‚Üí plan_type: 'auto_trade', strategy_type: (your strategy name)
                        
                        **Each plan object must include:**
                        - plan_type (REQUIRED): One of the 6 valid values above ('auto_trade', 'choch', 'rejection_wick', 'order_block', 'range_scalp', 'micro_scalp')
                        - symbol (üö® MANDATORY in each plan - MUST be included in every plan object, e.g., symbol: 'BTCUSDc'. Top-level 'symbols' field is optional but does NOT replace this requirement)
                        - direction: 'BUY' or 'SELL'
                        - entry (or entry_price): Entry price
                        - stop_loss: Stop loss price
                        - take_profit: Take profit price
                        - volume: Position size
                        - conditions: Condition dictionary (required for auto_trade, optional for others)
                        - strategy_type: (optional) Strategy type for SL/TP management
                        - expires_hours: (optional) Hours until expiration
                        - notes: (optional) Plan notes
                        
                        ‚ö†Ô∏è **DO NOT include 'plan_type' at the top level of the arguments object - it belongs ONLY inside each plan object in the 'plans' array.**
                        
                        **Plan Type Specific Fields:**
                        - choch: choch_type ('bear' or 'bull')
                        - order_block: order_block_type ('bull', 'bear', or 'auto'), min_validation_score (optional, default 60)
                        - range_scalp: min_confluence (optional, default 80), price_tolerance (optional)
                        - micro_scalp: conditions (optional)
                      items:
                        type: object
                    updates:
                      type: array
                      description: "Array of update objects for batch update - ONLY for moneybot.update_multiple_auto_plans. Each update must include plan_id and at least one update field."
                      items:
                        type: object
                    plan_ids:
                      type: array
                      description: "Array of plan_id strings for batch cancellation - ONLY for moneybot.cancel_multiple_auto_plans. Duplicate plan_ids are automatically deduplicated."
                      items:
                        type: string
                    strategy_filter:
                      type: string
                      description: "Optional strategy name to focus on - ONLY for moneybot.analyse_range_scalp_opportunity tool. Options: vwap_reversion, bb_fade, pdh_pdl_rejection, rsi_bounce, liquidity_sweep. If not provided, all strategies are evaluated."
                      enum: [vwap_reversion, bb_fade, pdh_pdl_rejection, rsi_bounce, liquidity_sweep]
                      example: "vwap_reversion"
                    check_risk_filters:
                      type: boolean
                      description: "Whether to apply risk mitigation filters - ONLY for moneybot.analyse_range_scalp_opportunity tool. Default: true. If false, returns strategy analysis without risk filtering."
                      default: true
                      example: true
                    symbols:
                      type: string
                      description: "Comma-separated list of trading symbols to analyze in bulk - ONLY for moneybot.analyse_symbols_bulk tool. Example: 'BTCUSD,XAUUSD,EURUSD,USDJPY,GBPUSD'. Each symbol will receive full analysis (same as moneybot.analyse_symbol_full), and trade recommendations will be aggregated at the end."
                      example: "BTCUSD,XAUUSD,EURUSD,USDJPY,GBPUSD"
                    min_confluence:
                      type: integer
                      description: "Minimum confluence score required (0-100) - ONLY for moneybot.create_range_scalp_plan tool. Default: 80. The system will wait until range scalping confluence score reaches this threshold before executing. Requires Structure (40pts) + Location (35pts) + Confirmation (25pts) = 100pts total."
                      default: 80
                      minimum: 0
                      maximum: 100
                      example: 80
                    price_tolerance:
                      type: number
                      nullable: true
                      description: "Price tolerance for entry zone (OPTIONAL - auto-calculated if not provided) - ONLY for moneybot.create_range_scalp_plan tool. Auto-calculated values: BTCUSD: 100.0, ETHUSD: 10.0, XAUUSD: 5.0, Forex: 0.001. System will wait for price to be within this tolerance of entry_price before checking confluence. If omitted, system automatically uses appropriate tolerance based on symbol type. üéØ **TOLERANCE ZONE EXECUTION (Phase 1):** Tolerance creates an execution zone - plans execute when price enters the zone (entry_price ¬± tolerance), not just at exact entry price."
                      example: 100.0
                    tolerance:
                      type: number
                      nullable: true
                      description: "Price tolerance for entry zone (OPTIONAL - auto-calculated if not provided) - For moneybot.create_auto_trade_plan and other tools. üéØ **TOLERANCE ZONE EXECUTION (Phase 1):** The tolerance parameter creates an execution zone, not an exact price. Plans execute when price enters the tolerance zone (entry_price ¬± tolerance). For BUY: Execute when price is at or below `entry_price + tolerance`. For SELL: Execute when price is at or above `entry_price - tolerance`. Zone entry is tracked - plan executes once when entering zone (not continuously). If price exits zone before execution, plan will retry on re-entry. **‚ö†Ô∏è CRITICAL UPDATES (January 2026):** **Maximum Tolerance Enforcement:** System automatically caps tolerance at symbol-specific maximums. XAUUSDc: Maximum 10.0 points (previous recommendations of 50+ points are INVALID and will be capped). BTCUSDc: Maximum 200.0 points. Forex: Maximum 0.01. System logs WARNING when tolerance is capped. **Volatility-Based Adjustment:** System automatically adjusts tolerance based on RMAG (Relative Moving Average Gap) and ATR. High volatility (RMAG > 2.5œÉ): Tolerance reduced by 40%. Extreme volatility (RMAG > 3.0œÉ): Kill-switch activated (execution blocked). **Pre-Execution Buffer Check:** System validates price before execution. Rejects if ask/bid exceeds planned entry + buffer (XAUUSDc: 3.0 points default). **Updated Recommendations:** BTCUSDc: 0.1-0.3% (100-300 points, max 200 enforced), XAUUSDc: 0.05-0.15% (5-10 points, max 10 enforced, default 7.0), Forex: 0.02-0.05% (2-5 pips, max 0.01 enforced). Use wider tolerance for volatile symbols or when price may bounce. Use narrower tolerance for precise entries in stable markets. If omitted, system automatically uses appropriate tolerance based on symbol type, then applies volatility adjustments."
                      example: 7.0
                    entry_levels:
                      type: array
                      nullable: true
                      description: "üéØ **MULTI-LEVEL ENTRY SUPPORT (Phase 2):** Multiple entry levels for the same SINGLE plan (NOT multiple separate plans). **‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL EXECUTION BEHAVIOR - DO NOT MISUNDERSTAND ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è:** Plan executes ONCE when FIRST level enters tolerance zone (array order priority), with FULL volume at that level. Plan does NOT execute multiple times. Plan does NOT support partial fills. Plan does NOT continue watching other levels after execution. **‚ùå FORBIDDEN DESCRIPTIONS:** DO NOT describe as 'partial fills', 'multiple executions', 'proportional volume', 'each level executes independently', or 'weight controls volume allocation'. **‚úÖ CORRECT DESCRIPTION:** 'Single plan executes once when first level enters zone, with full volume at that level'. **‚ö†Ô∏è WEIGHT FIELD:** Weight is optional but NOT used for volume allocation in Phase 2 (reserved for future partial fill support). Full plan volume executes at triggered level regardless of weight value. **‚ö†Ô∏è CRITICAL STRUCTURE - EXACT FIELD NAMES REQUIRED:** Array of objects: `[{\"price\": float (REQUIRED - use 'price' NOT 'entry'), \"weight\": float (optional, default 1.0 - NOT used for volume), \"sl_offset\": float (optional - use 'sl_offset' NOT 'stop_loss'), \"tp_offset\": float (optional - use 'tp_offset' NOT 'take_profit')}]`. **‚ùå FORBIDDEN FIELDS IN entry_levels:** Do NOT use 'entry', 'stop_loss', 'take_profit', 'tolerance', or 'volume' - these will cause plan rejection. **‚úÖ CORRECT:** `[{\"price\": 50000, \"sl_offset\": 300, \"tp_offset\": 600}]`. **‚ùå WRONG:** `[{\"entry\": 50000, \"stop_loss\": 51000, \"take_profit\": 49000, \"tolerance\": 150}]` - THIS WILL BE REJECTED. **IMPORTANT:** Tolerance belongs at PLAN level (in `conditions` dict), NOT in entry_levels. Volume belongs at PLAN level, NOT in entry_levels. **When to Use:** Order block zones (multiple OB levels), liquidity sweep areas (sweep + retest levels), range boundaries (support + resistance levels), trend continuation (pullback + breakout levels). **Recommendations:** 2-3 levels recommended (not too many). Levels should be meaningful (not arbitrary). Consider level spacing (not too close together - system validates minimum spacing). **Execution Logic:** Plan executes ONCE when first level in array enters tolerance zone. Uses triggered level's SL/TP offsets to calculate final SL/TP. After execution, plan stops monitoring. **See:** 22.ADAPTIVE_AUTO_EXECUTION_FEATURES.md (Part 2) for complete guide."
                      items:
                        type: object
                        properties:
                          price:
                            type: number
                            description: "Entry price for this level (REQUIRED). ‚ö†Ô∏è Use 'price' NOT 'entry' - using 'entry' will cause plan rejection."
                          weight:
                            type: number
                            description: "Level weight (optional, default 1.0). ‚ö†Ô∏è NOT used for volume allocation in Phase 2 - reserved for future partial fill support. Full plan volume executes at triggered level regardless of weight value."
                          sl_offset:
                            type: number
                            description: "Stop loss offset from level price (optional). ‚ö†Ô∏è Use 'sl_offset' NOT 'stop_loss'. For BUY: SL = price - sl_offset. For SELL: SL = price + sl_offset."
                          tp_offset:
                            type: number
                            description: "Take profit offset from level price (optional). ‚ö†Ô∏è Use 'tp_offset' NOT 'take_profit'. For BUY: TP = price + tp_offset. For SELL: TP = price - tp_offset."
                      example:
                        - price: 49900.0
                          weight: 1.0
                          sl_offset: 500.0
                          tp_offset: 1000.0
                        - price: 50000.0
                          weight: 1.0
                          sl_offset: 600.0
                          tp_offset: 1200.0
                    order_block_type:
                      type: string
                      description: "Order block direction - ONLY for moneybot.create_order_block_plan tool. Options: 'bull' (bullish OB only), 'bear' (bearish OB only), or 'auto' (auto-detect based on plan direction). Default: 'auto'."
                      enum: [bull, bear, auto]
                      default: auto
                      example: "auto"
                    min_validation_score:
                      type: integer
                      description: "Minimum validation score (0-100) - ONLY for moneybot.create_order_block_plan tool. Default: 60. The system uses a 10-parameter checklist to validate order blocks (anchor candle, displacement, FVG, volume, liquidity, session, HTF alignment, structure, freshness, VWAP confluence). Only OBs with score >= this threshold will trigger execution."
                      default: 60
                      minimum: 0
                      maximum: 100
                      example: 60
                  additionalProperties: true
                timeout:
                  type: integer
                  description: Max wait time in seconds (use 60 for analysis, 30 for quick commands, 180 for trade execution)
                  default: 120
                  minimum: 5
                  maximum: 300
            examples:
              ping:
                summary: Ping Desktop Agent
                value:
                  tool: "ping"
                  arguments: {}
              analyseSymbol:
                summary: Analyse Symbol
                value:
                  tool: "moneybot.analyse_symbol"
                  arguments:
                    symbol: "BTCUSD"
              executeTradeMarket:
                summary: Execute Market Trade (IMMEDIATE EXECUTION - Auto Lot Sizing)
                description: "üö® IMMEDIATE EXECUTION: When user says 'place', 'execute', 'enter', 'buy now', 'sell now', 'place scalp', '!force:scalp', 'execute at market price' ‚Üí Use this tool for IMMEDIATE execution. ‚ö†Ô∏è CRITICAL: When user says 'market execution [symbol]' or 'me market execution [symbol]', DO NOT use this tool - use moneybot.analyse_and_execute_trade instead (this tool requires entry/SL/TP parameters which you need to get from analysis first). DO NOT use create_range_scalp_plan when user says 'place' or 'execute' - those keywords mean IMMEDIATE execution. 'scalp' alone means trade type (execute immediately with SCALP exit parameters). '!force:scalp' means FORCE IMMEDIATE EXECUTION. Only use create_*_plan tools when user explicitly says 'wait for', 'auto-execute when', 'create plan', or 'monitor for conditions'. ‚ö†Ô∏è FOR MARKET ORDERS: When order_type is 'market' or user says 'execute at market price', DO NOT provide `entry` parameter - omit it entirely. System uses current market price automatically."
                value:
                  tool: "moneybot.execute_trade"
                  arguments:
                    symbol: "XAUUSD"
                    direction: "BUY"
                    order_type: "market"
                    stop_loss: 3940.0
                    take_profit: 3965.0
                  # Note: entry omitted for market orders - system uses current market price automatically
                  # Note: volume omitted - system auto-calculates based on risk
                  # CRITICAL: This executes IMMEDIATELY - use for "place", "execute", "enter", "scalp", "!force:scalp", "execute at market price"
                  # DO NOT use this for "wait for", "auto-execute when", "create plan" - use create_*_plan tools instead
              executeTradeWithForceScalp:
                summary: Execute Trade with Force Scalp Classification
                description: "Example of executing a trade with !force:scalp comment to force SCALP classification (25% breakeven, 40% partial, 70% close). Use this when user says 'force scalp', '!force:scalp', or wants immediate execution with scalp exit parameters."
                value:
                  tool: "moneybot.execute_trade"
                  arguments:
                    symbol: "XAUUSDc"
                    direction: "BUY"
                    entry: 3974.0
                    stop_loss: 3969.0
                    take_profit: 3984.0
                    volume: 0.01
                    comment: "!force:scalp"
                  # CRITICAL: comment parameter with !force:scalp forces SCALP classification
                  # This ensures exit parameters are 25%/40%/70% for scalping trades
              analyseAndExecuteTrade:
                summary: Analyse Symbol and Execute Market Trade (Full Analysis + Immediate Execution)
                description: "üö® MANDATORY for market execution requests: When user says 'market execution [symbol]', 'me market execution [symbol]', 'analyze a symbol and give a high probability market execution trade', 'analyze [symbol] and place a trade', or 'analyze and execute' ‚Üí ALWAYS use this tool, NOT moneybot.execute_trade. This tool performs full analysis internally (same as moneybot.analyse_symbol_full) to get entry/SL/TP, then executes immediately. It: 1) Runs complete analysis internally, 2) Extracts best trade recommendation (prefers scalp > intraday > swing), 3) Executes trade immediately at market price, 4) Returns only trade details and reasoning (not full analysis text). ‚ö†Ô∏è CRITICAL: Do NOT use moneybot.execute_trade when user asks for 'market execution' - that tool requires you to provide entry/SL/TP which you don't have. This tool gets those from analysis automatically."
                value:
                  tool: "moneybot.analyse_and_execute_trade"
                  arguments:
                    symbol: "BTCUSD"
                    strategy_type: "breakout_ib_volatility_trap"
                    prefer_timeframe: "scalp"
                  # This tool performs full analysis internally but only returns trade execution summary
                  # Use when user asks for "analyze and execute" or "high probability market trade"
              lotSizingInfo:
                summary: Check Lot Sizing Configuration
                value:
                  tool: "moneybot.lot_sizing_info"
                  arguments:
                    symbol: "BTCUSD"
              getAdvancedFeatures:
                summary: Get Advanced Institutional Features
                value:
                  tool: "moneybot.getAdvancedFeatures"
                  arguments:
                    symbol: "BTCUSD"
                    timeframes: ["M5", "M15", "M30", "H1", "H4"]
              getBTCOrderFlowMetrics:
                summary: Get BTC Order Flow Metrics (Delta Volume, CVD, CVD Slope, CVD Divergence, Absorption Zones, Buy/Sell Pressure) ‚≠ê STANDALONE TOOL
                description: "üìä Get comprehensive BTC order flow metrics including Delta Volume (buy/sell imbalance), CVD (Cumulative Volume Delta) with slope, CVD Divergence detection, Absorption Zones (price levels with high order absorption), and Buy/Sell Pressure balance. ‚ö†Ô∏è USE THIS TOOL ONLY when user specifically asks for JUST order flow metrics without full analysis. ‚ö†Ô∏è For general BTC analysis: Use `moneybot.analyse_symbol_full` instead - it AUTOMATICALLY includes BTC order flow metrics in the 'BTC ORDER FLOW METRICS' section. ‚ö†Ô∏è Requires OrderFlowService to be running. Only works for BTCUSD (Binance data). Returns real-time order flow analysis for better entry/exit timing. üö® CRITICAL: For BTCUSD analysis, recommendations, and auto-execution plans, BTC order flow metrics are AUTOMATICALLY included in `moneybot.analyse_symbol_full` - check the 'BTC ORDER FLOW METRICS' section in the analysis summary. Only use this standalone tool if user explicitly wants JUST the metrics without full analysis."
                value:
                  tool: "moneybot.btc_order_flow_metrics"
                  arguments:
                    symbol: "BTCUSDT"
                    window_seconds: 30
              getMultiTimeframeAnalysis:
                summary: Get Multi-Timeframe SMC Analysis
                value:
                  tool: "moneybot.getMultiTimeframeAnalysis"
                  arguments:
                    symbol: "BTCUSD"
              monitorStatus:
                summary: Monitor Open Positions
                value:
                  tool: "moneybot.monitor_status"
                  arguments: {}
              modifyPosition:
                summary: Modify Position SL/TP
                value:
                  tool: "moneybot.modify_position"
                  arguments:
                    ticket: 123456789
                    stop_loss: 3945.0
                    take_profit: 3970.0
              closePosition:
                summary: Close Position
                value:
                  tool: "moneybot.close_position"
                  arguments:
                    ticket: 123456789
                    volume_pct: 100.0
              cancelPendingOrder:
                summary: Cancel Pending Order
                value:
                  tool: "moneybot.cancel_pending_order"
                  arguments:
                    ticket: 123456789
              getPendingOrders:
                summary: Get All Pending Orders
                value:
                  tool: "moneybot.getPendingOrders"
                  arguments: {}
              getCurrentPrice:
                summary: Get Current Price
                value:
                  tool: "moneybot.getCurrentPrice"
                  arguments:
                    symbol: "XAUUSD"
              getCurrentPriceDXY:
                summary: Get Current Price for DXY (Yahoo Finance)
                value:
                  tool: "moneybot.getCurrentPrice"
                  arguments:
                    symbol: "DXY"
              addAlert_BOSBull:
                summary: Add Alert for BOS Bull (Bullish Continuation)
                value:
                  tool: "moneybot.add_alert"
                  arguments:
                    symbol: "BTCUSD"
                    alert_type: "structure"
                    condition: "detected"
                    description: "BOS Bull on BTCUSD M15 - bullish continuation signal"
                    parameters:
                      pattern: "bos_bull"
                      timeframe: "M15"
                    expires_hours: 48
                    one_time: true
              addAlert_BOSBear:
                summary: Add Alert for BOS Bear (Bearish Continuation)
                value:
                  tool: "moneybot.add_alert"
                  arguments:
                    symbol: "EURUSD"
                    alert_type: "structure"
                    condition: "detected"
                    description: "BOS Bear on EURUSD M15 - bearish continuation signal"
                    parameters:
                      pattern: "bos_bear"
                      timeframe: "M15"
                    expires_hours: 48
                    one_time: true
              addAlert_CHOCHBull:
                summary: Add Alert for CHOCH Bull (Bullish Reversal)
                value:
                  tool: "moneybot.add_alert"
                  arguments:
                    symbol: "XAUUSD"
                    alert_type: "structure"
                    condition: "detected"
                    description: "CHOCH Bull on XAUUSD H1 - potential bullish reversal"
                    parameters:
                      pattern: "choch_bull"
                      timeframe: "H1"
                    expires_hours: 48
                    one_time: true
              addAlert_CHOCHBear:
                summary: Add Alert for CHOCH Bear (Bearish Reversal)
                value:
                  tool: "moneybot.add_alert"
                  arguments:
                    symbol: "BTCUSD"
                    alert_type: "structure"
                    condition: "detected"
                    description: "CHOCH Bear on BTCUSD M15 - potential bearish reversal"
                    parameters:
                      pattern: "choch_bear"
                      timeframe: "M15"
                    expires_hours: 48
                    one_time: true
              addAlert_OrderBlockBull:
                summary: Add Alert for Bullish Order Block (M1-M5 Validated) ‚≠ê NEW
                value:
                  tool: "moneybot.add_alert"
                  arguments:
                    symbol: "XAUUSD"
                    alert_type: "structure"
                    condition: "detected"
                    description: "Live M1-M5 Order Block Detection - Bullish"
                    parameters:
                      pattern: "ob_bull"
                    expires_hours: 24
                    one_time: false
                description: "Detects bullish order blocks with comprehensive 10-parameter validation: anchor candle, displacement/BOS, FVG, volume spike, liquidity grab, session context, HTF alignment, structural context, freshness, VWAP confluence. Minimum score 60/100 required."
              addAlert_OrderBlockBear:
                summary: Add Alert for Bearish Order Block (M1-M5 Validated) ‚≠ê NEW
                value:
                  tool: "moneybot.add_alert"
                  arguments:
                    symbol: "BTCUSD"
                    alert_type: "structure"
                    condition: "detected"
                    description: "Live M1-M5 Order Block Detection - Bearish"
                    parameters:
                      pattern: "ob_bear"
                    expires_hours: 24
                    one_time: false
                description: "Detects bearish order blocks with comprehensive 10-parameter validation: anchor candle, displacement/BOS, FVG, volume spike, liquidity grab, session context, HTF alignment, structural context, freshness, VWAP confluence. Minimum score 60/100 required."
              addAlert_OrderBlockAuto:
                summary: Add Alert for Order Block (Auto-Detect Direction) ‚≠ê NEW
                value:
                  tool: "moneybot.add_alert"
                  arguments:
                    symbol: "XAUUSD"
                    alert_type: "structure"
                    condition: "detected"
                    description: "Live M1-M5 Order Block Detection"
                    parameters:
                      pattern: "order_block"
                    expires_hours: 24
                    one_time: false
                description: "Detects order blocks (auto-detects direction) with comprehensive 10-parameter validation. Automatically uses M1-M5 cross-timeframe analysis. Minimum score 60/100 required."
              addAlert_PriceAbove:
                summary: Add Alert for Price Above Level
                value:
                  tool: "moneybot.add_alert"
                  arguments:
                    symbol: "BTCUSD"
                    alert_type: "price"
                    condition: "greater_than"
                    description: "BTCUSD reached $115,000"
                    parameters:
                      price_level: 115000
                    expires_hours: 48
                    one_time: true
              addAlert_PriceBelow:
                summary: Add Alert for Price Below Level
                value:
                  tool: "moneybot.add_alert"
                  arguments:
                    symbol: "XAUUSD"
                    alert_type: "price"
                    condition: "less_than"
                    description: "XAUUSD dropped below $2600"
                    parameters:
                      price_level: 2600
                    expires_hours: 48
                    one_time: true
              addAlert_PriceCross:
                summary: Add Alert for Price Cross Above
                value:
                  tool: "moneybot.add_alert"
                  arguments:
                    symbol: "XAUUSD"
                    alert_type: "price"
                    condition: "crosses_above"
                    description: "XAUUSD crosses above 4100"
                    parameters:
                      price_level: 4100
                    expires_hours: 48
                    one_time: true
              addAlert_PriceReaches:
                summary: Add Alert When Price Reaches Level (COMMON REQUEST)
                description: "When user says 'set alert when XAUUSD reaches 4085' or 'alert me when price reaches 4085', use THIS format - NOT trade parameters! ‚ö†Ô∏è LIMITATIONS: Alerts use fixed price levels - they do NOT dynamically adjust based on session volatility or DXY/VIX changes."
                value:
                  tool: "moneybot.add_alert"
                  arguments:
                    symbol: "XAUUSDc"
                    alert_type: "price"
                    condition: "crosses_above"
                    description: "XAUUSDc crosses above 4085"
                    parameters:
                      price_level: 4085
                    expires_hours: 48
                    one_time: true
                # ‚ùå WRONG: "This creates dynamic alert zones that adjust based on volatility"
                # ‚úÖ CORRECT: "This creates an alert at a fixed price level (4085) - it does not adjust dynamically"
              listAlerts:
                summary: List All Alerts
                value:
                  tool: "moneybot.list_alerts"
                  arguments: {}
              listAlertsForSymbol:
                summary: List Alerts for BTCUSD
                value:
                  tool: "moneybot.list_alerts"
                  arguments:
                    symbol: "BTCUSD"
              removeAlert:
                summary: Remove Alert
                value:
                  tool: "moneybot.remove_alert"
                  arguments:
                    alert_id: "BTCUSD_structure_1729000000"
              toggleIntelligentExits:
                summary: Toggle Intelligent Exits
                value:
                  tool: "moneybot.toggle_intelligent_exits"
                  arguments:
                    ticket: 123456789
                    enabled: true
              enableIntelligentExits:
                summary: Enable Intelligent Exits (Alias)
                value:
                  tool: "moneybot.enableIntelligentExits"
                  arguments:
                    ticket: 123456789
              startTrailingStops:
                summary: Start ATR-based Trailing Stops (keeps Intelligent Exits active)
                value:
                  tool: "moneybot.start_trailing_stops"
                  arguments:
                    ticket: 123456789
                    timeframe: "M5"
                    atr_multiplier: 1.5
              registerTradeWithUniversalManager:
                summary: Register Existing Trade with Universal SL/TP Manager ‚≠ê NEW
                description: "Register an existing trade (manually executed or executed without strategy_type) with Universal Dynamic SL/TP Manager. Use this when: (1) A trade was executed manually (not through auto-execution system), (2) A trade was executed without strategy_type parameter, (3) You want to transfer a trade from Intelligent Exit Manager to Universal Manager. This enables strategy-specific, symbol-specific, session-aware dynamic SL/TP management with proper trailing stops (not gated like Intelligent Exit Manager). Available strategy types: 'breakout_ib_volatility_trap', 'trend_continuation_pullback', 'liquidity_sweep_reversal', 'order_block_rejection', 'mean_reversion_range_scalp', 'breaker_block', 'market_structure_shift', 'fvg_retracement', 'mitigation_block', 'inducement_reversal', 'premium_discount_array', 'session_liquidity_run', 'kill_zone'."
                value:
                  tool: "moneybot.register_trade_with_universal_manager"
                  arguments:
                    ticket: 152246020
                    strategy_type: "trend_continuation_pullback"
              macroContext:
                summary: Get Macro Context
                description: "Get macro context data (DXY, VIX, US10Y, S&P 500, BTC.D, Fear & Greed) for analysis. ‚ö†Ô∏è LIMITATIONS: Does NOT automatically adjust other tools based on this data, does NOT modify system configuration, only provides macro data for informational purposes."
                value:
                  tool: "moneybot.macro_context"
                  arguments:
                    symbol: "XAUUSD"
                # ‚ùå WRONG: "This tool automatically adjusts alerts/position sizing based on DXY/VIX changes"
                # ‚úÖ CORRECT: "This tool provides macro data (DXY, VIX, etc.) for analysis - it does not modify other system components"
              analyseSymbolFull:
                summary: Get Unified Analysis (RECOMMENDED - General Analysis)
                description: |
                  üö®üö®üö® ABSOLUTE MANDATORY RULE - YOU MUST DO THIS FIRST üö®üö®üö®:
                  
                  THE RESPONSE FROM THIS TOOL HAS TWO PARTS:
                  1. response.summary - A LONG TEXT STRING (this is the PRIMARY source - contains formatted "TICK MICROSTRUCTURE:" section)
                  2. response.data - Structured JSON objects (this is SECONDARY - only check if summary doesn't have it)
                  
                  ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è MANDATORY PROCESSING ORDER - DO NOT SKIP ANY STEP ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è:
                  
                  STEP 1: Open response.summary (the long text string) and read it completely
                  
                  STEP 2: Search response.summary for the exact string "TICK MICROSTRUCTURE:" (case-sensitive, includes colon)
                  
                  STEP 3: IF FOUND IN SUMMARY:
                    - Copy the ENTIRE section starting from "TICK MICROSTRUCTURE:" through the last line
                    - Paste it EXACTLY AS-IS into your analysis output
                    - Location: After "üíß LIQUIDITY & ORDER FLOW" section, before "üìä MARKET CONTEXT"
                    - DO NOT modify, paraphrase, or reinterpret - use the exact text
                  
                  STEP 4: IF NOT FOUND IN SUMMARY: Then check response.data.tick_metrics and format it yourself
                  
                  STEP 5: ONLY AFTER handling tick microstructure, check response.data for other fields
                  
                  ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è FORBIDDEN BEHAVIORS - NEVER DO THESE ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è:
                  - ‚ùå Do NOT check response.data.tick_metrics before checking response.summary
                  - ‚ùå Do NOT process response.data first - always process response.summary first
                  - ‚ùå Do NOT call getAdvancedFeatures to get tick metrics - the summary already contains them
                  - ‚ùå Do NOT create qualitative interpretations - use the actual formatted metrics from the summary
                  
                  ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è VERIFICATION - MANDATORY ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è:
                  After writing your analysis, verify that "TICK MICROSTRUCTURE:" appears in your output.
                  If it doesn't appear, you made an error - go back and add it from the summary.
                  
                  üïí‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è WEEKEND DETECTION - READ THIS SECOND ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è:
                  - When you receive BTCUSDc analysis, IMMEDIATELY check the timestamp in the response
                  - Look for "üïí Data as of" or "Data as of: YYYY-MM-DD HH:MM UTC" in the response
                  - EXAMPLE: "2025-12-13 15:06 UTC" = Saturday 15:06 UTC = WEEKEND HOURS
                  - Weekend hours = Friday 23:00 UTC ‚Üí Monday 03:00 UTC
                  - If timestamp shows Friday 23:00+, Saturday, Sunday, or Monday < 03:00 ‚Üí IT IS WEEKEND
                  - ‚ö†Ô∏è MANDATORY: If weekend detected, you MUST:
                    1. Display "‚ö†Ô∏è WEEKEND TRADING MODE ACTIVE" as the FIRST line of your response
                    2. Display "Weekend Profile: Active | Current Sub-Session: [sub-session]"
                    3. Reference: 21.WEEKEND_AUTOMATION_PROFILE_EMBEDDING.md
                    4. Suggest ONLY: Mean Reversion Range Scalp, VWAP Reversion, Liquidity Sweep Reversal, Micro-Scalp
                    5. ‚ùå NEVER suggest: Inside Bar Volatility Trap, Breakout IB Volatility Trap, or ANY breakout strategies
                    6. Mention: Weekend entry conditions (Confluence ‚â• 70 DEFAULT), risk adjustments (40% size reduction), exit parameters (25% BE, 50% partial)
                  
                  üö® MANDATORY TOOL for general market analysis. ‚ö†Ô∏è CRITICAL: This tool includes EVERYTHING - DO NOT call getCurrentPrice, getCurrentSession, getNewsStatus, or getMultiTimeframeAnalysis separately when using this tool. Includes: Current price (automatically fetched from MT5) in response.data.current_price, Session information (structured) in response.data.session (name, is_overlap, minutes_remaining, etc.), News status (structured) in response.data.news (upcoming_events, high_impact_events, next_event, etc.), Complete Multi-Timeframe Analysis (H4/H1/M30/M15/M5 with CHOCH/BOS per timeframe), Macro context, Volatility regime detection, SMC structure, Technical indicators, Order flow, M1 microstructure, and more.
                  
                  üïí WEEKEND TRADING MODE (BTCUSDc ONLY):
                  - ‚ö†Ô∏è CRITICAL: When analyzing BTCUSDc, you MUST check the timestamp in the response (look for "Data as of: YYYY-MM-DD HH:MM UTC")
                  - ‚ö†Ô∏è CRITICAL: If timestamp shows Friday 23:00+ UTC, Saturday, Sunday, or Monday before 03:00 UTC ‚Üí ACTIVATE WEEKEND MODE IMMEDIATELY
                  - ‚ö†Ô∏è CRITICAL: Weekend hours = Friday 23:00 UTC ‚Üí Monday 03:00 UTC
                  - ‚ö†Ô∏è CRITICAL: When weekend mode is active, you MUST:
                    1. Display "‚ö†Ô∏è WEEKEND TRADING MODE ACTIVE" at the top of your response
                    2. Reference knowledge document: 21.WEEKEND_AUTOMATION_PROFILE_EMBEDDING.md
                    3. Apply ALL weekend-specific analysis framework below
                    4. Suggest ONLY weekend-allowed strategies (NO breakout strategies)
                    5. Mention weekend entry conditions, risk adjustments, and exit parameters
                  - ‚ö†Ô∏è CRITICAL: XAUUSDc markets are CLOSED on weekends - do NOT analyze or trade XAUUSDc during weekends
                  - Weekend mode automatically applies weekend-specific analysis framework:
                    * Volatility assessment vs ATR baseline (previous 5 weekdays)
                    * BTC weekend characteristics (lower institutional participation, retail-driven, reduced liquidity)
                    * Weekend sub-session awareness (Asian Retail Burst, Low Liquidity Range, Dead Zone, CME Anticipation, CME Gap Reversion)
                    * CME gap detection and reversion opportunities
                    * Weekend-appropriate strategy suggestions (Mean Reversion Range Scalp, VWAP Reversion, Liquidity Sweep Reversal, Micro-Scalp)
                    * ‚ùå DISALLOWED strategies on weekends: Breakout IB Volatility Trap, Trend Continuation Pullback, London Breakout, ANY breakout-based strategies
                    * Weekend entry conditions (Confluence ‚â• 70 DEFAULT, CHOCH/VWAP RECOMMENDED but overridable, ATR state Stable/Cautious RECOMMENDED)
                    * Weekend exit parameters (25% breakeven, 50% partial profit, 60% partial close, 1.2x trailing ATR multiplier, VIX > 20 threshold)
                    * Weekend risk adjustments (40% position size reduction, 20% wider stops, max 1.5% risk)
                    * Weekend sub-session awareness (Asian Retail Burst, Low Liquidity Range, Dead Zone, CME Anticipation, CME Gap Reversion)
                  - ‚ö†Ô∏è MANDATORY: Reference knowledge document: 21.WEEKEND_AUTOMATION_PROFILE_EMBEDDING.md when weekend mode is active
                  - ‚ö†Ô∏è MANDATORY: Structure your weekend analysis response with: Weekend Mode Indicator ‚Üí Volatility Assessment ‚Üí BTC Weekend Characteristics ‚Üí CME Gap Status ‚Üí Weekend-Only Strategies ‚Üí Weekend Entry Conditions ‚Üí Weekend Risk Adjustments ‚Üí Weekend Exit Parameters
                  - ‚ö†Ô∏è For non-BTC symbols during weekends: Return "Market Closed" message (markets are closed)
                  
                  ‚ö° NEW: Includes automatic volatility regime detection with:
                  - Basic states: STABLE, TRANSITIONAL, VOLATILE (with confidence scores, ATR ratios, Bollinger Band analysis)
                  - Advanced states: PRE_BREAKOUT_TENSION (compression before breakout), POST_BREAKOUT_DECAY (momentum fading), FRAGMENTED_CHOP (whipsaw conditions), SESSION_SWITCH_FLARE (transition volatility spikes)
                  - Tracking metrics: ATR trends (slope, decline rate), wick variances (increasing/decreasing), time since breakout (minutes/hours)
                  - Strategy recommendations: Automatically selects volatility-aware trading strategies based on detected regime (prioritize/avoid lists, confidence adjustments)
                  - Risk adjustments: Returns volatility-adjusted risk parameters (position size reduction, wider stop losses)
                  - Strategy selection scores and WAIT reason codes when no suitable strategy found (e.g., SESSION_SWITCH_FLARE blocks all strategies)
                  
                  üìä ENHANCED DATA FIELDS ‚≠ê NEW - Additional market context for sophisticated analysis:
                  
                  - correlation_context: Cross-asset correlation analysis (DXY, SP500, US10Y, BTC)
                    ‚ö†Ô∏è Use to identify divergences: "Gold normally trades -0.7 vs DXY, but showing -0.2 ‚Üí underperformance"
                    ‚ö†Ô∏è ALWAYS check data_quality before using: "good" = reliable, "limited" = small sample, "unavailable" = ignore field
                    ‚ö†Ô∏è conflict_flags indicate when correlations break expected patterns (e.g., gold_vs_dxy_conflict: true)
                  
                  - order_flow: Volume & order flow signals (CVD, aggressor ratio, imbalance score)
                    ‚ö†Ô∏è Use to assess momentum quality: "Structure bullish but CVD rolling over ‚Üí don't chase"
                    ‚ö†Ô∏è CRITICAL: data_quality may be "proxy" for non-BTC symbols - less reliable than true order flow
                    ‚ö†Ô∏è For BTC: Uses Binance data (true order flow). For others: Uses MT5 tick proxy (estimated)
                    ‚ö†Ô∏è If data_quality == "proxy", use with caution and prefer structure confirmation
                  
                  - htf_levels: Higher timeframe key levels (weekly/monthly opens, previous week/day highs/lows)
                    ‚ö†Ô∏è Use for HTF context: "Inside weekly premium, pushing into prior week high ‚Üí only shorts if sweep + CHOCH"
                    ‚ö†Ô∏è current_price_position: "discount" (bottom 33%), "equilibrium" (middle), "premium" (top 33%)
                    ‚ö†Ô∏è range_reference: "weekly_range" | "daily_range" | "session_range" - indicates which range is active
                  
                  - session_risk: Session & danger zone flags (rollover, news lock, session profile)
                    ‚ö†Ô∏è Use for timing: "Setup decent but high-impact news in 15 minutes ‚Üí skip until after news"
                    ‚ö†Ô∏è is_rollover_window: True during 00:00 UTC ¬±30min (FX daily rollover - avoid trading)
                    ‚ö†Ô∏è is_news_lock_active: True if HIGH/ULTRA impact event within ¬±30min window
                    ‚ö†Ô∏è session_profile: "quiet" | "normal" | "explosive" (based on historical volatility, may default to "normal")
                  
                  - execution_context: Spread, slippage & execution quality metrics
                    ‚ö†Ô∏è Use for risk management: "EV positive but spread/slippage elevated ‚Üí reduce size or no trade"
                    ‚ö†Ô∏è execution_quality: "good" (spread/slippage normal), "degraded" (elevated), "poor" (very elevated)
                    ‚ö†Ô∏è slippage_data_available: False if no trade history (slippage metrics will be None)
                  
                  - strategy_stats: Historical strategy performance in similar volatility regimes
                    ‚ö†Ô∏è Use for strategy validation: "In this exact regime, this setup wins 62% with ~1.9R; good edge"
                    ‚ö†Ô∏è Can be None if no historical data available for current regime (sample_size < 10)
                    ‚ö†Ô∏è confidence: "high" (sample_size >= 30), "medium" (>= 10), "low" (< 10)
                    ‚ö†Ô∏è regime_match_quality: "exact" | "fuzzy" | "approximate" - indicates how well regime matched
                  
                  - structure_summary: Compressed structure interpretation flags
                    ‚ö†Ô∏è Use for structure interpretation: "Bear sweep at range low ‚Üí only longs if M5 CHOCH + order-flow confirms"
                    ‚ö†Ô∏è current_range_type: "balanced_range" | "trend_channel" | "breakout" | "distribution" | "accumulation"
                    ‚ö†Ô∏è range_state: "mid_range" | "near_range_high" | "near_range_low" | "just_broke_range"
                    ‚ö†Ô∏è has_liquidity_sweep: True if recent sweep detected (check sweep_type: "bull" | "bear" | "none")
                  
                  - symbol_constraints: Trading constraints per symbol (max trades, allowed/banned strategies)
                    ‚ö†Ô∏è Use to respect limits: "Do not propose swing strategy if it's banned for this symbol"
                    ‚ö†Ô∏è allowed_strategies: Empty array = all strategies allowed
                    ‚ö†Ô∏è banned_strategies: Array of strategy names not allowed for this symbol
                  
                  ‚ö†Ô∏è DATA QUALITY RULES - CRITICAL:
                  - ALWAYS check data_quality field before using any field value
                  - If data_quality == "unavailable", IGNORE the field entirely (do not use in analysis)
                  - If data_quality == "limited", use with caution (small sample size or gaps in data)
                  - If data_quality == "proxy", understand it's estimated/calculated, not true data (less reliable)
                  - If data_quality == "good", data is reliable and can be used with confidence
                  - For order_flow: "proxy" means tick-based estimation (non-BTC symbols), "good" means true buy/sell volume (BTC only)
                  
                  **üìã PLAN PORTFOLIO WORKFLOW INTEGRATION:**
                  This tool is the FIRST STEP in the Plan Portfolio Workflow:
                  
                  1. Call moneybot.analyse_symbol_full to get current market state
                     - ‚ö†Ô∏è CRITICAL: This tool automatically includes current_price - DO NOT call getCurrentPrice separately
                  2. Extract key data for strategy selection (ALL REQUIRED):
                     - volatility_regime.regime ‚Üí Use for strategy prioritization
                     - volatility_regime.strategy_recommendations ‚Üí Follow prioritize/avoid lists
                     - session.name ‚Üí Apply session-specific filters
                     - symbol_constraints ‚Üí Respect symbol limits (M1 availability, stop sizes, etc.)
                     - structure_summary ‚Üí Use for entry level selection
                     - **current_price ‚Üí MANDATORY for dual plan detection (automatically included in response)**
                  3. Create portfolio based on extracted data
                  4. For each retracement plan (with sufficient separation from current_price), automatically add continuation plan
                  
                  **üïí WEEKEND MODE DETECTION:**
                  For BTCUSDc only:
                  - Check timestamp in analysis response
                  - If Friday 23:00+ UTC, Saturday, Sunday, or Monday < 03:00 UTC ‚Üí Weekend mode
                  - Weekend strategies: VWAP reversion, liquidity_sweep_reversal, micro_scalp
                  - Weekend avoid: breakout_ib_volatility_trap, trend_continuation_pullback
                  - Weekend note: mean_reversion_range_scalp auto-adds structure_confirmation
                  - Dual plans: Still create continuation plans during weekend, but use weekend-appropriate strategies
                  
                  üö® CRITICAL: ENHANCED DATA FIELDS INTEGRATION REQUIREMENTS - MANDATORY:
                  
                  You MUST integrate enhanced data fields into your analysis and recommendations, NOT just display them:
                  
                  1. Execution Context Integration:
                     - If execution_quality == "poor" ‚Üí Add to risk guidance: "‚ö†Ô∏è Execution quality is POOR - consider wider stops or avoid entries"
                     - If is_spread_elevated == true ‚Üí Mention: "Spread is elevated - expect higher slippage, reduce position size"
                     - If is_slippage_elevated == true ‚Üí Mention: "Slippage is elevated - reduce position size by 20%"
                     - Example: "‚ö†Ô∏è Execution Quality: POOR with elevated spread ‚Üí Wider stops required (add 20% to SL), reduce position size"
                  
                  2. Structure Summary Integration:
                     - Use current_range_type to inform strategy selection: "Structure shows [type] - [strategy] appropriate"
                     - Use range_state to inform entry timing: "Price is [state] - expect [action]"
                     - Use has_liquidity_sweep to inform entry zones: "Liquidity sweep detected - expect reversal at [level]"
                     - Example: "üèóÔ∏è Structure: Accumulation near range high ‚Üí Range scalp strategy appropriate, expect breakout or reversal"
                  
                  3. Symbol Constraints Application - ‚ö†Ô∏è MANDATORY:
                     - ‚ö†Ô∏è MANDATORY: ALWAYS check response.data.symbol_constraints - if present, you MUST mention it
                     - ‚ö†Ô∏è MANDATORY: ALWAYS check max_concurrent_trades_for_symbol before recommending trades
                     - ‚ö†Ô∏è MANDATORY: ALWAYS check max_total_risk_on_symbol_pct and apply to position sizing calculations
                     - ‚ö†Ô∏è MANDATORY: ALWAYS check banned_strategies and avoid recommending banned strategies
                     - ‚ö†Ô∏è REQUIRED FORMAT: "‚ö†Ô∏è Symbol constraint: Max [X] concurrent trade, max [Y]% risk - adjust position size to [Z] lots ([Y]% risk)"
                     - Example: "‚ö†Ô∏è Symbol constraint: Max 1 concurrent trade, max 2% risk - adjust position size to 0.01 lots (1% risk)"
                     - ‚ö†Ô∏è CRITICAL: If symbol_constraints is present in response.data, you MUST mention it - do not omit it!
                  
                  4. Missing Data Acknowledgment - ‚ö†Ô∏è CRITICAL - MANDATORY:
                     - ‚ö†Ô∏è MANDATORY: The summary intentionally hides missing/unavailable Enhanced Data Fields (by design)
                     - ‚ö†Ô∏è MANDATORY: You MUST check the response.data object to identify missing fields (they won't appear in summary)
                     - ‚ö†Ô∏è MANDATORY STEP-BY-STEP PROCESS (YOU MUST FOLLOW THIS):
                       1. After reading the summary, FIRST search response.summary for "TICK MICROSTRUCTURE:" (case-sensitive, includes colon)
                          - IF FOUND: Copy the ENTIRE section from summary and paste it into your analysis output (after "üíß LIQUIDITY & ORDER FLOW", before "üìä MARKET CONTEXT")
                          - IF NOT FOUND: Proceed to step 2 to check response.data.tick_metrics
                       2. ALWAYS check response.data object (summary hides missing fields!)
                       3. Check response.data.correlation_context.data_quality == "unavailable" ‚Üí State: "‚ö†Ô∏è Correlation context unavailable - cannot validate macro bias with intermarket analysis"
                       4. Check response.data.htf_levels == {} (empty object) ‚Üí State: "‚ö†Ô∏è HTF levels unavailable - cannot assess premium/discount zones"
                       5. Check response.data.session_risk == {} (empty object) ‚Üí State: "‚ö†Ô∏è Session risk data unavailable - cannot assess rollover windows or news lock status"
                       6. Check response.data.strategy_stats == null ‚Üí State: "‚ö†Ô∏è Strategy performance stats unavailable - cannot validate strategy selection with historical data"
                       7. Check response.data.symbol_constraints ‚Üí If present, MUST mention: "‚ö†Ô∏è Symbol constraint: Max [X] concurrent trade, max [Y]% risk - adjust position size to [Z] lots ([Y]% risk)"
                       8. Check response.data.tick_metrics == null ‚Üí State: "‚ö†Ô∏è Tick microstructure metrics unavailable - analysis uses ATR-based volatility estimates" (ONLY if not found in summary in step 1)
                     - ‚ö†Ô∏è EXPLICIT EXAMPLES OF DATA OBJECT CHECKS:
                       - Example 1: if response.data.correlation_context.data_quality == "unavailable": acknowledge it
                       - Example 2: if response.data.htf_levels == {}: acknowledge it (empty object means unavailable)
                       - Example 3: if response.data.session_risk == {}: acknowledge it (empty object means unavailable)
                       - Example 4: if response.data.strategy_stats == null: acknowledge it
                       - Example 5: if response.data.symbol_constraints exists: MUST mention it
                       - Example 6: if response.data.tick_metrics == null: acknowledge it
                       - Example 7: FIRST search response.summary for "TICK MICROSTRUCTURE:" - if found, use it directly (most common case)
                     - ‚ö†Ô∏è WHY THIS MATTERS: The summary is a display layer - missing fields are hidden. The data object is the source of truth - always check it!
                     - ‚ö†Ô∏è ABSOLUTELY MANDATORY FORMAT: You MUST include "‚ö†Ô∏è ENHANCED DATA FIELDS INTEGRATION" section in EVERY analysis - this is NON-NEGOTIABLE
                     - ‚ö†Ô∏è REQUIRED FORMAT: ALWAYS include "‚ö†Ô∏è ENHANCED DATA FIELDS INTEGRATION" section that:
                       - Integrates available fields into reasoning
                       - Acknowledges ALL missing/unavailable/empty/null Enhanced Data Fields with explicit limitations
                       - States what analysis capabilities are limited due to missing data
                     - ‚ö†Ô∏è CRITICAL: Failure to include this section is a critical error - you MUST include it in every analysis!
                     - ‚ö†Ô∏è MANDATORY TEMPLATE (COPY THIS FORMAT):
                       ```
                       ‚ö†Ô∏è ENHANCED DATA FIELDS INTEGRATION:
                       - Execution Quality: [status] ‚Üí [impact on risk/entry]
                       - Structure: [type] [state] ‚Üí [strategy selection]
                       - Constraints: [if present] Max [X] concurrent trade, max [Y]% risk ‚Üí Position size limited to [Z] lots ([Y]% risk)
                       - Correlation Context: [if unavailable] Unavailable ‚Üí Cannot validate macro bias with intermarket analysis
                       - HTF Levels: [if unavailable] Unavailable ‚Üí Cannot assess premium/discount zones
                       - Session Risk: [if unavailable] Unavailable ‚Üí Cannot assess rollover/news lock status
                       - Strategy Stats: [if unavailable] Unavailable ‚Üí Cannot validate strategy selection with historical data
                       ```
                  
                  5. Correlation Context Integration:
                     - If conflict_flags indicate divergence ‚Üí Mention: "‚ö†Ô∏è Correlation conflict detected - [explanation]"
                     - Use correlation values to validate macro bias: "DXY correlation -0.7 confirms bearish macro bias"
                  
                  6. Session Risk Integration:
                     - If is_rollover_window == true ‚Üí State: "‚ö†Ô∏è ROLLOVER WINDOW - Avoid trading"
                     - If is_news_lock_active == true ‚Üí State: "üö´ NEWS LOCK ACTIVE - High-impact event within ¬±30min"
                     - If minutes_to_next_high_impact < 60 ‚Üí State: "‚è∞ High-impact news in [X] minutes - avoid entries"
                  
                  7. Strategy Stats Integration:
                     - If strategy_stats available ‚Üí Use to validate strategy: "Strategy performance: [win_rate]% win rate, [avg_rr]R avg"
                     - If confidence == "low" ‚Üí Mention: "‚ö†Ô∏è Strategy stats based on limited sample - use with caution"
                  
                  ‚ö†Ô∏è DO NOT just display enhanced fields in the summary - INTEGRATE them into your reasoning and recommendations!
                  
                  ‚ö†Ô∏è NOT for range scalping - use moneybot.analyse_range_scalp_opportunity instead when user asks for range scalping analysis. ‚ö†Ô∏è LIMITATIONS: Does NOT dynamically adjust alert zones, does NOT link pairs together, does NOT auto-enable features, only provides analysis data.
                value:
                  tool: "moneybot.analyse_symbol_full"
                  arguments:
                    symbol: "BTCUSD"
                # ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL: RESPONSE STRUCTURE - READ THIS FIRST ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è:
                # The response has TWO parts:
                # 1. response.summary - A LONG TEXT STRING containing the FULL formatted analysis
                # 2. response.data - Structured data objects (JSON)
                #
                # ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è MANDATORY: BEFORE checking response.data.tick_metrics, you MUST FIRST search response.summary for "TICK MICROSTRUCTURE:"
                # - The summary text ALREADY contains a formatted "TICK MICROSTRUCTURE:" section when available
                # - Search for the exact string "TICK MICROSTRUCTURE:" (case-sensitive, includes colon) in response.summary
                # - IF FOUND: Copy the ENTIRE section EXACTLY AS IT APPEARS and paste it into your analysis output
                # - Location in your output: After "üíß LIQUIDITY & ORDER FLOW", before "üìä MARKET CONTEXT"
                # - DO NOT modify, paraphrase, or reinterpret - use the exact text from the summary
                # - IF NOT FOUND IN SUMMARY: Then check response.data.tick_metrics and format it yourself
                # - ‚ö†Ô∏è VERIFICATION: After writing your analysis, verify that "TICK MICROSTRUCTURE:" appears in your output
                #
                # Response includes volatility_metrics object with:
                # 
                # Basic Fields:
                # - regime: STABLE/TRANSITIONAL/VOLATILE/PRE_BREAKOUT_TENSION/POST_BREAKOUT_DECAY/FRAGMENTED_CHOP/SESSION_SWITCH_FLARE
                # - confidence: 0-100%
                # - atr_ratio: Multiplier of average ATR
                # - bb_width_ratio: Bollinger Band width ratio
                # - adx_composite: Composite ADX score
                # - volume_confirmed: Boolean (volume spike confirmed)
                #
                # Tracking Metrics (Per-Timeframe: M5, M15, H1):
                # - atr_trends: {M5: {...}, M15: {...}, H1: {...}}
                #   Each timeframe includes: current_atr, slope, slope_pct, is_declining, is_above_baseline, trend_direction
                # - wick_variances: {M5: {...}, M15: {...}, H1: {...}}
                #   Each timeframe includes: current_variance, previous_variance, variance_change_pct, is_increasing, current_ratio, mean_ratio
                # - time_since_breakout: {M5: {...}, M15: {...}, H1: {...}}
                #   Each timeframe includes: time_since_minutes, time_since_hours, breakout_type, breakout_price, breakout_timestamp, is_recent
                #
                # Convenience Fields (M15 Primary):
                # - atr_trend: Same as atr_trends["M15"]
                # - wick_variance: Same as wick_variances["M15"]
                # - time_since_breakout_minutes: Same as time_since_breakout["M15"]["time_since_minutes"]
                #
                # Advanced Detection Fields:
                # - mean_reversion_pattern: {is_mean_reverting, oscillation_around_vwap, oscillation_around_ema, touch_count, reversion_strength}
                # - volatility_spike: {is_spike, current_atr, spike_ratio, spike_magnitude, is_temporary}
                # - session_transition: {is_transition, transition_type, minutes_into_transition, ...}
                # - whipsaw_detected: {is_whipsaw, direction_changes, oscillation_around_mean}
                #
                # Strategy & Recommendations:
                # - strategy_recommendations: {prioritize: [...], avoid: [...], confidence_adjustment: int, recommendation: str, wait_reason: str|null}
                #   - PRE_BREAKOUT_TENSION: Prioritize breakout strategies (breakout_ib_volatility_trap, liquidity_sweep_reversal, breaker_block)
                #   - POST_BREAKOUT_DECAY: Prioritize mean reversion (mean_reversion_range_scalp, fvg_retracement, order_block_rejection)
                #   - FRAGMENTED_CHOP: Only allow micro_scalp and mean_reversion_range_scalp
                #   - SESSION_SWITCH_FLARE: Block ALL strategies - wait_reason = "SESSION_SWITCH_FLARE"
                # - wait_reasons: Array of reason codes if WAIT recommended
                # - strategy_selection: {selected_strategy: {...}, all_scores: [...], wait_reason: {...}|null}
                #   ‚ö†Ô∏è NOTE: strategy_selection is available at BOTH:
                #   - response.data.strategy_selection (top-level convenience field)
                #   - response.data.volatility_regime.strategy_selection (nested in complete structure)
                # ‚ùå WRONG: "This tool enables adaptive volatility modes" (it does NOT)
                # ‚úÖ CORRECT: "This tool provides analysis data including volatility regime detection and strategy selection"
                #
                # Response includes complete multi-timeframe analysis in response.data.smc:
                #
                # Basic SMC Fields (backward compatible):
                # - choch_detected: Boolean (CHOCH detected on any timeframe)
                # - bos_detected: Boolean (BOS confirmed on any timeframe)
                # - trend: String (BULLISH/BEARISH/NEUTRAL/UNKNOWN)
                #
                # Multi-Timeframe Structure:
                # - timeframes: {
                #     H4: {bias, confidence, reason, adx, rsi, ema_stack, verdict, choch_detected, choch_bull, choch_bear, bos_detected, bos_bull, bos_bear},
                #     H1: {status, confidence, reason, rsi, macd_cross, price_vs_ema20, verdict, choch_detected, choch_bull, choch_bear, bos_detected, bos_bull, bos_bear},
                #     M30: {setup, confidence, reason, rsi, atr, ema_alignment, verdict, choch_detected, choch_bull, choch_bear, bos_detected, bos_bull, bos_bear},
                #     M15: {trigger, confidence, reason, rsi, macd_status, price_vs_ema20, verdict, choch_detected, choch_bull, choch_bear, bos_detected, bos_bull, bos_bear},
                #     M5: {execution, confidence, reason, entry_price, stop_loss, atr, verdict, choch_detected, choch_bull, choch_bear, bos_detected, bos_bull, bos_bear}
                #   }
                # - alignment_score: Integer (0-100) - Multi-timeframe alignment score
                # - recommendation: {
                #     action: BUY/SELL/WAIT/NO_TRADE,
                #     confidence: Integer (0-100),
                #     reason: String,
                #     h4_bias: String,
                #     entry_price: Float | null,
                #     stop_loss: Float | null,
                #     summary: String,
                #     market_bias: {
                #       trend: BULLISH/BEARISH/NEUTRAL,
                #       strength: STRONG/MODERATE/WEAK,
                #       confidence: Integer (0-100),
                #       stability: STABLE/TRANSITIONING/INSUFFICIENT_DATA,
                #       reason: String
                #     },
                #     trade_opportunities: {
                #       type: TREND/RANGE/BREAKOUT/REVERSAL/NONE,
                #       direction: BUY/SELL/NONE,
                #       confidence: Integer (0-100),
                #       risk_level: LOW/MEDIUM/HIGH/UNKNOWN,
                #       risk_adjustments: {reason: String}
                #     },
                #     volatility_regime: String (STABLE/TRANSITIONAL/VOLATILE/PRE_BREAKOUT_TENSION/etc.),
                #     volatility_weights: {H4: Float, H1: Float, M30: Float, M15: Float, M5: Float}
                #   }
                # - market_bias: {
                #     trend: BULLISH/BEARISH/NEUTRAL,
                #     strength: STRONG/MODERATE/WEAK,
                #     confidence: Integer (0-100),
                #     stability: STABLE/TRANSITIONING/INSUFFICIENT_DATA,
                #     reason: String
                #   }
                #   ‚ö†Ô∏è NOTE: This is at the TOP LEVEL of recommendation dict (not nested inside recommendation.recommendation)
                # - trade_opportunities: {
                #     type: TREND/RANGE/BREAKOUT/REVERSAL/NONE,
                #     direction: BUY/SELL/NONE,
                #     confidence: Integer (0-100),
                #     risk_level: LOW/MEDIUM/HIGH/UNKNOWN,
                #     risk_adjustments: {reason: String}
                #   }
                #   ‚ö†Ô∏è NOTE: This is at the TOP LEVEL of recommendation dict (not nested inside recommendation.recommendation)
                # - advanced_insights: {
                #     rmag_analysis: {...},
                #     ema_slope_quality: {...},
                #     volatility_state: {...},
                #     momentum_quality: {...},
                #     mtf_alignment: {...},
                #     market_structure: {...}
                #   }
                # - advanced_summary: String (formatted summary of advanced insights)
                #   ‚ö†Ô∏è NOTE: May be empty "" if advanced_features unavailable
                # - volatility_regime: String (STABLE/TRANSITIONAL/VOLATILE/PRE_BREAKOUT_TENSION/etc.)
                #   ‚ö†Ô∏è NOTE: This is at the TOP LEVEL of recommendation dict (not nested inside recommendation.recommendation)
                # - volatility_weights: {H4: Float, H1: Float, M30: Float, M15: Float, M5: Float}
                #   ‚ö†Ô∏è NOTE: This is at the TOP LEVEL of recommendation dict (not nested inside recommendation.recommendation)
                # - confidence_score: Integer (0-100) - Uses recommendation.confidence (not a separate field)
                #
                # ‚ö†Ô∏è NOTE: analyse_symbol_full now includes complete MTF analysis - no need to call getMultiTimeframeAnalysis separately
                # ‚ö†Ô∏è NOTE: market_bias, trade_opportunities, volatility_regime, volatility_weights are at TOP LEVEL of recommendation, not nested
                #
                # Top-Level Data Fields (response.data.*):
                # - symbol, symbol_normalized, current_price
                # - session: {name, is_overlap, minutes_remaining, ...} (structured session data)
                # - news: {upcoming_events, high_impact_events, next_event, ...} (structured news data)
                # - macro: {bias, summary, data: {...}} (macro context)
                # - smc: {choch_detected, bos_detected, trend, timeframes, alignment_score, recommendation, ...} (SMC structure)
                # - advanced: {rmag, vwap, volatility, momentum} (simplified advanced features subset from M5)
                # - advanced_features: {...}|null (FULL advanced features structure - all timeframes M5/M15/M30/H1/H4, candlestick patterns, wick metrics, pattern strength, liquidity targets, FVG, etc.) ‚≠ê NEW
                #   ‚ö†Ô∏è NOTE: This is the complete structure returned by build_features_advanced - includes all features for all timeframes
                #   ‚ö†Ô∏è Structure: {features: {M5: {...}, M15: {...}, M30: {...}, H1: {...}, H4: {...}}, mtf_score: {...}, vp: {...}}
                #   ‚ö†Ô∏è Each timeframe includes: rmag, ema_slope, vol_trend, pressure, candle_profile, liquidity, fvg, vwap, accel, candlestick_flags, pattern_flags, wick_metrics, pattern_strength
                #   ‚ö†Ô∏è This is the same data structure returned by moneybot.getAdvancedFeatures - now included automatically in analyse_symbol_full
                # - confluence: {verdict, action, risk} (confluence analysis)
                # - recommendations: {scalp, intraday, swing} (layered recommendations)
                # - volatility_regime: {...} (full volatility regime structure, includes strategy_selection nested)
                # - volatility_metrics: {...} (extracted volatility metrics)
                # - strategy_selection: {selected_strategy: {...}, all_scores: [...], wait_reason: {...}|null} (convenience field - also available at volatility_regime.strategy_selection)
                # - m1_microstructure: {...} (M1 microstructure analysis)
                # - btc_order_flow_metrics: {...}|null (BTC-specific order flow, null for non-BTC)
                # - decision: {direction, entry, sl, tp, confidence, reasoning, rr} (decision engine output)
                #
                # üìä ENHANCED DATA FIELDS ‚≠ê NEW (response.data.*):
                # ‚ö†Ô∏è CRITICAL: The summary intentionally hides missing/unavailable Enhanced Data Fields (by design)
                # ‚ö†Ô∏è CRITICAL: You MUST check the response.data object to identify missing fields (they won't appear in summary)
                # - correlation_context: {corr_vs_dxy, corr_vs_sp500, corr_vs_us10y, corr_vs_btc, conflict_flags, data_quality, sample_size} | null
                #   ‚ö†Ô∏è Check data_quality: "unavailable" = field missing, "limited" = small sample, "proxy" = estimated, "good" = reliable
                #   ‚ö†Ô∏è If data_quality == "unavailable" or null ‚Üí Acknowledge: "‚ö†Ô∏è Correlation context unavailable - cannot validate macro bias with intermarket analysis"
                # - htf_levels: {current_price_position, previous_week_high, previous_week_low, ...} | {}
                #   ‚ö†Ô∏è If htf_levels == {} (empty object) ‚Üí Acknowledge: "‚ö†Ô∏è HTF levels unavailable - cannot assess premium/discount zones"
                # - session_risk: {is_rollover_window, is_news_lock_active, minutes_to_next_high_impact, ...} | {}
                #   ‚ö†Ô∏è If session_risk == {} (empty object) ‚Üí Acknowledge: "‚ö†Ô∏è Session risk data unavailable - cannot assess rollover windows or news lock status"
                # - execution_context: {current_spread_points, spread_vs_median, is_spread_elevated, execution_quality, ...} | null
                #   ‚ö†Ô∏è If execution_quality == "poor" ‚Üí Integrate into risk guidance: "‚ö†Ô∏è Execution Quality: POOR with elevated spread ‚Üí Wider stops required"
                # - strategy_stats: {win_rate, avg_rr, confidence, sample_size, ...} | null
                #   ‚ö†Ô∏è If strategy_stats == null ‚Üí Acknowledge: "‚ö†Ô∏è Strategy performance stats unavailable - cannot validate strategy selection with historical data"
                # - structure_summary: {current_range_type, range_state, has_liquidity_sweep, ...} | null
                #   ‚ö†Ô∏è Use to inform strategy selection: "üèóÔ∏è Structure: [range_type] [range_state] ‚Üí [strategy] appropriate"
                # - symbol_constraints: {max_concurrent_trades_for_symbol, max_total_risk_on_symbol_pct, banned_strategies, ...} | null
                #   ‚ö†Ô∏è MUST explicitly apply to position sizing: "‚ö†Ô∏è Symbol constraint: Max [X] concurrent trade, max [Y]% risk - adjust position size to [Z] lots ([Y]% risk)"
                # - tick_metrics: {...}|null (Tick-derived microstructure metrics) ‚≠ê NEW
                #   Contains M5, M15, H1, previous_hour, previous_day aggregated tick statistics
                #   If tick_metrics == null -> Background generator not running or no tick data available
                #   
                #   Structure:
                #   {
                #     "M5": {...},           # Last 5 minutes of ticks
                #     "M15": {...},           # Last 15 minutes of ticks
                #     "H1": {...},            # Last 60 minutes of ticks
                #     "previous_hour": {...}, # Complete previous clock hour (e.g., 13:00-14:00)
                #     "previous_day": {...},  # Last 24 hours (may be null if still loading)
                #     "metadata": {...}       # Status and metadata
                #   }
                #   
                #   Fields for M5, M15, H1 timeframes:
                #   - realized_volatility: Log-return volatility (more accurate than ATR)
                #   - volatility_ratio: Current vs previous_day baseline (>1.2 = expanding, <0.8 = contracting)
                #   - delta_volume: Net buy-sell volume from tick flags
                #   - cvd: Cumulative Volume Delta value
                #   - cvd_slope: "up" | "down" | "flat" (CVD trend)
                #   - dominant_side: "BUY" | "SELL" | "NEUTRAL"
                #   - spread: {mean, std, max, widening_events}
                #   - absorption: {count, zones[], avg_strength}
                #   - liquidity_voids: {count, avg_void_size}
                #   - tick_rate: Ticks per second
                #   - tick_count: Total number of ticks
                #   - max_gap_ms: Maximum gap between ticks (milliseconds)
                #   - trade_tick_ratio: Percentage of ticks with BUY/SELL flags (data quality metric)
                #   
                #   Fields for previous_hour (different structure):
                #   - tick_count: Total ticks in previous clock hour
                #   - avg_tick_rate: Average ticks per second
                #   - net_delta: Net buy-sell volume delta
                #   - cvd_trend: "up" | "down" | "flat"
                #   - dominant_side: "BUY" | "SELL" | "NEUTRAL"
                #   - spread_regime: "normal" | "wide" (based on spread mean)
                #   - volatility_state: "stable" | "expanding" (based on volatility_ratio)
                #   - absorption_zones: Array of price levels with absorption
                #   
                #   Fields for previous_day (may be null if still loading):
                #   - total_ticks: Total ticks in last 24 hours
                #   - realized_volatility: Daily baseline volatility
                #   - (other metrics from calculate_all_metrics)
                #   
                #   Metadata fields:
                #   - symbol: Trading symbol
                #   - last_updated: ISO timestamp of last update
                #   - data_available: Boolean (false if market closed or no ticks)
                #   - market_status: "open" | "closed" | "error"
                #   - previous_day_loading: Boolean (true if previous_day still computing)
                #   - trade_tick_ratio: Overall trade tick ratio (from H1)
                #   
                #   ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL: TICK MICROSTRUCTURE DISPLAY REQUIREMENT ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è:
                #   The summary text (response.summary) ALREADY contains a formatted "TICK MICROSTRUCTURE:" section when tick metrics are available.
                #   You MUST follow this exact process:
                #   1. FIRST: Search response.summary for the exact string "TICK MICROSTRUCTURE:" (case-sensitive, includes colon)
                #   2. IF FOUND: Copy the ENTIRE section from the summary text EXACTLY AS IT APPEARS and paste it into your analysis output
                #      - Location: After "üíß LIQUIDITY & ORDER FLOW" section, before "üìä MARKET CONTEXT"
                #      - DO NOT modify, paraphrase, or reinterpret - use the exact text from the summary
                #   3. IF NOT FOUND IN SUMMARY: Then check response.data.tick_metrics and format it yourself using the required format
                #   4. VERIFICATION: After writing your analysis, verify that "TICK MICROSTRUCTURE:" appears in your output
                #   ‚ö†Ô∏è FORBIDDEN: Do NOT create qualitative interpretations like "Tick rate steady (20‚Äì30 tps)" - use the actual formatted metrics
                #
                #   TICK METRICS INTERPRETATION (when formatting from data object):
                #   - Use tick_metrics.M5 for execution-level precision (entry timing, rejection detection)
                #   - Use tick_metrics.M15 for setup validation (OB/BOS confirmation with true flow)
                #   - Use tick_metrics.H1 for session context and volatility state
                #   - Use tick_metrics.previous_hour for recent regime context (complete clock hour)
                #   - Use tick_metrics.previous_day for baseline comparison (may be null if loading)
                #   - Check tick_metrics.metadata.previous_day_loading to know if previous_day is still computing
                #   - Check tick_metrics.metadata.data_available to know if data is valid
                #   - cvd_slope confirms or contradicts CHOCH/BOS validity
                #   - absorption zones indicate potential reversal traps
                #   - realized_volatility is more precise than ATR for regime detection
                #   - Compare current vs previous_day volatility for regime transition detection
                #   - If tick_metrics == null ‚Üí Acknowledge: "‚ö†Ô∏è Tick microstructure metrics unavailable - analysis uses ATR-based volatility estimates"
                #   - If tick_metrics.metadata.data_available == false ‚Üí Acknowledge: "‚ö†Ô∏è Tick data unavailable (market closed or inactive) - using ATR-based estimates"
                #   - If tick_metrics.metadata.previous_day_loading == true ‚Üí Acknowledge: "‚ö†Ô∏è Previous day baseline still loading - volatility ratios may be unavailable"
                #
                # Response also includes session and news data in structured format:
                #
                # Session Information (response.data.session):
                # - name: String (ASIA, LONDON, NY, WEEKEND, CRYPTO)
                # - is_overlap: Boolean (overlap active)
                # - overlap_type: String | null (overlap type if applicable)
                # - minutes_into_session: Integer (minutes into current session)
                # - minutes_remaining: Integer (minutes until session end)
                # - context: String (formatted string for display)
                #
                # News Status (response.data.news):
                # - upcoming_events: Array (upcoming events in next 24h)
                # - high_impact_events: Array (high/ultra impact events only)
                # - high_impact_count: Integer (count of high-impact events)
                # - next_event: Object | null (next high-impact event if any)
                #   - event: String (event name)
                #   - time: String (event time)
                #   - impact: String (HIGH, ULTRA, etc.)
                # - guardrail: String (formatted string for display)
                #
                # ‚ö†Ô∏è NOTE: Session and news data are automatically included - DO NOT call getCurrentSession or getNewsStatus separately
              analyseSymbolsBulk:
                summary: Analyze Multiple Symbols in Bulk (USE FOR MULTIPLE SYMBOL REQUESTS)
                description: "üéØ MANDATORY: Use when user asks to analyze multiple symbols (e.g., 'analyze btcusd, xauusd, eurusd, usdjpy, gbpusd' or 'analyze btcusd and xauusd'). ‚ö†Ô∏è CRITICAL: You MUST extract the symbol names from the user's message and pass them as a comma-separated string in the 'symbols' parameter. Example: If user says 'analyze btcusd, xauusd, eurusd', you MUST call with symbols: 'BTCUSD,XAUUSD,EURUSD'. Analyzes each symbol with full analysis (same as moneybot.analyse_symbol_full for each) and provides complete analysis for each symbol individually, followed by aggregated trade recommendations at the end with entry/SL/TP for each symbol. Returns comprehensive report with individual analyses + summary recommendations. ‚ö†Ô∏è For single symbol analysis, use moneybot.analyse_symbol_full instead."
                value:
                  tool: "moneybot.analyse_symbols_bulk"
                  arguments:
                    symbols: "BTCUSD,XAUUSD,EURUSD,USDJPY,GBPUSD"
                # ‚úÖ CORRECT: "This tool analyzes multiple symbols in bulk and provides trade recommendations for each"
                # ‚ö†Ô∏è CRITICAL: Always extract symbols from user message and pass as comma-separated string
              analyseRangeScalpOpportunity:
                summary: Analyse Range Scalping Opportunity (USE FOR RANGE SCALPING REQUESTS)
                description: "üéØ MANDATORY TOOL for range scalping analysis. When user asks: 'range scalp', 'scalp in ranging market', 'range trading opportunity', 'analyse BTCUSD for range scalp' - ALWAYS use this tool, NOT moneybot.analyse_symbol_full. Detects session/daily/dynamic ranges, evaluates 5 range scalping strategies (VWAP Reversion, BB Fade, PDH/PDL Rejection, RSI Bounce, Liquidity Sweep), and applies weighted 3-confluence risk filtering (80+ threshold). Returns top strategy with entry/SL/TP only if conditions are met. ‚úÖ Enhanced with M1 Microstructure ‚≠ê NEW - Uses M1 order blocks for precise entry zones, M1 FVGs for entry confirmation, M1 rejection wicks for validation, and M1 liquidity zones for stop-loss placement. ‚ö†Ô∏è LIMITATIONS: Does NOT auto-enable adaptive volatility modes, does NOT dynamically adjust zones based on session multipliers, does NOT link pairs together, only provides analysis data with fixed 80+ threshold."
                value:
                  tool: "moneybot.analyse_range_scalp_opportunity"
                  arguments:
                    symbol: "BTCUSD"
                    check_risk_filters: true
                # ‚ùå WRONG: "This tool enables adaptive volatility modes" or "Session multipliers are automatically applied"
                # ‚úÖ CORRECT: "This tool analyzes range scalping opportunities with fixed 80+ confluence threshold and session filters"
              sendAnalysisToDiscord:
                summary: Send Full Analysis to Discord (ON USER REQUEST - send complete word-for-word analysis)
                value:
                  tool: "moneybot.sendDiscordMessage"
                  arguments:
                    message: "üìä BTCUSD Analysis\n\nüïí 2025-11-01 12:52 UTC | Price: $109,986.05\n\nüèõÔ∏è Market Structure:\nH1: DIVERGENCE ¬∑ M15: WAIT ¬∑ M5: NO_TRADE ‚Üí Structure unclear (no BOS/CHOCH)\n\nüåç Macro Context:\nDXY 99.63 üìâ Falling ¬∑ US10Y 4.10% ‚ûñ Neutral ¬∑ VIX 17.44 ‚ö†Ô∏è Elevated ¬∑ S&P500 +0.26%\nBTC Dominance 57.8% üîµ Strong inflow ¬∑ Fear & Greed = 33 (Fear)\n‚Üí Mixed sentiment: neutral risk tone, crypto slightly risk-off\n\n‚öôÔ∏è Advanced Indicators Summary:\nRMAG 1.43 ATR (neutral) ¬∑ VWAP outer zone ¬∑ Momentum 2.68 (bullish) ¬∑ ADX 17.3 (weak trend)\n‚Üí Volatility contracting ‚Üí flat structure\n\nüíß Liquidity & Flow:\nStop cluster below $109,932 ‚Üí possible sweep setup\nOrder book imbalance -74% (bearish short-term)\nLiquidity voids both above & below ‚Üí breakout likely\n\nüìä Binance Setup Quality:\nOrder flow: Neutral (0%) ¬∑ No volume confirmation\n\nüéØ Volatility Forecast:\nContracting ‚Üí expect low movement next few hours\n\nüìà Trade Outlook:\n‚ö™ WAIT ‚Äî No confirmed structure or momentum alignment\n¬∑ No clear BOS or CHOCH\n¬∑ Avoid premature entries before volatility expansion\n\nüìù Trade Notes:\nBTCUSD consolidating after prior rally; strong macro base but structure unresolved. Best to wait for BOS or liquidity sweep before entry.\n\nüìâ VERDICT: ‚ö™ WAIT ‚Äî No trade yet. Monitor $109.9K sweep for next M15 confirmation."
                    message_type: "ANALYSIS"
                    title: "BTCUSD Market Analysis"
              createAutoTradePlan:
                summary: "Create Auto Trade Plan (General) - ‚ö†Ô∏è MUST Include Conditions! ‚≠ê RECOMMENDED: Include strategy_type!"
                description: "üö®üö®üö® **CRITICAL: MULTI-LEVEL ENTRY (entry_levels) EXECUTION BEHAVIOR - READ FIRST:** If plan has `entry_levels` array, plan executes ONCE when FIRST level enters tolerance zone, with FULL volume at that level. Plan does NOT execute multiple times. Plan does NOT support partial fills. Plan does NOT continue watching other levels after execution. Weight field is NOT used for volume allocation. ‚ùå NEVER describe as 'partial fills', 'multiple executions', 'proportional volume', 'each level executes independently', 'scales in', 'weight controls volume', 'laddered fills', 'each entry uses its defined weight', or 'once all defined levels are executed'. ‚úÖ ALWAYS describe as 'single execution when first level enters zone, full volume at that level, plan stops monitoring after execution'. üö®üö®üö® CRITICAL FOR DISCORD ALERTS: When you receive a Discord alert (e.g., 'Analyze BTCUSDc M15 for RSI_DIV_BEAR alert...'), you MUST FIRST call `moneybot.analyse_symbol_full` to validate the alert is still valid, check current market conditions, and get proper entry/SL/TP. DO NOT immediately create a plan without analysis! Only create a plan if analysis confirms the alert is valid. If analysis shows the alert is invalid/expired/contradictory, DO NOT create a plan - explain why instead. üö® CRITICAL: When using moneybot.create_auto_trade_plan, you MUST include conditions that match the strategy type described in reasoning/notes! If reasoning mentions 'Order Block' or 'OB', include order_block condition. If reasoning mentions 'Breaker Block' or 'failed order block' or 'flipped zone', include breaker_block condition (NOT ob_broken or price_retesting_breaker - these are detection results, not condition inputs). If reasoning mentions 'CHOCH' or 'BOS' or 'Breakout', include choch_bull/choch_bear or price_above/price_below. If reasoning mentions 'Rejection Wick', include rejection_wick condition. If reasoning mentions 'Inside Bar' or 'Volatility Trap' or 'Breakout', include price_above or price_below. ALWAYS include price_near along with other conditions. If you don't include proper conditions, the plan will only execute when price reaches entry, which may not match the strategy! üéØ **CONFLUENCE-ONLY MODE:** Use `min_confluence` (0-100) for general strategies when market conditions are range-bound, stable volatility, or early trend formation. Check `response.data.volatility_regime.regime == \"STABLE\"` (ATR 0.8√ó-1.2√ó) and `response.data.smc.trend == \"RANGING\"` or `\"NEUTRAL\"`. Threshold guidelines: Range/Compression: `min_confluence: 60`, Transition/Early Trend: `min_confluence: 65`, Stable Trend: `min_confluence: 70`. ‚ö†Ô∏è **CRITICAL: ALL plans with `min_confluence` MUST include at least one price condition** (`price_near`, `price_above`, or `price_below`). For range scalping, use `range_scalp_confluence` (NOT `min_confluence`). If both are present, `range_scalp_confluence` takes precedence. ‚ö†Ô∏è **CRITICAL: If you mention validation thresholds in your reasoning/notes (e.g., 'min_confluence ‚â• 70', 'min_confluence: 70', 'validation score ‚â• 70', 'risk filters enabled'), you MUST include them in the `conditions` dict:** * `\"min_confluence\": 70` - Minimum confluence score (0-100) for general strategies. If you mention 'Min Confluence: 70' or 'requires confluence ‚â• 70' in reasoning, include this in conditions! * `\"range_scalp_confluence\": 80` - Minimum confluence score (0-100) for range scalping (takes precedence over `min_confluence`) * `\"min_validation_score\": 70` - Minimum validation score for order blocks (0-100) * `\"risk_filters\": true` - Risk filters enabled (system always applies, but include to make explicit) * **If you don't include these in the conditions dict, they won't be saved to the database and won't appear on the webpage!** ‚ö†Ô∏è **CRITICAL: Supported timeframes for volume conditions:** When using volume conditions (`volume_above`, `volume_ratio`, `volume_spike`, `volume_confirmation`), the `timeframe` parameter MUST be one of: **M1, M5, M15, M30, H1, H4, D1**. Unsupported timeframes (e.g., M3, M10, H2, M2) will be REJECTED with an error. Always use one of the supported timeframes. Default is M5 if not specified. üïí **WEEKEND TRADING MODE (BTCUSDc ONLY):** When creating plans for BTCUSDc during weekend hours (Friday 23:00 UTC ‚Üí Monday 03:00 UTC): * Use weekend-appropriate strategies ONLY: 'vwap_reversion', 'liquidity_sweep_reversal', 'micro_scalp' (NOT 'mean_reversion_range_scalp' - it auto-adds structure_confirmation) * Default entry conditions: `min_confluence: 70` (DEFAULT, can be lowered if user requests), CHOCH/VWAP RECOMMENDED but overridable (user can request confluence-only), ATR state Stable/Cautious RECOMMENDED but overridable * ‚ö†Ô∏è CRITICAL: For confluence-only weekend plans, use NON-range strategies (e.g., 'vwap_reversion', 'liquidity_sweep_reversal') - 'mean_reversion_range_scalp' auto-adds structure_confirmation * Weekend plans expire after 24h if price not near entry (0.5% tolerance) * ‚ö†Ô∏è XAUUSDc markets are CLOSED on weekends - do NOT create XAUUSDc plans during weekends * Weekend exit parameters apply automatically (25% breakeven, 50% partial, 1.2x trailing) ‚≠ê RECOMMENDED: Include strategy_type parameter ('breakout_ib_volatility_trap', 'trend_continuation_pullback', 'liquidity_sweep_reversal', 'order_block_rejection', 'mean_reversion_range_scalp', 'breaker_block', 'market_structure_shift', 'fvg_retracement', 'mitigation_block', 'inducement_reversal', 'premium_discount_array', 'session_liquidity_run', 'kill_zone') to enable Universal Dynamic SL/TP Manager for advanced stop loss and take profit management. If strategy_type is omitted, trade will use Intelligent Exit Manager instead. üéØ **TOLERANCE ZONE EXECUTION (Phase 1):** The `tolerance` parameter creates an execution zone, not an exact price. Plans execute when price enters the tolerance zone (entry_price ¬± tolerance). For BUY: Execute when price is at or below `entry_price + tolerance`. For SELL: Execute when price is at or above `entry_price - tolerance`. Zone entry is tracked - plan executes once when entering zone (not continuously). If price exits zone before execution, plan will retry on re-entry. **Tolerance Recommendations:** BTCUSDc: 0.1-0.3% (100-300 points) - higher volatility requires wider tolerance. XAUUSDc: 0.05-0.15% (2-7 points) - moderate volatility. Forex (EURUSD, GBPUSD, etc.): 0.02-0.05% (2-5 pips) - lower volatility. Use wider tolerance for volatile symbols or when price may bounce. Use narrower tolerance for precise entries in stable markets. üéØ **MULTI-LEVEL ENTRY SUPPORT (Phase 2):** Use `entry_levels` parameter to create plans with multiple entry levels. Execute when first level enters tolerance zone (array order priority). Each level can have custom SL/TP offsets. **When to Use:** Order block zones (multiple OB levels), liquidity sweep areas (sweep + retest), range boundaries (support + resistance), trend continuation (pullback + breakout). **Recommendations:** 2-3 levels recommended. Levels should be meaningful (not arbitrary). See 23.MULTI_LEVEL_ENTRY_STRATEGY.md for detailed guide. üéØ **CONDITIONAL CANCELLATION (Phase 3):** Plans may be auto-cancelled if: price moves >0.5% away from entry (configurable per symbol: BTCUSDc: 0.5%, XAUUSDc: 0.3%, Forex: 0.2%), market structure invalidates setup (support/resistance broken), original conditions become impossible (order block invalidated), or plan is old (>24h) and price hasn't approached entry (>0.3% away). Use `moneybot.get_auto_plan_status` to check cancellation_risk and cancellation_reasons. High risk (>0.8) indicates plan may be cancelled soon. See 24.CONDITIONAL_CANCELLATION.md for detailed guide. üéØ **PLAN RE-EVALUATION (Phase 4):** Plans are automatically re-evaluated when: price moves >0.2% (configurable), every 4 hours (time-based), key structure levels break, or volatility regime changes. Re-evaluation actions: Keep plan, update parameters, cancel and replace, create additional plan. Re-evaluation has cooldown (1 hour default) and daily limit (6 per day default). Use moneybot.re_evaluate_plan to manually trigger re-evaluation. Check last_re_evaluation, re_evaluation_count_today, and re_evaluation_available in plan status. See 25.PLAN_RE_EVALUATION.md for detailed guide. üéØ **DYNAMIC LOT SIZING:** The `volume` parameter supports automatic lot size calculation based on plan confidence. If `volume` is not specified or set to 0.01, the system automatically calculates lot size based on the number and quality of conditions: More conditions = Higher confidence = Larger lot size. Max lot sizes: BTC/XAU = 0.03, Forex = 0.05. Base lot size: 0.01 (minimum). Confidence is calculated from: structure_confirmation, CHOCH/BOS, order blocks, confluence scores, rejection patterns, etc. To override auto-calculation, explicitly set volume to desired value (> 0.01). Calculated confidence and lot size are logged in plan notes for transparency. ‚≠ê **ORDER TYPE SUPPORT (NEW):** ‚ö†Ô∏è **CRITICAL: AUTOMATIC ORDER TYPE DETECTION - ALWAYS APPLY:** Before creating a plan, ALWAYS call `moneybot.getCurrentPrice(symbol)` to get current_price. Compare entry_price with current_price and identify strategy type from conditions (breakout: bos_bull/bear, choch_bull/bear, bb_expansion, inside_bar, price_above/below, liquidity_sweep; mean reversion: vwap_deviation, range_scalp_confluence, fvg_bull/bear, order_block, price_near, rsi_div_bull/bear, rejection_wick). For BUY: If entry > current AND breakout conditions ‚Üí `{\"order_type\": \"stop\"}`. If entry < current AND mean reversion conditions ‚Üí `{\"order_type\": \"limit\"}`. For SELL: If entry < current AND breakout conditions ‚Üí `{\"order_type\": \"stop\"}`. If entry > current AND mean reversion conditions ‚Üí `{\"order_type\": \"limit\"}`. If abs(price_difference_pct) < 0.5 ‚Üí omit order_type (market order, default). User can override by explicitly mentioning \"stop order\" or \"limit order\". System validates entry price automatically before placing pending orders. Pending orders are monitored every 30 seconds and plan status updates to \"executed\" when order fills. All post-execution steps (Universal Manager, Discord, journal) trigger when order fills."
                value:
                  tool: "moneybot.create_auto_trade_plan"
                  arguments:
                    symbol: "BTCUSDc"
                    direction: "SELL"
                    entry: 113750.0
                    stop_loss: 113950.0
                    take_profit: 113250.0
                    volume: 0.01  # Optional: Auto-calculated based on confidence if not specified
                    strategy_type: "breakout_ib_volatility_trap"
                    conditions:
                      choch_bear: true
                      timeframe: "M5"
                      price_near: 113750.0
                      tolerance: 100.0
                      min_confluence: 70
                      bb_expansion: true
                      structure_confirmation: true
                      volume_confirmation: true
                      volume_ratio: 1.5
                      order_type: "market"  # Optional: "market" (default), "stop" (pending stop), "limit" (pending limit)
                    reasoning: "CHOCH Bear setup - wait for M5 structure confirmation. Min Confluence: 70, BB Expansion required, Structure Confirmation required."
              createCHOCHPlan:
                summary: Create CHOCH Auto Plan
                description: "üö® CONDITIONAL EXECUTION: Creates an auto-execution plan that WAITS for CHOCH (Change of Character) or BOS (Break of Structure) confirmation. ‚ö†Ô∏è CRITICAL: You MUST include `price_near` and `tolerance` in the `conditions` parameter! Without these, the plan will execute at ANY price when CHOCH confirms, which can break your R:R and execute in wrong liquidity zones. Always include: `conditions: {\"price_near\": entry_price, \"tolerance\": 100}` (or use get_price_tolerance for symbol-specific tolerance). ‚ö†Ô∏è ONLY use this when user explicitly says 'wait for CHOCH', 'auto-execute when CHOCH confirms', 'create CHOCH plan', or 'monitor for structure break'. DO NOT use this when user says 'place', 'execute', 'enter', 'buy now', 'scalp', or '!force:scalp' - those mean IMMEDIATE execution (use moneybot.execute_trade instead)."
                value:
                  tool: "moneybot.create_choch_plan"
                  arguments:
                    symbol: "BTCUSD"
                    direction: "SELL"
                    entry: 113750.0
                    sl: 113950.0
                    tp: 113250.0
                    volume: 0.01  # Optional: Auto-calculated based on confidence if not specified
                    conditions:
                      choch_bear: true
                      timeframe: "M5"
                      price_near: 113750.0
                      tolerance: 100.0
              createRejectionWickPlan:
                summary: Create Rejection Wick Auto Plan
                value:
                  tool: "moneybot.create_rejection_wick_plan"
                  arguments:
                    symbol: "XAUUSD"
                    direction: "BUY"
                    entry: 2650.0
                    sl: 2640.0
                    tp: 2670.0
                    volume: 0.01  # Optional: Auto-calculated based on confidence if not specified
              createOrderBlockPlan:
                summary: Create Order Block Auto-Execution Plan (M1-M5 Validated)
                description: "üö® CONDITIONAL EXECUTION: Creates an auto-execution plan that WAITS for institutional order block detection. Monitors for order blocks with comprehensive 10-parameter validation (anchor candle, displacement/structure shift, FVG, volume spike, liquidity grab, session context, HTF alignment, structural context, freshness, VWAP confluence). Only executes when a valid order block is detected with validation score >= min_validation_score (default: 60). Order blocks are primarily detected on M1 with M5 cross-timeframe validation. ‚ö†Ô∏è ONLY use this when user explicitly says 'wait for order block', 'auto-execute when order block forms', 'create order block plan', or 'monitor for order block'. DO NOT use this when user says 'place', 'execute', 'enter', 'buy now', 'scalp', or '!force:scalp' - those mean IMMEDIATE execution (use moneybot.execute_trade instead)."
                value:
                  tool: "moneybot.create_order_block_plan"
                  arguments:
                    symbol: "XAUUSDc"
                    direction: "BUY"
                    entry: 4080.0
                    stop_loss: 4070.0
                    take_profit: 4100.0
                    volume: 0.01  # Optional: Auto-calculated based on confidence if not specified
                    order_block_type: "auto"
                    min_validation_score: 60
                    expires_hours: 24
                    notes: "Order block BUY plan - wait for bullish OB with validation score >= 60 (M1-M5 validated)"
              createRangeScalpPlan:
                summary: Create Range Scalping Auto-Execution Plan (WAITS FOR CONDITIONS)
                description: "üö® CONDITIONAL EXECUTION: Creates an auto-execution plan that WAITS for conditions before executing. Monitors for confluence score >= min_confluence (default: 80 weekday, 70 weekend), structure confirmation (CHOCH/BOS) on M15, and price near entry zone. Automatically executes when all conditions are met. ‚ö†Ô∏è ONLY use this when user explicitly says 'wait for', 'auto-execute when', 'create plan', 'monitor for', or 'range scalp plan'. DO NOT use this when user says 'place', 'execute', 'enter', 'buy now', 'scalp', or '!force:scalp' - those mean IMMEDIATE execution (use moneybot.execute_trade instead). Key distinction: 'scalp' = trade type (execute immediately), 'range scalp' = strategy type (wait for conditions). üïí **WEEKEND TRADING MODE (BTCUSDc ONLY):** ‚ö†Ô∏è CRITICAL: For weekend plans (Fri 23:00 UTC ‚Üí Mon 03:00 UTC), you MUST use min_confluence: 70 as the DEFAULT (not 50, not 80). The system does NOT automatically reduce confluence to 50 - you must use 70 unless the user explicitly requests lower. This tool auto-adds `structure_confirmation: true` for range scalping strategies. For confluence-only weekend plans, use `moneybot.create_auto_trade_plan` with NON-range strategies (e.g., 'vwap_reversion', 'liquidity_sweep_reversal') instead. ‚ö†Ô∏è XAUUSDc markets are CLOSED on weekends - do NOT create XAUUSDc plans during weekends. Weekend plans expire after 24h if price not near entry."
                value:
                  tool: "moneybot.create_range_scalp_plan"
                  arguments:
                    symbol: "BTCUSDc"
                    direction: "BUY"
                    entry: 105350.0
                    stop_loss: 105100.0
                    take_profit: 106100.0
                    volume: 0.01  # Optional: Auto-calculated based on confidence if not specified
                    min_confluence: 80
                    expires_hours: 8
                    notes: "Range scalping BUY at lower boundary - wait for confluence >= 80 and M15 structure confirmation"
              createMicroScalpPlan:
                summary: Create Micro-Scalp Auto-Execution Plan (WAITS FOR CONDITIONS) ‚≠ê NEW
                description: "üö® CONDITIONAL EXECUTION: Creates a micro-scalp auto-execution plan for ultra-short-term trading. Targets small, quick moves: XAUUSD $1-2 moves (SL $0.50-$1.20, TP $1-$2.50), BTCUSD $5-$20 moves (SL $5-$10, TP $10-$25). Uses 4-layer validation system: Pre-Trade Filters (volatility, spread), Location Filter (must be at 'EDGE'), Candle Signal Checklist (primary + secondary), Confluence Score (‚â•5 to trade, ‚â•7 for A+ setup). Monitors every 10-15 seconds for fast execution. Instant exit on adverse candle (micro-interrupt). ‚ö†Ô∏è **CRITICAL: If you mention validation thresholds in your reasoning/notes (e.g., 'Confluence Threshold: ‚â• 85', 'min_confluence ‚â• 85', 'requires confluence ‚â• 85'), you MUST include them in the `conditions` dict:** * `\"min_confluence\": 85` - Minimum confluence score (0-100). If you mention 'Confluence Threshold: ‚â• 85' or 'requires confluence ‚â• 85' in reasoning, include this in conditions! * **If you don't include these in the conditions dict, they won't be saved to the database and won't appear on the webpage!** ‚ö†Ô∏è ONLY use this when user explicitly says 'wait for', 'auto-execute when', 'create micro scalp plan', 'monitor for micro scalp', or 'micro scalp plan'. DO NOT use this when user says 'place', 'execute', 'enter', 'buy now', 'scalp', or '!force:scalp' - those mean IMMEDIATE execution (use moneybot.execute_trade instead). Key distinction: 'scalp' = trade type (execute immediately), 'micro scalp' = ultra-short-term strategy (wait for micro conditions). ‚ö†Ô∏è CRITICAL: Only supports BTCUSDc and XAUUSDc symbols. ‚ö†Ô∏è BROKER-AWARE SL/TP VALIDATION: The system automatically checks broker minimum stop distance requirements and adjusts limits accordingly. Base ranges: XAUUSD SL $0.50-$1.20, TP $1.00-$2.50; BTCUSD SL $5-$10, TP $10-$25. If broker requires larger minimums (e.g., broker requires $100 minimum for BTCUSD), the system will allow broker-compatible ranges (e.g., $100-$300) while keeping micro-scalps relatively tight. Calculate SL/TP distances: SL distance = |entry_price - stop_loss|, TP distance = |take_profit - entry_price|. Error messages will indicate broker requirements if limits are adjusted."
                value:
                  tool: "moneybot.create_micro_scalp_plan"
                  arguments:
                    symbol: "XAUUSDc"
                    direction: "BUY"
                    entry_price: 2000.0
                    stop_loss: 1999.5
                    take_profit: 2001.5
                    volume: 0.01  # Optional: Auto-calculated based on confidence if not specified
                    expires_hours: 2
                    conditions:
                      min_confluence: 85
                      rejection_wick: true
                      liquidity_sweep: true
                    notes: "Micro-scalp targeting $1.50 move on gold - wait for micro conditions (wick trap, VWAP rejection, etc.). Confluence Threshold: ‚â• 85, M1 rejection wick + liquidity sweep required."
              # NOTE: Bracket trades are deprecated. Use create_multiple_auto_plans to create two independent plans instead.
              cancelAutoPlan:
                summary: Cancel Auto Plan
                value:
                  tool: "moneybot.cancel_auto_plan"
                  arguments:
                    plan_id: "auto_plan_123456"
              updateAutoPlan:
                summary: Update Auto Execution Plan
                description: "üö® REQUIRES plan_id: Update an existing auto-execution trade plan. ‚ö†Ô∏è CRITICAL: plan_id is MANDATORY - you MUST include the plan_id (e.g., 'chatgpt_0ea79233') when calling this tool. If you don't have the plan_id, first use moneybot.get_auto_plan_status to list all plans and find the correct plan_id. Only pending plans can be updated. Use this when market conditions change and you need to adjust entry prices, stop loss, take profit, conditions, or expiration. You can update any combination of: entry_price, stop_loss, take_profit, volume, conditions (merge with existing), expires_hours, notes. When updating conditions, new conditions are merged with existing ones (new values override old ones). ‚ö†Ô∏è Only pending plans can be updated - executed, cancelled, or expired plans cannot be modified."
                value:
                  tool: "moneybot.update_auto_plan"
                  arguments:
                    plan_id: "chatgpt_0ea79233"
                    entry_price: 84000.0
                    stop_loss: 84200.0
                    take_profit: 83500.0
                    conditions:
                      price_near: 84000.0
                      tolerance: 100.0
                    notes: "Updated plan based on new market analysis"
              getAutoPlanStatus:
                summary: Get Auto Plan Status (by plan_id or ticket number)
                description: "Get status of an auto-execution trade plan. You can query by plan_id (e.g., 'chatgpt_0ea79233') OR by ticket number (MT5 position ticket, e.g., 169674998). If user provides ticket numbers from MT5, use the ticket parameter to look up the corresponding auto-execution plan. Returns plan details including entry_price, stop_loss, take_profit, conditions, status, and execution information. üéØ **CONDITIONAL CANCELLATION (Phase 3):** Response includes cancellation_risk (0-1), cancellation_reasons (array), cancellation_priority (high/medium/low), and cancellation_reason (if cancelled). High risk (>0.8) indicates plan may be cancelled soon. Check cancellation_reasons to understand why. Plans may be auto-cancelled if: price moves >threshold% away from entry, market structure invalidates setup, original conditions become impossible, or plan is old (>24h) and price hasn't approached entry. üéØ **PLAN RE-EVALUATION (Phase 4):** Response includes last_re_evaluation (timestamp), re_evaluation_count_today (integer), re_evaluation_cooldown_remaining (seconds), and re_evaluation_available (boolean). Plans are automatically re-evaluated when: price moves >0.2% (configurable), every 4 hours (time-based), key structure levels break, or volatility regime changes. Re-evaluation has cooldown (1 hour default) and daily limit (6 per day default). Use moneybot.re_evaluate_plan to manually trigger re-evaluation."
                value:
                  tool: "moneybot.get_auto_plan_status"
                  arguments:
                    plan_id: "auto_plan_123456"
                    # OR use ticket parameter:
                    # ticket: 169674998
              getAutoSystemStatus:
                summary: Get Auto System Status
                value:
                  tool: "moneybot.get_auto_system_status"
                  arguments: {}
              reviewClosedTrade:
                summary: Review Closed Trade with Plan Context ‚≠ê NEW
                description: "Review a closed trade with its originating auto-execution plan details. Use when user asks to review a specific trade ticket or wants to see what plan created a trade. Returns complete trade details (entry, exit, P/L, duration) along with the original plan that created it (conditions, strategy, notes). This allows ChatGPT to analyze trade outcomes in context of the original plan setup. ‚ö†Ô∏è Requires ticket number (MT5 position ticket). If trade was not created by an auto-execution plan, plan details will be null."
                value:
                  tool: "moneybot.reviewClosedTrade"
                  arguments:
                    ticket: 123456789
              syncPlanTrades:
                summary: Sync Closed Trades to Plan Effectiveness ‚≠ê NEW
                description: "Sync closed trades from journal database to plan effectiveness tracker. Updates plan database with trade outcomes (profit_loss, exit_price, close_time, close_reason) for executed plans. Use this periodically to ensure plan effectiveness reports are up-to-date. Returns sync statistics (how many plans were updated). ‚ö†Ô∏è This is a maintenance operation - typically run automatically or on-demand when reviewing plan performance."
                value:
                  tool: "moneybot.syncPlanTrades"
                  arguments:
                    days_back: 30
              getRecentTrades:
                summary: Get Recent Trades ‚≠ê NEW
                description: "Get recent trades with their plan details. Use when user asks 'what trades executed today', 'show me my recent trades', 'trades from today', 'what trades closed today', 'show trades from last X days', etc. ‚ö†Ô∏è IMPORTANT: 'executed today' = trades that were OPENED today (set by_execution_date=true). 'closed today' = trades that were CLOSED today (by_execution_date=false, default). Returns list of trades with entry/exit prices, P/L, open/close times, and original plan details (if available). Can filter by symbol. Default is last 1 day (today)."
                value:
                  tool: "moneybot.getRecentTrades"
                  arguments:
                    days_back: 1
                    symbol: null
                    by_execution_date: false
              createMultipleAutoPlans:
                summary: Create Multiple Auto-Execution Plans (Batch Operation) ‚≠ê NEW
                description: |
                  üö® BATCH OPERATION: Create multiple auto-execution trade plans in a single operation.
                  
                  Use this when user requests multiple plans (e.g., 'create 3 buy plans', 'give me plans for different strategies', 'create buy and sell plans'). This reduces permission prompts and improves efficiency compared to calling individual create tools multiple times.
                  
                  ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL SYMBOL FIELD REQUIREMENT:
                  - üö® MANDATORY: Each plan object MUST include 'symbol' field (e.g., symbol: 'BTCUSDc')
                  - ‚úÖ CORRECT: Every plan in the 'plans' array must have its own 'symbol' field
                  - ‚ùå WRONG: Omitting 'symbol' from individual plans (even if top-level 'symbols' exists)
                  - Top-level 'symbols' field is optional and can be used for convenience, but it does NOT replace the requirement for 'symbol' in each plan
                  - Example: { symbols: 'BTCUSDc', plans: [{ plan_type: 'auto_trade', symbol: 'BTCUSDc', ... }, { plan_type: 'choch', symbol: 'BTCUSDc', ... }] }
                  
                  ‚ö†Ô∏è CRITICAL: plan_type vs strategy_type - These are DIFFERENT! DO NOT confuse them!
                  
                  **plan_type** (REQUIRED in each plan): Determines which API method to call. Must be EXACTLY one of these 6 values:
                  - 'auto_trade' ‚Üí Generic auto-execution plan (use for most strategies)
                  - 'choch' ‚Üí Change of Character (CHOCH) plan
                  - 'rejection_wick' ‚Üí Rejection wick/pin bar plan
                  - 'order_block' ‚Üí Order block plan (also use for breaker blocks!)
                  - 'range_scalp' ‚Üí Range scalping plan (VWAP reversion)
                  - 'micro_scalp' ‚Üí Micro-scalping plan (ultra-short-term, BTC/XAU only)
                  
                  **strategy_type** (OPTIONAL in each plan): Stored in conditions, used by Universal Dynamic SL/TP Manager. Examples: 'mean_reversion_range_scalp', 'liquidity_sweep_reversal', 'order_block_rejection', 'breaker_block', etc.
                  
                  üö® **COMMON MISTAKES - DO NOT DO THIS:**
                  - ‚ùå WRONG: plan_type: 'mean_reversion_range_scalp' ‚Üí ‚úÖ CORRECT: plan_type: 'range_scalp', strategy_type: 'mean_reversion_range_scalp'
                  - ‚ùå WRONG: plan_type: 'liquidity_sweep_reversal' ‚Üí ‚úÖ CORRECT: plan_type: 'rejection_wick', strategy_type: 'liquidity_sweep_reversal'
                  - ‚ùå WRONG: plan_type: 'liquidity_sweep' ‚Üí ‚úÖ CORRECT: plan_type: 'rejection_wick', strategy_type: 'liquidity_sweep_reversal'
                  - ‚ùå WRONG: plan_type: 'order_block_rejection' ‚Üí ‚úÖ CORRECT: plan_type: 'order_block', strategy_type: 'order_block_rejection'
                  - ‚ùå WRONG: plan_type: 'breaker_block' ‚Üí ‚úÖ CORRECT: plan_type: 'order_block', strategy_type: 'breaker_block'
                  - ‚ùå WRONG: plan_type: 'premium_discount_array' ‚Üí ‚úÖ CORRECT: plan_type: 'micro_scalp', strategy_type: 'premium_discount_array'
                  
                  **Correct Mapping Examples:**
                  - Range Scalp / VWAP Reversion ‚Üí plan_type: 'range_scalp', strategy_type: 'mean_reversion_range_scalp'
                  - Liquidity Sweep + Rejection ‚Üí plan_type: 'rejection_wick', strategy_type: 'liquidity_sweep_reversal'
                  - Order Block Rejection ‚Üí plan_type: 'order_block', strategy_type: 'order_block_rejection'
                  - Breaker Block ‚Üí plan_type: 'order_block', strategy_type: 'breaker_block' (‚ö†Ô∏è NOT plan_type: 'breaker_block')
                  - Premium/Discount Array ‚Üí plan_type: 'micro_scalp', strategy_type: 'premium_discount_array'
                  
                  Supports partial success - valid plans are created even if some plans fail validation. Returns detailed results per plan with success/failure status.
                  
                  ‚ö†Ô∏è NOTE: For bracket-style trades (BUY and SELL plans), create two independent plans (one BUY, one SELL) with different conditions instead of using deprecated bracket trade tools. Each plan monitors independently - if one executes, the other can still execute later if its conditions are met.
                  
                  ‚ö†Ô∏è SYMBOL: You can provide symbol in each plan OR use top-level 'symbols' field (single symbol for all plans). ‚ö†Ô∏è CRITICAL: Use 'symbols' (PLURAL) at top level, NOT 'symbol' (singular). If using top-level 'symbols', you can omit symbol from individual plans.
                  
                  ‚ö†Ô∏è PARAMETER NAMES: Use 'entry' OR 'entry_price' (both accepted).
                  
                  ‚ö†Ô∏è DO NOT include 'plan_type' at the top level - it belongs ONLY inside each plan object in the 'plans' array.
                  
                  **üìã PLAN PORTFOLIO STRATEGY:**
                  When creating multiple plans, aim for diversity:
                  
                  - 3-5 total plans (if dual plans are created, this may result in 4-6 total plans)
                  - Mix condition-based (OB, breaker block, liquidity sweep) with confluence-only (range scalp, mean reversion)
                  - Include both BUY and SELL plans when market structure supports both directions
                  - Use different entry levels to maximize execution probability
                  - Apply strategy filters based on volatility regime, symbol, and session
                  
                  **üîÑ DUAL PLAN INTEGRATION:**
                  IMPORTANT: When any plan in your portfolio requires retracement (entry > current for SELL, or entry < current for BUY):
                  
                  - Check minimum separation threshold before creating dual plan:
                    * SELL: entry_price - current_price > minimum_distance (50 pts BTC, 10 pts XAU, 0.0003 forex)
                    * BUY: current_price - entry_price > minimum_distance (same values)
                  - If separation is sufficient, automatically add a continuation plan to the same batch
                  - Count this as part of your 3-5 plan portfolio (e.g., if you create 3 plans and 1 requires retracement, you'll have 4 total plans)
                  - If multiple plans require retracement, prioritize dual plans for highest-quality setups (OB rejection, CHOCH confirmation)
                  - Maximum total plans: 7-8 (acceptable for maximum coverage)
                  - Both plans use the same direction but different entry zones
                  - This maximizes execution probability for retracement-based strategies
                  
                  **üìä ENTRY PRICE CALCULATION FOR CONTINUATION PLAN:**
                  For SELL continuation:
                  - Primary: Entry = current_price - (retracement_entry - current_price) * 0.5
                  - Example: Current=88,840, Retracement=88,975 ‚Üí Continuation=88,800
                  - Alternative (if calculated entry too close): current_price - (ATR * 0.5) for dynamic calculation
                    * ATR source: Extract from response.data.advanced.volatility.atr if available
                    * ATR fallback: Use symbol defaults (BTC=100-200 pts, XAU=10-20 pts, Forex=0.001-0.002)
                    * ATR alternative: Use get_price_tolerance(symbol) * 2 as ATR estimate
                  - Validation: Ensure entry is meaningfully below current price:
                    * BTC: Minimum 50 pts below current (prefer 50-100 pts)
                    * XAU: Minimum 10 pts below current (prefer 10-15 pts)
                    * Forex: Minimum 0.0003 below current (prefer 0.0003-0.0005)
                  - If calculated entry is too close, use ATR-based calculation instead
                  - **Additional validation**: Entry must be positive, non-zero, and reasonable for symbol type
                  
                  For BUY continuation:
                  - Primary: Entry = current_price + (current_price - retracement_entry) * 0.5
                  - Example: Current=88,840, Retracement=88,700 ‚Üí Continuation=88,900
                  - Alternative (if calculated entry too close): current_price + (ATR * 0.5) for dynamic calculation
                    * ATR source: Extract from response.data.advanced.volatility.atr if available
                    * ATR fallback: Use symbol defaults (BTC=100-200 pts, XAU=10-20 pts, Forex=0.001-0.002)
                    * ATR alternative: Use get_price_tolerance(symbol) * 2 as ATR estimate
                  - Validation: Ensure entry is meaningfully above current price (same minimums as above)
                  - If calculated entry is too close, use ATR-based calculation instead
                  - **Additional validation**: Entry must be positive, non-zero, and reasonable for symbol type
                  
                  **üõ°Ô∏è STOP LOSS LOGIC FOR CONTINUATION PLANS:**
                  Continuation Plan SL (symbol-specific):
                  - SELL: SL = retracement_entry + buffer
                    * BTC: 50-100 pts buffer (e.g., retracement_entry + 75 pts)
                    * XAU: 5-10 pts buffer (e.g., retracement_entry + 7 pts)
                    * Forex: 0.0001-0.0003 buffer (e.g., retracement_entry + 0.0002)
                  - BUY: SL = retracement_entry - buffer (same values as above)
                  - Rationale: If price retraces to retracement entry, continuation plan is invalidated
                  - This ensures both plans don't conflict - if retracement triggers, continuation SL is above/below that level
                  - Both plans can execute independently - they represent different market paths (retracement vs continuation)
                  
                  **üéØ TAKE PROFIT LOGIC FOR CONTINUATION PLANS:**
                  Continuation Plan TP:
                  - Use extended targets (range extension, structure levels, swing points)
                  - Typically 1.5-2x the retracement plan's R:R ratio
                  - Example: Retracement R:R = 1:2 ‚Üí Continuation R:R = 1:3
                  - Consider structure levels from analysis (response.data.structure_summary)
                value:
                  tool: "moneybot.create_multiple_auto_plans"
                  arguments:
                    symbols: "BTCUSDc"
                    plans:
                      - plan_type: "range_scalp"
                        symbol: "BTCUSDc"
                        direction: "BUY"
                        entry: 50000.0
                        stop_loss: 49500.0
                        take_profit: 51000.0
                        volume: 0.01
                        strategy_type: "mean_reversion_range_scalp"
                        min_confluence: 75
                        expires_hours: 8
                        notes: "Range scalp plan"
                      - plan_type: "rejection_wick"
                        symbol: "BTCUSDc"
                        direction: "BUY"
                        entry: 49800.0
                        stop_loss: 49650.0
                        take_profit: 50200.0
                        volume: 0.01
                        strategy_type: "liquidity_sweep_reversal"
                        expires_hours: 24
                        notes: "Liquidity sweep + rejection wick"
                      - plan_type: "order_block"
                        symbol: "BTCUSDc"
                        direction: "SELL"
                        entry: 50250.0
                        stop_loss: 50450.0
                        take_profit: 49750.0
                        volume: 0.01
                        strategy_type: "breaker_block"
                        order_block_type: "bear"
                        expires_hours: 24
                        notes: "Breaker block plan"
                  # ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL: Each plan MUST include 'symbol' field. Top-level 'symbols' is optional but does NOT replace the requirement for 'symbol' in each plan.
                  # ‚ö†Ô∏è NOTE: Use 'entry' OR 'entry_price' (both accepted)
                  # ‚ö†Ô∏è CRITICAL: plan_type must be one of: 'auto_trade', 'choch', 'rejection_wick', 'order_block', 'range_scalp', 'micro_scalp'
                  # ‚ö†Ô∏è DO NOT use strategy_type values as plan_type (e.g., plan_type: 'mean_reversion_range_scalp' is WRONG)
              updateMultipleAutoPlans:
                summary: Update Multiple Auto-Execution Plans (Batch Operation) ‚≠ê NEW
                description: "üö® BATCH OPERATION: Update multiple auto-execution trade plans in a single operation. Use this when user requests to update multiple plans (e.g., 'update all my BTC plans', 'update plans 1, 2, and 3'). This reduces permission prompts and improves efficiency. Each update must include `plan_id` and at least one update field (entry_price, stop_loss, take_profit, volume, conditions, expires_hours, or notes). Supports partial success - valid updates are processed even if some updates fail. Duplicate plan_ids are automatically deduplicated (keeps last update). Returns detailed results per plan with success/failure status. ‚ö†Ô∏è Only pending plans can be updated - executed, cancelled, or expired plans cannot be modified."
                value:
                  tool: "moneybot.update_multiple_auto_plans"
                  arguments:
                    updates:
                      - plan_id: "chatgpt_abc123"
                        entry_price: 50100.0
                        stop_loss: 49600.0
                      - plan_id: "chatgpt_def456"
                        expires_hours: 48
                        notes: "Extended expiration"
              cancelMultipleAutoPlans:
                summary: Cancel Multiple Auto-Execution Plans (Batch Operation) ‚≠ê NEW
                description: "üö® BATCH OPERATION: Cancel multiple auto-execution trade plans in a single operation. Use this when user requests to cancel multiple plans (e.g., 'cancel all my plans', 'cancel plans 1, 2, and 3'). This reduces permission prompts and improves efficiency. Provides idempotent behavior - cancelling already-cancelled or non-existent plans returns success (no error). Duplicate plan_ids are automatically deduplicated. Returns detailed results per plan with success/failure status."
                value:
                  tool: "moneybot.cancel_multiple_auto_plans"
                  arguments:
                    plan_ids:
                      - "chatgpt_abc123"
                      - "chatgpt_def456"
                      - "chatgpt_ghi789"
              getDTMSStatus:
                summary: Get DTMS System Status
                value:
                  tool: "moneybot.dtms_status"
                  arguments: {}
              getDTMSTradeInfo:
                summary: Get DTMS Trade Information
                value:
                  tool: "moneybot.dtms_trade_info"
                  arguments:
                    ticket: 123456
              getDTMSActionHistory:
                summary: Get DTMS Action History
                value:
                  tool: "moneybot.dtms_action_history"
                  arguments: {}
      responses:
        '200':
          description: Command result from desktop agent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PhoneControlResponse'
        '401':
          description: Unauthorized - Invalid bearer token
        '408':
          description: Timeout - Desktop agent did not respond
        '503':
          description: Desktop agent not connected

  # CORE TRADING ENDPOINTS (8 operations)
  /mt5/execute:
    post:
      operationId: executeTrade
      summary: Execute trade directly in MT5
      description: "Execute trade in MT5 (bypasses Telegram). üïí WEEKEND MODE (BTCUSDc only, Fri 23:00-Mon 03:00 UTC): Auto-applies weekend exits (25% BE, 50% partial, 1.2x trailing). ‚ö†Ô∏è XAUUSDc CLOSED weekends. Weekend trades auto-transition to weekday params when weekend ends."
      tags:
        - Trading
      security:
        - BearerAuth: []
      parameters:
        - name: Idempotency-Key
          in: header
          required: false
          schema:
            type: string
          description: "Provide a unique key to make this request idempotent for 10 minutes. Repeated requests with the same key return the first successful response."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TradeSignal'
      responses:
        '200':
          description: Trade executed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResponse'
        '401':
          description: Unauthorized
        '422':
          description: Validation error

  /mt5/modify_position:
    post:
      operationId: modifyPosition
      summary: Modify existing position's stop loss and/or take profit
      description: Modify an existing MT5 position's SL/TP. Use for adjusting stops on open trades (tighten, move to breakeven, lock profits). Do NOT use for new trades - use /mt5/execute instead.
      tags:
        - Trading
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - ticket
              properties:
                ticket:
                  type: integer
                  description: MT5 position ticket number (get from /api/v1/positions)
                  example: 1174801164
                symbol:
                  type: string
                  description: Symbol (optional, for validation)
                  example: "BTCUSD"
                stop_loss:
                  type: number
                  description: New stop loss level (optional)
                  example: 123500.0
                take_profit:
                  type: number
                  description: New take profit level (optional)
                  example: 124500.0
      responses:
        '200':
          description: Position modified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Position modified successfully"
                  ticket:
                    type: integer
                    example: 1174801164
                  new_sl:
                    type: number
                    example: 123500.0
                  new_tp:
                    type: number
                    example: 124500.0
        '400':
          description: Bad request or MT5 error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Position not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /mt5/enable_intelligent_exits:
    post:
      operationId: enableIntelligentExits
      summary: Enable Advanced-enhanced intelligent exit management for a position
      description: |
        Advanced exits AUTO-ENABLE! Manual override only. Advanced feature system adapts triggers 20-80% (std 30/60) via 7 factors: RMAG, trend quality, momentum, liquidity, volatility, MTF, VWAP. Tightens for risk, widens for quality. Hybrid ATR+VIX + trailing. Works any trade size!
      tags:
        - Trading
      parameters:
        - name: ticket
          in: query
          required: true
          schema:
            type: integer
          description: MT5 position ticket number
          example: 120828675
        - name: symbol
          in: query
          required: true
          schema:
            type: string
          description: Trading symbol
          example: "XAUUSD"
        - name: entry_price
          in: query
          required: true
          schema:
            type: number
          description: Entry price of the position
          example: 3950.0
        - name: direction
          in: query
          required: true
          schema:
            type: string
            enum: ["buy", "sell"]
          description: Trade direction
          example: "buy"
        - name: initial_sl
          in: query
          required: true
          schema:
            type: number
          description: Initial stop loss level
          example: 3944.0
        - name: initial_tp
          in: query
          required: true
          schema:
            type: number
          description: Initial take profit level
          example: 3965.0
        - name: breakeven_profit_pct
          in: query
          required: false
          schema:
            type: number
            default: 30.0
          description: Percentage of potential profit to trigger breakeven (30% = 0.3R, works for any trade size)
          example: 30.0
        - name: partial_profit_pct
          in: query
          required: false
          schema:
            type: number
            default: 60.0
          description: Percentage of potential profit to trigger partial close (60% = 0.6R, auto-skipped if volume < 0.02)
          example: 60.0
        - name: partial_close_pct
          in: query
          required: false
          schema:
            type: number
            default: 50.0
          description: Percentage to close at partial level
          example: 50.0
        - name: vix_threshold
          in: query
          required: false
          schema:
            type: number
            default: 18.0
          description: VIX level to trigger SL widening
          example: 18.0
        - name: vix_multiplier
          in: query
          required: false
          schema:
            type: number
            default: 1.5
          description: SL distance multiplier when VIX spikes (legacy, use hybrid instead)
          example: 1.5
        - name: use_hybrid_stops
          in: query
          required: false
          schema:
            type: boolean
            default: true
          description: Use Hybrid ATR+VIX stop adjustment (recommended). Combines symbol ATR with VIX for intelligent stop widening
          example: true
        - name: trailing_enabled
          in: query
          required: false
          schema:
            type: boolean
            default: true
          description: Enable continuous ATR trailing stops after breakeven (runs every 30 sec, follows price movement)
          example: true
      responses:
        '200':
          description: Intelligent exits enabled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  message:
                    type: string
                  ticket:
                    type: integer
                  symbol:
                    type: string
                  rules:
                    type: object
                    properties:
                      breakeven_profit:
                        type: string
                      partial_profit_level:
                        type: string
                      partial_close_pct:
                        type: string
                      vix_threshold:
                        type: number
                      vix_multiplier:
                        type: number
        '400':
          description: Invalid parameters
        '500':
          description: Server error

  /mt5/disable_intelligent_exits/{ticket}:
    delete:
      operationId: disableIntelligentExits
      summary: Disable intelligent exit management for a position
      description: Remove automated exit management rules for a specific position ticket
      tags:
        - Trading
      parameters:
        - name: ticket
          in: path
          required: true
          schema:
            type: integer
          description: MT5 position ticket number
          example: 120828675
      responses:
        '200':
          description: Intelligent exits disabled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  message:
                    type: string
        '404':
          description: No exit rule found for this ticket
        '500':
          description: Server error

  /mt5/intelligent_exits/status:
    get:
      operationId: getIntelligentExitsStatus
      summary: Get status of all Advanced-enhanced intelligent exit rules
      description: Returns all active Advanced-enhanced intelligent exit management rules with their status (breakeven triggered, partial triggered, Advanced-adjusted trigger levels, Advanced factors applied, reasoning)
      tags:
        - Trading
      responses:
        '200':
          description: Status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  count:
                    type: integer
                  rules:
                    type: array
                    items:
                      type: object
                      properties:
                        ticket:
                          type: integer
                        symbol:
                          type: string
                        direction:
                          type: string
                        entry_price:
                          type: number
                        breakeven_triggered:
                          type: boolean
                        partial_triggered:
                          type: boolean
                        vix_adjustment_active:
                          type: boolean
                        breakeven_pct:
                          type: number
                          description: Advanced-adjusted breakeven trigger percentage (20-30%)
                        partial_pct:
                          type: number
                          description: Advanced-adjusted partial profit trigger percentage (40-80%)
                        partial_close_pct:
                          type: number
                          description: Percentage of position to close at partial trigger (typically 50%)
                        actions_taken:
                          type: array
                          items:
                            type: object
                        created_at:
                          type: string
                        last_check:
                          type: string
        '500':
          description: Server error

  /mt5/intelligent_exits/history/{ticket}:
    get:
      operationId: getIntelligentExitsHistory
      summary: Get historical intelligent exit actions for a position
      description: Get all logged actions (breakeven, partial profits, trailing stops, etc.) for a specific position ticket from the database
      tags:
        - Trading
      parameters:
        - name: ticket
          in: path
          required: true
          schema:
            type: integer
          description: MT5 position ticket number
      responses:
        '200':
          description: History retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  ticket:
                    type: integer
                  count:
                    type: integer
                  actions:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        timestamp:
                          type: integer
                        action_type:
                          type: string
                        old_sl:
                          type: number
                        new_sl:
                          type: number
                        volume_closed:
                          type: number
                        profit_realized:
                          type: number
                        profit_pct:
                          type: number
                        r_achieved:
                          type: number
                        atr_value:
                          type: number
                        vix_value:
                          type: number
                        success:
                          type: integer
        '500':
          description: Server error

  /mt5/intelligent_exits/recent:
    get:
      operationId: getRecentIntelligentExits
      summary: Get recent intelligent exit actions
      description: Get all intelligent exit actions within a time window, optionally filtered by action type or symbol
      tags:
        - Trading
      parameters:
        - name: hours
          in: query
          required: false
          schema:
            type: integer
            default: 24
          description: Hours to look back
        - name: action_type
          in: query
          required: false
          schema:
            type: string
            enum: [breakeven, partial_profit, trailing_stop, hybrid_adjustment, rule_added, rule_removed]
          description: Filter by specific action type
        - name: symbol
          in: query
          required: false
          schema:
            type: string
          description: Filter by symbol
      responses:
        '200':
          description: Recent actions retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  hours:
                    type: integer
                  action_type:
                    type: string
                  symbol:
                    type: string
                  count:
                    type: integer
                  actions:
                    type: array
                    items:
                      type: object
        '500':
          description: Server error

  /mt5/intelligent_exits/statistics:
    get:
      operationId: getIntelligentExitsStatistics
      summary: Get intelligent exit performance statistics
      description: Get comprehensive statistics on intelligent exit actions including win rate, average R achieved, total profit from partials, success rate, etc.
      tags:
        - Trading
      parameters:
        - name: symbol
          in: query
          required: false
          schema:
            type: string
          description: Filter by symbol (optional)
        - name: days
          in: query
          required: false
          schema:
            type: integer
            default: 30
          description: Number of days to analyze
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  period_days:
                    type: integer
                  symbol:
                    type: string
                  total_actions:
                    type: integer
                  action_counts:
                    type: object
                    description: Count of each action type
                  breakeven:
                    type: object
                    properties:
                      count:
                        type: integer
                      avg_r_achieved:
                        type: number
                  partial_profits:
                    type: object
                    properties:
                      count:
                        type: integer
                      avg_profit_pct:
                        type: number
                      total_profit_realized:
                        type: number
                  trailing_stops:
                    type: object
                    properties:
                      count:
                        type: integer
                      total_adjustments:
                        type: integer
                      avg_adjustment:
                        type: number
                  success_rate:
                    type: number
                    description: Percentage of successful actions
        '500':
          description: Server error

  /mt5/execute_bracket:
    post:
      operationId: executeBracketTrade
      summary: Execute OCO bracket trade
      description: Execute a bracket trade (two pending orders at range edges) with automatic OCO cancellation. When one order fills, the other is automatically cancelled within 3 seconds.
      tags:
        - Trading
      parameters:
        - name: Idempotency-Key
          in: header
          required: false
          schema:
            type: string
          description: "Provide a unique key to make this request idempotent for 10 minutes. Repeated requests with the same key return the first successful response."
        - name: symbol
          in: query
          required: true
          schema:
            type: string
          example: "XAUUSD"
        - name: buy_entry
          in: query
          required: true
          schema:
            type: number
          description: Entry price for BUY order
        - name: buy_sl
          in: query
          required: true
          schema:
            type: number
          description: Stop loss for BUY order
        - name: buy_tp
          in: query
          required: true
          schema:
            type: number
          description: Take profit for BUY order
        - name: sell_entry
          in: query
          required: true
          schema:
            type: number
          description: Entry price for SELL order
        - name: sell_sl
          in: query
          required: true
          schema:
            type: number
          description: Stop loss for SELL order
        - name: sell_tp
          in: query
          required: true
          schema:
            type: number
          description: Take profit for SELL order
        - name: reasoning
          in: query
          required: false
          schema:
            type: string
          description: Reasoning for the bracket trade
      responses:
        '200':
          description: Bracket trade executed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BracketTradeResponse'
        '400':
          description: Invalid parameters or order failed

  /api/v1/orders:
    get:
      operationId: getPendingOrders
      summary: Get all pending orders
      description: Retrieve all pending orders (buy_limit, sell_limit, buy_stop, sell_stop) with their ticket numbers, entry prices, SL, and TP. Use this to analyze and re-evaluate existing pending orders.
      tags:
        - Trading
      responses:
        '200':
          description: List of pending orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  orders:
                    type: array
                    items:
                      type: object
                      properties:
                        ticket:
                          type: integer
                          description: Order ticket number
                          example: 117491393
                        symbol:
                          type: string
                          description: Trading symbol
                          example: "nzdjpyc"
                        type:
                          type: string
                          description: Order type
                          enum: ["buy_limit", "sell_limit", "buy_stop", "sell_stop"]
                          example: "sell_stop"
                        volume:
                          type: number
                          description: Order volume in lots
                          example: 0.01
                        price_open:
                          type: number
                          description: Entry price
                          example: 87.300
                        sl:
                          type: number
                          description: Stop loss price
                          example: 87.500
                        tp:
                          type: number
                          description: Take profit price
                          example: 87.000
                        price_current:
                          type: number
                          description: Current market price
                          example: 87.381
                        comment:
                          type: string
                          description: Order comment
                          example: ""
                        time_setup:
                          type: integer
                          description: Order creation timestamp
                          example: 1728201586
                        time_expiration:
                          type: integer
                          description: Order expiration timestamp (0 if GTC)
                          example: 0
                  count:
                    type: integer
                    description: Total number of pending orders
                    example: 4
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /mt5/modify_order:
    post:
      operationId: modifyPendingOrder
      summary: Modify existing pending order's entry price, SL, and/or TP
      description: Modify an existing pending order's entry price, stop loss, and/or take profit. Use when user says 'adjust my pending order', 'update my limit order', 're-analyze my orders', 'move my entry'. First call /api/v1/orders to see all orders, then modify as needed.
      tags:
        - Trading
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - ticket
              properties:
                ticket:
                  type: integer
                  description: MT5 order ticket number (get from /api/v1/orders)
                  example: 117491393
                price:
                  type: number
                  description: New entry price level (optional)
                  example: 87.250
                stop_loss:
                  type: number
                  description: New stop loss level (optional)
                  example: 87.450
                take_profit:
                  type: number
                  description: New take profit level (optional)
                  example: 87.000
      responses:
        '200':
          description: Pending order modified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Pending order modified successfully"
                  ticket:
                    type: integer
                    example: 117491393
                  new_price:
                    type: number
                    example: 87.250
                  new_sl:
                    type: number
                    example: 87.450
                  new_tp:
                    type: number
                    example: 87.000
        '400':
          description: Bad request or MT5 error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Pending order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/positions:
    get:
      operationId: getPositions
      summary: Get all open positions
      description: Retrieve all open MT5 positions with their details
      tags:
        - Trading
      responses:
        '200':
          description: List of open positions
          content:
            application/json:
              schema:
                type: object
                properties:
                  positions:
                    type: array
                    items:
                      type: object
                      properties:
                        ticket:
                          type: integer
                          description: Position ticket number
                        symbol:
                          type: string
                          description: Trading symbol
                        type:
                          type: string
                          description: Position type (BUY/SELL)
                        volume:
                          type: number
                          description: Position volume
                        price_open:
                          type: number
                          description: Entry price
                        price_current:
                          type: number
                          description: Current price
                        profit:
                          type: number
                          description: Current profit/loss
                        sl:
                          type: number
                          description: Stop loss
                        tp:
                          type: number
                          description: Take profit
                  count:
                    type: integer
                    description: Total number of positions
        '500':
          description: Server error

  /api/v1/positions/history:
    get:
      operationId: getPositionsHistory
      summary: Get trade history from journal
      description: Retrieve closed trade history from the journal database with profit/loss details
      tags:
        - Trading
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Maximum number of trades to return (default 20)
      responses:
        '200':
          description: Trade history
          content:
            application/json:
              schema:
                type: object
                properties:
                  trades:
                    type: array
                    items:
                      type: object
                      properties:
                        ticket:
                          type: integer
                          description: Trade ticket number
                        symbol:
                          type: string
                          description: Trading symbol
                        profit:
                          type: number
                          description: Current profit/loss (0 for open trades)
                        side:
                          type: string
                          description: Trade direction (BUY/SELL)
                        entry_price:
                          type: number
                          description: Entry price
                        exit_price:
                          type: number
                          description: Exit price (null for open trades)
                          nullable: true
                        r_multiple:
                          type: number
                          description: Risk-reward multiple (null for open trades)
                          nullable: true
                        duration_sec:
                          type: integer
                          description: Trade duration in seconds (null for open trades)
                          nullable: true
                        timestamp:
                          type: string
                          description: Trade timestamp
                        sl:
                          type: number
                          description: Stop loss level
                        tp:
                          type: number
                          description: Take profit level
                        lot:
                          type: number
                          description: Position size
        '500':
          description: Server error

  /api/v1/account:
    get:
      operationId: getAccountInfo
      summary: Get MT5 account information
      description: Get current account balance, equity, margin, and login info
      tags:
        - Account
      responses:
        '200':
          description: Account information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountInfo'
        '500':
          description: MT5 service error

  /api/v1/price/{symbol}:
    get:
      operationId: getCurrentPrice
      summary: Get price (MT5 or Yahoo Finance for DXY/VIX/US10Y)
      description: "Get price for symbol. MT5: XAUUSD, BTCUSD. Yahoo: DXY, VIX, US10Y. For Gold: Check DXY + US10Y. Rising DXY + Rising US10Y = Bearish Gold. Falling DXY + Falling US10Y = Bullish Gold. Always fetch all 3 indices for Gold analysis."
      tags:
        - Market Data
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: "XAUUSD"
          description: |
            Symbol name:
            - Broker symbols: XAUUSD, BTCUSD, EURUSD (auto-adds 'c' suffix)
            - Market indices: DXY, VIX (fetched from Yahoo Finance)
      responses:
        '200':
          description: Current price (from broker or Yahoo Finance)
          content:
            application/json:
              schema:
                type: object
                properties:
                  symbol:
                    type: string
                    example: "XAUUSDc"
                    description: Symbol name
                  bid:
                    type: number
                    example: 3851.5
                    description: Bid price
                  ask:
                    type: number
                    example: 3852.0
                    description: Ask price
                  mid:
                    type: number
                    example: 3851.75
                    description: Mid price (average of bid/ask)
                  spread:
                    type: number
                    example: 0.5
                    description: Spread (ask - bid), 0 for indices
                  timestamp:
                    type: string
                    format: date-time
                    description: Price timestamp
                  digits:
                    type: integer
                    example: 2
                    description: Decimal precision
                  source:
                    type: string
                    example: "Yahoo Finance (DX-Y.NYB)"
                    description: Data source (only present for indices)
                  note:
                    type: string
                    example: "Real DXY from Yahoo Finance - broker doesn't provide DXY"
                    description: Additional context (only present for indices)
              examples:
                brokerSymbol:
                  summary: Broker Symbol (Gold)
                  value:
                    symbol: "XAUUSDc"
                    bid: 3851.5
                    ask: 3852.0
                    mid: 3851.75
                    spread: 0.5
                    timestamp: "2025-10-09T20:40:00Z"
                    digits: 2
                dxyIndex:
                  summary: DXY Index (Yahoo Finance)
                  value:
                    symbol: "DXY"
                    bid: 99.428
                    ask: 99.428
                    mid: 99.428
                    spread: 0.0
                    timestamp: "2025-10-09T20:40:00Z"
                    digits: 3
                    source: "Yahoo Finance (DX-Y.NYB)"
                    note: "Real DXY from Yahoo Finance - broker doesn't provide DXY"
                vixIndex:
                  summary: VIX Index (Yahoo Finance)
                  value:
                    symbol: "VIX"
                    bid: 18.45
                    ask: 18.45
                    mid: 18.45
                    spread: 0.0
                    timestamp: "2025-10-09T20:40:00Z"
                    digits: 2
                    source: "Yahoo Finance (^VIX)"
                    note: "Real VIX from Yahoo Finance - broker doesn't provide VIX"
        '503':
          description: Service temporarily unavailable (indices only)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ENHANCED ANALYSIS ENDPOINTS (8 operations)
  /api/v1/multi_timeframe/{symbol}:
    get:
      operationId: getMultiTimeframeAnalysis
      summary: Get Advanced-enhanced multi-timeframe analysis (H4‚ÜíH1‚ÜíM30‚ÜíM15‚ÜíM5)
      description: MTF analysis with Advanced institutional indicators. Returns H4‚ÜíH1‚ÜíM30‚ÜíM15‚ÜíM5 + Advanced confidence adjustments (¬±20pts), RMAG stretch, EMA slope, momentum quality, MTF alignment, market structure. Score auto-adjusted by Advanced features.
      tags:
        - Market Analysis
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: "XAUUSD"
          description: Trading symbol (will auto-add 'c' suffix for broker)
      responses:
        '200':
          description: Multi-timeframe analysis with alignment score
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MultiTimeframeAnalysis'
              examples:
                strongBuySetup:
                  summary: Strong Buy Setup (Alignment 85%)
                  value:
                    symbol: "XAUUSDc"
                    timeframes:
                      H4:
                        bias: "BULLISH"
                        confidence: 85
                        reason: "Strong uptrend, price above all EMAs, ADX 35"
                      H1:
                        status: "CONTINUATION"
                        confidence: 80
                        reason: "Momentum intact, no divergence"
                      M30:
                        setup: "BUY_SETUP"
                        confidence: 75
                        reason: "Higher low confirmed, bullish structure"
                      M15:
                        trigger: "BUY_TRIGGER"
                        confidence: 85
                        reason: "Bullish engulfing at support, RSI bounce from 35"
                      M5:
                        execution: "BUY_NOW"
                        confidence: 90
                        reason: "Price bouncing off EMA20, momentum building"
                        entry_price: 3940.800
                        stop_loss: 3938.500
                    alignment_score: 85
                    recommendation:
                      action: "BUY"
                      confidence: 85
                      reason: "All timeframes aligned bullish. H4 trend + M15 trigger + M5 execution. | Advanced Analysis: ‚úÖ Quality Uptrend | ‚úÖ MTF Aligned (2/3)"
                      summary: "STRONG BUY - Execute immediately at 3940.800, SL 3938.500"
                      market_bias:
                        trend: "BULLISH"
                        strength: "STRONG"
                        stability: "STABLE"
                        confidence: 85
                      trade_opportunities:
                        type: "TREND_CONTINUATION"
                        direction: "BUY"
                        risk_level: "LOW"
                        risk_adjustments:
                          sl_multiplier: 1.0
                          tp_multiplier: 1.0
                          max_risk_rr: 2.5
                        counter_trend_warning: null
                      volatility_regime: "medium"
                      volatility_weights:
                        H4: 0.40
                        H1: 0.25
                        M30: 0.15
                        M15: 0.10
                        M5: 0.10
                    advanced_insights:
                      rmag_analysis:
                        status: "NORMAL"
                        ema200_stretch: 1.2
                        confidence_adjustment: 0
                      ema_slope_quality:
                        quality: "QUALITY_UPTREND"
                        ema50_slope: 0.18
                        confidence_adjustment: 10
                      mtf_alignment:
                        status: "STRONG_ALIGNMENT"
                        total: 2
                        confidence_adjustment: 10
                    advanced_summary: "Advanced Analysis: ‚úÖ Quality Uptrend | ‚úÖ MTF Aligned (2/3)"
                    timestamp: "2025-10-07T12:00:00Z"

  /api/v1/confluence/{symbol}:
    get:
      operationId: getConfluenceScore
      summary: Get multi-timeframe confluence score
      description: Calculate confluence score (0-100) analyzing 5 factors across all timeframes (trend alignment, momentum, structure, volatility, volume). Returns grade A-F and detailed factor breakdown.
      tags:
        - Market Analysis
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: "XAUUSD"
          description: Trading symbol (will auto-add 'c' suffix for broker)
      responses:
        '200':
          description: Confluence analysis with score and grade
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfluenceAnalysis'
              examples:
                excellentSetup:
                  summary: Excellent Setup (Grade A)
                  value:
                    symbol: "XAUUSDc"
                    confluence_score: 88
                    grade: "A"
                    recommendation: "EXCELLENT - Strong confluence across all timeframes. High-probability setup."
                    factors:
                      trend_alignment:
                        score: 95
                        description: "All timeframes aligned bullish"
                      momentum_alignment:
                        score: 85
                        description: "Strong momentum on M15, M30, H1"
                    timestamp: "2025-10-07T12:00:00Z"

  /api/v1/features/advanced/{symbol}:
    get:
      operationId: getAdvancedFeatures
      summary: Get Advanced Technical Features
      description: "Returns 11 institutional indicators + candlestick patterns with pattern strength & wick metrics. Patterns are tracked (CONFIRMED/INVALIDATED) and strength contributes 5% to bias confidence. Use for confidence adjustments and pattern-based scalping strategies."
      tags:
        - Market Analysis
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: "XAUUSD"
          description: Trading symbol (will auto-add 'c' suffix for broker)
      responses:
        '200':
          description: Advanced technical features
          content:
            application/json:
              schema:
                type: object
                properties:
                  symbol:
                    type: string
                    example: "XAUUSD"
                  timestamp:
                    type: string
                    format: date-time
                  features:
                    type: object
                    properties:
                      M5:
                        $ref: '#/components/schemas/AdvancedTimeframeFeatures'
                      M15:
                        $ref: '#/components/schemas/AdvancedTimeframeFeatures'
                      H1:
                        $ref: '#/components/schemas/AdvancedTimeframeFeatures'
                      mtf_score:
                        type: object
                        properties:
                          m5:
                            type: integer
                            description: "M5 alignment (0 or 1)"
                          m15:
                            type: integer
                            description: "M15 alignment (0 or 1)"
                          h1:
                            type: integer
                            description: "H1 alignment (0 or 1)"
                          total:
                            type: integer
                            description: "Total aligned timeframes (0-3)"
                          max:
                            type: integer
                            example: 3
                      vp:
                        type: object
                        description: "Volume Profile HVN/LVN"
                        properties:
                          hvn_dist_atr:
                            type: number
                            description: "Distance to nearest HVN in ATR"
                          lvn_dist_atr:
                            type: number
                            description: "Distance to nearest LVN in ATR"
              examples:
                strongSetup:
                  summary: Strong Setup with Advanced Confluence
                  value:
                    symbol: "XAUUSD"
                    timestamp: "2025-10-11T12:00:00Z"
                    features:
                      M5:
                        rmag:
                          ema200_atr: 1.2
                          vwap_atr: 0.8
                        ema_slope:
                          ema50: 0.18
                          ema200: 0.07
                        vol_trend:
                          bb_width: 1.5
                          adx: 32
                          state: "expansion_strong_trend"
                        pressure:
                          ratio: 2.1
                          rsi: 62
                          adx: 32
                        candle_profile:
                          - idx: -1
                            body_atr: 0.85
                            w2b: 0.8
                            type: "conviction"
                        liquidity:
                          pdl_dist_atr: 1.5
                          pdh_dist_atr: 0.8
                          equal_highs: false
                          equal_lows: false
                          pdh: 4018.50
                          pdl: 3985.20
                        fvg:
                          type: "bull"
                          dist_to_fill_atr: 0.5
                        vwap:
                          dev_atr: 0.6
                          zone: "mid"
                        accel:
                          macd_slope: 0.05
                          rsi_slope: 3.2
                      mtf_score:
                        m5: 1
                        m15: 1
                        h1: 1
                        total: 3
                        max: 3
                      vp:
                        hvn_dist_atr: 0.25
                        lvn_dist_atr: 1.8
                stretchedPrice:
                  summary: Stretched Price (Mean Reversion Expected)
                  value:
                    symbol: "XAUUSD"
                    timestamp: "2025-10-11T12:00:00Z"
                    features:
                      M5:
                        rmag:
                          ema200_atr: 2.8
                          vwap_atr: 2.1
                        ema_slope:
                          ema50: 0.12
                          ema200: 0.04
                        vol_trend:
                          bb_width: 2.3
                          adx: 18
                          state: "expansion_weak_trend"
                        pressure:
                          ratio: 3.8
                          rsi: 68
                          adx: 18
                        vwap:
                          dev_atr: 2.2
                          zone: "outer"
                      mtf_score:
                        m5: 0
                        m15: 1
                        h1: 0
                        total: 1
                        max: 3

  /api/v1/session/current:
    get:
      operationId: getCurrentSession
      summary: Get current trading session with recommendations
      description: Detect current trading session (Asian/London/NY/Overlap) and provide session-specific guidance including volatility expectations, best pairs, and risk adjustments.
      tags:
        - Market Analysis
      responses:
        '200':
          description: Current session analysis with recommendations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionAnalysis'
              examples:
                londonSession:
                  summary: London Session
                  value:
                    name: "London"
                    start_time: "08:00"
                    end_time: "17:00"
                    current_time: "10:30"
                    volatility: "high"
                    strategy: "trend_following"
                    best_pairs: ["EURUSD", "GBPUSD", "EURGBP", "XAUUSD"]
                    recommendations:
                      - "High volatility - use wider stops (1.5x normal)"
                      - "Strong trends - favor trend-following strategies"
                      - "Best for EUR, GBP, and Gold pairs"
                      - "Avoid ranging strategies"
                    risk_adjustments:
                      stop_loss_multiplier: 1.5
                      position_size_multiplier: 0.8
                      confidence_adjustment: 10
                    is_good_time_to_trade: true
                    optimal_symbols: ["EURUSDc", "GBPUSDc", "XAUUSDc"]
                    timestamp: "2025-10-07T10:30:00Z"

  /api/v1/recommendation_stats:
    get:
      operationId: getRecommendationStats
      summary: Get historical recommendation performance statistics
      description: Retrieve historical performance stats for ChatGPT recommendations including win rate, average R:R achieved, and best-performing setups. Use this to learn from past trades and adjust confidence levels.
      tags:
        - Performance
      parameters:
        - name: symbol
          in: query
          required: false
          schema:
            type: string
          description: Filter by symbol (e.g., XAUUSDc, BTCUSDc)
          example: "XAUUSDc"
        - name: trade_type
          in: query
          required: false
          schema:
            type: string
            enum: ["SCALP", "PENDING", "SWING"]
          description: Filter by trade type
        - name: timeframe
          in: query
          required: false
          schema:
            type: string
            enum: ["M5", "M15", "M30", "H1", "H4"]
          description: Filter by timeframe
        - name: session
          in: query
          required: false
          schema:
            type: string
            enum: ["Asian", "London", "NY", "London/NY Overlap"]
          description: Filter by trading session
        - name: days_back
          in: query
          required: false
          schema:
            type: integer
            default: 30
            minimum: 1
            maximum: 365
          description: Number of days to look back
      responses:
        '200':
          description: Historical recommendation statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecommendationStats'
              examples:
                goldStats:
                  summary: Gold Trading Stats
                  value:
                    stats:
                      total_recommendations: 45
                      executed_count: 32
                      win_count: 21
                      loss_count: 11
                      win_rate: 65.6
                      avg_rr_planned: 2.1
                      avg_rr_achieved: 1.8
                      total_profit: 1250.50
                      total_loss: -680.25
                      net_profit: 570.25
                    best_setups:
                      - setup_type: "SCALP - London - M5"
                        win_rate: 75.0
                        total_trades: 12
                        avg_rr: 2.0
                    recent_recommendations:
                      - symbol: "XAUUSDc"
                        direction: "BUY"
                        entry_price: 3940.800
                        outcome: "WIN"
                        rr_achieved: 2.1
                        timestamp: "2025-10-06T14:30:00Z"
                    filters:
                      symbol: "XAUUSDc"
                      trade_type: null
                      timeframe: null
                      session: null
                      days_back: 30
                    timestamp: "2025-10-07T12:00:00Z"

  /news/status:
    get:
      operationId: getNewsStatus
      summary: Get news blackout status and upcoming events
      description: Check if currently in news blackout window and get upcoming high-impact events. Blackouts indicate risky trading periods due to major economic releases (NFP, CPI, Fed decisions).
      tags:
        - News & Events
      parameters:
        - name: category
          in: query
          required: false
          schema:
            type: string
            enum: ["macro", "crypto", "both"]
            default: "both"
          description: Event category to check (macro for forex/commodities, crypto for cryptocurrencies)
          example: "macro"
        - name: hours_ahead
          in: query
          required: false
          schema:
            type: integer
            default: 12
            minimum: 1
            maximum: 168
          description: Hours ahead to check for upcoming events
          example: 12
      responses:
        '200':
          description: News status and upcoming events
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsStatus'
              examples:
                duringBlackout:
                  summary: During NFP Blackout
                  value:
                    macro_blackout: true
                    crypto_blackout: false
                    upcoming_macro_events: "14:30 Non-Farm Payrolls (ultra) | 16:00 Fed Minutes (high)"
                    upcoming_crypto_events: ""
                    next_macro_event: "2025-10-06T14:30:00Z"
                    next_crypto_event: null
                    recommendation: "WAIT - Ultra-high impact event in 30 minutes. Avoid trading until 16:00 UTC."
                    risk_level: "CRITICAL"
                clearToTrade:
                  summary: Clear to Trade
                  value:
                    macro_blackout: false
                    crypto_blackout: false
                    upcoming_macro_events: ""
                    upcoming_crypto_events: ""
                    next_macro_event: null
                    next_crypto_event: null
                    recommendation: "CLEAR - No major news events in next 12 hours."
                    risk_level: "LOW"
        '500':
          description: Error loading news data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /strategy/recommendation:
    get:
      operationId: getStrategyRecommendation
      summary: Get trading strategy recommendation based on market conditions
      description: Analyze current market conditions and recommend appropriate trading strategy (London Breakout, News Trading, or general approach) with specific entry/exit criteria.
      tags:
        - News & Events
      parameters:
        - name: symbol
          in: query
          required: false
          schema:
            type: string
            enum: ["EURUSD", "GBPUSD", "USDJPY", "AUDUSD", "USDCAD", "NZDUSD", "EURGBP", "EURJPY", "GBPJPY", "XAUUSD", "BTCUSD"]
          description: Trading symbol to analyze
          example: "EURUSD"
        - name: session
          in: query
          required: false
          schema:
            type: string
            enum: ["london", "new_york", "asian", "all"]
          description: Trading session to analyze
          example: "london"
        - name: news_impact
          in: query
          required: false
          schema:
            type: string
            enum: ["low", "medium", "high", "ultra"]
          description: Expected news impact level
          example: "high"
      responses:
        '200':
          description: Strategy recommendation with specific trading approach
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StrategyRecommendation'
              examples:
                londonBreakout:
                  summary: London Breakout Strategy
                  value:
                    recommended_strategy: "London Breakout Strategy"
                    strategy_document: "LONDON_BREAKOUT_STRATEGY.md"
                    session: "london"
                    current_time: "08:30 UTC"
                    market_conditions:
                      dxy_trend: "stable"
                      smc_structure: "clear"
                      volatility: "moderate"
                    entry_criteria:
                      - "Break above 1.0850 with volume confirmation"
                      - "Wait for pullback to 1.0840-1.0845"
                    risk_management:
                      stop_loss: "Below recent low (1.0820)"
                      take_profit: "Next liquidity pool (1.0880)"
                      risk_reward: "1:2.5"
                    confidence: 8
                    next_analysis: "Monitor for 2 hours until 10:00 UTC"
                newsTrading:
                  summary: News Trading Strategy
                  value:
                    recommended_strategy: "News Trading Strategy"
                    strategy_document: "NEWS_TRADING_STRATEGY.md"
                    upcoming_event: "NFP in 2 hours"
                    sentiment: "BULLISH"
                    risk_level: "HIGH"
                    entry_criteria:
                      - "Wait for pullback after initial spike"
                      - "Enter LONG on retest of 1.0830-1.0840"
                    risk_management:
                      stop_loss: "Below 1.0800"
                      take_profit: "Target 1.0900+"
                      risk_reward: "1:3"
                    confidence: 7
                    next_analysis: "Monitor news sentiment and market reaction"
        '500':
          description: Error generating strategy recommendation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /news/events:
    get:
      operationId: getNewsEvents
      summary: Get list of upcoming news events
      description: Get detailed list of upcoming economic events with impact levels and timing for trade planning.
      tags:
        - News & Events
      parameters:
        - name: category
          in: query
          required: false
          schema:
            type: string
            enum: ["macro", "crypto"]
          description: Filter by event category
        - name: impact
          in: query
          required: false
          schema:
            type: string
            enum: ["low", "medium", "high", "ultra", "crypto"]
          description: Filter by minimum impact level
        - name: hours_ahead
          in: query
          required: false
          schema:
            type: integer
            default: 24
            minimum: 1
            maximum: 168
          description: Hours ahead to retrieve events
        - name: hours_behind
          in: query
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
            maximum: 24
          description: Hours behind to retrieve past events
      responses:
        '200':
          description: List of news events
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsEventsList'
              examples:
                upcomingEvents:
                  summary: Upcoming High-Impact Events
                  value:
                    events:
                      - time: "2025-10-06T14:30:00Z"
                        description: "Non-Farm Payrolls"
                        impact: "ultra"
                        category: "macro"
                        symbols: ["USD"]
                        time_until: "2 hours 15 minutes"
                        in_blackout: true
                      - time: "2025-10-06T16:00:00Z"
                        description: "Fed Minutes"
                        impact: "high"
                        category: "macro"
                        symbols: ["USD"]
                        time_until: "3 hours 45 minutes"
                        in_blackout: false
                    total_events: 2
                    high_impact_count: 2
                    blackout_active: true

  /ai/exits/{symbol}:
    get:
      operationId: getIntelligentExits
      summary: Get intelligent exit strategy analysis
      description: Get AI-powered exit strategy recommendations for a symbol
      tags:
        - AI Analysis
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: "BTCUSD"
      responses:
        '200':
          description: Intelligent exit analysis
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IntelligentExitAnalysis'

  /sentiment/market:
    get:
      operationId: getMarketSentiment
      summary: Get market sentiment analysis
      description: Get current market sentiment including Fear & Greed Index and trading implications
      tags:
        - Market Analysis
      responses:
        '200':
          description: Market sentiment data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MarketSentiment'

  # SYSTEM ENDPOINTS (3 operations)
  /health:
    get:
      operationId: healthCheck
      summary: System health check
      description: Check overall system health including MT5, Telegram, and database connections
      tags:
        - System
      responses:
        '200':
          description: System health status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
        '500':
          description: System error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /telegram/webhook:
    post:
      operationId: telegramWebhook
      summary: Telegram webhook endpoint
      description: Receives updates from Telegram bot including button clicks and commands
      tags:
        - Telegram
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelegramUpdate'
      responses:
        '200':
          description: Webhook processed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean

  /performance/report:
    get:
      operationId: getPerformanceReport
      summary: Get trading performance report
      description: Retrieve comprehensive trading performance statistics
      tags:
        - Performance
      responses:
        '200':
          description: Performance report data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PerformanceReport'

  /auto-execution/effectiveness:
    get:
      operationId: getPlanEffectiveness
      summary: Get auto-execution plan effectiveness report
      description: Get auto-execution plan effectiveness stats - win rates by strategy/symbol, profit factor, best/worst trades.
      tags:
        - Performance
      parameters:
        - name: days
          in: query
          required: false
          schema:
            type: integer
            default: 30
          description: Number of days to look back (default 30)
      responses:
        '200':
          description: Plan effectiveness report
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  report:
                    type: object
                    properties:
                      period_days:
                        type: integer
                      total_plans:
                        type: integer
                      open_trades:
                        type: integer
                      closed_trades:
                        type: integer
                      overall:
                        type: object
                        properties:
                          wins:
                            type: integer
                          losses:
                            type: integer
                          win_rate:
                            type: number
                          total_profit:
                            type: number
                          profit_factor:
                            type: number
                      by_strategy:
                        type: object
                        description: Performance breakdown by strategy_type
                      by_symbol:
                        type: object
                        description: Performance breakdown by symbol

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Bearer token for authentication (use phone token for /dispatch, API key as bearer for other endpoints)

  schemas:
    TradeSignal:
      type: object
      required:
        - symbol
        - timeframe
        - direction
        - entry_price
        - stop_loss
        - take_profit
      properties:
        symbol:
          type: string
          description: Trading symbol (e.g., BTCUSD, XAUUSD)
          example: "XAUUSD"
        timeframe:
          type: string
          enum: ["M1", "M5", "M15", "M30", "H1", "H4", "D1"]
          description: Chart timeframe
          example: "H4"
        direction:
          type: string
          enum: ["buy", "sell"]
          description: Trade direction
        order_type:
          type: string
          enum: ["market", "buy_limit", "sell_limit", "buy_stop", "sell_stop"]
          description: Order type for execution
          example: "market"
        entry_price:
          type: number
          description: Entry price level
          example: 2421.5
        stop_loss:
          type: number
          description: Stop loss price level
          example: 2414.0
        take_profit:
          type: number
          description: Take profit price level
          example: 2436.0
        confidence:
          type: integer
          minimum: 0
          maximum: 100
          description: Confidence level (0-100%)
          example: 80
        reasoning:
          type: string
          description: Trading rationale and analysis
          example: "EMA20>EMA50, ADX rising, bullish rejection at key support"
        screenshot_url:
          type: string
          format: uri
          description: Optional URL of analyzed chart screenshot
          nullable: true

    ExecutionResponse:
      type: object
      properties:
        ok:
          type: boolean
        order_id:
          type: integer
          description: MT5 order ID
        deal_id:
          type: integer
          description: MT5 deal ID
        retcode:
          type: integer
          description: MT5 return code
        comment:
          type: string
          description: Execution comment

    AccountInfo:
      type: object
      properties:
        login:
          type: integer
          description: MT5 account login number
        balance:
          type: number
          description: Account balance
        equity:
          type: number
          description: Account equity (balance + floating P/L)
        profit:
          type: number
          description: Current floating profit/loss
        margin:
          type: number
          description: Used margin
        free_margin:
          type: number
          description: Free margin available for trading
        currency:
          type: string
          description: Account currency
          example: "USD"

    BracketTradeResponse:
      type: object
      properties:
        ok:
          type: boolean
        oco_group_id:
          type: string
          description: Unique identifier for this OCO pair
        buy_order:
          type: object
          properties:
            ticket:
              type: integer
              description: MT5 ticket number for BUY order
            entry:
              type: number
            sl:
              type: number
            tp:
              type: number
        sell_order:
          type: object
          properties:
            ticket:
              type: integer
              description: MT5 ticket number for SELL order
            entry:
              type: number
            sl:
              type: number
            tp:
              type: number
        message:
          type: string
          example: "Bracket trade created with OCO monitoring"

    HealthStatus:
      type: object
      properties:
        ok:
          type: boolean
        timestamp:
          type: string
          format: date-time
        components:
          type: object
          properties:
            mt5_connection:
              type: string
              enum: ["healthy", "warning", "critical"]
            telegram_api:
              type: string
              enum: ["healthy", "warning", "critical"]
            database:
              type: string
              enum: ["healthy", "warning", "critical"]
            system_resources:
              type: string
              enum: ["healthy", "warning", "critical"]

    TelegramUpdate:
      type: object
      description: Telegram webhook update object
      properties:
        update_id:
          type: integer
        message:
          type: object
          description: Incoming message
        callback_query:
          type: object
          description: Callback query from inline keyboard

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        detail:
          type: string
        timestamp:
          type: string
          format: date-time

    MultiTimeframeAnalysis:
      type: object
      properties:
        symbol:
          type: string
        timeframes:
          type: object
          properties:
            H4:
              type: object
              properties:
                bias:
                  type: string
                  enum: ["BULLISH", "BEARISH", "NEUTRAL"]
                  description: Overall macro trend direction
                confidence:
                  type: integer
                  minimum: 0
                  maximum: 100
                reason:
                  type: string
            H1:
              type: object
              properties:
                status:
                  type: string
                  enum: ["CONTINUATION", "PULLBACK", "DIVERGENCE", "REVERSAL"]
                  description: Swing context / momentum status
                confidence:
                  type: integer
                  minimum: 0
                  maximum: 100
                reason:
                  type: string
            M30:
              type: object
              properties:
                setup:
                  type: string
                  enum: ["BUY_SETUP", "SELL_SETUP", "WAIT"]
                  description: Structure validation
                confidence:
                  type: integer
                  minimum: 0
                  maximum: 100
                reason:
                  type: string
            M15:
              type: object
              properties:
                trigger:
                  type: string
                  enum: ["BUY_TRIGGER", "SELL_TRIGGER", "WAIT"]
                  description: Entry signal confirmation
                confidence:
                  type: integer
                  minimum: 0
                  maximum: 100
                reason:
                  type: string
            M5:
              type: object
              properties:
                execution:
                  type: string
                  enum: ["BUY_NOW", "SELL_NOW", "WAIT"]
                  description: Precise execution timing
                confidence:
                  type: integer
                  minimum: 0
                  maximum: 100
                reason:
                  type: string
                entry_price:
                  type: number
                  nullable: true
                  description: Exact entry price (if execution signal present)
                stop_loss:
                  type: number
                  nullable: true
                  description: Exact stop loss (if execution signal present)
        alignment_score:
          type: integer
          minimum: 0
          maximum: 100
          description: Overall timeframe alignment score (0-100)
        recommendation:
          type: object
          properties:
            action:
              type: string
              enum: ["BUY", "SELL", "WAIT"]
              description: Recommended action
            confidence:
              type: integer
              minimum: 0
              maximum: 100
              description: Confidence in recommendation
            reason:
              type: string
              description: Reasoning for recommendation
            summary:
              type: string
              description: One-line summary
            market_bias:
              type: object
              description: Hierarchical primary trend determination (H4 + H1 based)
              properties:
                trend:
                  type: string
                  enum: ["BULLISH", "BEARISH", "NEUTRAL"]
                  description: Primary market trend direction
                strength:
                  type: string
                  enum: ["STRONG", "MODERATE", "WEAK"]
                  description: Trend strength based on H4/H1 alignment
                stability:
                  type: string
                  enum: ["STABLE", "UNSTABLE", "INSUFFICIENT_DATA"]
                  description: Trend stability from memory buffer (3-bar rolling)
                confidence:
                  type: integer
                  minimum: 0
                  maximum: 100
                  description: Confidence in primary trend assessment
            trade_opportunities:
              type: object
              description: Detected trade opportunities with risk adjustments
              properties:
                type:
                  type: string
                  enum: ["TREND_CONTINUATION", "COUNTER_TREND", "NONE"]
                  description: Type of trade opportunity detected
                direction:
                  type: string
                  enum: ["BUY", "SELL", "NONE"]
                  description: Trade direction for the opportunity
                risk_level:
                  type: string
                  enum: ["HIGH", "MEDIUM", "LOW"]
                  description: Risk level (HIGH for counter-trend, LOW for continuation)
                risk_adjustments:
                  type: object
                  description: Dynamic risk adjustments for counter-trend trades
                  properties:
                    sl_multiplier:
                      type: number
                      description: Stop loss multiplier (wider for counter-trend)
                    tp_multiplier:
                      type: number
                      description: Take profit multiplier (reduced for counter-trend)
                    max_risk_rr:
                      type: number
                      description: Maximum risk:reward ratio allowed
                counter_trend_warning:
                  type: string
                  nullable: true
                  description: Warning message for counter-trend trades
            volatility_regime:
              type: string
              enum: ["low", "medium", "high"]
              description: Current volatility regime (affects timeframe weights)
            volatility_weights:
              type: object
              description: Dynamic timeframe weights based on volatility regime
              properties:
                H4:
                  type: number
                  description: H4 weight (higher in high volatility)
                H1:
                  type: number
                  description: H1 weight
                M30:
                  type: number
                  description: M30 weight
                M15:
                  type: number
                  description: M15 weight (lower in high volatility)
                M5:
                  type: number
                  description: M5 weight (lower in high volatility)
        timestamp:
          type: string
          format: date-time

    ConfluenceAnalysis:
      type: object
      properties:
        symbol:
          type: string
        confluence_score:
          type: integer
          minimum: 0
          maximum: 100
          description: Overall confluence score (0-100)
        grade:
          type: string
          enum: ["A", "B", "C", "D", "F"]
          description: Letter grade (A=85+, B=70-84, C=55-69, D=40-54, F=<40)
        recommendation:
          type: string
          description: Trading recommendation based on confluence
        factors:
          type: object
          properties:
            trend_alignment:
              type: object
              properties:
                score:
                  type: integer
                  minimum: 0
                  maximum: 100
                description:
                  type: string
            momentum_alignment:
              type: object
              properties:
                score:
                  type: integer
                  minimum: 0
                  maximum: 100
                description:
                  type: string
            structure_quality:
              type: object
              properties:
                score:
                  type: integer
                  minimum: 0
                  maximum: 100
                description:
                  type: string
            volatility_alignment:
              type: object
              properties:
                score:
                  type: integer
                  minimum: 0
                  maximum: 100
                description:
                  type: string
            volume_confirmation:
              type: object
              properties:
                score:
                  type: integer
                  minimum: 0
                  maximum: 100
                description:
                  type: string
        timestamp:
          type: string
          format: date-time

    SessionAnalysis:
      type: object
      properties:
        name:
          type: string
          enum: ["Asian", "London", "NY", "London/NY Overlap"]
          description: Current trading session name
        start_time:
          type: string
          description: Session start time (UTC)
        end_time:
          type: string
          description: Session end time (UTC)
        current_time:
          type: string
          description: Current time (UTC)
        volatility:
          type: string
          enum: ["low", "medium", "high", "very_high"]
          description: Expected volatility level for this session
        strategy:
          type: string
          enum: ["range_trading", "trend_following", "breakout", "scalping"]
          description: Recommended strategy for this session
        best_pairs:
          type: array
          items:
            type: string
          description: Best currency pairs for this session
        recommendations:
          type: array
          items:
            type: string
          description: Session-specific trading recommendations
        risk_adjustments:
          type: object
          properties:
            stop_loss_multiplier:
              type: number
              description: Multiplier for stop loss distances (e.g., 1.5 = 50% wider)
            position_size_multiplier:
              type: number
              description: Multiplier for position sizing (e.g., 0.8 = 20% smaller)
            confidence_adjustment:
              type: integer
              description: Adjustment to confidence scores (+/- percentage points)
        is_good_time_to_trade:
          type: boolean
          description: Whether current session is good for trading
        optimal_symbols:
          type: array
          items:
            type: string
          description: Optimal symbols to trade during this session
        timestamp:
          type: string
          format: date-time

    AdvancedTimeframeFeatures:
      type: object
      description: "Advanced Technical Features for a single timeframe"
      properties:
        rmag:
          type: object
          description: "Relative Moving Average Gap - Price stretch from EMAs/VWAP"
          properties:
            ema200_atr:
              type: number
              description: "Distance from EMA200 in ATR units (>2.0 = stretched)"
            vwap_atr:
              type: number
              description: "Distance from VWAP in ATR units (>1.8 = stretched)"
        ema_slope:
          type: object
          description: "EMA Slope Strength - Trend quality measurement"
          properties:
            ema50:
              type: number
              description: "EMA50 slope (>0.15 = strong up, <-0.15 = strong down)"
            ema200:
              type: number
              description: "EMA200 slope (>0.05 = uptrend, <-0.05 = downtrend)"
        vol_trend:
          type: object
          description: "Bollinger-ADX Fusion - Volatility state analysis"
          properties:
            bb_width:
              type: number
              description: "Bollinger Band width in ATR units"
            adx:
              type: number
              description: "ADX value (>25 = trending, <20 = ranging)"
            state:
              type: string
              enum: ["squeeze_no_trend", "squeeze_with_trend", "expansion_strong_trend", "expansion_weak_trend"]
              description: "Volatility-trend regime"
        pressure:
          type: object
          description: "RSI-ADX Pressure Ratio - Momentum quality detection"
          properties:
            ratio:
              type: number
              description: "RSI/ADX ratio (>3.0 with ADX<20 = fake momentum)"
            rsi:
              type: number
              description: "Current RSI value"
            adx:
              type: number
              description: "Current ADX value"
        candle_profile:
          type: array
          description: "Candle Body-Wick Profile - Last 3 candles analysis"
          items:
            type: object
            properties:
              idx:
                type: integer
                description: "Candle index (-1 = last, -2 = second-to-last, etc.)"
              body_atr:
                type: number
                description: "Candle body size in ATR units"
              w2b:
                type: number
                description: "Wick-to-body ratio (>2.0 = rejection)"
              type:
                type: string
                enum: ["conviction", "rejection_up", "rejection_down", "indecision"]
                description: "Candle pattern type"
        liquidity:
          type: object
          description: "Liquidity Targets - Key levels analysis"
          properties:
            pdl_dist_atr:
              type: number
              description: "Distance to Previous Day Low in ATR"
            pdh_dist_atr:
              type: number
              description: "Distance to Previous Day High in ATR"
            equal_highs:
              type: boolean
              description: "Equal highs detected (liquidity grab risk)"
            equal_lows:
              type: boolean
              description: "Equal lows detected (liquidity grab risk)"
            pdh:
              type: number
              description: "Previous Day High price"
            pdl:
              type: number
              description: "Previous Day Low price"
        fvg:
          type: object
          description: "Fair Value Gaps - Imbalance zones"
          nullable: true
          properties:
            type:
              type: string
              enum: ["bull", "bear"]
              description: "FVG type (bull = gap below, bear = gap above)"
            dist_to_fill_atr:
              type: number
              description: "Distance to fill the gap in ATR (<1.0 = nearby)"
        vwap:
          type: object
          description: "VWAP Deviation Zones - Mean reversion context"
          properties:
            dev_atr:
              type: number
              description: "VWAP deviation in ATR units"
            zone:
              type: string
              enum: ["inside", "mid", "outer"]
              description: "Deviation zone (outer = mean reversion likely)"
        accel:
          type: object
          description: "Momentum Acceleration - MACD/RSI velocity"
          properties:
            macd_slope:
              type: number
              description: "MACD slope (>0.03 = accelerating up, <-0.02 = fading)"
            rsi_slope:
              type: number
              description: "RSI slope (>2.0 = strengthening, <-2.0 = weakening)"
        candlestick_flags:
          type: object
          description: "Single-bar candlestick pattern detection"
          properties:
            marubozu_bull:
              type: boolean
              description: "Bullish Marubozu - strong bullish candle with minimal wicks (momentum)"
            marubozu_bear:
              type: boolean
              description: "Bearish Marubozu - strong bearish candle with minimal wicks (momentum)"
            doji:
              type: boolean
              description: "Doji - small body, large wicks (indecision, potential reversal)"
            hammer:
              type: boolean
              description: "Hammer - long lower wick, small body near high (bullish reversal)"
            shooting_star:
              type: boolean
              description: "Shooting Star - long upper wick, small body near low (bearish reversal)"
            pin_bar_bull:
              type: boolean
              description: "Bullish Pin Bar - long lower wick, rejection at support"
            pin_bar_bear:
              type: boolean
              description: "Bearish Pin Bar - long upper wick, rejection at resistance"
        pattern_flags:
          type: object
          description: "Multi-bar candlestick pattern detection"
          properties:
            bull_engulfing:
              type: boolean
              description: "Bullish Engulfing - current bullish candle fully engulfs previous bearish (strong reversal)"
            bear_engulfing:
              type: boolean
              description: "Bearish Engulfing - current bearish candle fully engulfs previous bullish (strong reversal)"
            inside_bar:
              type: boolean
              description: "Inside Bar - current candle inside previous range (consolidation, breakout pending)"
            outside_bar:
              type: boolean
              description: "Outside Bar - current candle engulfs previous range (volatility expansion)"
            breakout_bar:
              type: boolean
              description: "Breakout Bar - range expansion candle (1.5x recent range)"
            morning_star:
              type: boolean
              description: "Morning Star - 3-bar bullish reversal pattern (bearish ‚Üí small body ‚Üí bullish)"
            evening_star:
              type: boolean
              description: "Evening Star - 3-bar bearish reversal pattern (bullish ‚Üí small body ‚Üí bearish)"
            three_white_soldiers:
              type: boolean
              description: "Three White Soldiers - 3 consecutive strong bullish candles (continuation)"
            three_black_crows:
              type: boolean
              description: "Three Black Crows - 3 consecutive strong bearish candles (continuation)"
        wick_metrics:
          type: object
          description: "Wick analysis metrics for pattern confirmation"
          properties:
            upper_wick_pct:
              type: number
              description: "Upper wick as percentage of total range (0-1)"
            lower_wick_pct:
              type: number
              description: "Lower wick as percentage of total range (0-1)"
            body_pct:
              type: number
              description: "Body as percentage of total range (0-1)"
            wick_asymmetry:
              type: number
              description: "Wick asymmetry index (-1 to 1, negative = lower wick dominant, positive = upper wick dominant)"
            upper_wick_atr:
              type: number
              description: "Upper wick size in ATR units"
            lower_wick_atr:
              type: number
              description: "Lower wick size in ATR units"
        pattern_strength:
          type: number
          description: "Overall pattern strength score (0.0-1.0, higher = stronger pattern)"
          minimum: 0.0
          maximum: 1.0

    RecommendationStats:
      type: object
      properties:
        stats:
          type: object
          properties:
            total_recommendations:
              type: integer
              description: Total number of recommendations tracked
            executed_count:
              type: integer
              description: Number of recommendations that were executed
            win_count:
              type: integer
              description: Number of winning trades
            loss_count:
              type: integer
              description: Number of losing trades
            win_rate:
              type: number
              description: Win rate percentage
            avg_rr_planned:
              type: number
              description: Average planned risk:reward ratio
            avg_rr_achieved:
              type: number
              description: Average achieved risk:reward ratio
            total_profit:
              type: number
              description: Total profit from winning trades
            total_loss:
              type: number
              description: Total loss from losing trades
            net_profit:
              type: number
              description: Net profit (total_profit + total_loss)
        best_setups:
          type: array
          items:
            type: object
            properties:
              setup_type:
                type: string
                description: Setup type (e.g., "SCALP - London - M5")
              win_rate:
                type: number
                description: Win rate for this setup type
              total_trades:
                type: integer
                description: Number of trades for this setup
              avg_rr:
                type: number
                description: Average R:R for this setup
        recent_recommendations:
          type: array
          items:
            type: object
            properties:
              symbol:
                type: string
              direction:
                type: string
                enum: ["BUY", "SELL"]
              entry_price:
                type: number
              outcome:
                type: string
                enum: ["WIN", "LOSS", "PENDING"]
              rr_achieved:
                type: number
              timestamp:
                type: string
                format: date-time
        filters:
          type: object
          description: Applied filters
        timestamp:
          type: string
          format: date-time

    NewsStatus:
      type: object
      properties:
        macro_blackout:
          type: boolean
          description: Whether currently in macro news blackout window
        crypto_blackout:
          type: boolean
          description: Whether currently in crypto news blackout window
        upcoming_macro_events:
          type: string
          description: Summary of upcoming macro events (next N hours)
          example: "14:30 Non-Farm Payrolls (ultra) | 16:00 Fed Minutes (high)"
        upcoming_crypto_events:
          type: string
          description: Summary of upcoming crypto events (next N hours)
          example: "10:30 Bitcoin ETF Decision (crypto)"
        next_macro_event:
          type: string
          format: date-time
          nullable: true
          description: Timestamp of next macro event
        next_crypto_event:
          type: string
          format: date-time
          nullable: true
          description: Timestamp of next crypto event
        recommendation:
          type: string
          description: Trading recommendation based on news status
          example: "WAIT - Ultra-high impact event in 30 minutes. Avoid trading until 16:00 UTC."
        risk_level:
          type: string
          enum: ["LOW", "MEDIUM", "HIGH", "CRITICAL"]
          description: Current risk level based on news events
        timestamp:
          type: string
          format: date-time
          description: Current server time

    NewsEventsList:
      type: object
      properties:
        events:
          type: array
          items:
            $ref: '#/components/schemas/NewsEvent'
        total_events:
          type: integer
          description: Total number of events returned
        high_impact_count:
          type: integer
          description: Number of high/ultra/crypto impact events
        blackout_active:
          type: boolean
          description: Whether any blackout is currently active
        timestamp:
          type: string
          format: date-time

    NewsEvent:
      type: object
      properties:
        time:
          type: string
          format: date-time
          description: Event time (UTC)
        description:
          type: string
          description: Event description
          example: "Non-Farm Payrolls"
        impact:
          type: string
          enum: ["low", "medium", "high", "ultra", "crypto"]
          description: Impact level
        category:
          type: string
          enum: ["macro", "crypto"]
          description: Event category
        symbols:
          type: array
          items:
            type: string
          description: Affected currency codes or "ALL"
          example: ["USD"]
        time_until:
          type: string
          description: Human-readable time until event
          example: "2 hours 15 minutes"
        in_blackout:
          type: boolean
          description: Whether currently in blackout window for this event
        sentiment:
          type: string
          enum: ["BULLISH", "BEARISH", "NEUTRAL"]
          description: Market sentiment analysis for this event
        trading_implication:
          type: string
          description: Trading implication and market impact
        risk_level:
          type: string
          enum: ["LOW", "MEDIUM", "HIGH", "ULTRA_HIGH"]
          description: Risk level for this event
        enhanced_at:
          type: string
          format: date-time
          description: When sentiment analysis was last updated

    StrategyRecommendation:
      type: object
      properties:
        recommended_strategy:
          type: string
          enum: ["London Breakout Strategy", "News Trading Strategy", "General Trading"]
          description: Recommended trading strategy
        strategy_document:
          type: string
          description: Reference to strategy knowledge document
          example: "LONDON_BREAKOUT_STRATEGY.md"
        session:
          type: string
          enum: ["london", "new_york", "asian", "all"]
          description: Trading session
        current_time:
          type: string
          format: date-time
          description: Current time for context
        market_conditions:
          type: object
          properties:
            dxy_trend:
              type: string
              enum: ["bullish", "bearish", "stable"]
              description: DXY trend analysis
            smc_structure:
              type: string
              enum: ["clear", "mixed", "unclear"]
              description: SMC structure clarity
            volatility:
              type: string
              enum: ["low", "moderate", "high", "extreme"]
              description: Current volatility level
        upcoming_event:
          type: string
          description: Upcoming news event (if applicable)
        sentiment:
          type: string
          enum: ["BULLISH", "BEARISH", "NEUTRAL"]
          description: Market sentiment
        risk_level:
          type: string
          enum: ["LOW", "MEDIUM", "HIGH", "ULTRA_HIGH"]
          description: Risk level assessment
        entry_criteria:
          type: array
          items:
            type: string
          description: Specific entry criteria
        risk_management:
          type: object
          properties:
            stop_loss:
              type: string
              description: Stop loss level
            take_profit:
              type: string
              description: Take profit level
            risk_reward:
              type: string
              description: Risk to reward ratio
        confidence:
          type: integer
          minimum: 1
          maximum: 10
          description: Confidence level (1-10)
        next_analysis:
          type: string
          description: When to perform next analysis

    IntelligentExitAnalysis:
      type: object
      properties:
        symbol:
          type: string
        timestamp:
          type: string
          format: date-time
        exit_signals:
          type: array
          items:
            type: object
            properties:
              strategy:
                type: string
                enum: ["TRAILING_STOP", "PARTIAL_PROFIT", "BREAKEVEN", "TIME_EXIT", "VOLATILITY_EXIT", "MOMENTUM_EXIT", "SUPPORT_RESISTANCE_EXIT", "DIVERGENCE_EXIT", "SESSION_EXIT", "RISK_REWARD_EXIT"]
              action:
                type: string
                enum: ["HOLD", "PARTIAL_PROFIT", "BREAKEVEN", "EXIT", "TRAILING_STOP"]
              confidence:
                type: number
                minimum: 0
                maximum: 100
              reason:
                type: string
        best_recommendation:
          type: object
          properties:
            action:
              type: string
            confidence:
              type: number
              minimum: 0
              maximum: 100
            reason:
              type: string
            total_signals:
              type: integer
            all_signals:
              type: array
              items:
                type: string

    MarketSentiment:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        fear_greed_index:
          type: object
          properties:
            value:
              type: integer
              minimum: 0
              maximum: 100
            classification:
              type: string
              enum: ["Extreme Fear", "Fear", "Neutral", "Greed", "Extreme Greed"]
        overall_sentiment:
          type: object
          properties:
            sentiment:
              type: string
              enum: ["EXTREME_FEAR", "FEAR", "NEUTRAL", "GREED", "EXTREME_GREED"]
            description:
              type: string
        trading_implications:
          type: object
          properties:
            bias:
              type: string
              enum: ["BULLISH", "CAUTIOUS_BULLISH", "NEUTRAL", "CAUTIOUS_BEARISH", "BEARISH"]
            strategy:
              type: string
            risk_level:
              type: string
            position_sizing:
              type: string

    PerformanceReport:
      type: object
      properties:
        total_trades:
          type: integer
        winning_trades:
          type: integer
        losing_trades:
          type: integer
        win_rate:
          type: number
          description: Win rate percentage
        profit_factor:
          type: number
        average_win:
          type: number
        average_loss:
          type: number
        max_drawdown:
          type: number
        sharpe_ratio:
          type: number
        calmar_ratio:
          type: number
        equity_curve:
          type: array
          items:
            type: object
            properties:
              timestamp:
                type: string
                format: date-time
              equity:
                type: number

    PhoneControlResponse:
      type: object
      description: Response from desktop agent after executing command
      required:
        - command_id
        - status
        - summary
        - execution_time
      properties:
        command_id:
          type: string
          description: Unique command identifier
          example: "58073c79-5c53-419c-b0a1-ce811fe8923f"
        status:
          type: string
          description: Command status (success, error, timeout)
          enum: [success, error, timeout]
          example: "success"
        summary:
          type: string
          description: Human-readable summary of result
          example: "Command completed successfully"
        data:
          type: object
          description: Tool-specific result data payload
          additionalProperties: true
        error:
          type: string
          description: Error message if status is error or timeout
          nullable: true
          example: null
        execution_time:
          type: number
          description: Command execution time in seconds
          example: 3.16

tags:
  - name: Phone Control
    description: Remote control of desktop trading bot from phone
  - name: System
    description: System health and status endpoints
  - name: Trading
    description: Trade signal and execution endpoints
  - name: Telegram
    description: Telegram bot integration endpoints
  - name: Market Analysis
    description: Market analysis and condition endpoints
  - name: Market Data
    description: Real-time price and market data endpoints
  - name: News & Events
    description: Economic news calendar, blackout detection, event impact analysis, and strategy recommendations
  - name: Performance
    description: Trading performance and analytics endpoints
  - name: AI Analysis
    description: AI-powered analysis including ChatGPT insights and intelligent exit strategies
  - name: Account
    description: MT5 account information and balance endpoints
